var NV=Object.create;var{defineProperty:y9,getPrototypeOf:LV,getOwnPropertyNames:BV}=Object;var PV=Object.prototype.hasOwnProperty;var t$=($,Z,J)=>{J=$!=null?NV(LV($)):{};const Q=Z||!$||!$.__esModule?y9(J,"default",{value:$,enumerable:!0}):J;for(let K of BV($))if(!PV.call(Q,K))y9(Q,K,{get:()=>$[K],enumerable:!0});return Q};var r=($,Z)=>()=>(Z||$((Z={exports:{}}).exports,Z),Z.exports);var FV=($,Z)=>{for(var J in Z)y9($,J,{get:Z[J],enumerable:!0,configurable:!0,set:(Q)=>Z[J]=()=>Q})};var h6=r((wY,CQ)=>{var IV=Number.MAX_SAFE_INTEGER||9007199254740991,kV=["major","premajor","minor","preminor","patch","prepatch","prerelease"];CQ.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:IV,RELEASE_TYPES:kV,SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var y6=r((jY,XQ)=>{var OV=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...$)=>console.error("SEMVER",...$):()=>{};XQ.exports=OV});var e$=r((y7,GQ)=>{var{MAX_SAFE_COMPONENT_LENGTH:f9,MAX_SAFE_BUILD_LENGTH:RV,MAX_LENGTH:_V}=h6(),MV=y6();y7=GQ.exports={};var DV=y7.re=[],AV=y7.safeRe=[],u=y7.src=[],d=y7.t={},EV=0,g9="[a-zA-Z0-9-]",bV=[["\\s",1],["\\d",_V],[g9,RV]],vV=($)=>{for(let[Z,J]of bV)$=$.split(`${Z}*`).join(`${Z}{0,${J}}`).split(`${Z}+`).join(`${Z}{1,${J}}`);return $},J0=($,Z,J)=>{const Q=vV(Z),K=EV++;MV($,K,Z),d[$]=K,u[K]=Z,DV[K]=new RegExp(Z,J?"g":void 0),AV[K]=new RegExp(Q,J?"g":void 0)};J0("NUMERICIDENTIFIER","0|[1-9]\\d*");J0("NUMERICIDENTIFIERLOOSE","\\d+");J0("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${g9}*`);J0("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.`+`(${u[d.NUMERICIDENTIFIER]})\\.`+`(${u[d.NUMERICIDENTIFIER]})`);J0("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.`+`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.`+`(${u[d.NUMERICIDENTIFIERLOOSE]})`);J0("PRERELEASEIDENTIFIER",`(?:${u[d.NUMERICIDENTIFIER]}|${u[d.NONNUMERICIDENTIFIER]})`);J0("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NUMERICIDENTIFIERLOOSE]}|${u[d.NONNUMERICIDENTIFIER]})`);J0("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`);J0("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`);J0("BUILDIDENTIFIER",`${g9}+`);J0("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`);J0("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`);J0("FULL",`^${u[d.FULLPLAIN]}\$`);J0("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`);J0("LOOSE",`^${u[d.LOOSEPLAIN]}\$`);J0("GTLT","((?:<|>)?=?)");J0("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);J0("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`);J0("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})`+`(?:\\.(${u[d.XRANGEIDENTIFIER]})`+`(?:\\.(${u[d.XRANGEIDENTIFIER]})`+`(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?`+")?)?");J0("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})`+`(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})`+`(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})`+`(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?`+")?)?");J0("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}\$`);J0("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}\$`);J0("COERCE",`(^|[^\\d])(\\d{1,${f9}})`+`(?:\\.(\\d{1,${f9}}))?`+`(?:\\.(\\d{1,${f9}}))?`+"(?:$|[^\\d])");J0("COERCERTL",u[d.COERCE],!0);J0("LONETILDE","(?:~>?)");J0("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0);y7.tildeTrimReplace="$1~";J0("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}\$`);J0("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}\$`);J0("LONECARET","(?:\\^)");J0("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0);y7.caretTrimReplace="$1^";J0("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}\$`);J0("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}\$`);J0("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})\$|^\$`);J0("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})\$|^\$`);J0("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0);y7.comparatorTrimReplace="$1$2$3";J0("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})`+"\\s+-\\s+"+`(${u[d.XRANGEPLAIN]})`+"\\s*$");J0("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})`+"\\s+-\\s+"+`(${u[d.XRANGEPLAINLOOSE]})`+"\\s*$");J0("STAR","(<|>)?=?\\s*\\*");J0("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");J0("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var $5=r((CY,NQ)=>{var SV=Object.freeze({loose:!0}),TV=Object.freeze({}),hV=($)=>{if(!$)return TV;if(typeof $!=="object")return SV;return $};NQ.exports=hV});var x9=r((XY,PQ)=>{var LQ=/^[0-9]+$/,BQ=($,Z)=>{const J=LQ.test($),Q=LQ.test(Z);if(J&&Q)$=+$,Z=+Z;return $===Z?0:J&&!Q?-1:Q&&!J?1:$<Z?-1:1},yV=($,Z)=>BQ(Z,$);PQ.exports={compareIdentifiers:BQ,rcompareIdentifiers:yV}});var S0=r((GY,OQ)=>{var Z5=y6(),{MAX_LENGTH:FQ,MAX_SAFE_INTEGER:J5}=h6(),{safeRe:IQ,t:kQ}=e$(),fV=$5(),{compareIdentifiers:$6}=x9();class L7{constructor($,Z){if(Z=fV(Z),$ instanceof L7)if($.loose===!!Z.loose&&$.includePrerelease===!!Z.includePrerelease)return $;else $=$.version;else if(typeof $!=="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof $}".`);if($.length>FQ)throw new TypeError(`version is longer than ${FQ} characters`);Z5("SemVer",$,Z),this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease;const J=$.trim().match(Z.loose?IQ[kQ.LOOSE]:IQ[kQ.FULL]);if(!J)throw new TypeError(`Invalid Version: ${$}`);if(this.raw=$,this.major=+J[1],this.minor=+J[2],this.patch=+J[3],this.major>J5||this.major<0)throw new TypeError("Invalid major version");if(this.minor>J5||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>J5||this.patch<0)throw new TypeError("Invalid patch version");if(!J[4])this.prerelease=[];else this.prerelease=J[4].split(".").map((Q)=>{if(/^[0-9]+$/.test(Q)){const K=+Q;if(K>=0&&K<J5)return K}return Q});this.build=J[5]?J[5].split("."):[],this.format()}format(){if(this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length)this.version+=`-${this.prerelease.join(".")}`;return this.version}toString(){return this.version}compare($){if(Z5("SemVer.compare",this.version,this.options,$),!($ instanceof L7)){if(typeof $==="string"&&$===this.version)return 0;$=new L7($,this.options)}if($.version===this.version)return 0;return this.compareMain($)||this.comparePre($)}compareMain($){if(!($ instanceof L7))$=new L7($,this.options);return $6(this.major,$.major)||$6(this.minor,$.minor)||$6(this.patch,$.patch)}comparePre($){if(!($ instanceof L7))$=new L7($,this.options);if(this.prerelease.length&&!$.prerelease.length)return-1;else if(!this.prerelease.length&&$.prerelease.length)return 1;else if(!this.prerelease.length&&!$.prerelease.length)return 0;let Z=0;do{const J=this.prerelease[Z],Q=$.prerelease[Z];if(Z5("prerelease compare",Z,J,Q),J===void 0&&Q===void 0)return 0;else if(Q===void 0)return 1;else if(J===void 0)return-1;else if(J===Q)continue;else return $6(J,Q)}while(++Z)}compareBuild($){if(!($ instanceof L7))$=new L7($,this.options);let Z=0;do{const J=this.build[Z],Q=$.build[Z];if(Z5("prerelease compare",Z,J,Q),J===void 0&&Q===void 0)return 0;else if(Q===void 0)return 1;else if(J===void 0)return-1;else if(J===Q)continue;else return $6(J,Q)}while(++Z)}inc($,Z,J){switch($){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",Z,J);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",Z,J);break;case"prepatch":this.prerelease.length=0,this.inc("patch",Z,J),this.inc("pre",Z,J);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",Z,J);this.inc("pre",Z,J);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0,this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":{const Q=Number(J)?1:0;if(!Z&&J===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[Q];else{let K=this.prerelease.length;while(--K>=0)if(typeof this.prerelease[K]==="number")this.prerelease[K]++,K=-2;if(K===-1){if(Z===this.prerelease.join(".")&&J===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(Q)}}if(Z){let K=[Z,Q];if(J===!1)K=[Z];if($6(this.prerelease[0],Z)===0){if(isNaN(this.prerelease[1]))this.prerelease=K}else this.prerelease=K}break}default:throw new Error(`invalid increment argument: ${$}`)}if(this.raw=this.format(),this.build.length)this.raw+=`+${this.build.join(".")}`;return this}}OQ.exports=L7});var R$=r((NY,_Q)=>{var RQ=S0(),gV=($,Z,J=!1)=>{if($ instanceof RQ)return $;try{return new RQ($,Z)}catch(Q){if(!J)return null;throw Q}};_Q.exports=gV});var DQ=r((LY,MQ)=>{var xV=R$(),mV=($,Z)=>{const J=xV($,Z);return J?J.version:null};MQ.exports=mV});var EQ=r((BY,AQ)=>{var cV=R$(),pV=($,Z)=>{const J=cV($.trim().replace(/^[=v]+/,""),Z);return J?J.version:null};AQ.exports=pV});var SQ=r((PY,vQ)=>{var bQ=S0(),uV=($,Z,J,Q,K)=>{if(typeof J==="string")K=Q,Q=J,J=void 0;try{return new bQ($ instanceof bQ?$.version:$,J).inc(Z,Q,K).version}catch(q){return null}};vQ.exports=uV});var yQ=r((FY,hQ)=>{var TQ=R$(),dV=($,Z)=>{const J=TQ($,null,!0),Q=TQ(Z,null,!0),K=J.compare(Q);if(K===0)return null;const q=K>0,V=q?J:Q,U=q?Q:J,H=!!V.prerelease.length;if(!!U.prerelease.length&&!H){if(!U.patch&&!U.minor)return"major";if(V.patch)return"patch";if(V.minor)return"minor";return"major"}const W=H?"pre":"";if(J.major!==Q.major)return W+"major";if(J.minor!==Q.minor)return W+"minor";if(J.patch!==Q.patch)return W+"patch";return"prerelease"};hQ.exports=dV});var gQ=r((IY,fQ)=>{var lV=S0(),nV=($,Z)=>new lV($,Z).major;fQ.exports=nV});var mQ=r((kY,xQ)=>{var oV=S0(),sV=($,Z)=>new oV($,Z).minor;xQ.exports=sV});var pQ=r((OY,cQ)=>{var iV=S0(),aV=($,Z)=>new iV($,Z).patch;cQ.exports=aV});var dQ=r((RY,uQ)=>{var rV=R$(),tV=($,Z)=>{const J=rV($,Z);return J&&J.prerelease.length?J.prerelease:null};uQ.exports=tV});var z7=r((_Y,nQ)=>{var lQ=S0(),eV=($,Z,J)=>new lQ($,J).compare(new lQ(Z,J));nQ.exports=eV});var sQ=r((MY,oQ)=>{var $U=z7(),ZU=($,Z,J)=>$U(Z,$,J);oQ.exports=ZU});var aQ=r((DY,iQ)=>{var JU=z7(),QU=($,Z)=>JU($,Z,!0);iQ.exports=QU});var Q5=r((AY,tQ)=>{var rQ=S0(),KU=($,Z,J)=>{const Q=new rQ($,J),K=new rQ(Z,J);return Q.compare(K)||Q.compareBuild(K)};tQ.exports=KU});var $4=r((EY,eQ)=>{var qU=Q5(),VU=($,Z)=>$.sort((J,Q)=>qU(J,Q,Z));eQ.exports=VU});var J4=r((bY,Z4)=>{var UU=Q5(),HU=($,Z)=>$.sort((J,Q)=>UU(Q,J,Z));Z4.exports=HU});var f6=r((vY,Q4)=>{var zU=z7(),WU=($,Z,J)=>zU($,Z,J)>0;Q4.exports=WU});var K5=r((SY,K4)=>{var YU=z7(),wU=($,Z,J)=>YU($,Z,J)<0;K4.exports=wU});var m9=r((TY,q4)=>{var jU=z7(),CU=($,Z,J)=>jU($,Z,J)===0;q4.exports=CU});var c9=r((hY,V4)=>{var XU=z7(),GU=($,Z,J)=>XU($,Z,J)!==0;V4.exports=GU});var q5=r((yY,U4)=>{var NU=z7(),LU=($,Z,J)=>NU($,Z,J)>=0;U4.exports=LU});var V5=r((fY,H4)=>{var BU=z7(),PU=($,Z,J)=>BU($,Z,J)<=0;H4.exports=PU});var p9=r((gY,z4)=>{var FU=m9(),IU=c9(),kU=f6(),OU=q5(),RU=K5(),_U=V5(),MU=($,Z,J,Q)=>{switch(Z){case"===":if(typeof $==="object")$=$.version;if(typeof J==="object")J=J.version;return $===J;case"!==":if(typeof $==="object")$=$.version;if(typeof J==="object")J=J.version;return $!==J;case"":case"=":case"==":return FU($,J,Q);case"!=":return IU($,J,Q);case">":return kU($,J,Q);case">=":return OU($,J,Q);case"<":return RU($,J,Q);case"<=":return _U($,J,Q);default:throw new TypeError(`Invalid operator: ${Z}`)}};z4.exports=MU});var Y4=r((xY,W4)=>{var DU=S0(),AU=R$(),{safeRe:U5,t:H5}=e$(),EU=($,Z)=>{if($ instanceof DU)return $;if(typeof $==="number")$=String($);if(typeof $!=="string")return null;Z=Z||{};let J=null;if(!Z.rtl)J=$.match(U5[H5.COERCE]);else{let Q;while((Q=U5[H5.COERCERTL].exec($))&&(!J||J.index+J[0].length!==$.length)){if(!J||Q.index+Q[0].length!==J.index+J[0].length)J=Q;U5[H5.COERCERTL].lastIndex=Q.index+Q[1].length+Q[2].length}U5[H5.COERCERTL].lastIndex=-1}if(J===null)return null;return AU(`${J[2]}.${J[3]||"0"}.${J[4]||"0"}`,Z)};W4.exports=EU});var j4=r((mY,w4)=>{w4.exports=function($){$.prototype[Symbol.iterator]=function*(){for(let Z=this.head;Z;Z=Z.next)yield Z.value}}});var X4=r((cY,C4)=>{var q0=function($){var Z=this;if(!(Z instanceof q0))Z=new q0;if(Z.tail=null,Z.head=null,Z.length=0,$&&typeof $.forEach==="function")$.forEach(function(K){Z.push(K)});else if(arguments.length>0)for(var J=0,Q=arguments.length;J<Q;J++)Z.push(arguments[J]);return Z},bU=function($,Z,J){var Q=Z===$.head?new _$(J,null,Z,$):new _$(J,Z,Z.next,$);if(Q.next===null)$.tail=Q;if(Q.prev===null)$.head=Q;return $.length++,Q},vU=function($,Z){if($.tail=new _$(Z,$.tail,null,$),!$.head)$.head=$.tail;$.length++},SU=function($,Z){if($.head=new _$(Z,null,$.head,$),!$.tail)$.tail=$.head;$.length++},_$=function($,Z,J,Q){if(!(this instanceof _$))return new _$($,Z,J,Q);if(this.list=Q,this.value=$,Z)Z.next=this,this.prev=Z;else this.prev=null;if(J)J.prev=this,this.next=J;else this.next=null};C4.exports=q0;q0.Node=_$;q0.create=q0;q0.prototype.removeNode=function($){if($.list!==this)throw new Error("removing node which does not belong to this list");var{next:Z,prev:J}=$;if(Z)Z.prev=J;if(J)J.next=Z;if($===this.head)this.head=Z;if($===this.tail)this.tail=J;return $.list.length--,$.next=null,$.prev=null,$.list=null,Z};q0.prototype.unshiftNode=function($){if($===this.head)return;if($.list)$.list.removeNode($);var Z=this.head;if($.list=this,$.next=Z,Z)Z.prev=$;if(this.head=$,!this.tail)this.tail=$;this.length++};q0.prototype.pushNode=function($){if($===this.tail)return;if($.list)$.list.removeNode($);var Z=this.tail;if($.list=this,$.prev=Z,Z)Z.next=$;if(this.tail=$,!this.head)this.head=$;this.length++};q0.prototype.push=function(){for(var $=0,Z=arguments.length;$<Z;$++)vU(this,arguments[$]);return this.length};q0.prototype.unshift=function(){for(var $=0,Z=arguments.length;$<Z;$++)SU(this,arguments[$]);return this.length};q0.prototype.pop=function(){if(!this.tail)return;var $=this.tail.value;if(this.tail=this.tail.prev,this.tail)this.tail.next=null;else this.head=null;return this.length--,$};q0.prototype.shift=function(){if(!this.head)return;var $=this.head.value;if(this.head=this.head.next,this.head)this.head.prev=null;else this.tail=null;return this.length--,$};q0.prototype.forEach=function($,Z){Z=Z||this;for(var J=this.head,Q=0;J!==null;Q++)$.call(Z,J.value,Q,this),J=J.next};q0.prototype.forEachReverse=function($,Z){Z=Z||this;for(var J=this.tail,Q=this.length-1;J!==null;Q--)$.call(Z,J.value,Q,this),J=J.prev};q0.prototype.get=function($){for(var Z=0,J=this.head;J!==null&&Z<$;Z++)J=J.next;if(Z===$&&J!==null)return J.value};q0.prototype.getReverse=function($){for(var Z=0,J=this.tail;J!==null&&Z<$;Z++)J=J.prev;if(Z===$&&J!==null)return J.value};q0.prototype.map=function($,Z){Z=Z||this;var J=new q0;for(var Q=this.head;Q!==null;)J.push($.call(Z,Q.value,this)),Q=Q.next;return J};q0.prototype.mapReverse=function($,Z){Z=Z||this;var J=new q0;for(var Q=this.tail;Q!==null;)J.push($.call(Z,Q.value,this)),Q=Q.prev;return J};q0.prototype.reduce=function($,Z){var J,Q=this.head;if(arguments.length>1)J=Z;else if(this.head)Q=this.head.next,J=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var K=0;Q!==null;K++)J=$(J,Q.value,K),Q=Q.next;return J};q0.prototype.reduceReverse=function($,Z){var J,Q=this.tail;if(arguments.length>1)J=Z;else if(this.tail)Q=this.tail.prev,J=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var K=this.length-1;Q!==null;K--)J=$(J,Q.value,K),Q=Q.prev;return J};q0.prototype.toArray=function(){var $=new Array(this.length);for(var Z=0,J=this.head;J!==null;Z++)$[Z]=J.value,J=J.next;return $};q0.prototype.toArrayReverse=function(){var $=new Array(this.length);for(var Z=0,J=this.tail;J!==null;Z++)$[Z]=J.value,J=J.prev;return $};q0.prototype.slice=function($,Z){if(Z=Z||this.length,Z<0)Z+=this.length;if($=$||0,$<0)$+=this.length;var J=new q0;if(Z<$||Z<0)return J;if($<0)$=0;if(Z>this.length)Z=this.length;for(var Q=0,K=this.head;K!==null&&Q<$;Q++)K=K.next;for(;K!==null&&Q<Z;Q++,K=K.next)J.push(K.value);return J};q0.prototype.sliceReverse=function($,Z){if(Z=Z||this.length,Z<0)Z+=this.length;if($=$||0,$<0)$+=this.length;var J=new q0;if(Z<$||Z<0)return J;if($<0)$=0;if(Z>this.length)Z=this.length;for(var Q=this.length,K=this.tail;K!==null&&Q>Z;Q--)K=K.prev;for(;K!==null&&Q>$;Q--,K=K.prev)J.push(K.value);return J};q0.prototype.splice=function($,Z,...J){if($>this.length)$=this.length-1;if($<0)$=this.length+$;for(var Q=0,K=this.head;K!==null&&Q<$;Q++)K=K.next;var q=[];for(var Q=0;K&&Q<Z;Q++)q.push(K.value),K=this.removeNode(K);if(K===null)K=this.tail;if(K!==this.head&&K!==this.tail)K=K.prev;for(var Q=0;Q<J.length;Q++)K=bU(this,K,J[Q]);return q};q0.prototype.reverse=function(){var $=this.head,Z=this.tail;for(var J=$;J!==null;J=J.prev){var Q=J.prev;J.prev=J.next,J.next=Q}return this.head=Z,this.tail=$,this};try{j4()(q0)}catch($){}});var I4=r((pY,F4)=>{var TU=X4(),M$=Symbol("max"),g7=Symbol("length"),Z6=Symbol("lengthCalculator"),x6=Symbol("allowStale"),D$=Symbol("maxAge"),f7=Symbol("dispose"),G4=Symbol("noDisposeOnSet"),O0=Symbol("lruList"),B7=Symbol("cache"),L4=Symbol("updateAgeOnGet"),u9=()=>1;class B4{constructor($){if(typeof $==="number")$={max:$};if(!$)$={};if($.max&&(typeof $.max!=="number"||$.max<0))throw new TypeError("max must be a non-negative number");const Z=this[M$]=$.max||Infinity,J=$.length||u9;if(this[Z6]=typeof J!=="function"?u9:J,this[x6]=$.stale||!1,$.maxAge&&typeof $.maxAge!=="number")throw new TypeError("maxAge must be a number");this[D$]=$.maxAge||0,this[f7]=$.dispose,this[G4]=$.noDisposeOnSet||!1,this[L4]=$.updateAgeOnGet||!1,this.reset()}set max($){if(typeof $!=="number"||$<0)throw new TypeError("max must be a non-negative number");this[M$]=$||Infinity,g6(this)}get max(){return this[M$]}set allowStale($){this[x6]=!!$}get allowStale(){return this[x6]}set maxAge($){if(typeof $!=="number")throw new TypeError("maxAge must be a non-negative number");this[D$]=$,g6(this)}get maxAge(){return this[D$]}set lengthCalculator($){if(typeof $!=="function")$=u9;if($!==this[Z6])this[Z6]=$,this[g7]=0,this[O0].forEach((Z)=>{Z.length=this[Z6](Z.value,Z.key),this[g7]+=Z.length});g6(this)}get lengthCalculator(){return this[Z6]}get length(){return this[g7]}get itemCount(){return this[O0].length}rforEach($,Z){Z=Z||this;for(let J=this[O0].tail;J!==null;){const Q=J.prev;N4(this,$,J,Z),J=Q}}forEach($,Z){Z=Z||this;for(let J=this[O0].head;J!==null;){const Q=J.next;N4(this,$,J,Z),J=Q}}keys(){return this[O0].toArray().map(($)=>$.key)}values(){return this[O0].toArray().map(($)=>$.value)}reset(){if(this[f7]&&this[O0]&&this[O0].length)this[O0].forEach(($)=>this[f7]($.key,$.value));this[B7]=new Map,this[O0]=new TU,this[g7]=0}dump(){return this[O0].map(($)=>z5(this,$)?!1:{k:$.key,v:$.value,e:$.now+($.maxAge||0)}).toArray().filter(($)=>$)}dumpLru(){return this[O0]}set($,Z,J){if(J=J||this[D$],J&&typeof J!=="number")throw new TypeError("maxAge must be a number");const Q=J?Date.now():0,K=this[Z6](Z,$);if(this[B7].has($)){if(K>this[M$])return J6(this,this[B7].get($)),!1;const U=this[B7].get($).value;if(this[f7]){if(!this[G4])this[f7]($,U.value)}return U.now=Q,U.maxAge=J,U.value=Z,this[g7]+=K-U.length,U.length=K,this.get($),g6(this),!0}const q=new P4($,Z,K,Q,J);if(q.length>this[M$]){if(this[f7])this[f7]($,Z);return!1}return this[g7]+=q.length,this[O0].unshift(q),this[B7].set($,this[O0].head),g6(this),!0}has($){if(!this[B7].has($))return!1;const Z=this[B7].get($).value;return!z5(this,Z)}get($){return d9(this,$,!0)}peek($){return d9(this,$,!1)}pop(){const $=this[O0].tail;if(!$)return null;return J6(this,$),$.value}del($){J6(this,this[B7].get($))}load($){this.reset();const Z=Date.now();for(let J=$.length-1;J>=0;J--){const Q=$[J],K=Q.e||0;if(K===0)this.set(Q.k,Q.v);else{const q=K-Z;if(q>0)this.set(Q.k,Q.v,q)}}}prune(){this[B7].forEach(($,Z)=>d9(this,Z,!1))}}var d9=($,Z,J)=>{const Q=$[B7].get(Z);if(Q){const K=Q.value;if(z5($,K)){if(J6($,Q),!$[x6])return}else if(J){if($[L4])Q.value.now=Date.now();$[O0].unshiftNode(Q)}return K.value}},z5=($,Z)=>{if(!Z||!Z.maxAge&&!$[D$])return!1;const J=Date.now()-Z.now;return Z.maxAge?J>Z.maxAge:$[D$]&&J>$[D$]},g6=($)=>{if($[g7]>$[M$])for(let Z=$[O0].tail;$[g7]>$[M$]&&Z!==null;){const J=Z.prev;J6($,Z),Z=J}},J6=($,Z)=>{if(Z){const J=Z.value;if($[f7])$[f7](J.key,J.value);$[g7]-=J.length,$[B7].delete(J.key),$[O0].removeNode(Z)}};class P4{constructor($,Z,J,Q,K){this.key=$,this.value=Z,this.length=J,this.now=Q,this.maxAge=K||0}}var N4=($,Z,J,Q)=>{let K=J.value;if(z5($,K)){if(J6($,J),!$[x6])K=void 0}if(K)Z.call(Q,K.value,K.key,$)};F4.exports=B4});var W7=r((uY,_4)=>{class m6{constructor($,Z){if(Z=yU(Z),$ instanceof m6)if($.loose===!!Z.loose&&$.includePrerelease===!!Z.includePrerelease)return $;else return new m6($.raw,Z);if($ instanceof l9)return this.raw=$.value,this.set=[[$]],this.format(),this;if(this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease,this.raw=$.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map((J)=>this.parseRange(J.trim())).filter((J)=>J.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const J=this.set[0];if(this.set=this.set.filter((Q)=>!O4(Q[0])),this.set.length===0)this.set=[J];else if(this.set.length>1){for(let Q of this.set)if(Q.length===1&&uU(Q[0])){this.set=[Q];break}}}this.format()}format(){return this.range=this.set.map(($)=>$.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange($){const J=((this.options.includePrerelease&&cU)|(this.options.loose&&pU))+":"+$,Q=k4.get(J);if(Q)return Q;const K=this.options.loose,q=K?s0[f0.HYPHENRANGELOOSE]:s0[f0.HYPHENRANGE];$=$.replace(q,eU(this.options.includePrerelease)),C0("hyphen replace",$),$=$.replace(s0[f0.COMPARATORTRIM],gU),C0("comparator trim",$),$=$.replace(s0[f0.TILDETRIM],xU),C0("tilde trim",$),$=$.replace(s0[f0.CARETTRIM],mU),C0("caret trim",$);let V=$.split(" ").map((W)=>dU(W,this.options)).join(" ").split(/\s+/).map((W)=>tU(W,this.options));if(K)V=V.filter((W)=>{return C0("loose invalid filter",W,this.options),!!W.match(s0[f0.COMPARATORLOOSE])});C0("range list",V);const U=new Map,H=V.map((W)=>new l9(W,this.options));for(let W of H){if(O4(W))return[W];U.set(W.value,W)}if(U.size>1&&U.has(""))U.delete("");const z=[...U.values()];return k4.set(J,z),z}intersects($,Z){if(!($ instanceof m6))throw new TypeError("a Range is required");return this.set.some((J)=>{return R4(J,Z)&&$.set.some((Q)=>{return R4(Q,Z)&&J.every((K)=>{return Q.every((q)=>{return K.intersects(q,Z)})})})})}test($){if(!$)return!1;if(typeof $==="string")try{$=new fU($,this.options)}catch(Z){return!1}for(let Z=0;Z<this.set.length;Z++)if($H(this.set[Z],$,this.options))return!0;return!1}}_4.exports=m6;var hU=I4(),k4=new hU({max:1000}),yU=$5(),l9=c6(),C0=y6(),fU=S0(),{safeRe:s0,t:f0,comparatorTrimReplace:gU,tildeTrimReplace:xU,caretTrimReplace:mU}=e$(),{FLAG_INCLUDE_PRERELEASE:cU,FLAG_LOOSE:pU}=h6(),O4=($)=>$.value==="<0.0.0-0",uU=($)=>$.value==="",R4=($,Z)=>{let J=!0;const Q=$.slice();let K=Q.pop();while(J&&Q.length)J=Q.every((q)=>{return K.intersects(q,Z)}),K=Q.pop();return J},dU=($,Z)=>{return C0("comp",$,Z),$=oU($,Z),C0("caret",$),$=lU($,Z),C0("tildes",$),$=iU($,Z),C0("xrange",$),$=rU($,Z),C0("stars",$),$},g0=($)=>!$||$.toLowerCase()==="x"||$==="*",lU=($,Z)=>{return $.trim().split(/\s+/).map((J)=>nU(J,Z)).join(" ")},nU=($,Z)=>{const J=Z.loose?s0[f0.TILDELOOSE]:s0[f0.TILDE];return $.replace(J,(Q,K,q,V,U)=>{C0("tilde",$,Q,K,q,V,U);let H;if(g0(K))H="";else if(g0(q))H=`>=${K}.0.0 <${+K+1}.0.0-0`;else if(g0(V))H=`>=${K}.${q}.0 <${K}.${+q+1}.0-0`;else if(U)C0("replaceTilde pr",U),H=`>=${K}.${q}.${V}-${U} <${K}.${+q+1}.0-0`;else H=`>=${K}.${q}.${V} <${K}.${+q+1}.0-0`;return C0("tilde return",H),H})},oU=($,Z)=>{return $.trim().split(/\s+/).map((J)=>sU(J,Z)).join(" ")},sU=($,Z)=>{C0("caret",$,Z);const J=Z.loose?s0[f0.CARETLOOSE]:s0[f0.CARET],Q=Z.includePrerelease?"-0":"";return $.replace(J,(K,q,V,U,H)=>{C0("caret",$,K,q,V,U,H);let z;if(g0(q))z="";else if(g0(V))z=`>=${q}.0.0${Q} <${+q+1}.0.0-0`;else if(g0(U))if(q==="0")z=`>=${q}.${V}.0${Q} <${q}.${+V+1}.0-0`;else z=`>=${q}.${V}.0${Q} <${+q+1}.0.0-0`;else if(H)if(C0("replaceCaret pr",H),q==="0")if(V==="0")z=`>=${q}.${V}.${U}-${H} <${q}.${V}.${+U+1}-0`;else z=`>=${q}.${V}.${U}-${H} <${q}.${+V+1}.0-0`;else z=`>=${q}.${V}.${U}-${H} <${+q+1}.0.0-0`;else if(C0("no pr"),q==="0")if(V==="0")z=`>=${q}.${V}.${U}${Q} <${q}.${V}.${+U+1}-0`;else z=`>=${q}.${V}.${U}${Q} <${q}.${+V+1}.0-0`;else z=`>=${q}.${V}.${U} <${+q+1}.0.0-0`;return C0("caret return",z),z})},iU=($,Z)=>{return C0("replaceXRanges",$,Z),$.split(/\s+/).map((J)=>aU(J,Z)).join(" ")},aU=($,Z)=>{$=$.trim();const J=Z.loose?s0[f0.XRANGELOOSE]:s0[f0.XRANGE];return $.replace(J,(Q,K,q,V,U,H)=>{C0("xRange",$,Q,K,q,V,U,H);const z=g0(q),W=z||g0(V),Y=W||g0(U),w=Y;if(K==="="&&w)K="";if(H=Z.includePrerelease?"-0":"",z)if(K===">"||K==="<")Q="<0.0.0-0";else Q="*";else if(K&&w){if(W)V=0;if(U=0,K===">")if(K=">=",W)q=+q+1,V=0,U=0;else V=+V+1,U=0;else if(K==="<=")if(K="<",W)q=+q+1;else V=+V+1;if(K==="<")H="-0";Q=`${K+q}.${V}.${U}${H}`}else if(W)Q=`>=${q}.0.0${H} <${+q+1}.0.0-0`;else if(Y)Q=`>=${q}.${V}.0${H} <${q}.${+V+1}.0-0`;return C0("xRange return",Q),Q})},rU=($,Z)=>{return C0("replaceStars",$,Z),$.trim().replace(s0[f0.STAR],"")},tU=($,Z)=>{return C0("replaceGTE0",$,Z),$.trim().replace(s0[Z.includePrerelease?f0.GTE0PRE:f0.GTE0],"")},eU=($)=>(Z,J,Q,K,q,V,U,H,z,W,Y,w,j)=>{if(g0(Q))J="";else if(g0(K))J=`>=${Q}.0.0${$?"-0":""}`;else if(g0(q))J=`>=${Q}.${K}.0${$?"-0":""}`;else if(V)J=`>=${J}`;else J=`>=${J}${$?"-0":""}`;if(g0(z))H="";else if(g0(W))H=`<${+z+1}.0.0-0`;else if(g0(Y))H=`<${z}.${+W+1}.0-0`;else if(w)H=`<=${z}.${W}.${Y}-${w}`;else if($)H=`<${z}.${W}.${+Y+1}-0`;else H=`<=${H}`;return`${J} ${H}`.trim()},$H=($,Z,J)=>{for(let Q=0;Q<$.length;Q++)if(!$[Q].test(Z))return!1;if(Z.prerelease.length&&!J.includePrerelease){for(let Q=0;Q<$.length;Q++){if(C0($[Q].semver),$[Q].semver===l9.ANY)continue;if($[Q].semver.prerelease.length>0){const K=$[Q].semver;if(K.major===Z.major&&K.minor===Z.minor&&K.patch===Z.patch)return!0}}return!1}return!0}});var c6=r((dY,v4)=>{var p6=Symbol("SemVer ANY");class W5{static get ANY(){return p6}constructor($,Z){if(Z=M4(Z),$ instanceof W5)if($.loose===!!Z.loose)return $;else $=$.value;if($=$.trim().split(/\s+/).join(" "),o9("comparator",$,Z),this.options=Z,this.loose=!!Z.loose,this.parse($),this.semver===p6)this.value="";else this.value=this.operator+this.semver.version;o9("comp",this)}parse($){const Z=this.options.loose?D4[A4.COMPARATORLOOSE]:D4[A4.COMPARATOR],J=$.match(Z);if(!J)throw new TypeError(`Invalid comparator: ${$}`);if(this.operator=J[1]!==void 0?J[1]:"",this.operator==="=")this.operator="";if(!J[2])this.semver=p6;else this.semver=new E4(J[2],this.options.loose)}toString(){return this.value}test($){if(o9("Comparator.test",$,this.options.loose),this.semver===p6||$===p6)return!0;if(typeof $==="string")try{$=new E4($,this.options)}catch(Z){return!1}return n9($,this.operator,this.semver,this.options)}intersects($,Z){if(!($ instanceof W5))throw new TypeError("a Comparator is required");if(this.operator===""){if(this.value==="")return!0;return new b4($.value,Z).test(this.value)}else if($.operator===""){if($.value==="")return!0;return new b4(this.value,Z).test($.semver)}if(Z=M4(Z),Z.includePrerelease&&(this.value==="<0.0.0-0"||$.value==="<0.0.0-0"))return!1;if(!Z.includePrerelease&&(this.value.startsWith("<0.0.0")||$.value.startsWith("<0.0.0")))return!1;if(this.operator.startsWith(">")&&$.operator.startsWith(">"))return!0;if(this.operator.startsWith("<")&&$.operator.startsWith("<"))return!0;if(this.semver.version===$.semver.version&&this.operator.includes("=")&&$.operator.includes("="))return!0;if(n9(this.semver,"<",$.semver,Z)&&this.operator.startsWith(">")&&$.operator.startsWith("<"))return!0;if(n9(this.semver,">",$.semver,Z)&&this.operator.startsWith("<")&&$.operator.startsWith(">"))return!0;return!1}}v4.exports=W5;var M4=$5(),{safeRe:D4,t:A4}=e$(),n9=p9(),o9=y6(),E4=S0(),b4=W7()});var u6=r((lY,S4)=>{var ZH=W7(),JH=($,Z,J)=>{try{Z=new ZH(Z,J)}catch(Q){return!1}return Z.test($)};S4.exports=JH});var h4=r((nY,T4)=>{var QH=W7(),KH=($,Z)=>new QH($,Z).set.map((J)=>J.map((Q)=>Q.value).join(" ").trim().split(" "));T4.exports=KH});var f4=r((oY,y4)=>{var qH=S0(),VH=W7(),UH=($,Z,J)=>{let Q=null,K=null,q=null;try{q=new VH(Z,J)}catch(V){return null}return $.forEach((V)=>{if(q.test(V)){if(!Q||K.compare(V)===-1)Q=V,K=new qH(Q,J)}}),Q};y4.exports=UH});var x4=r((sY,g4)=>{var HH=S0(),zH=W7(),WH=($,Z,J)=>{let Q=null,K=null,q=null;try{q=new zH(Z,J)}catch(V){return null}return $.forEach((V)=>{if(q.test(V)){if(!Q||K.compare(V)===1)Q=V,K=new HH(Q,J)}}),Q};g4.exports=WH});var p4=r((iY,c4)=>{var s9=S0(),YH=W7(),m4=f6(),wH=($,Z)=>{$=new YH($,Z);let J=new s9("0.0.0");if($.test(J))return J;if(J=new s9("0.0.0-0"),$.test(J))return J;J=null;for(let Q=0;Q<$.set.length;++Q){const K=$.set[Q];let q=null;if(K.forEach((V)=>{const U=new s9(V.semver.version);switch(V.operator){case">":if(U.prerelease.length===0)U.patch++;else U.prerelease.push(0);U.raw=U.format();case"":case">=":if(!q||m4(U,q))q=U;break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${V.operator}`)}}),q&&(!J||m4(J,q)))J=q}if(J&&$.test(J))return J;return null};c4.exports=wH});var d4=r((aY,u4)=>{var jH=W7(),CH=($,Z)=>{try{return new jH($,Z).range||"*"}catch(J){return null}};u4.exports=CH});var Y5=r((rY,s4)=>{var XH=S0(),o4=c6(),{ANY:GH}=o4,NH=W7(),LH=u6(),l4=f6(),n4=K5(),BH=V5(),PH=q5(),FH=($,Z,J,Q)=>{$=new XH($,Q),Z=new NH(Z,Q);let K,q,V,U,H;switch(J){case">":K=l4,q=BH,V=n4,U=">",H=">=";break;case"<":K=n4,q=PH,V=l4,U="<",H="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(LH($,Z,Q))return!1;for(let z=0;z<Z.set.length;++z){const W=Z.set[z];let Y=null,w=null;if(W.forEach((j)=>{if(j.semver===GH)j=new o4(">=0.0.0");if(Y=Y||j,w=w||j,K(j.semver,Y.semver,Q))Y=j;else if(V(j.semver,w.semver,Q))w=j}),Y.operator===U||Y.operator===H)return!1;if((!w.operator||w.operator===U)&&q($,w.semver))return!1;else if(w.operator===H&&V($,w.semver))return!1}return!0};s4.exports=FH});var a4=r((tY,i4)=>{var IH=Y5(),kH=($,Z,J)=>IH($,Z,">",J);i4.exports=kH});var t4=r((eY,r4)=>{var OH=Y5(),RH=($,Z,J)=>OH($,Z,"<",J);r4.exports=RH});var Z1=r(($w,$1)=>{var e4=W7(),_H=($,Z,J)=>{return $=new e4($,J),Z=new e4(Z,J),$.intersects(Z,J)};$1.exports=_H});var Q1=r((Zw,J1)=>{var MH=u6(),DH=z7();J1.exports=($,Z,J)=>{const Q=[];let K=null,q=null;const V=$.sort((W,Y)=>DH(W,Y,J));for(let W of V)if(MH(W,Z,J)){if(q=W,!K)K=W}else{if(q)Q.push([K,q]);q=null,K=null}if(K)Q.push([K,null]);const U=[];for(let[W,Y]of Q)if(W===Y)U.push(W);else if(!Y&&W===V[0])U.push("*");else if(!Y)U.push(`>=${W}`);else if(W===V[0])U.push(`<=${Y}`);else U.push(`${W} - ${Y}`);const H=U.join(" || "),z=typeof Z.raw==="string"?Z.raw:String(Z);return H.length<z.length?H:Z}});var z1=r((Jw,H1)=>{var K1=W7(),a9=c6(),{ANY:i9}=a9,d6=u6(),r9=z7(),AH=($,Z,J={})=>{if($===Z)return!0;$=new K1($,J),Z=new K1(Z,J);let Q=!1;$:for(let K of $.set){for(let q of Z.set){const V=bH(K,q,J);if(Q=Q||V!==null,V)continue $}if(Q)return!1}return!0},EH=[new a9(">=0.0.0-0")],q1=[new a9(">=0.0.0")],bH=($,Z,J)=>{if($===Z)return!0;if($.length===1&&$[0].semver===i9)if(Z.length===1&&Z[0].semver===i9)return!0;else if(J.includePrerelease)$=EH;else $=q1;if(Z.length===1&&Z[0].semver===i9)if(J.includePrerelease)return!0;else Z=q1;const Q=new Set;let K,q;for(let j of $)if(j.operator===">"||j.operator===">=")K=V1(K,j,J);else if(j.operator==="<"||j.operator==="<=")q=U1(q,j,J);else Q.add(j.semver);if(Q.size>1)return null;let V;if(K&&q){if(V=r9(K.semver,q.semver,J),V>0)return null;else if(V===0&&(K.operator!==">="||q.operator!=="<="))return null}for(let j of Q){if(K&&!d6(j,String(K),J))return null;if(q&&!d6(j,String(q),J))return null;for(let C of Z)if(!d6(j,String(C),J))return!1;return!0}let U,H,z,W,Y=q&&!J.includePrerelease&&q.semver.prerelease.length?q.semver:!1,w=K&&!J.includePrerelease&&K.semver.prerelease.length?K.semver:!1;if(Y&&Y.prerelease.length===1&&q.operator==="<"&&Y.prerelease[0]===0)Y=!1;for(let j of Z){if(W=W||j.operator===">"||j.operator===">=",z=z||j.operator==="<"||j.operator==="<=",K){if(w){if(j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===w.major&&j.semver.minor===w.minor&&j.semver.patch===w.patch)w=!1}if(j.operator===">"||j.operator===">="){if(U=V1(K,j,J),U===j&&U!==K)return!1}else if(K.operator===">="&&!d6(K.semver,String(j),J))return!1}if(q){if(Y){if(j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===Y.major&&j.semver.minor===Y.minor&&j.semver.patch===Y.patch)Y=!1}if(j.operator==="<"||j.operator==="<="){if(H=U1(q,j,J),H===j&&H!==q)return!1}else if(q.operator==="<="&&!d6(q.semver,String(j),J))return!1}if(!j.operator&&(q||K)&&V!==0)return!1}if(K&&z&&!q&&V!==0)return!1;if(q&&W&&!K&&V!==0)return!1;if(w||Y)return!1;return!0},V1=($,Z,J)=>{if(!$)return Z;const Q=r9($.semver,Z.semver,J);return Q>0?$:Q<0?Z:Z.operator===">"&&$.operator===">="?Z:$},U1=($,Z,J)=>{if(!$)return Z;const Q=r9($.semver,Z.semver,J);return Q<0?$:Q>0?Z:Z.operator==="<"&&$.operator==="<="?Z:$};H1.exports=AH});var w5=r((Qw,w1)=>{var t9=e$(),W1=h6(),vH=S0(),Y1=x9(),SH=R$(),TH=DQ(),hH=EQ(),yH=SQ(),fH=yQ(),gH=gQ(),xH=mQ(),mH=pQ(),cH=dQ(),pH=z7(),uH=sQ(),dH=aQ(),lH=Q5(),nH=$4(),oH=J4(),sH=f6(),iH=K5(),aH=m9(),rH=c9(),tH=q5(),eH=V5(),$z=p9(),Zz=Y4(),Jz=c6(),Qz=W7(),Kz=u6(),qz=h4(),Vz=f4(),Uz=x4(),Hz=p4(),zz=d4(),Wz=Y5(),Yz=a4(),wz=t4(),jz=Z1(),Cz=Q1(),Xz=z1();w1.exports={parse:SH,valid:TH,clean:hH,inc:yH,diff:fH,major:gH,minor:xH,patch:mH,prerelease:cH,compare:pH,rcompare:uH,compareLoose:dH,compareBuild:lH,sort:nH,rsort:oH,gt:sH,lt:iH,eq:aH,neq:rH,gte:tH,lte:eH,cmp:$z,coerce:Zz,Comparator:Jz,Range:Qz,satisfies:Kz,toComparators:qz,maxSatisfying:Vz,minSatisfying:Uz,minVersion:Hz,validRange:zz,outside:Wz,gtr:Yz,ltr:wz,intersects:jz,simplifyRange:Cz,subset:Xz,SemVer:vH,re:t9.re,src:t9.src,tokens:t9.t,SEMVER_SPEC_VERSION:W1.SEMVER_SPEC_VERSION,RELEASE_TYPES:W1.RELEASE_TYPES,compareIdentifiers:Y1.compareIdentifiers,rcompareIdentifiers:Y1.rcompareIdentifiers}});var R1=r((hw,VZ)=>{var n6=function(){},Bz=function($,Z,J){this.fn=$,this.context=Z,this.once=J||!1},O1=function($,Z,J,Q,K){if(typeof J!=="function")throw new TypeError("The listener must be a function");var q=new Bz(J,Q||$,K),V=c0?c0+Z:Z;if(!$._events[V])$._events[V]=q,$._eventsCount++;else if(!$._events[V].fn)$._events[V].push(q);else $._events[V]=[$._events[V],q];return $},N5=function($,Z){if(--$._eventsCount===0)$._events=new n6;else delete $._events[Z]},T0=function(){this._events=new n6,this._eventsCount=0},Lz=Object.prototype.hasOwnProperty,c0="~";if(Object.create){if(n6.prototype=Object.create(null),!new n6().__proto__)c0=!1}T0.prototype.eventNames=function $(){var Z=[],J,Q;if(this._eventsCount===0)return Z;for(Q in J=this._events)if(Lz.call(J,Q))Z.push(c0?Q.slice(1):Q);if(Object.getOwnPropertySymbols)return Z.concat(Object.getOwnPropertySymbols(J));return Z};T0.prototype.listeners=function $(Z){var J=c0?c0+Z:Z,Q=this._events[J];if(!Q)return[];if(Q.fn)return[Q.fn];for(var K=0,q=Q.length,V=new Array(q);K<q;K++)V[K]=Q[K].fn;return V};T0.prototype.listenerCount=function $(Z){var J=c0?c0+Z:Z,Q=this._events[J];if(!Q)return 0;if(Q.fn)return 1;return Q.length};T0.prototype.emit=function $(Z,J,Q,K,q,V){var U=c0?c0+Z:Z;if(!this._events[U])return!1;var H=this._events[U],z=arguments.length,W,Y;if(H.fn){if(H.once)this.removeListener(Z,H.fn,void 0,!0);switch(z){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,J),!0;case 3:return H.fn.call(H.context,J,Q),!0;case 4:return H.fn.call(H.context,J,Q,K),!0;case 5:return H.fn.call(H.context,J,Q,K,q),!0;case 6:return H.fn.call(H.context,J,Q,K,q,V),!0}for(Y=1,W=new Array(z-1);Y<z;Y++)W[Y-1]=arguments[Y];H.fn.apply(H.context,W)}else{var w=H.length,j;for(Y=0;Y<w;Y++){if(H[Y].once)this.removeListener(Z,H[Y].fn,void 0,!0);switch(z){case 1:H[Y].fn.call(H[Y].context);break;case 2:H[Y].fn.call(H[Y].context,J);break;case 3:H[Y].fn.call(H[Y].context,J,Q);break;case 4:H[Y].fn.call(H[Y].context,J,Q,K);break;default:if(!W)for(j=1,W=new Array(z-1);j<z;j++)W[j-1]=arguments[j];H[Y].fn.apply(H[Y].context,W)}}}return!0};T0.prototype.on=function $(Z,J,Q){return O1(this,Z,J,Q,!1)};T0.prototype.once=function $(Z,J,Q){return O1(this,Z,J,Q,!0)};T0.prototype.removeListener=function $(Z,J,Q,K){var q=c0?c0+Z:Z;if(!this._events[q])return this;if(!J)return N5(this,q),this;var V=this._events[q];if(V.fn){if(V.fn===J&&(!K||V.once)&&(!Q||V.context===Q))N5(this,q)}else{for(var U=0,H=[],z=V.length;U<z;U++)if(V[U].fn!==J||K&&!V[U].once||Q&&V[U].context!==Q)H.push(V[U]);if(H.length)this._events[q]=H.length===1?H[0]:H;else N5(this,q)}return this};T0.prototype.removeAllListeners=function $(Z){var J;if(Z){if(J=c0?c0+Z:Z,this._events[J])N5(this,J)}else this._events=new n6,this._eventsCount=0;return this};T0.prototype.off=T0.prototype.removeListener;T0.prototype.addListener=T0.prototype.on;T0.prefixed=c0;T0.EventEmitter=T0;if(typeof VZ!=="undefined")VZ.exports=T0});var E1=r((yw,WZ)=>{var P5=function($,Z,J){J=J||2;var Q=Z&&Z.length,K=Q?Z[0]*J:$.length,q=M1($,0,K,J,!0),V=[];if(!q||q.next===q.prev)return V;var U,H,z,W,Y,w,j;if(Q)q=Oz($,Z,q,J);if($.length>80*J){U=z=$[0],H=W=$[1];for(var C=J;C<K;C+=J){if(Y=$[C],w=$[C+1],Y<U)U=Y;if(w<H)H=w;if(Y>z)z=Y;if(w>W)W=w}j=Math.max(z-U,W-H),j=j!==0?32767/j:0}return o6(q,V,J,U,H,j,0),V},M1=function($,Z,J,Q,K){var q,V;if(K===zZ($,Z,J,Q)>0)for(q=Z;q<J;q+=Q)V=_1(q,$[q],$[q+1],V);else for(q=J-Q;q>=Z;q-=Q)V=_1(q,$[q],$[q+1],V);if(V&&F5(V,V.next))i6(V),V=V.next;return V},A$=function($,Z){if(!$)return $;if(!Z)Z=$;var J=$,Q;do if(Q=!1,!J.steiner&&(F5(J,J.next)||G0(J.prev,J,J.next)===0)){if(i6(J),J=Z=J.prev,J===J.next)break;Q=!0}else J=J.next;while(Q||J!==Z);return Z},o6=function($,Z,J,Q,K,q,V){if(!$)return;if(!V&&q)Az($,Q,K,q);var U=$,H,z;while($.prev!==$.next){if(H=$.prev,z=$.next,q?Fz($,Q,K,q):Pz($)){Z.push(H.i/J|0),Z.push($.i/J|0),Z.push(z.i/J|0),i6($),$=z.next,U=z.next;continue}if($=z,$===U){if(!V)o6(A$($),Z,J,Q,K,q,1);else if(V===1)$=Iz(A$($),Z,J),o6($,Z,J,Q,K,q,2);else if(V===2)kz($,Z,J,Q,K,q);break}}},Pz=function($){var Z=$.prev,J=$,Q=$.next;if(G0(Z,J,Q)>=0)return!1;var K=Z.x,q=J.x,V=Q.x,U=Z.y,H=J.y,z=Q.y,W=K<q?K<V?K:V:q<V?q:V,Y=U<H?U<z?U:z:H<z?H:z,w=K>q?K>V?K:V:q>V?q:V,j=U>H?U>z?U:z:H>z?H:z,C=Q.next;while(C!==Z){if(C.x>=W&&C.x<=w&&C.y>=Y&&C.y<=j&&K6(K,U,q,H,V,z,C.x,C.y)&&G0(C.prev,C,C.next)>=0)return!1;C=C.next}return!0},Fz=function($,Z,J,Q){var K=$.prev,q=$,V=$.next;if(G0(K,q,V)>=0)return!1;var U=K.x,H=q.x,z=V.x,W=K.y,Y=q.y,w=V.y,j=U<H?U<z?U:z:H<z?H:z,C=W<Y?W<w?W:w:Y<w?Y:w,X=U>H?U>z?U:z:H>z?H:z,G=W>Y?W>w?W:w:Y>w?Y:w,F=UZ(j,C,Z,J,Q),L=UZ(X,G,Z,J,Q),N=$.prevZ,B=$.nextZ;while(N&&N.z>=F&&B&&B.z<=L){if(N.x>=j&&N.x<=X&&N.y>=C&&N.y<=G&&N!==K&&N!==V&&K6(U,W,H,Y,z,w,N.x,N.y)&&G0(N.prev,N,N.next)>=0)return!1;if(N=N.prevZ,B.x>=j&&B.x<=X&&B.y>=C&&B.y<=G&&B!==K&&B!==V&&K6(U,W,H,Y,z,w,B.x,B.y)&&G0(B.prev,B,B.next)>=0)return!1;B=B.nextZ}while(N&&N.z>=F){if(N.x>=j&&N.x<=X&&N.y>=C&&N.y<=G&&N!==K&&N!==V&&K6(U,W,H,Y,z,w,N.x,N.y)&&G0(N.prev,N,N.next)>=0)return!1;N=N.prevZ}while(B&&B.z<=L){if(B.x>=j&&B.x<=X&&B.y>=C&&B.y<=G&&B!==K&&B!==V&&K6(U,W,H,Y,z,w,B.x,B.y)&&G0(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0},Iz=function($,Z,J){var Q=$;do{var K=Q.prev,q=Q.next.next;if(!F5(K,q)&&D1(K,Q,Q.next,q)&&s6(K,q)&&s6(q,K))Z.push(K.i/J|0),Z.push(Q.i/J|0),Z.push(q.i/J|0),i6(Q),i6(Q.next),Q=$=q;Q=Q.next}while(Q!==$);return A$(Q)},kz=function($,Z,J,Q,K,q){var V=$;do{var U=V.next.next;while(U!==V.prev){if(V.i!==U.i&&vz(V,U)){var H=A1(V,U);V=A$(V,V.next),H=A$(H,H.next),o6(V,Z,J,Q,K,q,0),o6(H,Z,J,Q,K,q,0);return}U=U.next}V=V.next}while(V!==$)},Oz=function($,Z,J,Q){var K=[],q,V,U,H,z;for(q=0,V=Z.length;q<V;q++){if(U=Z[q]*Q,H=q<V-1?Z[q+1]*Q:$.length,z=M1($,U,H,Q,!1),z===z.next)z.steiner=!0;K.push(bz(z))}K.sort(Rz);for(q=0;q<K.length;q++)J=_z(K[q],J);return J},Rz=function($,Z){return $.x-Z.x},_z=function($,Z){var J=Mz($,Z);if(!J)return Z;var Q=A1(J,$);return A$(Q,Q.next),A$(J,J.next)},Mz=function($,Z){var J=Z,Q=$.x,K=$.y,q=(-Infinity),V;do{if(K<=J.y&&K>=J.next.y&&J.next.y!==J.y){var U=J.x+(K-J.y)*(J.next.x-J.x)/(J.next.y-J.y);if(U<=Q&&U>q){if(q=U,V=J.x<J.next.x?J:J.next,U===Q)return V}}J=J.next}while(J!==Z);if(!V)return null;var H=V,z=V.x,W=V.y,Y=Infinity,w;J=V;do{if(Q>=J.x&&J.x>=z&&Q!==J.x&&K6(K<W?Q:q,K,z,W,K<W?q:Q,K,J.x,J.y)){if(w=Math.abs(K-J.y)/(Q-J.x),s6(J,$)&&(w<Y||w===Y&&(J.x>V.x||J.x===V.x&&Dz(V,J))))V=J,Y=w}J=J.next}while(J!==H);return V},Dz=function($,Z){return G0($.prev,$,Z.prev)<0&&G0(Z.next,$,$.next)<0},Az=function($,Z,J,Q){var K=$;do{if(K.z===0)K.z=UZ(K.x,K.y,Z,J,Q);K.prevZ=K.prev,K.nextZ=K.next,K=K.next}while(K!==$);K.prevZ.nextZ=null,K.prevZ=null,Ez(K)},Ez=function($){var Z,J,Q,K,q,V,U,H,z=1;do{J=$,$=null,q=null,V=0;while(J){V++,Q=J,U=0;for(Z=0;Z<z;Z++)if(U++,Q=Q.nextZ,!Q)break;H=z;while(U>0||H>0&&Q){if(U!==0&&(H===0||!Q||J.z<=Q.z))K=J,J=J.nextZ,U--;else K=Q,Q=Q.nextZ,H--;if(q)q.nextZ=K;else $=K;K.prevZ=q,q=K}J=Q}q.nextZ=null,z*=2}while(V>1);return $},UZ=function($,Z,J,Q,K){return $=($-J)*K|0,Z=(Z-Q)*K|0,$=($|$<<8)&16711935,$=($|$<<4)&252645135,$=($|$<<2)&858993459,$=($|$<<1)&1431655765,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,$|Z<<1},bz=function($){var Z=$,J=$;do{if(Z.x<J.x||Z.x===J.x&&Z.y<J.y)J=Z;Z=Z.next}while(Z!==$);return J},K6=function($,Z,J,Q,K,q,V,U){return(K-V)*(Z-U)>=($-V)*(q-U)&&($-V)*(Q-U)>=(J-V)*(Z-U)&&(J-V)*(q-U)>=(K-V)*(Q-U)},vz=function($,Z){return $.next.i!==Z.i&&$.prev.i!==Z.i&&!Sz($,Z)&&(s6($,Z)&&s6(Z,$)&&Tz($,Z)&&(G0($.prev,$,Z.prev)||G0($,Z.prev,Z))||F5($,Z)&&G0($.prev,$,$.next)>0&&G0(Z.prev,Z,Z.next)>0)},G0=function($,Z,J){return(Z.y-$.y)*(J.x-Z.x)-(Z.x-$.x)*(J.y-Z.y)},F5=function($,Z){return $.x===Z.x&&$.y===Z.y},D1=function($,Z,J,Q){var K=B5(G0($,Z,J)),q=B5(G0($,Z,Q)),V=B5(G0(J,Q,$)),U=B5(G0(J,Q,Z));if(K!==q&&V!==U)return!0;if(K===0&&L5($,J,Z))return!0;if(q===0&&L5($,Q,Z))return!0;if(V===0&&L5(J,$,Q))return!0;if(U===0&&L5(J,Z,Q))return!0;return!1},L5=function($,Z,J){return Z.x<=Math.max($.x,J.x)&&Z.x>=Math.min($.x,J.x)&&Z.y<=Math.max($.y,J.y)&&Z.y>=Math.min($.y,J.y)},B5=function($){return $>0?1:$<0?-1:0},Sz=function($,Z){var J=$;do{if(J.i!==$.i&&J.next.i!==$.i&&J.i!==Z.i&&J.next.i!==Z.i&&D1(J,J.next,$,Z))return!0;J=J.next}while(J!==$);return!1},s6=function($,Z){return G0($.prev,$,$.next)<0?G0($,Z,$.next)>=0&&G0($,$.prev,Z)>=0:G0($,Z,$.prev)<0||G0($,$.next,Z)<0},Tz=function($,Z){var J=$,Q=!1,K=($.x+Z.x)/2,q=($.y+Z.y)/2;do{if(J.y>q!==J.next.y>q&&J.next.y!==J.y&&K<(J.next.x-J.x)*(q-J.y)/(J.next.y-J.y)+J.x)Q=!Q;J=J.next}while(J!==$);return Q},A1=function($,Z){var J=new HZ($.i,$.x,$.y),Q=new HZ(Z.i,Z.x,Z.y),K=$.next,q=Z.prev;return $.next=Z,Z.prev=$,J.next=K,K.prev=J,Q.next=J,J.prev=Q,q.next=Q,Q.prev=q,Q},_1=function($,Z,J,Q){var K=new HZ($,Z,J);if(!Q)K.prev=K,K.next=K;else K.next=Q.next,K.prev=Q,Q.next.prev=K,Q.next=K;return K},i6=function($){if($.next.prev=$.prev,$.prev.next=$.next,$.prevZ)$.prevZ.nextZ=$.nextZ;if($.nextZ)$.nextZ.prevZ=$.prevZ},HZ=function($,Z,J){this.i=$,this.x=Z,this.y=J,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1},zZ=function($,Z,J,Q){var K=0;for(var q=Z,V=J-Q;q<J;q+=Q)K+=($[V]-$[q])*($[q+1]+$[V+1]),V=q;return K};WZ.exports=P5;WZ.exports.default=P5;P5.deviation=function($,Z,J,Q){var K=Z&&Z.length,q=K?Z[0]*J:$.length,V=Math.abs(zZ($,0,q,J));if(K)for(var U=0,H=Z.length;U<H;U++){var z=Z[U]*J,W=U<H-1?Z[U+1]*J:$.length;V-=Math.abs(zZ($,z,W,J))}var Y=0;for(U=0;U<Q.length;U+=3){var w=Q[U]*J,j=Q[U+1]*J,C=Q[U+2]*J;Y+=Math.abs(($[w]-$[C])*($[j+1]-$[w+1])-($[w]-$[j])*($[C+1]-$[w+1]))}return V===0&&Y===0?0:Math.abs((Y-V)/V)};P5.flatten=function($){var Z=$[0][0].length,J={vertices:[],holes:[],dimensions:Z},Q=0;for(var K=0;K<$.length;K++){for(var q=0;q<$[K].length;q++)for(var V=0;V<Z;V++)J.vertices.push($[K][q][V]);if(K>0)Q+=$[K-1].length,J.holes.push(Q)}return J}});var WV=r((dJ,zV)=>{(function($,Z){if(typeof define==="function"&&define.amd)define([],Z);else if(typeof dJ==="object")zV.exports=Z();else $.download=Z()})(dJ,function(){return function $(Z,J,Q){var K=window,q="application/octet-stream",V=Q||q,U=Z,H=!J&&!Q&&U,z=document.createElement("a"),W=function(T){return String(T)},Y=K.Blob||K.MozBlob||K.WebKitBlob||W,w=J||"download",j,C;if(Y=Y.call?Y.bind(K):Blob,String(this)==="true")U=[U,V],V=U[0],U=U[1];if(H&&H.length<2048){if(w=H.split("/").pop().split("?")[0],z.href=H,z.href.indexOf(H)!==-1){var X=new XMLHttpRequest;return X.open("GET",H,!0),X.responseType="blob",X.onload=function(T){$(T.target.response,w,q)},setTimeout(function(){X.send()},0),X}}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(U))if(U.length>2096103.424&&Y!==W)U=N(U),V=U.type||q;else return navigator.msSaveBlob?navigator.msSaveBlob(N(U),w):B(U);else if(/([\x80-\xff])/.test(U)){var G=0,F=new Uint8Array(U.length),L=F.length;for(G;G<L;++G)F[G]=U.charCodeAt(G);U=new Y([F],{type:V})}j=U instanceof Y?U:new Y([U],{type:V});function N(T){var x=T.split(/[:;,]/),k=x[1],v=x[2]=="base64"?atob:decodeURIComponent,s=v(x.pop()),E=s.length,h=0,Q0=new Uint8Array(E);for(h;h<E;++h)Q0[h]=s.charCodeAt(h);return new Y([Q0],{type:k})}function B(T,x){if("download"in z)return z.href=T,z.setAttribute("download",w),z.className="download-js-link",z.innerHTML="downloading...",z.style.display="none",document.body.appendChild(z),setTimeout(function(){if(z.click(),document.body.removeChild(z),x===!0)setTimeout(function(){K.URL.revokeObjectURL(z.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){if(/^data:/.test(T))T="data:"+T.replace(/^data:([\w\/\-\+]+)/,q);if(!window.open(T)){if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page."))location.href=T}return!0}var k=document.createElement("iframe");if(document.body.appendChild(k),!x&&/^data:/.test(T))T="data:"+T.replace(/^data:([\w\/\-\+]+)/,q);k.src=T,setTimeout(function(){document.body.removeChild(k)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(j,w);if(K.URL)B(K.URL.createObjectURL(j),!0);else{if(typeof j==="string"||j.constructor===W)try{return B("data:"+V+";base64,"+K.btoa(j))}catch(T){return B("data:"+V+","+encodeURIComponent(j))}C=new FileReader,C.onload=function(T){B(this.result)},C.readAsDataURL(j)}return!0}})});var jV=t$(w5(),1);class I0{static poecdn="http://web.poecdn.com/";static DATA_URI="data";static SKILL_TREES_URI=`${I0.DATA_URI}/skill-trees`;static getKeyByValue($,Z){return Object.keys($).find((J)=>{return $[J]===Z})}static NotUndefined($){return $!==void 0}static NotNullOrWhiteSpace($){return $!==void 0&&$!==null&&$.trim()!==""}}var P;(function(z){z[z["None"]=0]="None";z[z["Active"]=1<<0]="Active";z[z["Hovered"]=1<<1]="Hovered";z[z["Pathing"]=1<<2]="Pathing";z[z["Highlighted"]=1<<3]="Highlighted";z[z["Compared"]=1<<4]="Compared";z[z["Moved"]=1<<5]="Moved";z[z["Desired"]=1<<6]="Desired";z[z["UnDesired"]=1<<7]="UnDesired"})(P||(P={}));var x7;(function(J){J[J["Line"]=0]="Line";J[J["Arc"]=1]="Arc"})(x7||(x7={}));class e9{id;activeEffectImage;activeIcon;ascendancyName;classStartIndex;expansionJewel;flavourText;grantedDexterity;grantedIntelligence;grantedPassivePoints;grantedStrength;group;icon;in;inactiveIcon;isAscendancyStart;isBlighted;isJewelSocket;isKeystone;isMastery;isMultipleChoice;isMultipleChoiceOption;isNotable;isProxy;isWormhole;masteryEffects;name;orbit;orbitIndex;out;recipe;reminderText;skill;stats;state;nodeGroup;orbitAngles;orbitRadii;scale;arc;x;y;isRegular2;isRegular1;hoverText=null;patch;distance;constructor($,Z,J,Q,K,q,V){if(this.id=$,this.activeEffectImage=Z.activeEffectImage||"",this.activeIcon=Z.activeIcon||"",this.ascendancyName=Z.ascendancyName||"",this.classStartIndex=Z.classStartIndex,this.expansionJewel=Z.expansionJewel,this.flavourText=Z.flavourText||[],this.grantedDexterity=Z.grantedDexterity||0,this.grantedIntelligence=Z.grantedIntelligence||0,this.grantedPassivePoints=Z.grantedPassivePoints||0,this.grantedStrength=Z.grantedStrength||0,this.group=Z.group,this.icon=Z.icon,this.in=Z.in,this.inactiveIcon=Z.inactiveIcon||"",this.isAscendancyStart=Z.isAscendancyStart||!1,this.isBlighted=Z.isBlighted,this.isJewelSocket=Z.isJewelSocket,this.isKeystone=Z.isKeystone||!1,this.isMastery=Z.isMastery||!1,this.isMultipleChoice=Z.isMultipleChoice||!1,this.isMultipleChoiceOption=Z.isMultipleChoiceOption||!1,this.isNotable=Z.isNotable||!1,this.isProxy=Z.isProxy||!1,this.isWormhole=Z.isWormhole||!1,this.masteryEffects=Z.masteryEffects||[],this.name=Z.name,this.orbit=Z.orbit,this.orbitIndex=Z.orbitIndex,this.out=Z.out,this.recipe=Z.recipe||[],this.reminderText=Z.recipe||[],this.skill=Z.skill,this.stats=Z.stats,this.distance=Z.distance,this.state=P.None,this.nodeGroup=J,this.orbitAngles=K,this.orbitRadii=Q,this.scale=q,this.arc=this.getArc(this.orbitIndex),this.x=this.getX(this.arc),this.y=this.getY(this.arc),this.isRegular2=!this.isKeystone&&!this.isNotable&&!this.isJewelSocket&&!this.isMastery,this.isRegular1=this.isRegular2&&(this.grantedStrength>0||this.grantedDexterity>0||this.grantedIntelligence>0)&&this.stats.filter(I0.NotNullOrWhiteSpace).length===1,this.patch=V,this.grantedPassivePoints>0)this.stats.push(`Grants ${this.grantedPassivePoints} Passive Skill Point${this.grantedPassivePoints>1?"s":""}`)}getArc=($)=>this.orbitAngles[this.orbit]!==void 0&&this.orbitAngles[this.orbit].length>$?this.orbitAngles[this.orbit][$]:0;getX=($)=>this.orbitRadii.length>this.orbit&&this.nodeGroup!==void 0?this.nodeGroup.x*this.scale-this.orbitRadii[this.orbit]*this.scale*Math.sin(-$):0;getY=($)=>this.orbitRadii.length>this.orbit&&this.nodeGroup!==void 0?this.nodeGroup.y*this.scale-this.orbitRadii[this.orbit]*this.scale*Math.cos(-$):0;is=($)=>{return(this.state&$)===$};_add=($)=>{this.state|=$};_remove=($)=>{this.state&=~$};GetId=()=>{return`${this.id}`};GetIcon=()=>{if(this.isMastery){if(this.is(P.Active)&&this.activeIcon)return this.activeIcon;if(this.inactiveIcon)return this.inactiveIcon}else if(this.isWormhole)return"Wormhole";return this.icon};GetDrawType=($)=>{if(this.is(P.Active)||this.is(P.Hovered)){if(this.expansionJewel!==void 0||this.isProxy||this.nodeGroup?.isProxy)return"Active";if(this.isWormhole&&this.is(P.Hovered))return"Highlight";return"Allocated"}else if($.filter((Z)=>Z&&Z.is(P.Active)).length>0)return"CanAllocate";else if(this.ascendancyName!==""||this.expansionJewel!==void 0||this.isProxy||this.nodeGroup?.isProxy)return"Normal";return"Unallocated"};GetFrameAssetKey=($)=>{const Z=this.GetDrawType($);if(this.isAscendancyStart)return"AscendancyMiddle";else if(this.isJewelSocket){if(this.expansionJewel!==void 0||this.isProxy||this.nodeGroup?.isProxy)return`JewelSocketAlt${Z}`;return`JewelFrame${Z}`}else if(this.isKeystone)return`KeystoneFrame${Z}`;else if(this.isNotable&&this.ascendancyName===""){if(this.isBlighted)return`BlightedNotableFrame${Z}`;return`NotableFrame${Z}`}else if(this.isNotable&&this.ascendancyName!=="")return`AscendancyFrameLarge${Z}`;else if(this.isMastery)return null;else if(this.ascendancyName!=="")return`AscendancyFrameSmall${Z}`;else if(this.isWormhole)return`WormholeFrame${Z}`;switch(Z){case"Normal":case"Unallocated":return"PSSkillFrame";case"CanAllocate":return"PSSkillFrameHighlighted";case"Active":case"Allocated":return"PSSkillFrameActive";default:return null}};GetSpriteSheetKey=()=>{const $=this.is(P.Active)?"Active":"Inactive";if(this.isKeystone)return`keystone${$}`;else if(this.isNotable)return`notable${$}`;else if(this.isMastery)if(this.activeEffectImage!=="")if(this.is(P.Active))return"masteryActiveSelected";else if(this.is(P.Hovered)||this.is(P.Pathing))return"masteryConnected";else return"masteryInactive";else if(this.is(P.Active)||this.is(P.Hovered))return"masteryConnected";else return"mastery";else if(this.isWormhole)return`wormhole${$}`;return`normal${$}`};GetConnectionType=($)=>{return this.is(P.Active)&&$.is(P.Active)?"Active":this.is(P.Active)||$.is(P.Active)||this.is(P.Pathing)&&$.is(P.Pathing)?"Intermediate":"Normal"};GetTargetSize=()=>{if(this.isRegular1||this.isRegular2)return{width:Math.floor(70*this.scale),height:Math.floor(70*this.scale)};if(this.isNotable||this.isJewelSocket||this.isMastery)return{width:Math.floor(100*this.scale),height:Math.floor(100*this.scale)};if(this.isKeystone)return{width:Math.floor(138*this.scale),height:Math.floor(140*this.scale)};return{width:0,height:0}}}class $Z{classes;characterAttributes;PSSCentreInnerRadius;skillsPerOrbit;orbitRadii;classesToName;classIdToName;constructor($){this.classes=$.classes,this.characterAttributes=$.characterAttributes,this.PSSCentreInnerRadius=$.PSSCentreInnerRadius,this.skillsPerOrbit=$.skillsPerOrbit,this.orbitRadii=$.orbitRadii,this.classesToName={StrClass:"Marauder",DexClass:"Ranger",IntClass:"Witch",StrDexClass:"Duelist",StrIntClass:"Templar",DexIntClass:"Shadow",StrDexIntClass:"Scion"},this.classIdToName={0:"Scion",1:"Marauder",2:"Ranger",3:"Witch",4:"Duelist",5:"Templar",6:"Shadow"}}}var f=t$(w5(),1);class P7{static v0_9_6=new f.SemVer("0.9.6");static v0_9_7=new f.SemVer("0.9.7");static v0_9_8=new f.SemVer("0.9.8");static v0_9_9=new f.SemVer("0.9.9");static v0_9_10=new f.SemVer("0.9.10");static v0_9_11=new f.SemVer("0.9.11");static v0_9_12=new f.SemVer("0.9.12");static v0_9_12qq=new f.SemVer("0.9.12-qq");static v0_9_13=new f.SemVer("0.9.13");static v0_10_0=new f.SemVer("0.10.0");static v0_10_3=new f.SemVer("0.10.3");static v0_10_8=new f.SemVer("0.10.8");static v0_11_0=new f.SemVer("0.11.0");static v0_11_1=new f.SemVer("0.11.1");static v0_11_2=new f.SemVer("0.11.2");static v0_11_4=new f.SemVer("0.11.4");static v0_11_6=new f.SemVer("0.11.6");static v1_0_0=new f.SemVer("1.0.0");static v1_0_1=new f.SemVer("1.0.1");static v1_0_2=new f.SemVer("1.0.2");static v1_0_3=new f.SemVer("1.0.3");static v1_0_6=new f.SemVer("1.0.6");static v1_1_0=new f.SemVer("1.1.0");static v1_2_0=new f.SemVer("1.2.0");static v1_2_1=new f.SemVer("1.2.1");static v1_2_2=new f.SemVer("1.2.2");static v1_3_0=new f.SemVer("1.3.0");static v2_0_0=new f.SemVer("2.0.0");static v2_0_3=new f.SemVer("2.0.3");static v2_1_0=new f.SemVer("2.1.0");static v2_2_0=new f.SemVer("2.2.0");static v2_2_2=new f.SemVer("2.2.2");static v2_3_0=new f.SemVer("2.3.0");static v2_3_1=new f.SemVer("2.3.1");static v2_3_2=new f.SemVer("2.3.2");static v2_4_0=new f.SemVer("2.4.0");static v2_5_0=new f.SemVer("2.5.0");static v2_6_0=new f.SemVer("2.6.0");static v3_0_0=new f.SemVer("3.0.0");static v3_1_0=new f.SemVer("3.1.0");static v3_2_0=new f.SemVer("3.2.0");static v3_3_0=new f.SemVer("3.3.0");static v3_4_0=new f.SemVer("3.4.0");static v3_5_0=new f.SemVer("3.5.0");static v3_6_0=new f.SemVer("3.6.0");static v3_6_2=new f.SemVer("3.6.2");static v3_7_0=new f.SemVer("3.7.0");static v3_8_0=new f.SemVer("3.8.0");static v3_9_0=new f.SemVer("3.9.0");static v3_10_0=new f.SemVer("3.10.0");static v3_11_0=new f.SemVer("3.11.0");static v3_12_0=new f.SemVer("3.12.0");static v3_13_0=new f.SemVer("3.13.0");static v3_14_0=new f.SemVer("3.14.0");static v3_15_0=new f.SemVer("3.15.0");static v3_16_0=new f.SemVer("3.16.0");static v3_17_0_atlas=new f.SemVer("3.17.0-atlas");static v3_17_0=new f.SemVer("3.17.0");static v3_18_0_atlas=new f.SemVer("3.18.0-atlas");static v3_18_0=new f.SemVer("3.18.0");static v3_19_0_atlas=new f.SemVer("3.19.0-atlas");static v3_19_0=new f.SemVer("3.19.0");static v3_20_0_atlas=new f.SemVer("3.20.0-atlas");static v3_20_0_ruthless_atlas=new f.SemVer("3.20.0-ruthless-atlas");static v3_20_0=new f.SemVer("3.20.0");static v3_20_1_atlas=new f.SemVer("3.20.1-atlas");static v3_20_1_ruthless_atlas=new f.SemVer("3.20.1-ruthless-atlas");static v3_20_1=new f.SemVer("3.20.1");static v3_21_0_atlas=new f.SemVer("3.21.0-atlas");static v3_21_0_ruthless_atlas=new f.SemVer("3.21.0-ruthless-atlas");static v3_21_0=new f.SemVer("3.21.0");static v3_22_0_atlas=new f.SemVer("3.22.0-atlas");static v3_22_0_ruthless_atlas=new f.SemVer("3.22.0-ruthless-atlas");static v3_22_0_ruthless=new f.SemVer("3.22.0-ruthless");static v3_22_0=new f.SemVer("3.22.0")}class ZZ{tree;patch;version;fullscreen;classes;groups;root;nodes;min_x;min_y;max_x;max_y;imageZoomLevels;sprites;constants;points;jewelSlots;extraImages;width;height;maxZoomLevel;scale;classStartNodes;ascedancyNodes;nodesInState={[P.None]:new Array,[P.Active]:new Array,[P.Hovered]:new Array,[P.Pathing]:new Array,[P.Highlighted]:new Array,[P.Compared]:new Array,[P.Moved]:new Array,[P.Desired]:new Array,[P.UnDesired]:new Array};desiredNodes;constructor($,Z){if(this.tree=$.tree||"Default",this.patch=Z,this.version=4,$.version=this.version,this.fullscreen=$.fullscreen=0,this.jewelSlots=$.jewelSlots,this.extraImages=$.extraImages,this.groups=$.groups,this.root=$.nodes.root,this.extraImages=$.extraImages,this.min_x=$.min_x,this.max_x=$.max_x,this.min_y=$.min_y,this.max_y=$.max_y,this.imageZoomLevels=$.imageZoomLevels,this.constants=new $Z($.constants),this.points=$.points||{totalPoints:121,ascendancyPoints:8},this.width=Math.abs(this.min_x)+Math.abs(this.max_x),this.height=Math.abs(this.min_y)+Math.abs(this.max_y),this.maxZoomLevel=$.imageZoomLevels.length-1,this.scale=$.imageZoomLevels[this.maxZoomLevel],this.sprites=$.sprites,this.classes=$.classes||[],this.root.id="root",delete $.nodes.root,this.classes.length>0){const Q={};for(let K in $.nodes){const q=$.nodes[K],V=`${q.group||0}`;if(q.isAscendancyStart&&Q[V]===void 0){let U=void 0;for(let C of q.out)if($.nodes[C].classStartIndex!==void 0)U=$.nodes[C];for(let C of q.in)if($.nodes[C].classStartIndex!==void 0)U=$.nodes[C];if(U===void 0)continue;let H=0;if(U.classStartIndex!==void 0){const C=this.classes[U.classStartIndex].ascendancies;for(let X in C)if(q.ascendancyName&&C[X].name.toLowerCase().includes(q.ascendancyName.toLowerCase())){H=+X-1;break}}const z=100,W=1450;let Y=0,w=0;const j=this.groups[U.group||0];if(j.x>-z&&j.x<z&&(j.y>-z&&j.y<z)){if(Y=this.min_x*0.65,w=this.max_y*0.95,this.patch.compare(P7.v3_16_0)>=0)Y=this.min_x*0.85,w=this.max_y*0.85}else if(j.x>-z&&j.x<z)Y=j.x+Math.sign(j.x)*H*W,w=Math.sign(j.y)>0?this.max_y*1.05:this.min_y;else if(Y=j.x<0?this.min_x*0.8:this.max_x,w=j.y+Math.sign(j.y)*(H+1)*W,this.patch.compare(P7.v3_16_0)>=0)Y=j.x<0?this.min_x*1.05:this.max_x;Q[V]=!0;for(let C in $.nodes){const X=$.nodes[C],G=`${X.group||0}`;if(Q[G]===void 0&&X.ascendancyName===q.ascendancyName){const F=this.groups[V].x-this.groups[G].x,L=this.groups[V].y-this.groups[G].y;this.groups[G].x=Y-F,this.groups[G].y=w-L,Q[G]=!0}}this.groups[V].x=Y,this.groups[V].y=w}}}this.nodes={},this.classStartNodes={},this.ascedancyNodes={},this.desiredNodes={};const J=this.getOrbitAngles($.constants.skillsPerOrbit);for(let Q in $.nodes){const K=$.nodes[Q].group||0,q=new e9(Q,$.nodes[Q],this.groups[K],$.constants.orbitRadii,J,this.scale,this.patch);if(this.root.out.indexOf(Q)>=0&&q.classStartIndex===void 0)q.classStartIndex=this.root.out.indexOf(Q);if(this.nodes[Q]=q,q.classStartIndex===3)this.addState(q,P.Active);if(q.ascendancyName!=="")this.ascedancyNodes[Q]=q;if(q.classStartIndex!==void 0)this.classStartNodes[Q]=q}}getOrbitAngles=($)=>{const Z={};for(let K in $){const q=$[K];if(Z[K]=[],q===16)Z[K]=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330];else if(q===40)Z[K]=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350];else for(let V=0;V<q;V++)Z[K].push(360*V/q)}const J={},Q=Math.PI/180;for(let K in Z){const q=Z[K];J[K]=[];for(let V of q)J[K].push(V*Q)}return J};getStartClass=()=>{for(let $ in this.classStartNodes)if(this.nodes[$].is(P.Active))return this.nodes[$].classStartIndex||0;for(let $ in this.classStartNodes)return this.addState(this.nodes[$],P.Active),this.nodes[$].classStartIndex||0;return 0};getAscendancyClass=()=>{for(let $ in this.ascedancyNodes)if(this.nodes[$].isAscendancyStart&&this.nodes[$].is(P.Active)){if(this.classes===void 0)continue;for(let Z in this.classes){const J=this.classes[Z].ascendancies;if(J===void 0)continue;for(let Q in J)if(J[Q].name===this.nodes[$].name)return+Q}}return 0};getMasteryForGroup=($)=>{if($===void 0||$.nodes===void 0)return null;for(let Z of $.nodes){const J=this.nodes[Z];if(!J.isMastery)continue;return J}return null};getSkilledNodes=()=>this.getNodes(P.Active);getHoveredNodes=()=>{const $={};for(let Z in this.getNodes(P.Hovered))$[Z]=this.nodes[Z];for(let Z in this.getNodes(P.Pathing))$[Z]=this.nodes[Z];return $};getNodes=($)=>{const Z={};for(let J of this.nodesInState[$])if(this.nodes[J].is($))Z[J]=this.nodes[J];return Z};getNodesInRange=($,Z,J)=>{const Q=[];for(let K in this.nodes){const q=this.nodes[K];if(q.isMastery)continue;const V=Math.abs(q.x-$),U=Math.abs(q.y-Z);if(V*V+U*U<J*J&&Math.abs(q.y-Z)<J)Q.push(q)}return Q};addState=($,Z)=>this.addStateById($.GetId(),Z);addStateById=($,Z)=>{if(this.nodes[$]===void 0)return;if(this.nodes[$].is(Z))return;this.nodes[$]._add(Z),this.nodesInState[Z].push($)};removeState=($,Z)=>this.removeStateById($.GetId(),Z);removeStateById=($,Z)=>{if(this.nodes[$]===void 0)return;if(!this.nodes[$].is(Z))return;this.nodes[$]._remove(Z),this.nodesInState[Z].splice(this.nodesInState[Z].indexOf($),1)};clearState=($)=>{for(let Z in this.getNodes($))if(this.nodes[Z]._remove($),$===P.Hovered)this.nodes[Z].hoverText=null;this.nodesInState[$]=new Array};hasSprite=($,Z)=>{return this.sprites[$]&&(this.sprites[$][this.scale.toString()]&&this.sprites[$][this.scale.toString()].coords[Z]!==void 0||this.sprites[$]["1"]&&this.sprites[$]["1"].coords[Z]!==void 0)}}class m{static events={};static getEvents=($)=>{let Z=new Array;for(let J in m.events[$])Z.push(J);if(Z.length===0)return;return Z};static on=($,Z,J)=>{if(m.events[$]===void 0)m.events[$]={};if(m.events[$][Z]===void 0)m.events[$][Z]=new Array;m.events[$][Z].push(J)};static off=($,Z,J)=>{if(m.events[$]===void 0||m.events[$][Z]===void 0||m.events[$][Z].indexOf(J)===-1)return;m.events[$][Z].splice(m.events[$][Z].indexOf(J),1)};static fire($,Z,J){if(m.events[$]===void 0||m.events[$][Z]===void 0)return;for(let Q of m.events[$][Z])setTimeout(()=>Q(J),0)}}var $7=(($)=>{return $[$.WEBGL_LEGACY=0]="WEBGL_LEGACY",$[$.WEBGL=1]="WEBGL",$[$.WEBGL2=2]="WEBGL2",$})($7||{}),JZ=(($)=>{return $[$.UNKNOWN=0]="UNKNOWN",$[$.WEBGL=1]="WEBGL",$[$.CANVAS=2]="CANVAS",$})(JZ||{}),j5=(($)=>{return $[$.COLOR=16384]="COLOR",$[$.DEPTH=256]="DEPTH",$[$.STENCIL=1024]="STENCIL",$})(j5||{}),o=(($)=>{return $[$.NORMAL=0]="NORMAL",$[$.ADD=1]="ADD",$[$.MULTIPLY=2]="MULTIPLY",$[$.SCREEN=3]="SCREEN",$[$.OVERLAY=4]="OVERLAY",$[$.DARKEN=5]="DARKEN",$[$.LIGHTEN=6]="LIGHTEN",$[$.COLOR_DODGE=7]="COLOR_DODGE",$[$.COLOR_BURN=8]="COLOR_BURN",$[$.HARD_LIGHT=9]="HARD_LIGHT",$[$.SOFT_LIGHT=10]="SOFT_LIGHT",$[$.DIFFERENCE=11]="DIFFERENCE",$[$.EXCLUSION=12]="EXCLUSION",$[$.HUE=13]="HUE",$[$.SATURATION=14]="SATURATION",$[$.COLOR=15]="COLOR",$[$.LUMINOSITY=16]="LUMINOSITY",$[$.NORMAL_NPM=17]="NORMAL_NPM",$[$.ADD_NPM=18]="ADD_NPM",$[$.SCREEN_NPM=19]="SCREEN_NPM",$[$.NONE=20]="NONE",$[$.SRC_OVER=0]="SRC_OVER",$[$.SRC_IN=21]="SRC_IN",$[$.SRC_OUT=22]="SRC_OUT",$[$.SRC_ATOP=23]="SRC_ATOP",$[$.DST_OVER=24]="DST_OVER",$[$.DST_IN=25]="DST_IN",$[$.DST_OUT=26]="DST_OUT",$[$.DST_ATOP=27]="DST_ATOP",$[$.ERASE=26]="ERASE",$[$.SUBTRACT=28]="SUBTRACT",$[$.XOR=29]="XOR",$})(o||{}),i0=(($)=>{return $[$.POINTS=0]="POINTS",$[$.LINES=1]="LINES",$[$.LINE_LOOP=2]="LINE_LOOP",$[$.LINE_STRIP=3]="LINE_STRIP",$[$.TRIANGLES=4]="TRIANGLES",$[$.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",$[$.TRIANGLE_FAN=6]="TRIANGLE_FAN",$})(i0||{}),b=(($)=>{return $[$.RGBA=6408]="RGBA",$[$.RGB=6407]="RGB",$[$.RG=33319]="RG",$[$.RED=6403]="RED",$[$.RGBA_INTEGER=36249]="RGBA_INTEGER",$[$.RGB_INTEGER=36248]="RGB_INTEGER",$[$.RG_INTEGER=33320]="RG_INTEGER",$[$.RED_INTEGER=36244]="RED_INTEGER",$[$.ALPHA=6406]="ALPHA",$[$.LUMINANCE=6409]="LUMINANCE",$[$.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",$[$.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",$[$.DEPTH_STENCIL=34041]="DEPTH_STENCIL",$})(b||{}),m7=(($)=>{return $[$.TEXTURE_2D=3553]="TEXTURE_2D",$[$.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",$[$.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",$[$.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",$[$.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",$[$.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",$[$.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",$[$.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",$[$.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",$})(m7||{}),l=(($)=>{return $[$.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",$[$.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",$[$.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",$[$.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",$[$.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",$[$.UNSIGNED_INT=5125]="UNSIGNED_INT",$[$.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",$[$.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",$[$.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",$[$.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",$[$.BYTE=5120]="BYTE",$[$.SHORT=5122]="SHORT",$[$.INT=5124]="INT",$[$.FLOAT=5126]="FLOAT",$[$.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",$[$.HALF_FLOAT=36193]="HALF_FLOAT",$})(l||{}),C5=(($)=>{return $[$.FLOAT=0]="FLOAT",$[$.INT=1]="INT",$[$.UINT=2]="UINT",$})(C5||{}),a0=(($)=>{return $[$.NEAREST=0]="NEAREST",$[$.LINEAR=1]="LINEAR",$})(a0||{}),x0=(($)=>{return $[$.CLAMP=33071]="CLAMP",$[$.REPEAT=10497]="REPEAT",$[$.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",$})(x0||{}),D0=(($)=>{return $[$.OFF=0]="OFF",$[$.POW2=1]="POW2",$[$.ON=2]="ON",$[$.ON_MANUAL=3]="ON_MANUAL",$})(D0||{}),P0=(($)=>{return $[$.NPM=0]="NPM",$[$.UNPACK=1]="UNPACK",$[$.PMA=2]="PMA",$[$.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",$[$.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",$[$.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",$})(P0||{}),Z7=(($)=>{return $[$.NO=0]="NO",$[$.YES=1]="YES",$[$.AUTO=2]="AUTO",$[$.BLEND=0]="BLEND",$[$.CLEAR=1]="CLEAR",$[$.BLIT=2]="BLIT",$})(Z7||{}),X5=(($)=>{return $[$.AUTO=0]="AUTO",$[$.MANUAL=1]="MANUAL",$})(X5||{}),m0=(($)=>{return $.LOW="lowp",$.MEDIUM="mediump",$.HIGH="highp",$})(m0||{}),N0=(($)=>{return $[$.NONE=0]="NONE",$[$.SCISSOR=1]="SCISSOR",$[$.STENCIL=2]="STENCIL",$[$.SPRITE=3]="SPRITE",$[$.COLOR=4]="COLOR",$})(N0||{});var H0=(($)=>{return $[$.NONE=0]="NONE",$[$.LOW=2]="LOW",$[$.MEDIUM=4]="MEDIUM",$[$.HIGH=8]="HIGH",$})(H0||{}),r0=(($)=>{return $[$.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",$[$.ARRAY_BUFFER=34962]="ARRAY_BUFFER",$[$.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",$})(r0||{});var QZ={createCanvas:($,Z)=>{const J=document.createElement("canvas");return J.width=$,J.height=Z,J},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:($,Z)=>fetch($,Z),parseXML:($)=>{return new DOMParser().parseFromString($,"text/xml")}};var I={ADAPTER:QZ,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Gz=function($){return function(Z){return Z.test($)}},KZ=/iPhone/i,j1=/iPod/i,C1=/iPad/i,X1=/\biOS-universal(?:.+)Mac\b/i,qZ=/\bAndroid(?:.+)Mobile\b/i,G1=/Android/i,Q6=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,G5=/Silk/i,c7=/Windows Phone/i,N1=/\bWindows(?:.+)ARM\b/i,L1=/BlackBerry/i,B1=/BB10/i,P1=/Opera Mini/i,F1=/\b(CriOS|Chrome)(?:.+)Mobile/i,I1=/Mobile(?:.+)Firefox\b/i,k1=function($){return typeof $!=="undefined"&&$.platform==="MacIntel"&&typeof $.maxTouchPoints==="number"&&$.maxTouchPoints>1&&typeof MSStream==="undefined"};function l6($){var Z={userAgent:"",platform:"",maxTouchPoints:0};if(!$&&typeof navigator!=="undefined")Z={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};else if(typeof $==="string")Z.userAgent=$;else if($&&$.userAgent)Z={userAgent:$.userAgent,platform:$.platform,maxTouchPoints:$.maxTouchPoints||0};var J=Z.userAgent,Q=J.split("[FBAN");if(typeof Q[1]!=="undefined")J=Q[0];if(Q=J.split("Twitter"),typeof Q[1]!=="undefined")J=Q[0];var K=Gz(J),q={apple:{phone:K(KZ)&&!K(c7),ipod:K(j1),tablet:!K(KZ)&&(K(C1)||k1(Z))&&!K(c7),universal:K(X1),device:(K(KZ)||K(j1)||K(C1)||K(X1)||k1(Z))&&!K(c7)},amazon:{phone:K(Q6),tablet:!K(Q6)&&K(G5),device:K(Q6)||K(G5)},android:{phone:!K(c7)&&K(Q6)||!K(c7)&&K(qZ),tablet:!K(c7)&&!K(Q6)&&!K(qZ)&&(K(G5)||K(G1)),device:!K(c7)&&(K(Q6)||K(G5)||K(qZ)||K(G1))||K(/\bokhttp\b/i)},windows:{phone:K(c7),tablet:K(N1),device:K(c7)||K(N1)},other:{blackberry:K(L1),blackberry10:K(B1),opera:K(P1),firefox:K(I1),chrome:K(F1),device:K(L1)||K(B1)||K(P1)||K(I1)||K(F1)},any:!1,phone:!1,tablet:!1};return q.any=q.apple.device||q.android.device||q.windows.device||q.other.device,q.phone=q.apple.phone||q.android.phone||q.windows.phone,q.tablet=q.apple.tablet||q.android.tablet||q.windows.tablet,q}var Nz=l6.default??l6,Y7=Nz(globalThis.navigator);var A={};FV(A,{url:()=>{{return k5}},uid:()=>{{return A7}},trimCanvas:()=>{{return jK}},string2hex:()=>{{return e1}},skipHello:()=>{{return g1}},sign:()=>{{return UK}},sayHello:()=>{{return x1}},rgb2hex:()=>{{return $K}},removeItems:()=>{{return M5}},premultiplyTintToRgba:()=>{{return KK}},premultiplyTint:()=>{{return QK}},premultiplyRgba:()=>{{return JK}},premultiplyBlendMode:()=>{{return e6}},path:()=>{{return GZ}},nextPow2:()=>{{return J$}},log2:()=>{{return Z8}},isWebGLSupported:()=>{{return O5}},isPow2:()=>{{return $8}},isMobile:()=>{{return Y7}},interleaveTypedArrays:()=>{{return VK}},hex2string:()=>{{return t1}},hex2rgb:()=>{{return r1}},getResolutionOfUrl:()=>{{return Q8}},getCanvasBoundingBox:()=>{{return D5}},getBufferType:()=>{{return Z$}},earcut:()=>{{return XK.default}},determineCrossOrigin:()=>{{return E5}},destroyTextureCache:()=>{{return zK}},deprecation:()=>{{return t}},decomposeDataUri:()=>{{return CK}},createIndicesForQuads:()=>{{return qK}},correctBlendMode:()=>{{return ZK}},clearTextureCache:()=>{{return WK}},TextureCache:()=>{{return _0}},ProgramCache:()=>{{return J8}},EventEmitter:()=>{{return Q$.default}},DATA_URI:()=>{{return _5}},CanvasRenderTarget:()=>{{return OZ}},BoundingBox:()=>{{return U6}},BaseTextureCache:()=>{{return p0}}});I.RETINA_PREFIX=/@([0-9\.]+)x/;I.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Q$=t$(R1(),1),XK=t$(E1(),1);var XZ=function($){return typeof $=="string"},T1=function($){return typeof $=="object"&&$!==null},I5=function($){return $===null},yz=function($){return $==null},F7=function(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null},a6=function($,Z,J){if($&&T1($)&&$ instanceof F7)return $;var Q=new F7;return Q.parse($,Z,J),Q},h1=function($){return XZ($)&&($=a6($)),$ instanceof F7?$.format():F7.prototype.format.call($)},y1=function($,Z){return a6($,!1,!0).resolve(Z)};var{URL:hz,URLSearchParams:fw,[Symbol.for("Bun.lazy")]:YZ}=globalThis,fz=/^([a-z0-9.+-]+:)/i,gz=/:[0-9]*$/,xz=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,mz=["<",">",'"',"`"," ","\r",`
`,"	"],cz=["{","}","|","\\","^","`"].concat(mz),wZ=["'"].concat(cz),b1=["%","/","?",";","#"].concat(wZ),v1=["/","?","#"],pz=255,S1=/^[+a-z0-9A-Z_-]{0,63}$/,uz=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,dz={javascript:!0,"javascript:":!0},jZ={javascript:!0,"javascript:":!0},q6={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},CZ={parse($){var Z=decodeURIComponent;return($+"").replace(/\+/g," ").split("&").filter(Boolean).reduce(function(J,Q,K){var q=Q.split("="),V=Z(q[0]||""),U=Z(q[1]||""),H=J[V];return J[V]=H===void 0?U:[].concat(H,U),J},{})},stringify($){var Z=encodeURIComponent;return Object.keys($||{}).reduce(function(J,Q){return[].concat($[Q]).forEach(function(K){J.push(Z(Q)+"="+Z(K))}),J},[]).join("&").replace(/\s/g,"+")}};F7.prototype.parse=function($,Z,J){if(!XZ($))throw new TypeError("Parameter 'url' must be a string, not "+typeof $);var Q=$.indexOf("?"),K=Q!==-1&&Q<$.indexOf("#")?"?":"#",q=$.split(K),V=/\\/g;q[0]=q[0].replace(V,"/"),$=q.join(K);var U=$;if(U=U.trim(),!J&&$.split("#").length===1){var H=xz.exec(U);if(H)return this.path=U,this.href=U,this.pathname=H[1],H[2]?(this.search=H[2],Z?this.query=CZ.parse(this.search.substr(1)):this.query=this.search.substr(1)):Z&&(this.search="",this.query={}),this}var z=fz.exec(U);if(z){z=z[0];var W=z.toLowerCase();this.protocol=W,U=U.substr(z.length)}if(J||z||U.match(/^\/\/[^@\/]+@[^@\/]+/)){var Y=U.substr(0,2)==="//";Y&&!(z&&jZ[z])&&(U=U.substr(2),this.slashes=!0)}if(!jZ[z]&&(Y||z&&!q6[z])){for(var w=-1,j=0;j<v1.length;j++){var C=U.indexOf(v1[j]);C!==-1&&(w===-1||C<w)&&(w=C)}var X,G;w===-1?G=U.lastIndexOf("@"):G=U.lastIndexOf("@",w),G!==-1&&(X=U.slice(0,G),U=U.slice(G+1),this.auth=decodeURIComponent(X)),w=-1;for(var j=0;j<b1.length;j++){var C=U.indexOf(b1[j]);C!==-1&&(w===-1||C<w)&&(w=C)}w===-1&&(w=U.length),this.host=U.slice(0,w),U=U.slice(w),this.parseHost(),this.hostname=this.hostname||"";var F=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!F)for(var L=this.hostname.split(/\./),j=0,N=L.length;j<N;j++){var B=L[j];if(!!B&&!B.match(S1)){for(var T="",x=0,k=B.length;x<k;x++)B.charCodeAt(x)>127?T+="x":T+=B[x];if(!T.match(S1)){var v=L.slice(0,j),s=L.slice(j+1),E=B.match(uz);E&&(v.push(E[1]),s.unshift(E[2])),s.length&&(U="/"+s.join(".")+U),this.hostname=v.join(".");break}}}this.hostname.length>pz?this.hostname="":this.hostname=this.hostname.toLowerCase(),F||(this.hostname=new hz(`https://${this.hostname}`).hostname);var h=this.port?":"+this.port:"",Q0=this.hostname||"";this.host=Q0+h,this.href+=this.host,F&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),U[0]!=="/"&&(U="/"+U))}if(!dz[W])for(var j=0,N=wZ.length;j<N;j++){var M=wZ[j];if(U.indexOf(M)!==-1){var D=encodeURIComponent(M);D===M&&(D=escape(M)),U=U.split(M).join(D)}}var V0=U.indexOf("#");V0!==-1&&(this.hash=U.substr(V0),U=U.slice(0,V0));var e=U.indexOf("?");if(e!==-1?(this.search=U.substr(e),this.query=U.substr(e+1),Z&&(this.query=CZ.parse(this.query)),U=U.slice(0,e)):Z&&(this.search="",this.query={}),U&&(this.pathname=U),q6[W]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var h=this.pathname||"",$0=this.search||"";this.path=h+$0}return this.href=this.format(),this};F7.prototype.format=function(){var $=this.auth||"";$&&($=encodeURIComponent($),$=$.replace(/%3A/i,":"),$+="@");var Z=this.protocol||"",J=this.pathname||"",Q=this.hash||"",K=!1,q="";this.host?K=$+this.host:this.hostname&&(K=$+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(K+=":"+this.port)),this.query&&T1(this.query)&&Object.keys(this.query).length&&(q=CZ.stringify(this.query));var V=this.search||q&&"?"+q||"";return Z&&Z.substr(-1)!==":"&&(Z+=":"),this.slashes||(!Z||q6[Z])&&K!==!1?(K="//"+(K||""),J&&J.charAt(0)!=="/"&&(J="/"+J)):K||(K=""),Q&&Q.charAt(0)!=="#"&&(Q="#"+Q),V&&V.charAt(0)!=="?"&&(V="?"+V),J=J.replace(/[?#]/g,function(U){return encodeURIComponent(U)}),V=V.replace("#","%23"),Z+K+J+V+Q};F7.prototype.resolve=function($){return this.resolveObject(a6($,!1,!0)).format()};F7.prototype.resolveObject=function($){if(XZ($)){var Z=new F7;Z.parse($,!1,!0),$=Z}for(var J=new F7,Q=Object.keys(this),K=0;K<Q.length;K++){var q=Q[K];J[q]=this[q]}if(J.hash=$.hash,$.href==="")return J.href=J.format(),J;if($.slashes&&!$.protocol){for(var V=Object.keys($),U=0;U<V.length;U++){var H=V[U];H!=="protocol"&&(J[H]=$[H])}return q6[J.protocol]&&J.hostname&&!J.pathname&&(J.path=J.pathname="/"),J.href=J.format(),J}if($.protocol&&$.protocol!==J.protocol){if(!q6[$.protocol]){for(var z=Object.keys($),W=0;W<z.length;W++){var Y=z[W];J[Y]=$[Y]}return J.href=J.format(),J}if(J.protocol=$.protocol,!$.host&&!jZ[$.protocol]){for(var N=($.pathname||"").split("/");N.length&&!($.host=N.shift()););$.host||($.host=""),$.hostname||($.hostname=""),N[0]!==""&&N.unshift(""),N.length<2&&N.unshift(""),J.pathname=N.join("/")}else J.pathname=$.pathname;if(J.search=$.search,J.query=$.query,J.host=$.host||"",J.auth=$.auth,J.hostname=$.hostname||$.host,J.port=$.port,J.pathname||J.search){var w=J.pathname||"",j=J.search||"";J.path=w+j}return J.slashes=J.slashes||$.slashes,J.href=J.format(),J}var C=J.pathname&&J.pathname.charAt(0)==="/",X=$.host||$.pathname&&$.pathname.charAt(0)==="/",G=X||C||J.host&&$.pathname,F=G,L=J.pathname&&J.pathname.split("/")||[],N=$.pathname&&$.pathname.split("/")||[],B=J.protocol&&!q6[J.protocol];if(B&&(J.hostname="",J.port=null,J.host&&(L[0]===""?L[0]=J.host:L.unshift(J.host)),J.host="",$.protocol&&($.hostname=null,$.port=null,$.host&&(N[0]===""?N[0]=$.host:N.unshift($.host)),$.host=null),G=G&&(N[0]===""||L[0]==="")),X)J.host=$.host||$.host===""?$.host:J.host,J.hostname=$.hostname||$.hostname===""?$.hostname:J.hostname,J.search=$.search,J.query=$.query,L=N;else if(N.length)L||(L=[]),L.pop(),L=L.concat(N),J.search=$.search,J.query=$.query;else if(!yz($.search)){if(B){J.hostname=J.host=L.shift();var T=J.host&&J.host.indexOf("@")>0?J.host.split("@"):!1;T&&(J.auth=T.shift(),J.host=J.hostname=T.shift())}return J.search=$.search,J.query=$.query,(!I5(J.pathname)||!I5(J.search))&&(J.path=(J.pathname?J.pathname:"")+(J.search?J.search:"")),J.href=J.format(),J}if(!L.length)return J.pathname=null,J.search?J.path="/"+J.search:J.path=null,J.href=J.format(),J;for(var x=L.slice(-1)[0],k=(J.host||$.host||L.length>1)&&(x==="."||x==="..")||x==="",v=0,s=L.length;s>=0;s--)x=L[s],x==="."?L.splice(s,1):x===".."?(L.splice(s,1),v++):v&&(L.splice(s,1),v--);if(!G&&!F)for(;v--;v)L.unshift("..");G&&L[0]!==""&&(!L[0]||L[0].charAt(0)!=="/")&&L.unshift(""),k&&L.join("/").substr(-1)!=="/"&&L.push("");var E=L[0]===""||L[0]&&L[0].charAt(0)==="/";if(B){J.hostname=J.host=E?"":L.length?L.shift():"";var T=J.host&&J.host.indexOf("@")>0?J.host.split("@"):!1;T&&(J.auth=T.shift(),J.host=J.hostname=T.shift())}return G=G||J.host&&L.length,G&&!E&&L.unshift(""),L.length?J.pathname=L.join("/"):(J.pathname=null,J.path=null),(!I5(J.pathname)||!I5(J.search))&&(J.path=(J.pathname?J.pathname:"")+(J.search?J.search:"")),J.auth=$.auth||J.auth,J.slashes=J.slashes||$.slashes,J.href=J.format(),J};F7.prototype.parseHost=function(){var $=this.host,Z=gz.exec($);Z&&(Z=Z[0],Z!==":"&&(this.port=Z.substr(1)),$=$.substr(0,$.length-Z.length)),$&&(this.hostname=$)};var lz,nz;YZ&&(lz=YZ("pathToFileURL"),nz=YZ("fileURLToPath"));var k5={parse:a6,format:h1,resolve:y1};var I7=function($){if(typeof $!=="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify($)}`)},r6=function($){return $.split("?")[0].split("#")[0]},oz=function($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},sz=function($,Z,J){return $.replace(new RegExp(oz(Z),"g"),J)},iz=function($,Z){let J="",Q=0,K=-1,q=0,V=-1;for(let U=0;U<=$.length;++U){if(U<$.length)V=$.charCodeAt(U);else if(V===47)break;else V=47;if(V===47){if(K===U-1||q===1);else if(K!==U-1&&q===2){if(J.length<2||Q!==2||J.charCodeAt(J.length-1)!==46||J.charCodeAt(J.length-2)!==46){if(J.length>2){const H=J.lastIndexOf("/");if(H!==J.length-1){if(H===-1)J="",Q=0;else J=J.slice(0,H),Q=J.length-1-J.lastIndexOf("/");K=U,q=0;continue}}else if(J.length===2||J.length===1){J="",Q=0,K=U,q=0;continue}}if(Z){if(J.length>0)J+="/..";else J="..";Q=2}}else{if(J.length>0)J+=`/${$.slice(K+1,U)}`;else J=$.slice(K+1,U);Q=U-K-1}K=U,q=0}else if(V===46&&q!==-1)++q;else q=-1}return J},GZ={toPosix($){return sz($,"\\","/")},isUrl($){return/^https?:/.test(this.toPosix($))},isDataUrl($){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test($)},hasProtocol($){return/^[^/:]+:\//.test(this.toPosix($))},getProtocol($){I7($),$=this.toPosix($);let Z="";const J=/^file:\/\/\//.exec($),Q=/^[^/:]+:\/\//.exec($),K=/^[^/:]+:\//.exec($);if(J||Q||K){const q=J?.[0]||Q?.[0]||K?.[0];Z=q,$=$.slice(q.length)}return Z},toAbsolute($,Z,J){if(this.isDataUrl($))return $;const Q=r6(this.toPosix(Z??I.ADAPTER.getBaseUrl())),K=r6(this.toPosix(J??this.rootname(Q)));if(I7($),$=this.toPosix($),$.startsWith("/"))return GZ.join(K,$.slice(1));return this.isAbsolute($)?$:this.join(Q,$)},normalize($){if($=this.toPosix($),I7($),$.length===0)return".";let Z="";const J=$.startsWith("/");if(this.hasProtocol($))Z=this.rootname($),$=$.slice(Z.length);const Q=$.endsWith("/");if($=iz($,!1),$.length>0&&Q)$+="/";if(J)return`/${$}`;return Z+$},isAbsolute($){if(I7($),$=this.toPosix($),this.hasProtocol($))return!0;return $.startsWith("/")},join(...$){if($.length===0)return".";let Z;for(let J=0;J<$.length;++J){const Q=$[J];if(I7(Q),Q.length>0)if(Z===void 0)Z=Q;else{const K=$[J-1]??"";if(this.extname(K))Z+=`/../${Q}`;else Z+=`/${Q}`}}if(Z===void 0)return".";return this.normalize(Z)},dirname($){if(I7($),$.length===0)return".";$=this.toPosix($);let Z=$.charCodeAt(0);const J=Z===47;let Q=-1,K=!0;const q=this.getProtocol($),V=$;$=$.slice(q.length);for(let U=$.length-1;U>=1;--U)if(Z=$.charCodeAt(U),Z===47){if(!K){Q=U;break}}else K=!1;if(Q===-1)return J?"/":this.isUrl(V)?q+$:q;if(J&&Q===1)return"//";return q+$.slice(0,Q)},rootname($){I7($),$=this.toPosix($);let Z="";if($.startsWith("/"))Z="/";else Z=this.getProtocol($);if(this.isUrl($)){const J=$.indexOf("/",Z.length);if(J!==-1)Z=$.slice(0,J);else Z=$;if(!Z.endsWith("/"))Z+="/"}return Z},basename($,Z){if(I7($),Z)I7(Z);$=r6(this.toPosix($));let J=0,Q=-1,K=!0,q;if(Z!==void 0&&Z.length>0&&Z.length<=$.length){if(Z.length===$.length&&Z===$)return"";let V=Z.length-1,U=-1;for(q=$.length-1;q>=0;--q){const H=$.charCodeAt(q);if(H===47){if(!K){J=q+1;break}}else{if(U===-1)K=!1,U=q+1;if(V>=0)if(H===Z.charCodeAt(V)){if(--V===-1)Q=q}else V=-1,Q=U}}if(J===Q)Q=U;else if(Q===-1)Q=$.length;return $.slice(J,Q)}for(q=$.length-1;q>=0;--q)if($.charCodeAt(q)===47){if(!K){J=q+1;break}}else if(Q===-1)K=!1,Q=q+1;if(Q===-1)return"";return $.slice(J,Q)},extname($){I7($),$=r6(this.toPosix($));let Z=-1,J=0,Q=-1,K=!0,q=0;for(let V=$.length-1;V>=0;--V){const U=$.charCodeAt(V);if(U===47){if(!K){J=V+1;break}continue}if(Q===-1)K=!1,Q=V+1;if(U===46){if(Z===-1)Z=V;else if(q!==1)q=1}else if(Z!==-1)q=-1}if(Z===-1||Q===-1||q===0||q===1&&Z===Q-1&&Z===J+1)return"";return $.slice(Z,Q)},parse($){I7($);const Z={root:"",dir:"",base:"",ext:"",name:""};if($.length===0)return Z;$=r6(this.toPosix($));let J=$.charCodeAt(0);const Q=this.isAbsolute($);let K;const q="";if(Z.root=this.rootname($),Q||this.hasProtocol($))K=1;else K=0;let V=-1,U=0,H=-1,z=!0,W=$.length-1,Y=0;for(;W>=K;--W){if(J=$.charCodeAt(W),J===47){if(!z){U=W+1;break}continue}if(H===-1)z=!1,H=W+1;if(J===46){if(V===-1)V=W;else if(Y!==1)Y=1}else if(V!==-1)Y=-1}if(V===-1||H===-1||Y===0||Y===1&&V===H-1&&V===U+1){if(H!==-1)if(U===0&&Q)Z.base=Z.name=$.slice(1,H);else Z.base=Z.name=$.slice(U,H)}else{if(U===0&&Q)Z.name=$.slice(1,V),Z.base=$.slice(1,H);else Z.name=$.slice(U,V),Z.base=$.slice(U,H);Z.ext=$.slice(V,H)}if(Z.dir=this.dirname($),q)Z.dir=q+Z.dir;return Z},sep:"/",delimiter:":"};var t=function($,Z,J=3){if(f1[Z])return;let Q=new Error().stack;if(typeof Q==="undefined")console.warn("PixiJS Deprecation Warning: ",`${Z}
Deprecated since v${$}`);else if(Q=Q.split("\n").splice(J).join("\n"),console.groupCollapsed)console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${Z}
Deprecated since v${$}`),console.warn(Q),console.groupEnd();else console.warn("PixiJS Deprecation Warning: ",`${Z}
Deprecated since v${$}`),console.warn(Q);f1[Z]=!0},f1={};var g1=function(){t("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")},x1=function(){t("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)};var O5=function(){if(typeof NZ==="undefined")NZ=function $(){const Z={stencil:!0,failIfMajorPerformanceCaveat:I.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!I.ADAPTER.getWebGLRenderingContext())return!1;const J=I.ADAPTER.createCanvas();let Q=J.getContext("webgl",Z)||J.getContext("experimental-webgl",Z);const K=!!Q?.getContextAttributes()?.stencil;if(Q){const q=Q.getExtension("WEBGL_lose_context");if(q)q.loseContext()}return Q=null,K}catch(J){return!1}}();return NZ},NZ;var az={grad:0.9,turn:360,rad:360/(2*Math.PI)},p7=function($){return typeof $=="string"?$.length>0:typeof $=="number"},R0=function($,Z,J){return Z===void 0&&(Z=0),J===void 0&&(J=Math.pow(10,Z)),Math.round(J*$)/J+0},w7=function($,Z,J){return Z===void 0&&(Z=0),J===void 0&&(J=1),$>J?J:$>Z?$:Z},o1=function($){return($=isFinite($)?$%360:0)>0?$:$+360},m1=function($){return{r:w7($.r,0,255),g:w7($.g,0,255),b:w7($.b,0,255),a:w7($.a)}},LZ=function($){return{r:R0($.r),g:R0($.g),b:R0($.b),a:R0($.a,3)}},rz=/^#([0-9a-f]{3,8})$/i,R5=function($){var Z=$.toString(16);return Z.length<2?"0"+Z:Z},s1=function($){var{r:Z,g:J,b:Q,a:K}=$,q=Math.max(Z,J,Q),V=q-Math.min(Z,J,Q),U=V?q===Z?(J-Q)/V:q===J?2+(Q-Z)/V:4+(Z-J)/V:0;return{h:60*(U<0?U+6:U),s:q?V/q*100:0,v:q/255*100,a:K}},i1=function($){var{h:Z,s:J,v:Q,a:K}=$;Z=Z/360*6,J/=100,Q/=100;var q=Math.floor(Z),V=Q*(1-J),U=Q*(1-(Z-q)*J),H=Q*(1-(1-Z+q)*J),z=q%6;return{r:255*[Q,U,V,V,H,Q][z],g:255*[H,Q,Q,U,V,V][z],b:255*[V,V,H,Q,Q,U][z],a:K}},c1=function($){return{h:o1($.h),s:w7($.s,0,100),l:w7($.l,0,100),a:w7($.a)}},p1=function($){return{h:R0($.h),s:R0($.s),l:R0($.l),a:R0($.a,3)}},u1=function($){return i1((J=(Z=$).s,{h:Z.h,s:(J*=((Q=Z.l)<50?Q:100-Q)/100)>0?2*J/(Q+J)*100:0,v:Q+J,a:Z.a}));var Z,J,Q},t6=function($){return{h:(Z=s1($)).h,s:(K=(200-(J=Z.s))*(Q=Z.v)/100)>0&&K<200?J*Q/100/(K<=100?K:200-K)*100:0,l:K/2,a:Z.a};var Z,J,Q,K},tz=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ez=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,$W=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ZW=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,FZ={string:[[function($){var Z=rz.exec($);return Z?($=Z[1]).length<=4?{r:parseInt($[0]+$[0],16),g:parseInt($[1]+$[1],16),b:parseInt($[2]+$[2],16),a:$.length===4?R0(parseInt($[3]+$[3],16)/255,2):1}:$.length===6||$.length===8?{r:parseInt($.substr(0,2),16),g:parseInt($.substr(2,2),16),b:parseInt($.substr(4,2),16),a:$.length===8?R0(parseInt($.substr(6,2),16)/255,2):1}:null:null},"hex"],[function($){var Z=$W.exec($)||ZW.exec($);return Z?Z[2]!==Z[4]||Z[4]!==Z[6]?null:m1({r:Number(Z[1])/(Z[2]?0.39215686274509803:1),g:Number(Z[3])/(Z[4]?0.39215686274509803:1),b:Number(Z[5])/(Z[6]?0.39215686274509803:1),a:Z[7]===void 0?1:Number(Z[7])/(Z[8]?100:1)}):null},"rgb"],[function($){var Z=tz.exec($)||ez.exec($);if(!Z)return null;var J,Q,K=c1({h:(J=Z[1],Q=Z[2],Q===void 0&&(Q="deg"),Number(J)*(az[Q]||1)),s:Number(Z[3]),l:Number(Z[4]),a:Z[5]===void 0?1:Number(Z[5])/(Z[6]?100:1)});return u1(K)},"hsl"]],object:[[function($){var{r:Z,g:J,b:Q,a:K}=$,q=K===void 0?1:K;return p7(Z)&&p7(J)&&p7(Q)?m1({r:Number(Z),g:Number(J),b:Number(Q),a:Number(q)}):null},"rgb"],[function($){var{h:Z,s:J,l:Q,a:K}=$,q=K===void 0?1:K;if(!p7(Z)||!p7(J)||!p7(Q))return null;var V=c1({h:Number(Z),s:Number(J),l:Number(Q),a:Number(q)});return u1(V)},"hsl"],[function($){var{h:Z,s:J,v:Q,a:K}=$,q=K===void 0?1:K;if(!p7(Z)||!p7(J)||!p7(Q))return null;var V=function(U){return{h:o1(U.h),s:w7(U.s,0,100),v:w7(U.v,0,100),a:w7(U.a)}}({h:Number(Z),s:Number(J),v:Number(Q),a:Number(q)});return i1(V)},"hsv"]]},d1=function($,Z){for(var J=0;J<Z.length;J++){var Q=Z[J][0]($);if(Q)return[Q,Z[J][1]]}return[null,void 0]},JW=function($){return typeof $=="string"?d1($.trim(),FZ.string):typeof $=="object"&&$!==null?d1($,FZ.object):[null,void 0]};var BZ=function($,Z){var J=t6($);return{h:J.h,s:w7(J.s+100*Z,0,100),l:J.l,a:J.a}},PZ=function($){return(299*$.r+587*$.g+114*$.b)/1000/255},l1=function($,Z){var J=t6($);return{h:J.h,s:J.s,l:w7(J.l+100*Z,0,100),a:J.a}},IZ=function(){function $(Z){this.parsed=JW(Z)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return $.prototype.isValid=function(){return this.parsed!==null},$.prototype.brightness=function(){return R0(PZ(this.rgba),2)},$.prototype.isDark=function(){return PZ(this.rgba)<0.5},$.prototype.isLight=function(){return PZ(this.rgba)>=0.5},$.prototype.toHex=function(){return Z=LZ(this.rgba),J=Z.r,Q=Z.g,K=Z.b,V=(q=Z.a)<1?R5(R0(255*q)):"","#"+R5(J)+R5(Q)+R5(K)+V;var Z,J,Q,K,q,V},$.prototype.toRgb=function(){return LZ(this.rgba)},$.prototype.toRgbString=function(){return Z=LZ(this.rgba),J=Z.r,Q=Z.g,K=Z.b,(q=Z.a)<1?"rgba("+J+", "+Q+", "+K+", "+q+")":"rgb("+J+", "+Q+", "+K+")";var Z,J,Q,K,q},$.prototype.toHsl=function(){return p1(t6(this.rgba))},$.prototype.toHslString=function(){return Z=p1(t6(this.rgba)),J=Z.h,Q=Z.s,K=Z.l,(q=Z.a)<1?"hsla("+J+", "+Q+"%, "+K+"%, "+q+")":"hsl("+J+", "+Q+"%, "+K+"%)";var Z,J,Q,K,q},$.prototype.toHsv=function(){return Z=s1(this.rgba),{h:R0(Z.h),s:R0(Z.s),v:R0(Z.v),a:R0(Z.a,3)};var Z},$.prototype.invert=function(){return k7({r:255-(Z=this.rgba).r,g:255-Z.g,b:255-Z.b,a:Z.a});var Z},$.prototype.saturate=function(Z){return Z===void 0&&(Z=0.1),k7(BZ(this.rgba,Z))},$.prototype.desaturate=function(Z){return Z===void 0&&(Z=0.1),k7(BZ(this.rgba,-Z))},$.prototype.grayscale=function(){return k7(BZ(this.rgba,-1))},$.prototype.lighten=function(Z){return Z===void 0&&(Z=0.1),k7(l1(this.rgba,Z))},$.prototype.darken=function(Z){return Z===void 0&&(Z=0.1),k7(l1(this.rgba,-Z))},$.prototype.rotate=function(Z){return Z===void 0&&(Z=15),this.hue(this.hue()+Z)},$.prototype.alpha=function(Z){return typeof Z=="number"?k7({r:(J=this.rgba).r,g:J.g,b:J.b,a:Z}):R0(this.rgba.a,3);var J},$.prototype.hue=function(Z){var J=t6(this.rgba);return typeof Z=="number"?k7({h:Z,s:J.s,l:J.l,a:J.a}):R0(J.h)},$.prototype.isEqual=function(Z){return this.toHex()===k7(Z).toHex()},$}(),k7=function($){return $ instanceof IZ?$:new IZ($)},n1=[],a1=function($){$.forEach(function(Z){n1.indexOf(Z)<0&&(Z(IZ,FZ),n1.push(Z))})};function kZ($,Z){var J={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},Q={};for(var K in J)Q[J[K]]=K;var q={};$.prototype.toName=function(V){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var U,H,z=Q[this.toHex()];if(z)return z;if(V==null?void 0:V.closest){var W=this.toRgb(),Y=Infinity,w="black";if(!q.length)for(var j in J)q[j]=new $(J[j]).toRgb();for(var C in J){var X=(U=W,H=q[C],Math.pow(U.r-H.r,2)+Math.pow(U.g-H.g,2)+Math.pow(U.b-H.b,2));X<Y&&(Y=X,w=C)}return w}},Z.string.push([function(V){var U=V.toLowerCase(),H=U==="transparent"?"#0000":J[U];return H?new $(H).toRgb():null},"name"])}a1([kZ]);var V6=class{constructor($=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=$}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue($){return this.value=$,this}set value($){if($ instanceof V6)this._value=this.cloneSource($._value),this._int=$._int,this._components.set($._components);else if($===null)throw new Error("Cannot set PIXI.Color#value to null");else if(this._value===null||!this.isSourceEqual(this._value,$))this.normalize($),this._value=this.cloneSource($)}get value(){return this._value}cloneSource($){if(typeof $==="string"||typeof $==="number"||$ instanceof Number||$===null)return $;else if(Array.isArray($)||ArrayBuffer.isView($))return $.slice(0);else if(typeof $==="object"&&$!==null)return{...$};return $}isSourceEqual($,Z){const J=typeof $;if(J!==typeof Z)return!1;else if(J==="number"||J==="string"||$ instanceof Number)return $===Z;else if(Array.isArray($)&&Array.isArray(Z)||ArrayBuffer.isView($)&&ArrayBuffer.isView(Z)){if($.length!==Z.length)return!1;return $.every((K,q)=>K===Z[q])}else if($!==null&&Z!==null){const K=Object.keys($),q=Object.keys(Z);if(K.length!==q.length)return!1;return K.every((V)=>$[V]===Z[V])}return $===Z}toRgba(){const[$,Z,J,Q]=this._components;return{r:$,g:Z,b:J,a:Q}}toRgb(){const[$,Z,J]=this._components;return{r:$,g:Z,b:J}}toRgbaString(){const[$,Z,J]=this.toUint8RgbArray();return`rgba(${$},${Z},${J},${this.alpha})`}toUint8RgbArray($){const[Z,J,Q]=this._components;return $=$??[],$[0]=Math.round(Z*255),$[1]=Math.round(J*255),$[2]=Math.round(Q*255),$}toRgbArray($){$=$??[];const[Z,J,Q]=this._components;return $[0]=Z,$[1]=J,$[2]=Q,$}toNumber(){return this._int}toLittleEndianNumber(){const $=this._int;return($>>16)+($&65280)+(($&255)<<16)}multiply($){const[Z,J,Q,K]=V6.temp.setValue($)._components;return this._components[0]*=Z,this._components[1]*=J,this._components[2]*=Q,this._components[3]*=K,this.refreshInt(),this._value=null,this}premultiply($,Z=!0){if(Z)this._components[0]*=$,this._components[1]*=$,this._components[2]*=$;return this._components[3]=$,this.refreshInt(),this._value=null,this}toPremultiplied($,Z=!0){if($===1)return(255<<24)+this._int;if($===0)return Z?0:this._int;let J=this._int>>16&255,Q=this._int>>8&255,K=this._int&255;if(Z)J=J*$+0.5|0,Q=Q*$+0.5|0,K=K*$+0.5|0;return($*255<<24)+(J<<16)+(Q<<8)+K}toHex(){const $=this._int.toString(16);return`#${"000000".substring(0,6-$.length)+$}`}toHexa(){const Z=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-Z.length)+Z}setAlpha($){return this._components[3]=this._clamp($),this}round($){const[Z,J,Q]=this._components;return this._components[0]=Math.round(Z*$)/$,this._components[1]=Math.round(J*$)/$,this._components[2]=Math.round(Q*$)/$,this.refreshInt(),this._value=null,this}toArray($){$=$??[];const[Z,J,Q,K]=this._components;return $[0]=Z,$[1]=J,$[2]=Q,$[3]=K,$}normalize($){let Z,J,Q,K;if((typeof $==="number"||$ instanceof Number)&&$>=0&&$<=16777215){const q=$;Z=(q>>16&255)/255,J=(q>>8&255)/255,Q=(q&255)/255,K=1}else if((Array.isArray($)||$ instanceof Float32Array)&&$.length>=3&&$.length<=4)$=this._clamp($),[Z,J,Q,K=1]=$;else if(($ instanceof Uint8Array||$ instanceof Uint8ClampedArray)&&$.length>=3&&$.length<=4)$=this._clamp($,0,255),[Z,J,Q,K=255]=$,Z/=255,J/=255,Q/=255,K/=255;else if(typeof $==="string"||typeof $==="object"){if(typeof $==="string"){const V=V6.HEX_PATTERN.exec($);if(V)$=`#${V[2]}`}const q=k7($);if(q.isValid())({r:Z,g:J,b:Q,a:K}=q.rgba),Z/=255,J/=255,Q/=255}if(Z!==void 0)this._components[0]=Z,this._components[1]=J,this._components[2]=Q,this._components[3]=K,this.refreshInt();else throw new Error(`Unable to convert color ${$}`)}refreshInt(){this._clamp(this._components);const[$,Z,J]=this._components;this._int=($*255<<16)+(Z*255<<8)+(J*255|0)}_clamp($,Z=0,J=1){if(typeof $==="number")return Math.min(Math.max($,Z),J);return $.forEach((Q,K)=>{$[K]=Math.min(Math.max(Q,Z),J)}),$}},a=V6;a.shared=new V6;a.temp=new V6;a.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;var r1=function($,Z=[]){return t("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),a.shared.setValue($).toRgbArray(Z)},t1=function($){return t("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),a.shared.setValue($).toHex()},e1=function($){return t("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),a.shared.setValue($).toNumber()},$K=function($){return t("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),a.shared.setValue($).toNumber()};var QW=function(){const $=[],Z=[];for(let Q=0;Q<32;Q++)$[Q]=Q,Z[Q]=Q;$[o.NORMAL_NPM]=o.NORMAL,$[o.ADD_NPM]=o.ADD,$[o.SCREEN_NPM]=o.SCREEN,Z[o.NORMAL]=o.NORMAL_NPM,Z[o.ADD]=o.ADD_NPM,Z[o.SCREEN]=o.SCREEN_NPM;const J=[];return J.push(Z),J.push($),J},ZK=function($,Z){return e6[Z?1:0][$]},JK=function($,Z,J,Q=!0){return t("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),a.shared.setValue($).premultiply(Z,Q).toArray(J??new Float32Array(4))},QK=function($,Z){return t("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),a.shared.setValue($).toPremultiplied(Z)},KK=function($,Z,J,Q=!0){return t("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),a.shared.setValue($).premultiply(Z,Q).toArray(J??new Float32Array(4))},e6=QW();var _5=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;var qK=function($,Z=null){const J=$*6;if(Z=Z||new Uint16Array(J),Z.length!==J)throw new Error(`Out buffer length is incorrect, got ${Z.length} and expected ${J}`);for(let Q=0,K=0;Q<J;Q+=6,K+=4)Z[Q+0]=K+0,Z[Q+1]=K+1,Z[Q+2]=K+2,Z[Q+3]=K+0,Z[Q+4]=K+2,Z[Q+5]=K+3;return Z};var Z$=function($){if($.BYTES_PER_ELEMENT===4){if($ instanceof Float32Array)return"Float32Array";else if($ instanceof Uint32Array)return"Uint32Array";return"Int32Array"}else if($.BYTES_PER_ELEMENT===2){if($ instanceof Uint16Array)return"Uint16Array"}else if($.BYTES_PER_ELEMENT===1){if($ instanceof Uint8Array)return"Uint8Array"}return null};var VK=function($,Z){let J=0,Q=0;const K={};for(let H=0;H<$.length;H++)Q+=Z[H],J+=$[H].length;const q=new ArrayBuffer(J*4);let V=null,U=0;for(let H=0;H<$.length;H++){const z=Z[H],W=$[H],Y=Z$(W);if(!K[Y])K[Y]=new KW[Y](q);V=K[Y];for(let w=0;w<W.length;w++){const j=(w/z|0)*Q+U,C=w%z;V[j+C]=W[w]}U+=z}return new Float32Array(q)},KW={Float32Array,Uint32Array,Int32Array,Uint8Array};var J$=function($){return $+=$===0?1:0,--$,$|=$>>>1,$|=$>>>2,$|=$>>>4,$|=$>>>8,$|=$>>>16,$+1},$8=function($){return!($&$-1)&&!!$},Z8=function($){let Z=($>65535?1:0)<<4;$>>>=Z;let J=($>255?1:0)<<3;return $>>>=J,Z|=J,J=($>15?1:0)<<2,$>>>=J,Z|=J,J=($>3?1:0)<<1,$>>>=J,Z|=J,Z|$>>1};var M5=function($,Z,J){const Q=$.length;let K;if(Z>=Q||J===0)return;J=Z+J>Q?Q-Z:J;const q=Q-J;for(K=Z;K<q;++K)$[K]=$[K+J];$.length=q};var UK=function($){if($===0)return 0;return $<0?-1:1};var A7=function(){return++qW},qW=0;var HK=class{constructor($,Z,J,Q){this.left=$,this.top=Z,this.right=J,this.bottom=Q}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}},U6=HK;U6.EMPTY=new HK(0,0,0,0);var zK=function(){let $;for($ in _0)_0[$].destroy();for($ in p0)p0[$].destroy()},WK=function(){let $;for($ in _0)delete _0[$];for($ in p0)delete p0[$]},J8={},_0=Object.create(null),p0=Object.create(null);class OZ{constructor($,Z,J){this._canvas=I.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=J||I.RESOLUTION,this.resize($,Z)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize($,Z){this._checkDestroyed(),this._canvas.width=Math.round($*this.resolution),this._canvas.height=Math.round(Z*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width($){this._checkDestroyed(),this._canvas.width=Math.round($)}get height(){return this._checkDestroyed(),this._canvas.height}set height($){this._checkDestroyed(),this._canvas.height=Math.round($)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}var YK=function($,Z,J){for(let Q=0,K=4*J*Z;Q<Z;++Q,K+=4)if($[K+3]!==0)return!1;return!0},wK=function($,Z,J,Q,K){const q=4*Z;for(let V=Q,U=Q*q+4*J;V<=K;++V,U+=q)if($[U+3]!==0)return!1;return!0},D5=function($){const{width:Z,height:J}=$,Q=$.getContext("2d",{willReadFrequently:!0});if(Q===null)throw new TypeError("Failed to get canvas 2D context");const q=Q.getImageData(0,0,Z,J).data;let V=0,U=0,H=Z-1,z=J-1;while(U<J&&YK(q,Z,U))++U;if(U===J)return U6.EMPTY;while(YK(q,Z,z))--z;while(wK(q,Z,V,U,z))++V;while(wK(q,Z,H,U,z))--H;return++H,++z,new U6(V,U,H,z)};var jK=function($){const Z=D5($),{width:J,height:Q}=Z;let K=null;if(!Z.isEmpty()){const q=$.getContext("2d");if(q===null)throw new TypeError("Failed to get canvas 2D context");K=q.getImageData(Z.left,Z.top,J,Q)}return{width:J,height:Q,data:K}};var CK=function($){const Z=_5.exec($);if(Z)return{mediaType:Z[1]?Z[1].toLowerCase():void 0,subType:Z[2]?Z[2].toLowerCase():void 0,charset:Z[3]?Z[3].toLowerCase():void 0,encoding:Z[4]?Z[4].toLowerCase():void 0,data:Z[5]};return};var E5=function($,Z=globalThis.location){if($.startsWith("data:"))return"";if(Z=Z||globalThis.location,!A5)A5=document.createElement("a");A5.href=$;const J=k5.parse(A5.href),Q=!J.port&&Z.port===""||J.port===Z.port;if(J.hostname!==Z.hostname||!Q||J.protocol!==Z.protocol)return"anonymous";return""},A5;var Q8=function($,Z=1){const J=I.RETINA_PREFIX?.exec($);if(J)return parseFloat(J[1]);return Z};var O=(($)=>{return $.Renderer="renderer",$.Application="application",$.RendererSystem="renderer-webgl-system",$.RendererPlugin="renderer-webgl-plugin",$.CanvasRendererSystem="renderer-canvas-system",$.CanvasRendererPlugin="renderer-canvas-plugin",$.Asset="asset",$.LoadParser="load-parser",$.ResolveParser="resolve-parser",$.CacheParser="cache-parser",$.DetectionParser="detection-parser",$})(O||{}),RZ=($)=>{if(typeof $==="function"||typeof $==="object"&&$.extension){if(!$.extension)throw new Error("Extension class must have an extension object");$={...typeof $.extension!=="object"?{type:$.extension}:$.extension,ref:$}}if(typeof $==="object")$={...$};else throw new Error("Invalid extension type");if(typeof $.type==="string")$.type=[$.type];return $},GK=($,Z)=>RZ($).priority??Z,_={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...$){return $.map(RZ).forEach((Z)=>{Z.type.forEach((J)=>this._removeHandlers[J]?.(Z))}),this},add(...$){return $.map(RZ).forEach((Z)=>{Z.type.forEach((J)=>{const Q=this._addHandlers,K=this._queue;if(!Q[J])K[J]=K[J]||[],K[J].push(Z);else Q[J](Z)})}),this},handle($,Z,J){const Q=this._addHandlers,K=this._removeHandlers;if(Q[$]||K[$])throw new Error(`Extension type ${$} already has a handler`);Q[$]=Z,K[$]=J;const q=this._queue;if(q[$])q[$].forEach((V)=>Z(V)),delete q[$];return this},handleByMap($,Z){return this.handle($,(J)=>{Z[J.name]=J.ref},(J)=>{delete Z[J.name]})},handleByList($,Z,J=-1){return this.handle($,(Q)=>{if(Z.includes(Q.ref))return;Z.push(Q.ref),Z.sort((K,q)=>GK(q,J)-GK(K,J))},(Q)=>{const K=Z.indexOf(Q.ref);if(K!==-1)Z.splice(K,1)})}};class E${constructor($){if(typeof $==="number")this.rawBinaryData=new ArrayBuffer($);else if($ instanceof Uint8Array)this.rawBinaryData=$.buffer;else this.rawBinaryData=$;this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){if(!this._int8View)this._int8View=new Int8Array(this.rawBinaryData);return this._int8View}get uint8View(){if(!this._uint8View)this._uint8View=new Uint8Array(this.rawBinaryData);return this._uint8View}get int16View(){if(!this._int16View)this._int16View=new Int16Array(this.rawBinaryData);return this._int16View}get uint16View(){if(!this._uint16View)this._uint16View=new Uint16Array(this.rawBinaryData);return this._uint16View}get int32View(){if(!this._int32View)this._int32View=new Int32Array(this.rawBinaryData);return this._int32View}view($){return this[`${$}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf($){switch($){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${$} isn't a valid view type`)}}}var UW=function($){let Z="";for(let J=0;J<$;++J){if(J>0)Z+="\nelse ";if(J<$-1)Z+=`if(test == ${J}.0){}`}return Z},b5=function($,Z){if($===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const J=Z.createShader(Z.FRAGMENT_SHADER);while(!0){const Q=VW.replace(/%forloop%/gi,UW($));if(Z.shaderSource(J,Q),Z.compileShader(J),!Z.getShaderParameter(J,Z.COMPILE_STATUS))$=$/2|0;else break}return $},VW=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");var _Z=0,MZ=1,DZ=2,AZ=3,EZ=4,bZ=5;class A0{constructor(){this.data=0,this.blendMode=o.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<_Z)}set blend($){if(!!(this.data&1<<_Z)!==$)this.data^=1<<_Z}get offsets(){return!!(this.data&1<<MZ)}set offsets($){if(!!(this.data&1<<MZ)!==$)this.data^=1<<MZ}get culling(){return!!(this.data&1<<DZ)}set culling($){if(!!(this.data&1<<DZ)!==$)this.data^=1<<DZ}get depthTest(){return!!(this.data&1<<AZ)}set depthTest($){if(!!(this.data&1<<AZ)!==$)this.data^=1<<AZ}get depthMask(){return!!(this.data&1<<bZ)}set depthMask($){if(!!(this.data&1<<bZ)!==$)this.data^=1<<bZ}get clockwiseFrontFace(){return!!(this.data&1<<EZ)}set clockwiseFrontFace($){if(!!(this.data&1<<EZ)!==$)this.data^=1<<EZ}get blendMode(){return this._blendMode}set blendMode($){this.blend=$!==o.NONE,this._blendMode=$}get polygonOffset(){return this._polygonOffset}set polygonOffset($){this.offsets=!!$,this._polygonOffset=$}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const $=new A0;return $.depthTest=!1,$.blend=!0,$}}var z6=function($,Z){if(!$)return null;let J="";if(typeof $==="string"){const Q=/\.(\w{3,4})(?:$|\?|#)/i.exec($);if(Q)J=Q[1].toLowerCase()}for(let Q=H6.length-1;Q>=0;--Q){const K=H6[Q];if(K.test&&K.test($,J))return new K($,Z)}throw new Error("Unrecognized source type to auto-detect Resource")},H6=[];class F0{constructor($){this.items=[],this._name=$,this._aliasCount=0}emit($,Z,J,Q,K,q,V,U){if(arguments.length>8)throw new Error("max arguments reached");const{name:H,items:z}=this;this._aliasCount++;for(let W=0,Y=z.length;W<Y;W++)z[W][H]($,Z,J,Q,K,q,V,U);if(z===this.items)this._aliasCount--;return this}ensureNonAliasedItems(){if(this._aliasCount>0&&this.items.length>1)this._aliasCount=0,this.items=this.items.slice(0)}add($){if($[this._name])this.ensureNonAliasedItems(),this.remove($),this.items.push($);return this}remove($){const Z=this.items.indexOf($);if(Z!==-1)this.ensureNonAliasedItems(),this.items.splice(Z,1);return this}contains($){return this.items.includes($)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(F0.prototype,{dispatch:{value:F0.prototype.emit},run:{value:F0.prototype.emit}});class j7{constructor($=0,Z=0){this._width=$,this._height=Z,this.destroyed=!1,this.internal=!1,this.onResize=new F0("setRealSize"),this.onUpdate=new F0("update"),this.onError=new F0("onError")}bind($){if(this.onResize.add($),this.onUpdate.add($),this.onError.add($),this._width||this._height)this.onResize.emit(this._width,this._height)}unbind($){this.onResize.remove($),this.onUpdate.remove($),this.onError.remove($)}resize($,Z){if($!==this._width||Z!==this._height)this._width=$,this._height=Z,this.onResize.emit($,Z)}get valid(){return!!this._width&&!!this._height}update(){if(!this.destroyed)this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style($,Z,J){return!1}dispose(){}destroy(){if(!this.destroyed)this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null}static test($,Z){return!1}}class J7 extends j7{constructor($,Z){const{width:J,height:Q}=Z||{};if(!J||!Q)throw new Error("BufferResource width or height invalid");super(J,Q);this.data=$}upload($,Z,J){const Q=$.gl;Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.alphaMode===P0.UNPACK);const{realWidth:K,realHeight:q}=Z;if(J.width===K&&J.height===q)Q.texSubImage2D(Z.target,0,0,0,K,q,Z.format,J.type,this.data);else J.width=K,J.height=q,Q.texImage2D(Z.target,0,J.internalFormat,K,q,0,Z.format,J.type,this.data);return!0}dispose(){this.data=null}static test($){return $ instanceof Float32Array||$ instanceof Uint8Array||$ instanceof Uint32Array}}var HW={scaleMode:a0.NEAREST,format:b.RGBA,alphaMode:P0.NPM},W6=class extends Q$.default{constructor($=null,Z=null){super();Z=Object.assign({},W6.defaultOptions,Z);const{alphaMode:J,mipmap:Q,anisotropicLevel:K,scaleMode:q,width:V,height:U,wrapMode:H,format:z,type:W,target:Y,resolution:w,resourceOptions:j}=Z;if($&&!($ instanceof j7))$=z6($,j),$.internal=!0;this.resolution=w||I.RESOLUTION,this.width=Math.round((V||0)*this.resolution)/this.resolution,this.height=Math.round((U||0)*this.resolution)/this.resolution,this._mipmap=Q,this.anisotropicLevel=K,this._wrapMode=H,this._scaleMode=q,this.format=z,this.type=W,this.target=Y,this.alphaMode=J,this.uid=A7(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=V>0&&U>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource($)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap($){if(this._mipmap!==$)this._mipmap=$,this.dirtyStyleId++}get scaleMode(){return this._scaleMode}set scaleMode($){if(this._scaleMode!==$)this._scaleMode=$,this.dirtyStyleId++}get wrapMode(){return this._wrapMode}set wrapMode($){if(this._wrapMode!==$)this._wrapMode=$,this.dirtyStyleId++}setStyle($,Z){let J;if($!==void 0&&$!==this.scaleMode)this.scaleMode=$,J=!0;if(Z!==void 0&&Z!==this.mipmap)this.mipmap=Z,J=!0;if(J)this.dirtyStyleId++;return this}setSize($,Z,J){return J=J||this.resolution,this.setRealSize($*J,Z*J,J)}setRealSize($,Z,J){return this.resolution=J||this.resolution,this.width=Math.round($)/this.resolution,this.height=Math.round(Z)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=$8(this.realWidth)&&$8(this.realHeight)}setResolution($){const Z=this.resolution;if(Z===$)return this;if(this.resolution=$,this.valid)this.width=Math.round(this.width*Z)/$,this.height=Math.round(this.height*Z)/$,this.emit("update",this);return this._refreshPOT(),this}setResource($){if(this.resource===$)return this;if(this.resource)throw new Error("Resource can be set only once");return $.bind(this),this.resource=$,this}update(){if(!this.valid){if(this.width>0&&this.height>0)this.valid=!0,this.emit("loaded",this),this.emit("update",this)}else this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)}onError($){this.emit("error",this,$)}destroy(){if(this.resource){if(this.resource.unbind(this),this.resource.internal)this.resource.destroy();this.resource=null}if(this.cacheId)delete p0[this.cacheId],delete _0[this.cacheId],this.cacheId=null;this.dispose(),W6.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from($,Z,J=I.STRICT_TEXTURE_CACHE){const Q=typeof $==="string";let K=null;if(Q)K=$;else{if(!$._pixiId){const V=Z?.pixiIdPrefix||"pixiid";$._pixiId=`${V}_${A7()}`}K=$._pixiId}let q=p0[K];if(Q&&J&&!q)throw new Error(`The cacheId "${K}" does not exist in BaseTextureCache.`);if(!q)q=new W6($,Z),q.cacheId=K,W6.addToCache(q,K);return q}static fromBuffer($,Z,J,Q){$=$||new Float32Array(Z*J*4);const K=new J7($,{width:Z,height:J}),q=$ instanceof Float32Array?l.FLOAT:l.UNSIGNED_BYTE;return new W6(K,Object.assign({},HW,{type:q},Q))}static addToCache($,Z){if(Z){if(!$.textureCacheIds.includes(Z))$.textureCacheIds.push(Z);if(p0[Z]&&p0[Z]!==$)console.warn(`BaseTexture added to the cache with an id [${Z}] that already had an entry`);p0[Z]=$}}static removeFromCache($){if(typeof $==="string"){const Z=p0[$];if(Z){const J=Z.textureCacheIds.indexOf($);if(J>-1)Z.textureCacheIds.splice(J,1);return delete p0[$],Z}}else if($?.textureCacheIds){for(let Z=0;Z<$.textureCacheIds.length;++Z)delete p0[$.textureCacheIds[Z]];return $.textureCacheIds.length=0,$}return null}},p=W6;p.defaultOptions={mipmap:D0.POW2,anisotropicLevel:0,scaleMode:a0.LINEAR,wrapMode:x0.CLAMP,alphaMode:P0.UNPACK,target:m7.TEXTURE_2D,format:b.RGBA,type:l.UNSIGNED_BYTE};p._globalBatch=0;class b${constructor(){this.texArray=null,this.blend=0,this.type=i0.TRIANGLES,this.start=0,this.size=0,this.data=null}}var zW=0;class z0{constructor($,Z=!0,J=!1){this.data=$||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=J,this.static=Z,this.id=zW++,this.disposeRunner=new F0("disposeBuffer")}update($){if($ instanceof Array)$=new Float32Array($);this.data=$||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index($){this.type=$?r0.ELEMENT_ARRAY_BUFFER:r0.ARRAY_BUFFER}get index(){return this.type===r0.ELEMENT_ARRAY_BUFFER}static from($){if($ instanceof Array)$=new Float32Array($);return new z0($)}}class Y6{constructor($,Z=0,J=!1,Q=l.FLOAT,K,q,V,U=1){this.buffer=$,this.size=Z,this.normalized=J,this.type=Q,this.stride=K,this.start=q,this.instance=V,this.divisor=U}destroy(){this.buffer=null}static from($,Z,J,Q,K){return new Y6($,Z,J,Q,K)}}var NK=function($,Z){let J=0,Q=0;const K={};for(let H=0;H<$.length;H++)Q+=Z[H],J+=$[H].length;const q=new ArrayBuffer(J*4);let V=null,U=0;for(let H=0;H<$.length;H++){const z=Z[H],W=$[H],Y=Z$(W);if(!K[Y])K[Y]=new WW[Y](q);V=K[Y];for(let w=0;w<W.length;w++){const j=(w/z|0)*Q+U,C=w%z;V[j+C]=W[w]}U+=z}return new Float32Array(q)},WW={Float32Array,Uint32Array,Int32Array,Uint8Array};var LK={5126:4,5123:2,5121:1},YW=0,wW={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class t0{constructor($=[],Z={}){this.buffers=$,this.indexBuffer=null,this.attributes=Z,this.glVertexArrayObjects={},this.id=YW++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new F0("disposeGeometry"),this.refCount=0}addAttribute($,Z,J=0,Q=!1,K,q,V,U=!1){if(!Z)throw new Error("You must pass a buffer when creating an attribute");if(!(Z instanceof z0)){if(Z instanceof Array)Z=new Float32Array(Z);Z=new z0(Z)}const H=$.split("|");if(H.length>1){for(let W=0;W<H.length;W++)this.addAttribute(H[W],Z,J,Q,K);return this}let z=this.buffers.indexOf(Z);if(z===-1)this.buffers.push(Z),z=this.buffers.length-1;return this.attributes[$]=new Y6(z,J,Q,K,q,V,U),this.instanced=this.instanced||U,this}getAttribute($){return this.attributes[$]}getBuffer($){return this.buffers[this.getAttribute($).buffer]}addIndex($){if(!($ instanceof z0)){if($ instanceof Array)$=new Uint16Array($);$=new z0($)}if($.type=r0.ELEMENT_ARRAY_BUFFER,this.indexBuffer=$,!this.buffers.includes($))this.buffers.push($);return this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const $=[],Z=[],J=new z0;let Q;for(Q in this.attributes){const K=this.attributes[Q],q=this.buffers[K.buffer];$.push(q.data),Z.push(K.size*LK[K.type]/4),K.buffer=0}J.data=NK($,Z);for(Q=0;Q<this.buffers.length;Q++)if(this.buffers[Q]!==this.indexBuffer)this.buffers[Q].destroy();if(this.buffers=[J],this.indexBuffer)this.buffers.push(this.indexBuffer);return this}getSize(){for(let $ in this.attributes){const Z=this.attributes[$];return this.buffers[Z.buffer].data.length/(Z.stride/4||Z.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const $=new t0;for(let Z=0;Z<this.buffers.length;Z++)$.buffers[Z]=new z0(this.buffers[Z].data.slice(0));for(let Z in this.attributes){const J=this.attributes[Z];$.attributes[Z]=new Y6(J.buffer,J.size,J.normalized,J.type,J.stride,J.start,J.instance)}if(this.indexBuffer)$.indexBuffer=$.buffers[this.buffers.indexOf(this.indexBuffer)],$.indexBuffer.type=r0.ELEMENT_ARRAY_BUFFER;return $}static merge($){const Z=new t0,J=[],Q=[],K=[];let q;for(let V=0;V<$.length;V++){q=$[V];for(let U=0;U<q.buffers.length;U++)Q[U]=Q[U]||0,Q[U]+=q.buffers[U].data.length,K[U]=0}for(let V=0;V<q.buffers.length;V++)J[V]=new wW[Z$(q.buffers[V].data)](Q[V]),Z.buffers[V]=new z0(J[V]);for(let V=0;V<$.length;V++){q=$[V];for(let U=0;U<q.buffers.length;U++)J[U].set(q.buffers[U].data,K[U]),K[U]+=q.buffers[U].data.length}if(Z.attributes=q.attributes,q.indexBuffer){Z.indexBuffer=Z.buffers[q.buffers.indexOf(q.indexBuffer)],Z.indexBuffer.type=r0.ELEMENT_ARRAY_BUFFER;let V=0,U=0,H=0,z=0;for(let W=0;W<q.buffers.length;W++)if(q.buffers[W]!==q.indexBuffer){z=W;break}for(let W in q.attributes){const Y=q.attributes[W];if((Y.buffer|0)===z)U+=Y.size*LK[Y.type]/4}for(let W=0;W<$.length;W++){const Y=$[W].indexBuffer.data;for(let w=0;w<Y.length;w++)Z.indexBuffer.data[w+H]+=V;V+=$[W].buffers[z].data.length/U,H+=Y.length}}return Z}}class w6 extends t0{constructor($=!1){super();this._buffer=new z0(null,$,!1),this._indexBuffer=new z0(null,$,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,l.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,l.FLOAT).addAttribute("aColor",this._buffer,4,!0,l.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,l.FLOAT).addIndex(this._indexBuffer)}}var K$=Math.PI*2,vZ=180/Math.PI,SZ=Math.PI/180,j0=(($)=>{return $[$.POLY=0]="POLY",$[$.RECT=1]="RECT",$[$.CIRC=2]="CIRC",$[$.ELIP=3]="ELIP",$[$.RREC=4]="RREC",$})(j0||{});class g{constructor($=0,Z=0){this.x=0,this.y=0,this.x=$,this.y=Z}clone(){return new g(this.x,this.y)}copyFrom($){return this.set($.x,$.y),this}copyTo($){return $.set(this.x,this.y),$}equals($){return $.x===this.x&&$.y===this.y}set($=0,Z=$){return this.x=$,this.y=Z,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}var v5=[new g,new g,new g,new g];class c{constructor($=0,Z=0,J=0,Q=0){this.x=Number($),this.y=Number(Z),this.width=Number(J),this.height=Number(Q),this.type=j0.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new c(0,0,0,0)}clone(){return new c(this.x,this.y,this.width,this.height)}copyFrom($){return this.x=$.x,this.y=$.y,this.width=$.width,this.height=$.height,this}copyTo($){return $.x=this.x,$.y=this.y,$.width=this.width,$.height=this.height,$}contains($,Z){if(this.width<=0||this.height<=0)return!1;if($>=this.x&&$<this.x+this.width){if(Z>=this.y&&Z<this.y+this.height)return!0}return!1}intersects($,Z){if(!Z){const k=this.x<$.x?$.x:this.x;if((this.right>$.right?$.right:this.right)<=k)return!1;const s=this.y<$.y?$.y:this.y;return(this.bottom>$.bottom?$.bottom:this.bottom)>s}const J=this.left,Q=this.right,K=this.top,q=this.bottom;if(Q<=J||q<=K)return!1;const V=v5[0].set($.left,$.top),U=v5[1].set($.left,$.bottom),H=v5[2].set($.right,$.top),z=v5[3].set($.right,$.bottom);if(H.x<=V.x||U.y<=V.y)return!1;const W=Math.sign(Z.a*Z.d-Z.b*Z.c);if(W===0)return!1;if(Z.apply(V,V),Z.apply(U,U),Z.apply(H,H),Z.apply(z,z),Math.max(V.x,U.x,H.x,z.x)<=J||Math.min(V.x,U.x,H.x,z.x)>=Q||Math.max(V.y,U.y,H.y,z.y)<=K||Math.min(V.y,U.y,H.y,z.y)>=q)return!1;const Y=W*(U.y-V.y),w=W*(V.x-U.x),j=Y*J+w*K,C=Y*Q+w*K,X=Y*J+w*q,G=Y*Q+w*q;if(Math.max(j,C,X,G)<=Y*V.x+w*V.y||Math.min(j,C,X,G)>=Y*z.x+w*z.y)return!1;const F=W*(V.y-H.y),L=W*(H.x-V.x),N=F*J+L*K,B=F*Q+L*K,T=F*J+L*q,x=F*Q+L*q;if(Math.max(N,B,T,x)<=F*V.x+L*V.y||Math.min(N,B,T,x)>=F*z.x+L*z.y)return!1;return!0}pad($=0,Z=$){return this.x-=$,this.y-=Z,this.width+=$*2,this.height+=Z*2,this}fit($){const Z=Math.max(this.x,$.x),J=Math.min(this.x+this.width,$.x+$.width),Q=Math.max(this.y,$.y),K=Math.min(this.y+this.height,$.y+$.height);return this.x=Z,this.width=Math.max(J-Z,0),this.y=Q,this.height=Math.max(K-Q,0),this}ceil($=1,Z=0.001){const J=Math.ceil((this.x+this.width-Z)*$)/$,Q=Math.ceil((this.y+this.height-Z)*$)/$;return this.x=Math.floor((this.x+Z)*$)/$,this.y=Math.floor((this.y+Z)*$)/$,this.width=J-this.x,this.height=Q-this.y,this}enlarge($){const Z=Math.min(this.x,$.x),J=Math.max(this.x+this.width,$.x+$.width),Q=Math.min(this.y,$.y),K=Math.max(this.y+this.height,$.y+$.height);return this.x=Z,this.width=J-Z,this.y=Q,this.height=K-Q,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class v${constructor($=0,Z=0,J=0){this.x=$,this.y=Z,this.radius=J,this.type=j0.CIRC}clone(){return new v$(this.x,this.y,this.radius)}contains($,Z){if(this.radius<=0)return!1;const J=this.radius*this.radius;let Q=this.x-$,K=this.y-Z;return Q*=Q,K*=K,Q+K<=J}getBounds(){return new c(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class K8{constructor($=0,Z=0,J=0,Q=0){this.x=$,this.y=Z,this.width=J,this.height=Q,this.type=j0.ELIP}clone(){return new K8(this.x,this.y,this.width,this.height)}contains($,Z){if(this.width<=0||this.height<=0)return!1;let J=($-this.x)/this.width,Q=(Z-this.y)/this.height;return J*=J,Q*=Q,J+Q<=1}getBounds(){return new c(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class u7{constructor(...$){let Z=Array.isArray($[0])?$[0]:$;if(typeof Z[0]!=="number"){const J=[];for(let Q=0,K=Z.length;Q<K;Q++)J.push(Z[Q].x,Z[Q].y);Z=J}this.points=Z,this.type=j0.POLY,this.closeStroke=!0}clone(){const $=this.points.slice(),Z=new u7($);return Z.closeStroke=this.closeStroke,Z}contains($,Z){let J=!1;const Q=this.points.length/2;for(let K=0,q=Q-1;K<Q;q=K++){const V=this.points[K*2],U=this.points[K*2+1],H=this.points[q*2],z=this.points[q*2+1];if(U>Z!==z>Z&&$<(H-V)*((Z-U)/(z-U))+V)J=!J}return J}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(($,Z)=>`${$}, ${Z}`,"")}]`}}class q8{constructor($=0,Z=0,J=0,Q=0,K=20){this.x=$,this.y=Z,this.width=J,this.height=Q,this.radius=K,this.type=j0.RREC}clone(){return new q8(this.x,this.y,this.width,this.height,this.radius)}contains($,Z){if(this.width<=0||this.height<=0)return!1;if($>=this.x&&$<=this.x+this.width){if(Z>=this.y&&Z<=this.y+this.height){const J=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(Z>=this.y+J&&Z<=this.y+this.height-J||$>=this.x+J&&$<=this.x+this.width-J)return!0;let Q=$-(this.x+J),K=Z-(this.y+J);const q=J*J;if(Q*Q+K*K<=q)return!0;if(Q=$-(this.x+this.width-J),Q*Q+K*K<=q)return!0;if(K=Z-(this.y+this.height-J),Q*Q+K*K<=q)return!0;if(Q=$-(this.x+J),Q*Q+K*K<=q)return!0}}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Z0{constructor($=1,Z=0,J=0,Q=1,K=0,q=0){this.array=null,this.a=$,this.b=Z,this.c=J,this.d=Q,this.tx=K,this.ty=q}fromArray($){this.a=$[0],this.b=$[1],this.c=$[3],this.d=$[4],this.tx=$[2],this.ty=$[5]}set($,Z,J,Q,K,q){return this.a=$,this.b=Z,this.c=J,this.d=Q,this.tx=K,this.ty=q,this}toArray($,Z){if(!this.array)this.array=new Float32Array(9);const J=Z||this.array;if($)J[0]=this.a,J[1]=this.b,J[2]=0,J[3]=this.c,J[4]=this.d,J[5]=0,J[6]=this.tx,J[7]=this.ty,J[8]=1;else J[0]=this.a,J[1]=this.c,J[2]=this.tx,J[3]=this.b,J[4]=this.d,J[5]=this.ty,J[6]=0,J[7]=0,J[8]=1;return J}apply($,Z){Z=Z||new g;const{x:J,y:Q}=$;return Z.x=this.a*J+this.c*Q+this.tx,Z.y=this.b*J+this.d*Q+this.ty,Z}applyInverse($,Z){Z=Z||new g;const J=1/(this.a*this.d+this.c*-this.b),Q=$.x,K=$.y;return Z.x=this.d*J*Q+-this.c*J*K+(this.ty*this.c-this.tx*this.d)*J,Z.y=this.a*J*K+-this.b*J*Q+(-this.ty*this.a+this.tx*this.b)*J,Z}translate($,Z){return this.tx+=$,this.ty+=Z,this}scale($,Z){return this.a*=$,this.d*=Z,this.c*=$,this.b*=Z,this.tx*=$,this.ty*=Z,this}rotate($){const Z=Math.cos($),J=Math.sin($),Q=this.a,K=this.c,q=this.tx;return this.a=Q*Z-this.b*J,this.b=Q*J+this.b*Z,this.c=K*Z-this.d*J,this.d=K*J+this.d*Z,this.tx=q*Z-this.ty*J,this.ty=q*J+this.ty*Z,this}append($){const Z=this.a,J=this.b,Q=this.c,K=this.d;return this.a=$.a*Z+$.b*Q,this.b=$.a*J+$.b*K,this.c=$.c*Z+$.d*Q,this.d=$.c*J+$.d*K,this.tx=$.tx*Z+$.ty*Q+this.tx,this.ty=$.tx*J+$.ty*K+this.ty,this}setTransform($,Z,J,Q,K,q,V,U,H){return this.a=Math.cos(V+H)*K,this.b=Math.sin(V+H)*K,this.c=-Math.sin(V-U)*q,this.d=Math.cos(V-U)*q,this.tx=$-(J*this.a+Q*this.c),this.ty=Z-(J*this.b+Q*this.d),this}prepend($){const Z=this.tx;if($.a!==1||$.b!==0||$.c!==0||$.d!==1){const J=this.a,Q=this.c;this.a=J*$.a+this.b*$.c,this.b=J*$.b+this.b*$.d,this.c=Q*$.a+this.d*$.c,this.d=Q*$.b+this.d*$.d}return this.tx=Z*$.a+this.ty*$.c+$.tx,this.ty=Z*$.b+this.ty*$.d+$.ty,this}decompose($){const Z=this.a,J=this.b,Q=this.c,K=this.d,q=$.pivot,V=-Math.atan2(-Q,K),U=Math.atan2(J,Z),H=Math.abs(V+U);if(H<0.00001||Math.abs(K$-H)<0.00001)$.rotation=U,$.skew.x=$.skew.y=0;else $.rotation=0,$.skew.x=V,$.skew.y=U;return $.scale.x=Math.sqrt(Z*Z+J*J),$.scale.y=Math.sqrt(Q*Q+K*K),$.position.x=this.tx+(q.x*Z+q.y*Q),$.position.y=this.ty+(q.x*J+q.y*K),$}invert(){const $=this.a,Z=this.b,J=this.c,Q=this.d,K=this.tx,q=$*Q-Z*J;return this.a=Q/q,this.b=-Z/q,this.c=-J/q,this.d=$/q,this.tx=(J*this.ty-Q*K)/q,this.ty=-($*this.ty-Z*K)/q,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const $=new Z0;return $.a=this.a,$.b=this.b,$.c=this.c,$.d=this.d,$.tx=this.tx,$.ty=this.ty,$}copyTo($){return $.a=this.a,$.b=this.b,$.c=this.c,$.d=this.d,$.tx=this.tx,$.ty=this.ty,$}copyFrom($){return this.a=$.a,this.b=$.b,this.c=$.c,this.d=$.d,this.tx=$.tx,this.ty=$.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Z0}static get TEMP_MATRIX(){return new Z0}}var jW=function(){for(let $=0;$<16;$++){const Z=[];TZ.push(Z);for(let J=0;J<16;J++){const Q=S5(S$[$]*S$[J]+h$[$]*T$[J]),K=S5(T$[$]*S$[J]+y$[$]*T$[J]),q=S5(S$[$]*h$[J]+h$[$]*y$[J]),V=S5(T$[$]*h$[J]+y$[$]*y$[J]);for(let U=0;U<16;U++)if(S$[U]===Q&&T$[U]===K&&h$[U]===q&&y$[U]===V){Z.push(U);break}}}for(let $=0;$<16;$++){const Z=new Z0;Z.set(S$[$],T$[$],h$[$],y$[$],0,0),BK.push(Z)}},S$=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],T$=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],h$=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],y$=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],TZ=[],BK=[],S5=Math.sign;jW();var X0={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:($)=>S$[$],uY:($)=>T$[$],vX:($)=>h$[$],vY:($)=>y$[$],inv:($)=>{if($&8)return $&15;return-$&7},add:($,Z)=>TZ[$][Z],sub:($,Z)=>TZ[$][X0.inv(Z)],rotate180:($)=>$^4,isVertical:($)=>($&3)===2,byDirection:($,Z)=>{if(Math.abs($)*2<=Math.abs(Z)){if(Z>=0)return X0.S;return X0.N}else if(Math.abs(Z)*2<=Math.abs($)){if($>0)return X0.E;return X0.W}else if(Z>0){if($>0)return X0.SE;return X0.SW}else if($>0)return X0.NE;return X0.NW},matrixAppendRotationInv:($,Z,J=0,Q=0)=>{const K=BK[X0.inv(Z)];K.tx=J,K.ty=Q,$.append(K)}};class C7{constructor($,Z,J=0,Q=0){this._x=J,this._y=Q,this.cb=$,this.scope=Z}clone($=this.cb,Z=this.scope){return new C7($,Z,this._x,this._y)}set($=0,Z=$){if(this._x!==$||this._y!==Z)this._x=$,this._y=Z,this.cb.call(this.scope);return this}copyFrom($){if(this._x!==$.x||this._y!==$.y)this._x=$.x,this._y=$.y,this.cb.call(this.scope);return this}copyTo($){return $.set(this._x,this._y),$}equals($){return $.x===this._x&&$.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x($){if(this._x!==$)this._x=$,this.cb.call(this.scope)}get y(){return this._y}set y($){if(this._y!==$)this._y=$,this.cb.call(this.scope)}}var PK=class{constructor(){this.worldTransform=new Z0,this.localTransform=new Z0,this.position=new C7(this.onChange,this,0,0),this.scale=new C7(this.onChange,this,1,1),this.pivot=new C7(this.onChange,this,0,0),this.skew=new C7(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const $=this.localTransform;if(this._localID!==this._currentLocalID)$.a=this._cx*this.scale.x,$.b=this._sx*this.scale.x,$.c=this._cy*this.scale.y,$.d=this._sy*this.scale.y,$.tx=this.position.x-(this.pivot.x*$.a+this.pivot.y*$.c),$.ty=this.position.y-(this.pivot.x*$.b+this.pivot.y*$.d),this._currentLocalID=this._localID,this._parentID=-1}updateTransform($){const Z=this.localTransform;if(this._localID!==this._currentLocalID)Z.a=this._cx*this.scale.x,Z.b=this._sx*this.scale.x,Z.c=this._cy*this.scale.y,Z.d=this._sy*this.scale.y,Z.tx=this.position.x-(this.pivot.x*Z.a+this.pivot.y*Z.c),Z.ty=this.position.y-(this.pivot.x*Z.b+this.pivot.y*Z.d),this._currentLocalID=this._localID,this._parentID=-1;if(this._parentID!==$._worldID){const J=$.worldTransform,Q=this.worldTransform;Q.a=Z.a*J.a+Z.b*J.c,Q.b=Z.a*J.b+Z.b*J.d,Q.c=Z.c*J.a+Z.d*J.c,Q.d=Z.c*J.b+Z.d*J.d,Q.tx=Z.tx*J.a+Z.ty*J.c+J.tx,Q.ty=Z.tx*J.b+Z.ty*J.d+J.ty,this._parentID=$._worldID,this._worldID++}}setFromMatrix($){$.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation($){if(this._rotation!==$)this._rotation=$,this.updateSkew()}},q$=PK;q$.IDENTITY=new PK;var FK="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}";var IK="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n";var T5=function($,Z,J){const Q=$.createShader(Z);return $.shaderSource(Q,J),$.compileShader(Q),Q};var hZ=function($){const Z=new Array($);for(let J=0;J<Z.length;J++)Z[J]=!1;return Z},V8=function($,Z){switch($){case"float":return 0;case"vec2":return new Float32Array(2*Z);case"vec3":return new Float32Array(3*Z);case"vec4":return new Float32Array(4*Z);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*Z);case"ivec3":return new Int32Array(3*Z);case"ivec4":return new Int32Array(4*Z);case"uvec2":return new Uint32Array(2*Z);case"uvec3":return new Uint32Array(3*Z);case"uvec4":return new Uint32Array(4*Z);case"bool":return!1;case"bvec2":return hZ(2*Z);case"bvec3":return hZ(3*Z);case"bvec4":return hZ(4*Z);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null};var E7=[{test:($)=>$.type==="float"&&$.size===1&&!$.isArray,code:($)=>`
            if(uv["${$}"] !== ud["${$}"].value)
            {
                ud["${$}"].value = uv["${$}"]
                gl.uniform1f(ud["${$}"].location, uv["${$}"])
            }
            `},{test:($,Z)=>($.type==="sampler2D"||$.type==="samplerCube"||$.type==="sampler2DArray")&&$.size===1&&!$.isArray&&(Z==null||Z.castToBaseTexture!==void 0),code:($)=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${$}"], t);

            if(ud["${$}"].value !== t)
            {
                ud["${$}"].value = t;
                gl.uniform1i(ud["${$}"].location, t);
; // eslint-disable-line max-len
            }`},{test:($,Z)=>$.type==="mat3"&&$.size===1&&!$.isArray&&Z.a!==void 0,code:($)=>`
            gl.uniformMatrix3fv(ud["${$}"].location, false, uv["${$}"].toArray(true));
            `,codeUbo:($)=>`
                var ${$}_matrix = uv.${$}.toArray(true);

                data[offset] = ${$}_matrix[0];
                data[offset+1] = ${$}_matrix[1];
                data[offset+2] = ${$}_matrix[2];
        
                data[offset + 4] = ${$}_matrix[3];
                data[offset + 5] = ${$}_matrix[4];
                data[offset + 6] = ${$}_matrix[5];
        
                data[offset + 8] = ${$}_matrix[6];
                data[offset + 9] = ${$}_matrix[7];
                data[offset + 10] = ${$}_matrix[8];
            `},{test:($,Z)=>$.type==="vec2"&&$.size===1&&!$.isArray&&Z.x!==void 0,code:($)=>`
                cv = ud["${$}"].value;
                v = uv["${$}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${$}"].location, v.x, v.y);
                }`,codeUbo:($)=>`
                v = uv.${$};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:($)=>$.type==="vec2"&&$.size===1&&!$.isArray,code:($)=>`
                cv = ud["${$}"].value;
                v = uv["${$}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${$}"].location, v[0], v[1]);
                }
            `},{test:($,Z)=>$.type==="vec4"&&$.size===1&&!$.isArray&&Z.width!==void 0,code:($)=>`
                cv = ud["${$}"].value;
                v = uv["${$}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${$}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:($)=>`
                    v = uv.${$};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:($,Z)=>$.type==="vec4"&&$.size===1&&!$.isArray&&Z.red!==void 0,code:($)=>`
                cv = ud["${$}"].value;
                v = uv["${$}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${$}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:($)=>`
                    v = uv.${$};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:($,Z)=>$.type==="vec3"&&$.size===1&&!$.isArray&&Z.red!==void 0,code:($)=>`
                cv = ud["${$}"].value;
                v = uv["${$}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${$}"].location, v.red, v.green, v.blue)
                }`,codeUbo:($)=>`
                    v = uv.${$};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:($)=>$.type==="vec4"&&$.size===1&&!$.isArray,code:($)=>`
                cv = ud["${$}"].value;
                v = uv["${$}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${$}"].location, v[0], v[1], v[2], v[3])
                }`}];var yZ=function($,Z){const J=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let Q in $.uniforms){const K=Z[Q];if(!K){if($.uniforms[Q]?.group)if($.uniforms[Q].ubo)J.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${Q}, '${Q}');
                    `);else J.push(`
                        renderer.shader.syncUniformGroup(uv.${Q}, syncData);
                    `);continue}const q=$.uniforms[Q];let V=!1;for(let U=0;U<E7.length;U++)if(E7[U].test(K,q)){J.push(E7[U].code(Q,q)),V=!0;break}if(!V){const H=(K.size===1&&!K.isArray?CW:XW)[K.type].replace("location",`ud["${Q}"].location`);J.push(`
            cu = ud["${Q}"];
            cv = cu.value;
            v = uv["${Q}"];
            ${H};`)}}return new Function("ud","uv","renderer","syncData",J.join("\n"))},CW={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},XW={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var y5=function(){if(h5===kK||h5?.isContextLost()){const $=I.ADAPTER.createCanvas();let Z;if(I.PREFER_ENV>=$7.WEBGL2)Z=$.getContext("webgl2",{});if(!Z)if(Z=$.getContext("webgl",{})||$.getContext("experimental-webgl",{}),!Z)Z=null;else Z.getExtension("WEBGL_draw_buffers");h5=Z}return h5},kK={},h5=kK;var fZ=function(){if(!f5){f5=m0.MEDIUM;const $=y5();if($){if($.getShaderPrecisionFormat)f5=$.getShaderPrecisionFormat($.FRAGMENT_SHADER,$.HIGH_FLOAT).precision?m0.HIGH:m0.MEDIUM}}return f5},f5;var OK=function($,Z){const J=$.getShaderSource(Z).split("\n").map((z,W)=>`${W}: ${z}`),Q=$.getShaderInfoLog(Z),K=Q.split("\n"),q={},V=K.map((z)=>parseFloat(z.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter((z)=>{if(z&&!q[z])return q[z]=!0,!0;return!1}),U=[""];V.forEach((z)=>{J[z-1]=`%c${J[z-1]}%c`,U.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const H=J.join("\n");U[0]=H,console.error(Q),console.groupCollapsed("click to view full shader code"),console.warn(...U),console.groupEnd()},gZ=function($,Z,J,Q){if(!$.getProgramParameter(Z,$.LINK_STATUS)){if(!$.getShaderParameter(J,$.COMPILE_STATUS))OK($,J);if(!$.getShaderParameter(Q,$.COMPILE_STATUS))OK($,Q);if(console.error("PixiJS Error: Could not initialize shader."),$.getProgramInfoLog(Z)!=="")console.warn("PixiJS Warning: gl.getProgramInfoLog()",$.getProgramInfoLog(Z))}};var U8=function($){return GW[$]},GW={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};var H8=function($,Z){if(!g5){const J=Object.keys(RK);g5={};for(let Q=0;Q<J.length;++Q){const K=J[Q];g5[$[K]]=RK[K]}}return g5[Z]},g5=null,RK={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};var x5=function($,Z,J){if($.substring(0,9)!=="precision"){let Q=Z;if(Z===m0.HIGH&&J!==m0.HIGH)Q=m0.MEDIUM;return`precision ${Q} float;
${$}`}else if(J!==m0.HIGH&&$.substring(0,15)==="precision highp")return $.replace("precision highp","precision mediump");return $};var m5=function(){if(typeof z8==="boolean")return z8;try{z8=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch($){z8=!1}return z8},z8;var NW=0,c5={},j6=class{constructor($,Z,J="pixi-shader",Q={}){if(this.extra={},this.id=NW++,this.vertexSrc=$||j6.defaultVertexSrc,this.fragmentSrc=Z||j6.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=Q,this.vertexSrc.substring(0,8)!=="#version"){if(J=J.replace(/\s+/g,"-"),c5[J])c5[J]++,J+=`-${c5[J]}`;else c5[J]=1;this.vertexSrc=`#define SHADER_NAME ${J}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${J}
${this.fragmentSrc}`,this.vertexSrc=x5(this.vertexSrc,j6.defaultVertexPrecision,m0.HIGH),this.fragmentSrc=x5(this.fragmentSrc,j6.defaultFragmentPrecision,fZ())}this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return IK}static get defaultFragmentSrc(){return FK}static from($,Z,J){const Q=$+Z;let K=J8[Q];if(!K)J8[Q]=K=new j6($,Z,J);return K}},M0=j6;M0.defaultVertexPrecision=m0.HIGH;M0.defaultFragmentPrecision=Y7.apple.device?m0.HIGH:m0.MEDIUM;var LW=0;class E0{constructor($,Z,J){if(this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=LW++,this.static=!!Z,this.ubo=!!J,$ instanceof z0)this.buffer=$,this.buffer.type=r0.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0;else if(this.uniforms=$,this.ubo)this.buffer=new z0(new Float32Array(1)),this.buffer.type=r0.UNIFORM_BUFFER,this.autoManage=!0}update(){if(this.dirtyId++,!this.autoManage&&this.buffer)this.buffer.update()}add($,Z,J){if(!this.ubo)this.uniforms[$]=new E0(Z,J);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from($,Z,J){return new E0($,Z,J)}static uboFrom($,Z){return new E0($,Z??!0,!0)}}class b0{constructor($,Z){if(this.uniformBindCount=0,this.program=$,Z)if(Z instanceof E0)this.uniformGroup=Z;else this.uniformGroup=new E0(Z);else this.uniformGroup=new E0({});this.disposeRunner=new F0("disposeShader")}checkUniformExists($,Z){if(Z.uniforms[$])return!0;for(let J in Z.uniforms){const Q=Z.uniforms[J];if(Q.group){if(this.checkUniformExists($,Q))return!0}}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from($,Z,J){const Q=M0.from($,Z);return new b0(Q,J)}}class p5{constructor($,Z){if(this.vertexSrc=$,this.fragTemplate=Z,this.programCache={},this.defaultGroupCache={},!Z.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!Z.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader($){if(!this.programCache[$]){const J=new Int32Array($);for(let K=0;K<$;K++)J[K]=K;this.defaultGroupCache[$]=E0.from({uSamplers:J},!0);let Q=this.fragTemplate;Q=Q.replace(/%count%/gi,`${$}`),Q=Q.replace(/%forloop%/gi,this.generateSampleSrc($)),this.programCache[$]=new M0(this.vertexSrc,Q)}const Z={tint:new Float32Array([1,1,1,1]),translationMatrix:new Z0,default:this.defaultGroupCache[$]};return new b0(this.programCache[$],Z)}generateSampleSrc($){let Z="";Z+="\n",Z+="\n";for(let J=0;J<$;J++){if(J>0)Z+="\nelse ";if(J<$-1)Z+=`if(vTextureId < ${J}.5)`;Z+="\n{",Z+=`
	color = texture2D(uSamplers[${J}], vTextureCoord);`,Z+="\n}"}return Z+="\n",Z+="\n",Z}}class f${constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let $=0;$<this.count;$++)this.elements[$]=null;this.count=0}}var _K=function(){return!Y7.apple.device};var MK=function($){let Z=!0;const J=I.ADAPTER.getNavigator();if(Y7.tablet||Y7.phone){if(Y7.apple.device){const Q=J.userAgent.match(/OS (\d+)_(\d+)?/);if(Q){if(parseInt(Q[1],10)<11)Z=!1}}if(Y7.android.device){const Q=J.userAgent.match(/Android\s([0-9.]*)/);if(Q){if(parseInt(Q[1],10)<7)Z=!1}}}return Z?$:4};class b7{constructor($){this.renderer=$}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render($){}}var DK="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n";var AK="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n";var O7=class extends b7{constructor($){super($);this.setShaderGenerator(),this.geometryClass=w6,this.vertexSize=6,this.state=A0.for2d(),this.size=O7.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),$.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??MK(32),this._defaultMaxTextures}static set defaultMaxTextures($){this._defaultMaxTextures=$}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??_K(),this._canUploadSameBuffer}static set canUploadSameBuffer($){this._canUploadSameBuffer=$}get MAX_TEXTURES(){return t("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return AK}static get defaultFragmentTemplate(){return DK}setShaderGenerator({vertex:$=O7.defaultVertexSrc,fragment:Z=O7.defaultFragmentTemplate}={}){this.shaderGenerator=new p5($,Z)}contextChange(){const $=this.renderer.gl;if(I.PREFER_ENV===$7.WEBGL_LEGACY)this.maxTextures=1;else this.maxTextures=Math.min($.getParameter($.MAX_TEXTURE_IMAGE_UNITS),O7.defaultMaxTextures),this.maxTextures=b5(this.maxTextures,$);this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let Z=0;Z<this._packedGeometryPoolSize;Z++)this._packedGeometries[Z]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:$,_textureArrayPool:Z}=O7,J=this.size/4,Q=Math.floor(J/this.maxTextures)+1;while($.length<J)$.push(new b$);while(Z.length<Q)Z.push(new f$);for(let K=0;K<this.maxTextures;K++)this._tempBoundTextures[K]=null}onPrerender(){this._flushId=0}render($){if(!$._texture.valid)return;if(this._vertexCount+$.vertexData.length/2>this.size)this.flush();this._vertexCount+=$.vertexData.length/2,this._indexCount+=$.indices.length,this._bufferedTextures[this._bufferSize]=$._texture.baseTexture,this._bufferedElements[this._bufferSize++]=$}buildTexturesAndDrawCalls(){const{_bufferedTextures:$,maxTextures:Z}=this,J=O7._textureArrayPool,Q=this.renderer.batch,K=this._tempBoundTextures,q=this.renderer.textureGC.count;let V=++p._globalBatch,U=0,H=J[0],z=0;Q.copyBoundTextures(K,Z);for(let W=0;W<this._bufferSize;++W){const Y=$[W];if($[W]=null,Y._batchEnabled===V)continue;if(H.count>=Z)Q.boundArray(H,K,V,Z),this.buildDrawCalls(H,z,W),z=W,H=J[++U],++V;Y._batchEnabled=V,Y.touched=q,H.elements[H.count++]=Y}if(H.count>0)Q.boundArray(H,K,V,Z),this.buildDrawCalls(H,z,this._bufferSize),++U,++V;for(let W=0;W<K.length;W++)K[W]=null;p._globalBatch=V}buildDrawCalls($,Z,J){const{_bufferedElements:Q,_attributeBuffer:K,_indexBuffer:q,vertexSize:V}=this,U=O7._drawCallPool;let H=this._dcIndex,z=this._aIndex,W=this._iIndex,Y=U[H];Y.start=this._iIndex,Y.texArray=$;for(let w=Z;w<J;++w){const j=Q[w],C=j._texture.baseTexture,X=e6[C.alphaMode?1:0][j.blendMode];if(Q[w]=null,Z<w&&Y.blend!==X)Y.size=W-Y.start,Z=w,Y=U[++H],Y.texArray=$,Y.start=W;this.packInterleavedGeometry(j,K,q,z,W),z+=j.vertexData.length/2*V,W+=j.indices.length,Y.blend=X}if(Z<J)Y.size=W-Y.start,++H;this._dcIndex=H,this._aIndex=z,this._iIndex=W}bindAndClearTexArray($){const Z=this.renderer.texture;for(let J=0;J<$.count;J++)Z.bind($.elements[J],$.ids[J]),$.elements[J]=null;$.count=0}updateGeometry(){const{_packedGeometries:$,_attributeBuffer:Z,_indexBuffer:J}=this;if(!O7.canUploadSameBuffer){if(this._packedGeometryPoolSize<=this._flushId)this._packedGeometryPoolSize++,$[this._flushId]=new this.geometryClass;$[this._flushId]._buffer.update(Z.rawBinaryData),$[this._flushId]._indexBuffer.update(J),this.renderer.geometry.bind($[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++}else $[this._flushId]._buffer.update(Z.rawBinaryData),$[this._flushId]._indexBuffer.update(J),this.renderer.geometry.updateBuffers()}drawBatches(){const $=this._dcIndex,{gl:Z,state:J}=this.renderer,Q=O7._drawCallPool;let K=null;for(let q=0;q<$;q++){const{texArray:V,type:U,size:H,start:z,blend:W}=Q[q];if(K!==V)K=V,this.bindAndClearTexArray(V);this.state.blendMode=W,J.set(this.state),Z.drawElements(U,H,Z.UNSIGNED_SHORT,z*2)}}flush(){if(this._vertexCount===0)return;this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0}start(){if(this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),O7.canUploadSameBuffer)this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let $=0;$<this._packedGeometryPoolSize;$++)if(this._packedGeometries[$])this._packedGeometries[$].destroy();if(this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader)this._shader.destroy(),this._shader=null;super.destroy()}getAttributeBuffer($){const Z=J$(Math.ceil($/8)),J=Z8(Z),Q=Z*8;if(this._aBuffers.length<=J)this._iBuffers.length=J+1;let K=this._aBuffers[Q];if(!K)this._aBuffers[Q]=K=new E$(Q*this.vertexSize*4);return K}getIndexBuffer($){const Z=J$(Math.ceil($/12)),J=Z8(Z),Q=Z*12;if(this._iBuffers.length<=J)this._iBuffers.length=J+1;let K=this._iBuffers[J];if(!K)this._iBuffers[J]=K=new Uint16Array(Q);return K}packInterleavedGeometry($,Z,J,Q,K){const{uint32View:q,float32View:V}=Z,U=Q/this.vertexSize,H=$.uvs,z=$.indices,W=$.vertexData,Y=$._texture.baseTexture._batchLocation,w=Math.min($.worldAlpha,1),j=a.shared.setValue($._tintRGB).toPremultiplied(w,$._texture.baseTexture.alphaMode>0);for(let C=0;C<W.length;C+=2)V[Q++]=W[C],V[Q++]=W[C+1],V[Q++]=H[C],V[Q++]=H[C+1],q[Q++]=j,V[Q++]=Y;for(let C=0;C<z.length;C++)J[K++]=U+z[C]}},Q7=O7;Q7.defaultBatchSize=4096;Q7.extension={name:"batch",type:O.RendererPlugin};Q7._drawCallPool=[];Q7._textureArrayPool=[];_.add(Q7);var EK="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n";var bK="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var W8=class extends b0{constructor($,Z,J){const Q=M0.from($||W8.defaultVertexSrc,Z||W8.defaultFragmentSrc);super(Q,J);this.padding=0,this.resolution=W8.defaultResolution,this.multisample=W8.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new A0}apply($,Z,J,Q,K){$.applyFilter(this,Z,J,Q)}get blendMode(){return this.state.blendMode}set blendMode($){this.state.blendMode=$}get resolution(){return this._resolution}set resolution($){this._resolution=$}static get defaultVertexSrc(){return bK}static get defaultFragmentSrc(){return EK}},W0=W8;W0.defaultResolution=1;W0.defaultMultisample=H0.NONE;class V${constructor(){this.clearBeforeRender=!0,this._backgroundColor=new a(0),this.alpha=1}init($){this.clearBeforeRender=$.clearBeforeRender;const{backgroundColor:Z,background:J,backgroundAlpha:Q}=$,K=J??Z;if(K!==void 0)this.color=K;this.alpha=Q}get color(){return this._backgroundColor.value}set color($){this._backgroundColor.setValue($)}get alpha(){return this._backgroundColor.alpha}set alpha($){this._backgroundColor.setAlpha($)}get backgroundColor(){return this._backgroundColor}destroy(){}}V$.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};V$.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"background"};_.add(V$);class Y8{constructor($){this.renderer=$,this.emptyRenderer=new b7($),this.currentRenderer=this.emptyRenderer}setObjectRenderer($){if(this.currentRenderer===$)return;this.currentRenderer.stop(),this.currentRenderer=$,this.currentRenderer.start()}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures($,Z){const{boundTextures:J}=this.renderer.texture;for(let Q=Z-1;Q>=0;--Q)if($[Q]=J[Q]||null,$[Q])$[Q]._batchLocation=Q}boundArray($,Z,J,Q){const{elements:K,ids:q,count:V}=$;let U=0;for(let H=0;H<V;H++){const z=K[H],W=z._batchLocation;if(W>=0&&W<Q&&Z[W]===z){q[H]=W;continue}while(U<Q){const Y=Z[U];if(Y&&Y._batchEnabled===J&&Y._batchLocation===U){U++;continue}q[H]=U,z._batchLocation=U,Z[U]=z;break}}}destroy(){this.renderer=null}}Y8.extension={type:O.RendererSystem,name:"batch"};_.add(Y8);var vK=0;class U${constructor($){this.renderer=$,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange($){this.gl=$,this.renderer.gl=$,this.renderer.CONTEXT_UID=vK++}init($){if($.context)this.initFromContext($.context);else{const Z=this.renderer.background.alpha<1,J=$.premultipliedAlpha;this.preserveDrawingBuffer=$.preserveDrawingBuffer,this.useContextAlpha=$.useContextAlpha,this.powerPreference=$.powerPreference,this.initFromOptions({alpha:Z,premultipliedAlpha:J,antialias:$.antialias,stencil:!0,preserveDrawingBuffer:$.preserveDrawingBuffer,powerPreference:$.powerPreference})}}initFromContext($){this.gl=$,this.validateContext($),this.renderer.gl=$,this.renderer.CONTEXT_UID=vK++,this.renderer.runners.contextChange.emit($);const Z=this.renderer.view;if(Z.addEventListener!==void 0)Z.addEventListener("webglcontextlost",this.handleContextLost,!1),Z.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}initFromOptions($){const Z=this.createContext(this.renderer.view,$);this.initFromContext(Z)}createContext($,Z){let J;if(I.PREFER_ENV>=$7.WEBGL2)J=$.getContext("webgl2",Z);if(J)this.webGLVersion=2;else if(this.webGLVersion=1,J=$.getContext("webgl",Z)||$.getContext("experimental-webgl",Z),!J)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=J,this.getExtensions(),this.gl}getExtensions(){const{gl:$}=this,Z={loseContext:$.getExtension("WEBGL_lose_context"),anisotropicFiltering:$.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:$.getExtension("OES_texture_float_linear"),s3tc:$.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:$.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:$.getExtension("WEBGL_compressed_texture_etc"),etc1:$.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:$.getExtension("WEBGL_compressed_texture_pvrtc")||$.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:$.getExtension("WEBGL_compressed_texture_atc"),astc:$.getExtension("WEBGL_compressed_texture_astc")};if(this.webGLVersion===1)Object.assign(this.extensions,Z,{drawBuffers:$.getExtension("WEBGL_draw_buffers"),depthTexture:$.getExtension("WEBGL_depth_texture"),vertexArrayObject:$.getExtension("OES_vertex_array_object")||$.getExtension("MOZ_OES_vertex_array_object")||$.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:$.getExtension("OES_element_index_uint"),floatTexture:$.getExtension("OES_texture_float"),floatTextureLinear:$.getExtension("OES_texture_float_linear"),textureHalfFloat:$.getExtension("OES_texture_half_float"),textureHalfFloatLinear:$.getExtension("OES_texture_half_float_linear")});else if(this.webGLVersion===2)Object.assign(this.extensions,Z,{colorBufferFloat:$.getExtension("EXT_color_buffer_float")})}handleContextLost($){$.preventDefault(),setTimeout(()=>{if(this.gl.isContextLost()&&this.extensions.loseContext)this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const $=this.renderer.view;if(this.renderer=null,$.removeEventListener!==void 0)$.removeEventListener("webglcontextlost",this.handleContextLost),$.removeEventListener("webglcontextrestored",this.handleContextRestored);if(this.gl.useProgram(null),this.extensions.loseContext)this.extensions.loseContext.loseContext()}postrender(){if(this.renderer.objectRenderer.renderingToScreen)this.gl.flush()}validateContext($){const Z=$.getContextAttributes(),J=("WebGL2RenderingContext"in globalThis)&&$ instanceof globalThis.WebGL2RenderingContext;if(J)this.webGLVersion=2;if(Z&&!Z.stencil)console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const Q=J||!!$.getExtension("OES_element_index_uint");if(this.supports.uint32Indices=Q,!Q)console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}U$.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};U$.extension={type:O.RendererSystem,name:"context"};_.add(U$);class xZ extends J7{upload($,Z,J){const Q=$.gl;Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.alphaMode===P0.UNPACK);const{realWidth:K,realHeight:q}=Z;if(J.width===K&&J.height===q)Q.texSubImage2D(Z.target,0,0,0,K,q,Z.format,J.type,this.data);else J.width=K,J.height=q,Q.texImage2D(Z.target,0,J.internalFormat,K,q,0,Z.format,J.type,this.data);return!0}}class g${constructor($,Z){this.width=Math.round($||100),this.height=Math.round(Z||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new F0("disposeFramebuffer"),this.multisample=H0.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture($=0,Z){return this.colorTextures[$]=Z||new p(null,{scaleMode:a0.NEAREST,resolution:1,mipmap:D0.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture($){return this.depthTexture=$||new p(new xZ(null,{width:this.width,height:this.height}),{scaleMode:a0.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:D0.OFF,format:b.DEPTH_COMPONENT,type:l.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize($,Z){if($=Math.round($),Z=Math.round(Z),$===this.width&&Z===this.height)return;this.width=$,this.height=Z,this.dirtyId++,this.dirtySize++;for(let J=0;J<this.colorTextures.length;J++){const Q=this.colorTextures[J],K=Q.resolution;Q.setSize($/K,Z/K)}if(this.depthTexture){const J=this.depthTexture.resolution;this.depthTexture.setSize($/J,Z/J)}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){if(this.depthTexture)this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat}}class C6 extends p{constructor($={}){if(typeof $==="number"){const Z=arguments[0],J=arguments[1],Q=arguments[2],K=arguments[3];$={width:Z,height:J,scaleMode:Q,resolution:K}}$.width=$.width||100,$.height=$.height||100,$.multisample??($.multisample=H0.NONE);super(null,$);this.mipmap=D0.OFF,this.valid=!0,this._clear=new a([0,0,0,0]),this.framebuffer=new g$(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=$.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor($){this._clear.setValue($)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize($,Z){this.framebuffer.resize($*this.resolution,Z*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class h0 extends j7{constructor($){const Z=$,J=Z.naturalWidth||Z.videoWidth||Z.width,Q=Z.naturalHeight||Z.videoHeight||Z.height;super(J,Q);this.source=$,this.noSubImage=!1}static crossOrigin($,Z,J){if(J===void 0&&!Z.startsWith("data:"))$.crossOrigin=E5(Z);else if(J!==!1)$.crossOrigin=typeof J==="string"?J:"anonymous"}upload($,Z,J,Q){const K=$.gl,q=Z.realWidth,V=Z.realHeight;if(Q=Q||this.source,typeof HTMLImageElement!=="undefined"&&Q instanceof HTMLImageElement){if(!Q.complete||Q.naturalWidth===0)return!1}else if(typeof HTMLVideoElement!=="undefined"&&Q instanceof HTMLVideoElement){if(Q.readyState<=1&&Q.buffered.length===0)return!1}if(K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.alphaMode===P0.UNPACK),!this.noSubImage&&Z.target===K.TEXTURE_2D&&J.width===q&&J.height===V)K.texSubImage2D(K.TEXTURE_2D,0,0,0,Z.format,J.type,Q);else J.width=q,J.height=V,K.texImage2D(Z.target,0,J.internalFormat,Z.format,J.type,Q);return!0}update(){if(this.destroyed)return;const $=this.source,Z=$.naturalWidth||$.videoWidth||$.width,J=$.naturalHeight||$.videoHeight||$.height;this.resize(Z,J),super.update()}dispose(){this.source=null}}class x$ extends h0{constructor($,Z){if(Z=Z||{},typeof $==="string"){const J=new Image;h0.crossOrigin(J,$,Z.crossorigin),J.src=$,$=J}super($);if(!$.complete&&!!this._width&&!!this._height)this._width=0,this._height=0;if(this.url=$.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(Z.createBitmap??I.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof Z.alphaMode==="number"?Z.alphaMode:null,this.bitmap=null,this._load=null,Z.autoLoad!==!1)this.load()}load($){if(this._load)return this._load;if($!==void 0)this.createBitmap=$;return this._load=new Promise((Z,J)=>{const Q=this.source;this.url=Q.src;const K=()=>{if(this.destroyed)return;if(Q.onload=null,Q.onerror=null,this.resize(Q.width,Q.height),this._load=null,this.createBitmap)Z(this.process());else Z(this)};if(Q.complete&&Q.src)K();else Q.onload=K,Q.onerror=(q)=>{J(q),this.onError.emit(q)}}),this._load}process(){const $=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const Z=globalThis.createImageBitmap,J=!$.crossOrigin||$.crossOrigin==="anonymous";return this._process=fetch($.src,{mode:J?"cors":"no-cors"}).then((Q)=>Q.blob()).then((Q)=>Z(Q,0,0,$.width,$.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===P0.UNPACK?"premultiply":"none"})).then((Q)=>{if(this.destroyed)return Promise.reject();return this.bitmap=Q,this.update(),this._process=null,Promise.resolve(this)}),this._process}upload($,Z,J){if(typeof this.alphaMode==="number")Z.alphaMode=this.alphaMode;if(!this.createBitmap)return super.upload($,Z,J);if(!this.bitmap){if(this.process(),!this.bitmap)return!1}if(super.upload($,Z,J,this.bitmap),!this.preserveBitmap){let Q=!0;const K=Z._glTextures;for(let q in K){const V=K[q];if(V!==J&&V.dirtyId!==Z.dirtyId){Q=!1;break}}if(Q){if(this.bitmap.close)this.bitmap.close();this.bitmap=null}}return!0}dispose(){if(this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap)this.bitmap.close(),this.bitmap=null;this._process=null,this._load=null}static test($){return typeof HTMLImageElement!=="undefined"&&(typeof $==="string"||$ instanceof HTMLImageElement)}}class w8{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set($,Z,J){const{width:Q,height:K}=Z;if(J){const q=$.width/2/Q,V=$.height/2/K,U=$.x/Q+q,H=$.y/K+V;J=X0.add(J,X0.NW),this.x0=U+q*X0.uX(J),this.y0=H+V*X0.uY(J),J=X0.add(J,2),this.x1=U+q*X0.uX(J),this.y1=H+V*X0.uY(J),J=X0.add(J,2),this.x2=U+q*X0.uX(J),this.y2=H+V*X0.uY(J),J=X0.add(J,2),this.x3=U+q*X0.uX(J),this.y3=H+V*X0.uY(J)}else this.x0=$.x/Q,this.y0=$.y/K,this.x1=($.x+$.width)/Q,this.y1=$.y/K,this.x2=($.x+$.width)/Q,this.y2=($.y+$.height)/K,this.x3=$.x/Q,this.y3=($.y+$.height)/K;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}var u5=function($){$.destroy=function Z(){},$.on=function Z(){},$.once=function Z(){},$.emit=function Z(){}},SK=new w8;class S extends Q$.default{constructor($,Z,J,Q,K,q,V){super();if(this.noFrame=!1,!Z)this.noFrame=!0,Z=new c(0,0,1,1);if($ instanceof S)$=$.baseTexture;if(this.baseTexture=$,this._frame=Z,this.trim=Q,this.valid=!1,this._uvs=SK,this.uvMatrix=null,this.orig=J||Z,this._rotate=Number(K||0),K===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");if(this.defaultAnchor=q?new g(q.x,q.y):new g(0,0),this.defaultBorders=V,this._updateID=0,this.textureCacheIds=[],!$.valid)$.once("loaded",this.onBaseTextureUpdated,this);else if(this.noFrame){if($.valid)this.onBaseTextureUpdated($)}else this.frame=Z;if(this.noFrame)$.on("update",this.onBaseTextureUpdated,this)}update(){if(this.baseTexture.resource)this.baseTexture.resource.update()}onBaseTextureUpdated($){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=$.width,this._frame.height=$.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy($){if(this.baseTexture){if($){const{resource:Z}=this.baseTexture;if(Z?.url&&_0[Z.url])S.removeFromCache(Z.url);this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,S.removeFromCache(this),this.textureCacheIds=null}clone(){const $=this._frame.clone(),Z=this._frame===this.orig?$:this.orig.clone(),J=new S(this.baseTexture,!this.noFrame&&$,Z,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);if(this.noFrame)J._frame=$;return J}updateUvs(){if(this._uvs===SK)this._uvs=new w8;this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from($,Z={},J=I.STRICT_TEXTURE_CACHE){const Q=typeof $==="string";let K=null;if(Q)K=$;else if($ instanceof p){if(!$.cacheId){const V=Z?.pixiIdPrefix||"pixiid";$.cacheId=`${V}-${A7()}`,p.addToCache($,$.cacheId)}K=$.cacheId}else{if(!$._pixiId){const V=Z?.pixiIdPrefix||"pixiid";$._pixiId=`${V}_${A7()}`}K=$._pixiId}let q=_0[K];if(Q&&J&&!q)throw new Error(`The cacheId "${K}" does not exist in TextureCache.`);if(!q&&!($ instanceof p)){if(!Z.resolution)Z.resolution=Q8($);q=new S(new p($,Z)),q.baseTexture.cacheId=K,p.addToCache(q.baseTexture,K),S.addToCache(q,K)}else if(!q&&$ instanceof p)q=new S($),S.addToCache(q,K);return q}static fromURL($,Z){const J=Object.assign({autoLoad:!1},Z?.resourceOptions),Q=S.from($,Object.assign({resourceOptions:J},Z),!1),K=Q.baseTexture.resource;if(Q.baseTexture.valid)return Promise.resolve(Q);return K.load().then(()=>Promise.resolve(Q))}static fromBuffer($,Z,J,Q){return new S(p.fromBuffer($,Z,J,Q))}static fromLoader($,Z,J,Q){const K=new p($,Object.assign({scaleMode:p.defaultOptions.scaleMode,resolution:Q8(Z)},Q)),{resource:q}=K;if(q instanceof x$)q.url=Z;const V=new S(K);if(!J)J=Z;if(p.addToCache(V.baseTexture,J),S.addToCache(V,J),J!==Z)p.addToCache(V.baseTexture,Z),S.addToCache(V,Z);if(V.baseTexture.valid)return Promise.resolve(V);return new Promise((U)=>{V.baseTexture.once("loaded",()=>U(V))})}static addToCache($,Z){if(Z){if(!$.textureCacheIds.includes(Z))$.textureCacheIds.push(Z);if(_0[Z]&&_0[Z]!==$)console.warn(`Texture added to the cache with an id [${Z}] that already had an entry`);_0[Z]=$}}static removeFromCache($){if(typeof $==="string"){const Z=_0[$];if(Z){const J=Z.textureCacheIds.indexOf($);if(J>-1)Z.textureCacheIds.splice(J,1);return delete _0[$],Z}}else if($?.textureCacheIds){for(let Z=0;Z<$.textureCacheIds.length;++Z)if(_0[$.textureCacheIds[Z]]===$)delete _0[$.textureCacheIds[Z]];return $.textureCacheIds.length=0,$}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame($){this._frame=$,this.noFrame=!1;const{x:Z,y:J,width:Q,height:K}=$,q=Z+Q>this.baseTexture.width,V=J+K>this.baseTexture.height;if(q||V){const U=q&&V?"and":"or",H=`X: ${Z} + ${Q} = ${Z+Q} > ${this.baseTexture.width}`,z=`Y: ${J} + ${K} = ${J+K} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${H} ${U} ${z}`)}if(this.valid=Q&&K&&this.baseTexture.valid,!this.trim&&!this.rotate)this.orig=$;if(this.valid)this.updateUvs()}get rotate(){return this._rotate}set rotate($){if(this._rotate=$,this.valid)this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){if(!S._EMPTY)S._EMPTY=new S(new p),u5(S._EMPTY),u5(S._EMPTY.baseTexture);return S._EMPTY}static get WHITE(){if(!S._WHITE){const $=I.ADAPTER.createCanvas(16,16),Z=$.getContext("2d");$.width=16,$.height=16,Z.fillStyle="white",Z.fillRect(0,0,16,16),S._WHITE=new S(p.from($)),u5(S._WHITE),u5(S._WHITE.baseTexture)}return S._WHITE}}class X7 extends S{constructor($,Z){super($,Z);this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample($){this.framebuffer.multisample=$}resize($,Z,J=!0){const Q=this.baseTexture.resolution,K=Math.round($*Q)/Q,q=Math.round(Z*Q)/Q;if(this.valid=K>0&&q>0,this._frame.width=this.orig.width=K,this._frame.height=this.orig.height=q,J)this.baseTexture.resize(K,q);this.updateUvs()}setResolution($){const{baseTexture:Z}=this;if(Z.resolution===$)return;Z.setResolution($),this.resize(Z.width,Z.height,!1)}static create($){return new X7(new C6($))}}class j8{constructor($){this.texturePool={},this.textureOptions=$||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture($,Z,J=H0.NONE){const Q=new C6(Object.assign({width:$,height:Z,resolution:1,multisample:J},this.textureOptions));return new X7(Q)}getOptimalTexture($,Z,J=1,Q=H0.NONE){let K;if($=Math.ceil($*J-0.000001),Z=Math.ceil(Z*J-0.000001),!this.enableFullScreen||$!==this._pixelsWidth||Z!==this._pixelsHeight){if($=J$($),Z=J$(Z),K=(($&65535)<<16|Z&65535)>>>0,Q>1)K+=Q*4294967296}else K=Q>1?-Q:-1;if(!this.texturePool[K])this.texturePool[K]=[];let q=this.texturePool[K].pop();if(!q)q=this.createTexture($,Z,Q);return q.filterPoolKey=K,q.setResolution(J),q}getFilterTexture($,Z,J){const Q=this.getOptimalTexture($.width,$.height,Z||$.resolution,J||H0.NONE);return Q.filterFrame=$.filterFrame,Q}returnTexture($){const Z=$.filterPoolKey;$.filterFrame=null,this.texturePool[Z].push($)}returnFilterTexture($){this.returnTexture($)}clear($){if($=$!==!1,$)for(let Z in this.texturePool){const J=this.texturePool[Z];if(J)for(let Q=0;Q<J.length;Q++)J[Q].destroy(!0)}this.texturePool={}}setScreenSize($){if($.width===this._pixelsWidth&&$.height===this._pixelsHeight)return;this.enableFullScreen=$.width>0&&$.height>0;for(let Z in this.texturePool){if(!(Number(Z)<0))continue;const J=this.texturePool[Z];if(J)for(let Q=0;Q<J.length;Q++)J[Q].destroy(!0);this.texturePool[Z]=[]}this._pixelsWidth=$.width,this._pixelsHeight=$.height}}j8.SCREEN_KEY=-1;class d5 extends t0{constructor(){super();this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class X6 extends t0{constructor(){super();this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new z0(this.vertices),this.uvBuffer=new z0(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map($,Z){let J=0,Q=0;return this.uvs[0]=J,this.uvs[1]=Q,this.uvs[2]=J+Z.width/$.width,this.uvs[3]=Q,this.uvs[4]=J+Z.width/$.width,this.uvs[5]=Q+Z.height/$.height,this.uvs[6]=J,this.uvs[7]=Q+Z.height/$.height,J=Z.x,Q=Z.y,this.vertices[0]=J,this.vertices[1]=Q,this.vertices[2]=J+Z.width,this.vertices[3]=Q,this.vertices[4]=J+Z.width,this.vertices[5]=Q+Z.height,this.vertices[6]=J,this.vertices[7]=Q+Z.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class l5{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=H0.NONE,this.sourceFrame=new c,this.destinationFrame=new c,this.bindingSourceFrame=new c,this.bindingDestinationFrame=new c,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}var n5=[new g,new g,new g,new g],mZ=new Z0;class C8{constructor($){this.renderer=$,this.defaultFilterStack=[{}],this.texturePool=new j8,this.statePool=[],this.quad=new d5,this.quadUv=new X6,this.tempRect=new c,this.activeState={},this.globalUniforms=new E0({outputFrame:new c,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push($,Z){const J=this.renderer,Q=this.defaultFilterStack,K=this.statePool.pop()||new l5,q=this.renderer.renderTexture;let V=Z[0].resolution,U=Z[0].multisample,H=Z[0].padding,z=Z[0].autoFit,W=Z[0].legacy??!0;for(let j=1;j<Z.length;j++){const C=Z[j];V=Math.min(V,C.resolution),U=Math.min(U,C.multisample),H=this.useMaxPadding?Math.max(H,C.padding):H+C.padding,z=z&&C.autoFit,W=W||(C.legacy??!0)}if(Q.length===1)this.defaultFilterStack[0].renderTexture=q.current;Q.push(K),K.resolution=V,K.multisample=U,K.legacy=W,K.target=$,K.sourceFrame.copyFrom($.filterArea||$.getBounds(!0)),K.sourceFrame.pad(H);const Y=this.tempRect.copyFrom(q.sourceFrame);if(J.projection.transform)this.transformAABB(mZ.copyFrom(J.projection.transform).invert(),Y);if(z){if(K.sourceFrame.fit(Y),K.sourceFrame.width<=0||K.sourceFrame.height<=0)K.sourceFrame.width=0,K.sourceFrame.height=0}else if(!K.sourceFrame.intersects(Y))K.sourceFrame.width=0,K.sourceFrame.height=0;this.roundFrame(K.sourceFrame,q.current?q.current.resolution:J.resolution,q.sourceFrame,q.destinationFrame,J.projection.transform),K.renderTexture=this.getOptimalFilterTexture(K.sourceFrame.width,K.sourceFrame.height,V,U),K.filters=Z,K.destinationFrame.width=K.renderTexture.width,K.destinationFrame.height=K.renderTexture.height;const w=this.tempRect;w.x=0,w.y=0,w.width=K.sourceFrame.width,w.height=K.sourceFrame.height,K.renderTexture.filterFrame=K.sourceFrame,K.bindingSourceFrame.copyFrom(q.sourceFrame),K.bindingDestinationFrame.copyFrom(q.destinationFrame),K.transform=J.projection.transform,J.projection.transform=null,q.bind(K.renderTexture,K.sourceFrame,w),J.framebuffer.clear(0,0,0,0)}pop(){const $=this.defaultFilterStack,Z=$.pop(),J=Z.filters;this.activeState=Z;const Q=this.globalUniforms.uniforms;Q.outputFrame=Z.sourceFrame,Q.resolution=Z.resolution;const{inputSize:K,inputPixel:q,inputClamp:V}=Q;if(K[0]=Z.destinationFrame.width,K[1]=Z.destinationFrame.height,K[2]=1/K[0],K[3]=1/K[1],q[0]=Math.round(K[0]*Z.resolution),q[1]=Math.round(K[1]*Z.resolution),q[2]=1/q[0],q[3]=1/q[1],V[0]=0.5*q[2],V[1]=0.5*q[3],V[2]=Z.sourceFrame.width*K[2]-0.5*q[2],V[3]=Z.sourceFrame.height*K[3]-0.5*q[3],Z.legacy){const H=Q.filterArea;H[0]=Z.destinationFrame.width,H[1]=Z.destinationFrame.height,H[2]=Z.sourceFrame.x,H[3]=Z.sourceFrame.y,Q.filterClamp=Q.inputClamp}this.globalUniforms.update();const U=$[$.length-1];if(this.renderer.framebuffer.blit(),J.length===1)J[0].apply(this,Z.renderTexture,U.renderTexture,Z7.BLEND,Z),this.returnFilterTexture(Z.renderTexture);else{let H=Z.renderTexture,z=this.getOptimalFilterTexture(H.width,H.height,Z.resolution);z.filterFrame=H.filterFrame;let W=0;for(W=0;W<J.length-1;++W){if(W===1&&Z.multisample>1)z=this.getOptimalFilterTexture(H.width,H.height,Z.resolution),z.filterFrame=H.filterFrame;J[W].apply(this,H,z,Z7.CLEAR,Z);const Y=H;H=z,z=Y}if(J[W].apply(this,H,U.renderTexture,Z7.BLEND,Z),W>1&&Z.multisample>1)this.returnFilterTexture(Z.renderTexture);this.returnFilterTexture(H),this.returnFilterTexture(z)}Z.clear(),this.statePool.push(Z)}bindAndClear($,Z=Z7.CLEAR){const{renderTexture:J,state:Q}=this.renderer;if($===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture)this.renderer.projection.transform=this.activeState.transform;else this.renderer.projection.transform=null;if($?.filterFrame){const q=this.tempRect;q.x=0,q.y=0,q.width=$.filterFrame.width,q.height=$.filterFrame.height,J.bind($,$.filterFrame,q)}else if($!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture)J.bind($);else this.renderer.renderTexture.bind($,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const K=Q.stateId&1||this.forceClear;if(Z===Z7.CLEAR||Z===Z7.BLIT&&K)this.renderer.framebuffer.clear(0,0,0,0)}applyFilter($,Z,J,Q){const K=this.renderer;if(K.state.set($.state),this.bindAndClear(J,Q),$.uniforms.uSampler=Z,$.uniforms.filterGlobals=this.globalUniforms,K.shader.bind($),$.legacy=!!$.program.attributeData.aTextureCoord,$.legacy)this.quadUv.map(Z._frame,Z.filterFrame),K.geometry.bind(this.quadUv),K.geometry.draw(i0.TRIANGLES);else K.geometry.bind(this.quad),K.geometry.draw(i0.TRIANGLE_STRIP)}calculateSpriteMatrix($,Z){const{sourceFrame:J,destinationFrame:Q}=this.activeState,{orig:K}=Z._texture,q=$.set(Q.width,0,0,Q.height,J.x,J.y),V=Z.worldTransform.copyTo(Z0.TEMP_MATRIX);return V.invert(),q.prepend(V),q.scale(1/K.width,1/K.height),q.translate(Z.anchor.x,Z.anchor.y),q}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture($,Z,J=1,Q=H0.NONE){return this.texturePool.getOptimalTexture($,Z,J,Q)}getFilterTexture($,Z,J){if(typeof $==="number"){const K=$;$=Z,Z=K}$=$||this.activeState.renderTexture;const Q=this.texturePool.getOptimalTexture($.width,$.height,Z||$.resolution,J||H0.NONE);return Q.filterFrame=$.filterFrame,Q}returnFilterTexture($){this.texturePool.returnTexture($)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB($,Z){const J=n5[0],Q=n5[1],K=n5[2],q=n5[3];J.set(Z.left,Z.top),Q.set(Z.left,Z.bottom),K.set(Z.right,Z.top),q.set(Z.right,Z.bottom),$.apply(J,J),$.apply(Q,Q),$.apply(K,K),$.apply(q,q);const V=Math.min(J.x,Q.x,K.x,q.x),U=Math.min(J.y,Q.y,K.y,q.y),H=Math.max(J.x,Q.x,K.x,q.x),z=Math.max(J.y,Q.y,K.y,q.y);Z.x=V,Z.y=U,Z.width=H-V,Z.height=z-U}roundFrame($,Z,J,Q,K){if($.width<=0||$.height<=0||J.width<=0||J.height<=0)return;if(K){const{a:q,b:V,c:U,d:H}=K;if((Math.abs(V)>0.0001||Math.abs(U)>0.0001)&&(Math.abs(q)>0.0001||Math.abs(H)>0.0001))return}K=K?mZ.copyFrom(K):mZ.identity(),K.translate(-J.x,-J.y).scale(Q.width/J.width,Q.height/J.height).translate(Q.x,Q.y),this.transformAABB(K,$),$.ceil(Z),this.transformAABB(K.invert(),$)}}C8.extension={type:O.RendererSystem,name:"filter"};_.add(C8);class o5{constructor($){this.framebuffer=$,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=H0.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}var BW=new c;class X8{constructor($){this.renderer=$,this.managedFramebuffers=[],this.unknownFramebuffer=new g$(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const $=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new c,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let Z=this.renderer.context.extensions.drawBuffers,J=this.renderer.context.extensions.depthTexture;if(I.PREFER_ENV===$7.WEBGL_LEGACY)Z=null,J=null;if(Z)$.drawBuffers=(Q)=>Z.drawBuffersWEBGL(Q);else this.hasMRT=!1,$.drawBuffers=()=>{};if(!J)this.writeDepthTexture=!1}else this.msaaSamples=$.getInternalformatParameter($.RENDERBUFFER,$.RGBA8,$.SAMPLES)}bind($,Z,J=0){const{gl:Q}=this;if($){const K=$.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer($);if(this.current!==$)this.current=$,Q.bindFramebuffer(Q.FRAMEBUFFER,K.framebuffer);if(K.mipLevel!==J)$.dirtyId++,$.dirtyFormat++,K.mipLevel=J;if(K.dirtyId!==$.dirtyId){if(K.dirtyId=$.dirtyId,K.dirtyFormat!==$.dirtyFormat)K.dirtyFormat=$.dirtyFormat,K.dirtySize=$.dirtySize,this.updateFramebuffer($,J);else if(K.dirtySize!==$.dirtySize)K.dirtySize=$.dirtySize,this.resizeFramebuffer($)}for(let q=0;q<$.colorTextures.length;q++){const V=$.colorTextures[q];this.renderer.texture.unbind(V.parentTextureArray||V)}if($.depthTexture)this.renderer.texture.unbind($.depthTexture);if(Z){const q=Z.width>>J,V=Z.height>>J,U=q/Z.width;this.setViewport(Z.x*U,Z.y*U,q,V)}else{const q=$.width>>J,V=$.height>>J;this.setViewport(0,0,q,V)}}else{if(this.current)this.current=null,Q.bindFramebuffer(Q.FRAMEBUFFER,null);if(Z)this.setViewport(Z.x,Z.y,Z.width,Z.height);else this.setViewport(0,0,this.renderer.width,this.renderer.height)}}setViewport($,Z,J,Q){const K=this.viewport;if($=Math.round($),Z=Math.round(Z),J=Math.round(J),Q=Math.round(Q),K.width!==J||K.height!==Q||K.x!==$||K.y!==Z)K.x=$,K.y=Z,K.width=J,K.height=Q,this.gl.viewport($,Z,J,Q)}get size(){if(this.current)return{x:0,y:0,width:this.current.width,height:this.current.height};return{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear($,Z,J,Q,K=j5.COLOR|j5.DEPTH){const{gl:q}=this;q.clearColor($,Z,J,Q),q.clear(K)}initFramebuffer($){const{gl:Z}=this,J=new o5(Z.createFramebuffer());return J.multisample=this.detectSamples($.multisample),$.glFramebuffers[this.CONTEXT_UID]=J,this.managedFramebuffers.push($),$.disposeRunner.add(this),J}resizeFramebuffer($){const{gl:Z}=this,J=$.glFramebuffers[this.CONTEXT_UID];if(J.stencil)if(Z.bindRenderbuffer(Z.RENDERBUFFER,J.stencil),J.msaaBuffer)Z.renderbufferStorageMultisample(Z.RENDERBUFFER,J.multisample,Z.DEPTH24_STENCIL8,$.width,$.height);else Z.renderbufferStorage(Z.RENDERBUFFER,Z.DEPTH_STENCIL,$.width,$.height);const Q=$.colorTextures;let K=Q.length;if(!Z.drawBuffers)K=Math.min(K,1);for(let q=0;q<K;q++){const V=Q[q],U=V.parentTextureArray||V;if(this.renderer.texture.bind(U,0),q===0&&J.msaaBuffer)Z.bindRenderbuffer(Z.RENDERBUFFER,J.msaaBuffer),Z.renderbufferStorageMultisample(Z.RENDERBUFFER,J.multisample,U._glTextures[this.CONTEXT_UID].internalFormat,$.width,$.height)}if($.depthTexture&&this.writeDepthTexture)this.renderer.texture.bind($.depthTexture,0)}updateFramebuffer($,Z){const{gl:J}=this,Q=$.glFramebuffers[this.CONTEXT_UID],K=$.colorTextures;let q=K.length;if(!J.drawBuffers)q=Math.min(q,1);if(Q.multisample>1&&this.canMultisampleFramebuffer($))Q.msaaBuffer=Q.msaaBuffer||J.createRenderbuffer();else if(Q.msaaBuffer){if(J.deleteRenderbuffer(Q.msaaBuffer),Q.msaaBuffer=null,Q.blitFramebuffer)Q.blitFramebuffer.dispose(),Q.blitFramebuffer=null}const V=[];for(let U=0;U<q;U++){const H=K[U],z=H.parentTextureArray||H;if(this.renderer.texture.bind(z,0),U===0&&Q.msaaBuffer)J.bindRenderbuffer(J.RENDERBUFFER,Q.msaaBuffer),J.renderbufferStorageMultisample(J.RENDERBUFFER,Q.multisample,z._glTextures[this.CONTEXT_UID].internalFormat,$.width,$.height),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.RENDERBUFFER,Q.msaaBuffer);else J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0+U,H.target,z._glTextures[this.CONTEXT_UID].texture,Z),V.push(J.COLOR_ATTACHMENT0+U)}if(V.length>1)J.drawBuffers(V);if($.depthTexture){if(this.writeDepthTexture){const H=$.depthTexture;this.renderer.texture.bind(H,0),J.framebufferTexture2D(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.TEXTURE_2D,H._glTextures[this.CONTEXT_UID].texture,Z)}}if(($.stencil||$.depth)&&!($.depthTexture&&this.writeDepthTexture)){if(Q.stencil=Q.stencil||J.createRenderbuffer(),J.bindRenderbuffer(J.RENDERBUFFER,Q.stencil),Q.msaaBuffer)J.renderbufferStorageMultisample(J.RENDERBUFFER,Q.multisample,J.DEPTH24_STENCIL8,$.width,$.height);else J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_STENCIL,$.width,$.height);J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_STENCIL_ATTACHMENT,J.RENDERBUFFER,Q.stencil)}else if(Q.stencil)J.deleteRenderbuffer(Q.stencil),Q.stencil=null}canMultisampleFramebuffer($){return this.renderer.context.webGLVersion!==1&&$.colorTextures.length<=1&&!$.depthTexture}detectSamples($){const{msaaSamples:Z}=this;let J=H0.NONE;if($<=1||Z===null)return J;for(let Q=0;Q<Z.length;Q++)if(Z[Q]<=$){J=Z[Q];break}if(J===1)J=H0.NONE;return J}blit($,Z,J){const{current:Q,renderer:K,gl:q,CONTEXT_UID:V}=this;if(K.context.webGLVersion!==2)return;if(!Q)return;const U=Q.glFramebuffers[V];if(!U)return;if(!$){if(!U.msaaBuffer)return;const z=Q.colorTextures[0];if(!z)return;if(!U.blitFramebuffer)U.blitFramebuffer=new g$(Q.width,Q.height),U.blitFramebuffer.addColorTexture(0,z);if($=U.blitFramebuffer,$.colorTextures[0]!==z)$.colorTextures[0]=z,$.dirtyId++,$.dirtyFormat++;if($.width!==Q.width||$.height!==Q.height)$.width=Q.width,$.height=Q.height,$.dirtyId++,$.dirtySize++}if(!Z)Z=BW,Z.width=Q.width,Z.height=Q.height;if(!J)J=Z;const H=Z.width===J.width&&Z.height===J.height;this.bind($),q.bindFramebuffer(q.READ_FRAMEBUFFER,U.framebuffer),q.blitFramebuffer(Z.left,Z.top,Z.right,Z.bottom,J.left,J.top,J.right,J.bottom,q.COLOR_BUFFER_BIT,H?q.NEAREST:q.LINEAR),q.bindFramebuffer(q.READ_FRAMEBUFFER,$.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer($,Z){const J=$.glFramebuffers[this.CONTEXT_UID],Q=this.gl;if(!J)return;delete $.glFramebuffers[this.CONTEXT_UID];const K=this.managedFramebuffers.indexOf($);if(K>=0)this.managedFramebuffers.splice(K,1);if($.disposeRunner.remove(this),!Z){if(Q.deleteFramebuffer(J.framebuffer),J.msaaBuffer)Q.deleteRenderbuffer(J.msaaBuffer);if(J.stencil)Q.deleteRenderbuffer(J.stencil)}if(J.blitFramebuffer)this.disposeFramebuffer(J.blitFramebuffer,Z)}disposeAll($){const Z=this.managedFramebuffers;this.managedFramebuffers=[];for(let J=0;J<Z.length;J++)this.disposeFramebuffer(Z[J],$)}forceStencil(){const $=this.current;if(!$)return;const Z=$.glFramebuffers[this.CONTEXT_UID];if(!Z||Z.stencil)return;$.stencil=!0;const{width:J,height:Q}=$,K=this.gl,q=K.createRenderbuffer();if(K.bindRenderbuffer(K.RENDERBUFFER,q),Z.msaaBuffer)K.renderbufferStorageMultisample(K.RENDERBUFFER,Z.multisample,K.DEPTH24_STENCIL8,J,Q);else K.renderbufferStorage(K.RENDERBUFFER,K.DEPTH_STENCIL,J,Q);Z.stencil=q,K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_STENCIL_ATTACHMENT,K.RENDERBUFFER,q)}reset(){this.current=this.unknownFramebuffer,this.viewport=new c}destroy(){this.renderer=null}}X8.extension={type:O.RendererSystem,name:"framebuffer"};_.add(X8);var cZ={5126:4,5123:2,5121:1};class G8{constructor($){this.renderer=$,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const $=this.gl=this.renderer.gl,Z=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,Z.webGLVersion!==2){let J=this.renderer.context.extensions.vertexArrayObject;if(I.PREFER_ENV===$7.WEBGL_LEGACY)J=null;if(J)$.createVertexArray=()=>J.createVertexArrayOES(),$.bindVertexArray=(Q)=>J.bindVertexArrayOES(Q),$.deleteVertexArray=(Q)=>J.deleteVertexArrayOES(Q);else this.hasVao=!1,$.createVertexArray=()=>null,$.bindVertexArray=()=>null,$.deleteVertexArray=()=>null}if(Z.webGLVersion!==2){const J=$.getExtension("ANGLE_instanced_arrays");if(J)$.vertexAttribDivisor=(Q,K)=>J.vertexAttribDivisorANGLE(Q,K),$.drawElementsInstanced=(Q,K,q,V,U)=>J.drawElementsInstancedANGLE(Q,K,q,V,U),$.drawArraysInstanced=(Q,K,q,V)=>J.drawArraysInstancedANGLE(Q,K,q,V);else this.hasInstance=!1}this.canUseUInt32ElementIndex=Z.webGLVersion===2||!!Z.extensions.uint32ElementIndex}bind($,Z){Z=Z||this.renderer.shader.shader;const{gl:J}=this;let Q=$.glVertexArrayObjects[this.CONTEXT_UID],K=!1;if(!Q)this.managedGeometries[$.id]=$,$.disposeRunner.add(this),$.glVertexArrayObjects[this.CONTEXT_UID]=Q={},K=!0;const q=Q[Z.program.id]||this.initGeometryVao($,Z,K);if(this._activeGeometry=$,this._activeVao!==q)if(this._activeVao=q,this.hasVao)J.bindVertexArray(q);else this.activateVao($,Z.program);this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const $=this._activeGeometry,Z=this.renderer.buffer;for(let J=0;J<$.buffers.length;J++){const Q=$.buffers[J];Z.update(Q)}}checkCompatibility($,Z){const J=$.attributes,Q=Z.attributeData;for(let K in Q)if(!J[K])throw new Error(`shader and geometry incompatible, geometry missing the "${K}" attribute`)}getSignature($,Z){const J=$.attributes,Q=Z.attributeData,K=["g",$.id];for(let q in J)if(Q[q])K.push(q,Q[q].location);return K.join("-")}initGeometryVao($,Z,J=!0){const Q=this.gl,K=this.CONTEXT_UID,q=this.renderer.buffer,V=Z.program;if(!V.glPrograms[K])this.renderer.shader.generateProgram(Z);this.checkCompatibility($,V);const U=this.getSignature($,V),H=$.glVertexArrayObjects[this.CONTEXT_UID];let z=H[U];if(z)return H[V.id]=z,z;const{buffers:W,attributes:Y}=$,w={},j={};for(let C in W)w[C]=0,j[C]=0;for(let C in Y){if(!Y[C].size&&V.attributeData[C])Y[C].size=V.attributeData[C].size;else if(!Y[C].size)console.warn(`PIXI Geometry attribute '${C}' size cannot be determined (likely the bound shader does not have the attribute)`);w[Y[C].buffer]+=Y[C].size*cZ[Y[C].type]}for(let C in Y){const X=Y[C],G=X.size;if(X.stride===void 0)if(w[X.buffer]===G*cZ[X.type])X.stride=0;else X.stride=w[X.buffer];if(X.start===void 0)X.start=j[X.buffer],j[X.buffer]+=G*cZ[X.type]}z=Q.createVertexArray(),Q.bindVertexArray(z);for(let C=0;C<W.length;C++){const X=W[C];if(q.bind(X),J)X._glBuffers[K].refCount++}return this.activateVao($,V),H[V.id]=z,H[U]=z,Q.bindVertexArray(null),q.unbind(r0.ARRAY_BUFFER),z}disposeGeometry($,Z){if(!this.managedGeometries[$.id])return;delete this.managedGeometries[$.id];const J=$.glVertexArrayObjects[this.CONTEXT_UID],Q=this.gl,K=$.buffers,q=this.renderer?.buffer;if($.disposeRunner.remove(this),!J)return;if(q)for(let V=0;V<K.length;V++){const U=K[V]._glBuffers[this.CONTEXT_UID];if(U){if(U.refCount--,U.refCount===0&&!Z)q.dispose(K[V],Z)}}if(!Z){for(let V in J)if(V[0]==="g"){const U=J[V];if(this._activeVao===U)this.unbind();Q.deleteVertexArray(U)}}delete $.glVertexArrayObjects[this.CONTEXT_UID]}disposeAll($){const Z=Object.keys(this.managedGeometries);for(let J=0;J<Z.length;J++)this.disposeGeometry(this.managedGeometries[Z[J]],$)}activateVao($,Z){const J=this.gl,Q=this.CONTEXT_UID,K=this.renderer.buffer,q=$.buffers,V=$.attributes;if($.indexBuffer)K.bind($.indexBuffer);let U=null;for(let H in V){const z=V[H],W=q[z.buffer],Y=W._glBuffers[Q];if(Z.attributeData[H]){if(U!==Y)K.bind(W),U=Y;const w=Z.attributeData[H].location;if(J.enableVertexAttribArray(w),J.vertexAttribPointer(w,z.size,z.type||J.FLOAT,z.normalized,z.stride,z.start),z.instance)if(this.hasInstance)J.vertexAttribDivisor(w,z.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw($,Z,J,Q){const{gl:K}=this,q=this._activeGeometry;if(q.indexBuffer){const V=q.indexBuffer.data.BYTES_PER_ELEMENT,U=V===2?K.UNSIGNED_SHORT:K.UNSIGNED_INT;if(V===2||V===4&&this.canUseUInt32ElementIndex)if(q.instanced)K.drawElementsInstanced($,Z||q.indexBuffer.data.length,U,(J||0)*V,Q||1);else K.drawElements($,Z||q.indexBuffer.data.length,U,(J||0)*V);else console.warn("unsupported index buffer type: uint32")}else if(q.instanced)K.drawArraysInstanced($,J,Z||q.getSize(),Q||1);else K.drawArrays($,J,Z||q.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}G8.extension={type:O.RendererSystem,name:"geometry"};_.add(G8);var TK=new Z0;class H${constructor($,Z){this._texture=$,this.mapCoord=new Z0,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof Z==="undefined"?0.5:Z,this.isSimple=!1}get texture(){return this._texture}set texture($){this._texture=$,this._textureID=-1}multiplyUvs($,Z){if(Z===void 0)Z=$;const J=this.mapCoord;for(let Q=0;Q<$.length;Q+=2){const K=$[Q],q=$[Q+1];Z[Q]=K*J.a+q*J.c+J.tx,Z[Q+1]=K*J.b+q*J.d+J.ty}return Z}update($){const Z=this._texture;if(!Z||!Z.valid)return!1;if(!$&&this._textureID===Z._updateID)return!1;this._textureID=Z._updateID,this._updateID++;const J=Z._uvs;this.mapCoord.set(J.x1-J.x0,J.y1-J.y0,J.x3-J.x0,J.y3-J.y0,J.x0,J.y0);const{orig:Q,trim:K}=Z;if(K)TK.set(Q.width/K.width,0,0,Q.height/K.height,-K.x/K.width,-K.y/K.height),this.mapCoord.append(TK);const q=Z.baseTexture,V=this.uClampFrame,U=this.clampMargin/q.resolution,H=this.clampOffset;return V[0]=(Z._frame.x+U+H)/q.width,V[1]=(Z._frame.y+U+H)/q.height,V[2]=(Z._frame.x+Z._frame.width-U+H)/q.width,V[3]=(Z._frame.y+Z._frame.height-U+H)/q.height,this.uClampOffset[0]=H/q.realWidth,this.uClampOffset[1]=H/q.realHeight,this.isSimple=Z._frame.width===q.width&&Z._frame.height===q.height&&Z.rotate===0,!0}}var hK="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n";var yK="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n";class s5 extends W0{constructor($,Z,J){let Q=null;if(typeof $!=="string"&&Z===void 0&&J===void 0)Q=$,$=void 0,Z=void 0,J=void 0;super($||yK,Z||hK,J);this.maskSprite=Q,this.maskMatrix=new Z0}get maskSprite(){return this._maskSprite}set maskSprite($){if(this._maskSprite=$,this._maskSprite)this._maskSprite.renderable=!1}apply($,Z,J,Q){const K=this._maskSprite,q=K._texture;if(!q.valid)return;if(!q.uvMatrix)q.uvMatrix=new H$(q,0);q.uvMatrix.update(),this.uniforms.npmAlpha=q.baseTexture.alphaMode?0:1,this.uniforms.mask=q,this.uniforms.otherMatrix=$.calculateSpriteMatrix(this.maskMatrix,K).prepend(q.uvMatrix.mapCoord),this.uniforms.alpha=K.worldAlpha,this.uniforms.maskClamp=q.uvMatrix.uClampFrame,$.applyFilter(this,Z,J,Q)}}class i5{constructor($=null){this.type=N0.NONE,this.autoDetect=!0,this.maskObject=$||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=W0.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter($){if($)if(this._filters)this._filters[0]=$;else this._filters=[$];else this._filters=null}reset(){if(this.pooled)this.maskObject=null,this.type=N0.NONE,this.autoDetect=!0;this._target=null,this._scissorRectLocal=null}copyCountersOrReset($){if($)this._stencilCounter=$._stencilCounter,this._scissorCounter=$._scissorCounter,this._scissorRect=$._scissorRect;else this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null}}class N8{constructor($){this.renderer=$,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack($){this.maskStack=$,this.renderer.scissor.setMaskStack($),this.renderer.stencil.setMaskStack($)}push($,Z){let J=Z;if(!J.isMaskData){const K=this.maskDataPool.pop()||new i5;K.pooled=!0,K.maskObject=Z,J=K}const Q=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(J.copyCountersOrReset(Q),J._colorMask=Q?Q._colorMask:15,J.autoDetect)this.detect(J);if(J._target=$,J.type!==N0.SPRITE)this.maskStack.push(J);if(J.enabled)switch(J.type){case N0.SCISSOR:this.renderer.scissor.push(J);break;case N0.STENCIL:this.renderer.stencil.push(J);break;case N0.SPRITE:J.copyCountersOrReset(null),this.pushSpriteMask(J);break;case N0.COLOR:this.pushColorMask(J);break;default:break}if(J.type===N0.SPRITE)this.maskStack.push(J)}pop($){const Z=this.maskStack.pop();if(!Z||Z._target!==$)return;if(Z.enabled)switch(Z.type){case N0.SCISSOR:this.renderer.scissor.pop(Z);break;case N0.STENCIL:this.renderer.stencil.pop(Z.maskObject);break;case N0.SPRITE:this.popSpriteMask(Z);break;case N0.COLOR:this.popColorMask(Z);break;default:break}if(Z.reset(),Z.pooled)this.maskDataPool.push(Z);if(this.maskStack.length!==0){const J=this.maskStack[this.maskStack.length-1];if(J.type===N0.SPRITE&&J._filters)J._filters[0].maskSprite=J.maskObject}}detect($){const Z=$.maskObject;if(!Z)$.type=N0.COLOR;else if(Z.isSprite)$.type=N0.SPRITE;else if(this.enableScissor&&this.renderer.scissor.testScissor($))$.type=N0.SCISSOR;else $.type=N0.STENCIL}pushSpriteMask($){const{maskObject:Z}=$,J=$._target;let Q=$._filters;if(!Q){if(Q=this.alphaMaskPool[this.alphaMaskIndex],!Q)Q=this.alphaMaskPool[this.alphaMaskIndex]=[new s5]}const K=this.renderer,q=K.renderTexture;let V,U;if(q.current){const z=q.current;V=$.resolution||z.resolution,U=$.multisample??z.multisample}else V=$.resolution||K.resolution,U=$.multisample??K.multisample;Q[0].resolution=V,Q[0].multisample=U,Q[0].maskSprite=Z;const H=J.filterArea;if(J.filterArea=Z.getBounds(!0),K.filter.push(J,Q),J.filterArea=H,!$._filters)this.alphaMaskIndex++}popSpriteMask($){if(this.renderer.filter.pop(),$._filters)$._filters[0].maskSprite=null;else this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null}pushColorMask($){const Z=$._colorMask,J=$._colorMask=Z&$.colorMask;if(J!==Z)this.renderer.gl.colorMask((J&1)!==0,(J&2)!==0,(J&4)!==0,(J&8)!==0)}popColorMask($){const Z=$._colorMask,J=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;if(J!==Z)this.renderer.gl.colorMask((J&1)!==0,(J&2)!==0,(J&4)!==0,(J&8)!==0)}destroy(){this.renderer=null}}N8.extension={type:O.RendererSystem,name:"mask"};_.add(N8);class L8{constructor($){this.renderer=$,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack($){const{gl:Z}=this.renderer,J=this.getStackLength();this.maskStack=$;const Q=this.getStackLength();if(Q!==J)if(Q===0)Z.disable(this.glConst);else Z.enable(this.glConst),this._useCurrent()}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}var fK=new Z0,gK=[],a5=class extends L8{constructor($){super($);this.glConst=I.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const $=this.maskStack[this.maskStack.length-1];if($)return $._scissorCounter;return 0}calcScissorRect($){if($._scissorRectLocal)return;const Z=$._scissorRect,{maskObject:J}=$,{renderer:Q}=this,K=Q.renderTexture,q=J.getBounds(!0,gK.pop()??new c);if(this.roundFrameToPixels(q,K.current?K.current.resolution:Q.resolution,K.sourceFrame,K.destinationFrame,Q.projection.transform),Z)q.fit(Z);$._scissorRectLocal=q}static isMatrixRotated($){if(!$)return!1;const{a:Z,b:J,c:Q,d:K}=$;return(Math.abs(J)>0.0001||Math.abs(Q)>0.0001)&&(Math.abs(Z)>0.0001||Math.abs(K)>0.0001)}testScissor($){const{maskObject:Z}=$;if(!Z.isFastRect||!Z.isFastRect())return!1;if(a5.isMatrixRotated(Z.worldTransform))return!1;if(a5.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect($);const J=$._scissorRectLocal;return J.width>0&&J.height>0}roundFrameToPixels($,Z,J,Q,K){if(a5.isMatrixRotated(K))return;K=K?fK.copyFrom(K):fK.identity(),K.translate(-J.x,-J.y).scale(Q.width/J.width,Q.height/J.height).translate(Q.x,Q.y),this.renderer.filter.transformAABB(K,$),$.fit(Q),$.x=Math.round($.x*Z),$.y=Math.round($.y*Z),$.width=Math.round($.width*Z),$.height=Math.round($.height*Z)}push($){if(!$._scissorRectLocal)this.calcScissorRect($);const{gl:Z}=this.renderer;if(!$._scissorRect)Z.enable(Z.SCISSOR_TEST);$._scissorCounter++,$._scissorRect=$._scissorRectLocal,this._useCurrent()}pop($){const{gl:Z}=this.renderer;if($)gK.push($._scissorRectLocal);if(this.getStackLength()>0)this._useCurrent();else Z.disable(Z.SCISSOR_TEST)}_useCurrent(){const $=this.maskStack[this.maskStack.length-1]._scissorRect;let Z;if(this.renderer.renderTexture.current)Z=$.y;else Z=this.renderer.height-$.height-$.y;this.renderer.gl.scissor($.x,Z,$.width,$.height)}},r5=a5;r5.extension={type:O.RendererSystem,name:"scissor"};_.add(r5);class B8 extends L8{constructor($){super($);this.glConst=I.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const $=this.maskStack[this.maskStack.length-1];if($)return $._stencilCounter;return 0}push($){const Z=$.maskObject,{gl:J}=this.renderer,Q=$._stencilCounter;if(Q===0)this.renderer.framebuffer.forceStencil(),J.clearStencil(0),J.clear(J.STENCIL_BUFFER_BIT),J.enable(J.STENCIL_TEST);$._stencilCounter++;const K=$._colorMask;if(K!==0)$._colorMask=0,J.colorMask(!1,!1,!1,!1);if(J.stencilFunc(J.EQUAL,Q,4294967295),J.stencilOp(J.KEEP,J.KEEP,J.INCR),Z.renderable=!0,Z.render(this.renderer),this.renderer.batch.flush(),Z.renderable=!1,K!==0)$._colorMask=K,J.colorMask((K&1)!==0,(K&2)!==0,(K&4)!==0,(K&8)!==0);this._useCurrent()}pop($){const Z=this.renderer.gl;if(this.getStackLength()===0)Z.disable(Z.STENCIL_TEST);else{const J=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,Q=J?J._colorMask:15;if(Q!==0)J._colorMask=0,Z.colorMask(!1,!1,!1,!1);if(Z.stencilOp(Z.KEEP,Z.KEEP,Z.DECR),$.renderable=!0,$.render(this.renderer),this.renderer.batch.flush(),$.renderable=!1,Q!==0)J._colorMask=Q,Z.colorMask((Q&1)!==0,(Q&2)!==0,(Q&4)!==0,(Q&8)!==0);this._useCurrent()}}_useCurrent(){const $=this.renderer.gl;$.stencilFunc($.EQUAL,this.getStackLength(),4294967295),$.stencilOp($.KEEP,$.KEEP,$.KEEP)}}B8.extension={type:O.RendererSystem,name:"stencil"};_.add(B8);class P8{constructor($){this.renderer=$,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return t("7.0.0","renderer.plugins.extract has moved to renderer.extract"),$.extract}},prepare:{enumerable:!1,get(){return t("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),$.prepare}},interaction:{enumerable:!1,get(){return t("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),$.events}}})}init(){const $=this.rendererPlugins;for(let Z in $)this.plugins[Z]=new $[Z](this.renderer)}destroy(){for(let $ in this.plugins)this.plugins[$].destroy(),this.plugins[$]=null}}P8.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"_plugin"};_.add(P8);class F8{constructor($){this.renderer=$,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Z0,this.transform=null}update($,Z,J,Q){if(this.destinationFrame=$||this.destinationFrame||this.defaultFrame,this.sourceFrame=Z||this.sourceFrame||$,this.calculateProjection(this.destinationFrame,this.sourceFrame,J,Q),this.transform)this.projectionMatrix.append(this.transform);const K=this.renderer;if(K.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,K.globalUniforms.update(),K.shader.shader)K.shader.syncUniformGroup(K.shader.shader.uniforms.globals)}calculateProjection($,Z,J,Q){const K=this.projectionMatrix,q=!Q?1:-1;K.identity(),K.a=1/Z.width*2,K.d=q*(1/Z.height*2),K.tx=-1-Z.x*K.a,K.ty=-q-Z.y*K.d}setTransform($){}destroy(){this.renderer=null}}F8.extension={type:O.RendererSystem,name:"projection"};_.add(F8);var PW=new q$;class I8{constructor($){this.renderer=$,this._tempMatrix=new Z0}generateTexture($,Z){const{region:J,...Q}=Z||{},K=J||$.getLocalBounds(null,!0);if(K.width===0)K.width=1;if(K.height===0)K.height=1;const q=X7.create({width:K.width,height:K.height,...Q});this._tempMatrix.tx=-K.x,this._tempMatrix.ty=-K.y;const V=$.transform;return $.transform=PW,this.renderer.render($,{renderTexture:q,transform:this._tempMatrix,skipUpdateTransform:!!$.parent,blit:!0}),$.transform=V,q}destroy(){}}I8.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"textureGenerator"};_.add(I8);var m$=new c,k8=new c;class O8{constructor($){this.renderer=$,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new c,this.destinationFrame=new c,this.viewportFrame=new c}contextChange(){const $=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!($&&$.alpha&&$.premultipliedAlpha)}bind($=null,Z,J){const Q=this.renderer;this.current=$;let K,q,V;if($){if(K=$.baseTexture,V=K.resolution,!Z)m$.width=$.frame.width,m$.height=$.frame.height,Z=m$;if(!J)k8.x=$.frame.x,k8.y=$.frame.y,k8.width=Z.width,k8.height=Z.height,J=k8;q=K.framebuffer}else{if(V=Q.resolution,!Z)m$.width=Q._view.screen.width,m$.height=Q._view.screen.height,Z=m$;if(!J)J=m$,J.width=Z.width,J.height=Z.height}const U=this.viewportFrame;if(U.x=J.x*V,U.y=J.y*V,U.width=J.width*V,U.height=J.height*V,!$)U.y=Q.view.height-(U.y+U.height);if(U.ceil(),this.renderer.framebuffer.bind(q,U),this.renderer.projection.update(J,Z,V,!q),$)this.renderer.mask.setMaskStack(K.maskStack);else this.renderer.mask.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(Z),this.destinationFrame.copyFrom(J)}clear($,Z){const J=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,Q=a.shared.setValue($?$:J);if(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)Q.premultiply(Q.alpha);const K=this.destinationFrame,q=this.current?this.current.baseTexture:this.renderer._view.screen,V=K.width!==q.width||K.height!==q.height;if(V){let{x:U,y:H,width:z,height:W}=this.viewportFrame;U=Math.round(U),H=Math.round(H),z=Math.round(z),W=Math.round(W),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(U,H,z,W)}if(this.renderer.framebuffer.clear(Q.red,Q.green,Q.blue,Q.alpha,Z),V)this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}O8.extension={type:O.RendererSystem,name:"renderTexture"};_.add(O8);class t5{constructor($,Z){this.program=$,this.uniformData=Z,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}var xK=function($,Z){const J={},Q=Z.getProgramParameter($,Z.ACTIVE_ATTRIBUTES);for(let K=0;K<Q;K++){const q=Z.getActiveAttrib($,K);if(q.name.startsWith("gl_"))continue;const V=H8(Z,q.type),U={type:V,name:q.name,size:U8(V),location:Z.getAttribLocation($,q.name)};J[q.name]=U}return J};var mK=function($,Z){const J={},Q=Z.getProgramParameter($,Z.ACTIVE_UNIFORMS);for(let K=0;K<Q;K++){const q=Z.getActiveUniform($,K),V=q.name.replace(/\[.*?\]$/,""),U=!!q.name.match(/\[.*?\]$/),H=H8(Z,q.type);J[V]={name:V,index:K,type:H,size:q.size,isArray:U,value:V8(H,q.size)}}return J};var pZ=function($,Z){const J=T5($,$.VERTEX_SHADER,Z.vertexSrc),Q=T5($,$.FRAGMENT_SHADER,Z.fragmentSrc),K=$.createProgram();$.attachShader(K,J),$.attachShader(K,Q);const q=Z.extra?.transformFeedbackVaryings;if(q)if(typeof $.transformFeedbackVaryings!=="function")console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given.");else $.transformFeedbackVaryings(K,q.names,q.bufferMode==="separate"?$.SEPARATE_ATTRIBS:$.INTERLEAVED_ATTRIBS);if($.linkProgram(K),!$.getProgramParameter(K,$.LINK_STATUS))gZ($,K,J,Q);if(Z.attributeData=xK(K,$),Z.uniformData=mK(K,$),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(Z.vertexSrc)){const H=Object.keys(Z.attributeData);H.sort((z,W)=>z>W?1:-1);for(let z=0;z<H.length;z++)Z.attributeData[H[z]].location=z,$.bindAttribLocation(K,z,H[z]);$.linkProgram(K)}$.deleteShader(J),$.deleteShader(Q);const V={};for(let H in Z.uniformData){const z=Z.uniformData[H];V[H]={location:$.getUniformLocation(K,H),value:V8(z.type,z.size)}}return new t5(K,V)};var FW=function($,Z,J,Q,K){J.buffer.update(K)},pK=function($){const Z=$.map((q)=>({data:q,offset:0,dataLen:0,dirty:0}));let J=0,Q=0,K=0;for(let q=0;q<Z.length;q++){const V=Z[q];if(J=cK[V.data.type],V.data.size>1)J=Math.max(J,16)*V.data.size;if(V.dataLen=J,Q%J!==0&&Q<16){const U=Q%J%16;Q+=U,K+=U}if(Q+J>16)K=Math.ceil(K/16)*16,V.offset=K,K+=J,Q=J;else V.offset=K,Q+=J,K+=J}return K=Math.ceil(K/16)*16,{uboElements:Z,size:K}},uK=function($,Z){const J=[];for(let Q in $)if(Z[Q])J.push(Z[Q]);return J.sort((Q,K)=>Q.index-K.index),J},uZ=function($,Z){if(!$.autoManage)return{size:0,syncFunc:FW};const J=uK($.uniforms,Z),{uboElements:Q,size:K}=pK(J),q=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let V=0;V<Q.length;V++){const U=Q[V],H=$.uniforms[U.data.name],z=U.data.name;let W=!1;for(let Y=0;Y<E7.length;Y++){const w=E7[Y];if(w.codeUbo&&w.test(U.data,H)){q.push(`offset = ${U.offset/4};`,E7[Y].codeUbo(U.data.name,H)),W=!0;break}}if(!W)if(U.data.size>1){const Y=U8(U.data.type),w=Math.max(cK[U.data.type]/16,1),j=Y/w,C=(4-j%4)%4;q.push(`
                cv = ud.${z}.value;
                v = uv.${z};
                offset = ${U.offset/4};

                t = 0;

                for(var i=0; i < ${U.data.size*w}; i++)
                {
                    for(var j = 0; j < ${j}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${C};
                }

                `)}else{const Y=IW[U.data.type];q.push(`
                cv = ud.${z}.value;
                v = uv.${z};
                offset = ${U.offset/4};
                ${Y};
                `)}}return q.push(`
       renderer.buffer.update(buffer);
    `),{size:K,syncFunc:new Function("ud","uv","renderer","syncData","buffer",q.join("\n"))}},IW={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},cK={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};var kW=0,e5={textureCount:0,uboCount:0};class R8{constructor($){this.destroyed=!1,this.renderer=$,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=kW++}systemCheck(){if(!m5())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange($){this.gl=$,this.reset()}bind($,Z){$.disposeRunner.add(this),$.uniforms.globals=this.renderer.globalUniforms;const J=$.program,Q=J.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram($);if(this.shader=$,this.program!==J)this.program=J,this.gl.useProgram(Q.program);if(!Z)e5.textureCount=0,e5.uboCount=0,this.syncUniformGroup($.uniformGroup,e5);return Q}setUniforms($){const Z=this.shader.program,J=Z.glPrograms[this.renderer.CONTEXT_UID];Z.syncUniforms(J.uniformData,$,this.renderer)}syncUniformGroup($,Z){const J=this.getGlProgram();if(!$.static||$.dirtyId!==J.uniformDirtyGroups[$.id])J.uniformDirtyGroups[$.id]=$.dirtyId,this.syncUniforms($,J,Z)}syncUniforms($,Z,J){($.syncUniforms[this.shader.program.id]||this.createSyncGroups($))(Z.uniformData,$.uniforms,this.renderer,J)}createSyncGroups($){const Z=this.getSignature($,this.shader.program.uniformData,"u");if(!this.cache[Z])this.cache[Z]=yZ($,this.shader.program.uniformData);return $.syncUniforms[this.shader.program.id]=this.cache[Z],$.syncUniforms[this.shader.program.id]}syncUniformBufferGroup($,Z){const J=this.getGlProgram();if(!$.static||$.dirtyId!==0||!J.uniformGroups[$.id]){$.dirtyId=0;const Q=J.uniformGroups[$.id]||this.createSyncBufferGroup($,J,Z);$.buffer.update(),Q(J.uniformData,$.uniforms,this.renderer,e5,$.buffer)}this.renderer.buffer.bindBufferBase($.buffer,J.uniformBufferBindings[Z])}createSyncBufferGroup($,Z,J){const{gl:Q}=this.renderer;this.renderer.buffer.bind($.buffer);const K=this.gl.getUniformBlockIndex(Z.program,J);Z.uniformBufferBindings[J]=this.shader.uniformBindCount,Q.uniformBlockBinding(Z.program,K,this.shader.uniformBindCount),this.shader.uniformBindCount++;const q=this.getSignature($,this.shader.program.uniformData,"ubo");let V=this._uboCache[q];if(!V)V=this._uboCache[q]=uZ($,this.shader.program.uniformData);if($.autoManage){const U=new Float32Array(V.size/4);$.buffer.update(U)}return Z.uniformGroups[$.id]=V.syncFunc,Z.uniformGroups[$.id]}getSignature($,Z,J){const Q=$.uniforms,K=[`${J}-`];for(let q in Q)if(K.push(q),Z[q])K.push(Z[q].type);return K.join("-")}getGlProgram(){if(this.shader)return this.shader.program.glPrograms[this.renderer.CONTEXT_UID];return null}generateProgram($){const Z=this.gl,J=$.program,Q=pZ(Z,J);return J.glPrograms[this.renderer.CONTEXT_UID]=Q,Q}reset(){this.program=null,this.shader=null}disposeShader($){if(this.shader===$)this.shader=null}destroy(){this.renderer=null,this.destroyed=!0}}R8.extension={type:O.RendererSystem,name:"shader"};_.add(R8);class z${constructor($){this.renderer=$}run($){const{renderer:Z}=this;if(Z.runners.init.emit(Z.options),$.hello)console.log(`PixiJS 7.2.4 - ${Z.rendererLogId} - https://pixijs.com`);Z.resize(Z.screen.width,Z.screen.height)}destroy(){}}z$.defaultOptions={hello:!1};z$.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"startup"};_.add(z$);var dK=function($,Z=[]){return Z[o.NORMAL]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.ADD]=[$.ONE,$.ONE],Z[o.MULTIPLY]=[$.DST_COLOR,$.ONE_MINUS_SRC_ALPHA,$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.SCREEN]=[$.ONE,$.ONE_MINUS_SRC_COLOR,$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.OVERLAY]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.DARKEN]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.LIGHTEN]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.COLOR_DODGE]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.COLOR_BURN]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.HARD_LIGHT]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.SOFT_LIGHT]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.DIFFERENCE]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.EXCLUSION]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.HUE]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.SATURATION]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.COLOR]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.LUMINOSITY]=[$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.NONE]=[0,0],Z[o.NORMAL_NPM]=[$.SRC_ALPHA,$.ONE_MINUS_SRC_ALPHA,$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.ADD_NPM]=[$.SRC_ALPHA,$.ONE,$.ONE,$.ONE],Z[o.SCREEN_NPM]=[$.SRC_ALPHA,$.ONE_MINUS_SRC_COLOR,$.ONE,$.ONE_MINUS_SRC_ALPHA],Z[o.SRC_IN]=[$.DST_ALPHA,$.ZERO],Z[o.SRC_OUT]=[$.ONE_MINUS_DST_ALPHA,$.ZERO],Z[o.SRC_ATOP]=[$.DST_ALPHA,$.ONE_MINUS_SRC_ALPHA],Z[o.DST_OVER]=[$.ONE_MINUS_DST_ALPHA,$.ONE],Z[o.DST_IN]=[$.ZERO,$.SRC_ALPHA],Z[o.DST_OUT]=[$.ZERO,$.ONE_MINUS_SRC_ALPHA],Z[o.DST_ATOP]=[$.ONE_MINUS_DST_ALPHA,$.SRC_ALPHA],Z[o.XOR]=[$.ONE_MINUS_DST_ALPHA,$.ONE_MINUS_SRC_ALPHA],Z[o.SUBTRACT]=[$.ONE,$.ONE,$.ONE,$.ONE,$.FUNC_REVERSE_SUBTRACT,$.FUNC_ADD],Z};var OW=0,RW=1,_W=2,MW=3,DW=4,AW=5,dZ=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=o.NONE,this._blendEq=!1,this.map=[],this.map[OW]=this.setBlend,this.map[RW]=this.setOffset,this.map[_W]=this.setCullFace,this.map[MW]=this.setDepthTest,this.map[DW]=this.setFrontFace,this.map[AW]=this.setDepthMask,this.checks=[],this.defaultState=new A0,this.defaultState.blend=!0}contextChange($){this.gl=$,this.blendModes=dK($),this.set(this.defaultState),this.reset()}set($){if($=$||this.defaultState,this.stateId!==$.data){let Z=this.stateId^$.data,J=0;while(Z){if(Z&1)this.map[J].call(this,!!($.data&1<<J));Z=Z>>1,J++}this.stateId=$.data}for(let Z=0;Z<this.checks.length;Z++)this.checks[Z](this,$)}forceState($){$=$||this.defaultState;for(let Z=0;Z<this.map.length;Z++)this.map[Z].call(this,!!($.data&1<<Z));for(let Z=0;Z<this.checks.length;Z++)this.checks[Z](this,$);this.stateId=$.data}setBlend($){this.updateCheck(dZ.checkBlendMode,$),this.gl[$?"enable":"disable"](this.gl.BLEND)}setOffset($){this.updateCheck(dZ.checkPolygonOffset,$),this.gl[$?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest($){this.gl[$?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask($){this.gl.depthMask($)}setCullFace($){this.gl[$?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace($){this.gl.frontFace(this.gl[$?"CW":"CCW"])}setBlendMode($){if($===this.blendMode)return;this.blendMode=$;const Z=this.blendModes[$],J=this.gl;if(Z.length===2)J.blendFunc(Z[0],Z[1]);else J.blendFuncSeparate(Z[0],Z[1],Z[2],Z[3]);if(Z.length===6)this._blendEq=!0,J.blendEquationSeparate(Z[4],Z[5]);else if(this._blendEq)this._blendEq=!1,J.blendEquationSeparate(J.FUNC_ADD,J.FUNC_ADD)}setPolygonOffset($,Z){this.gl.polygonOffset($,Z)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck($,Z){const J=this.checks.indexOf($);if(Z&&J===-1)this.checks.push($);else if(!Z&&J!==-1)this.checks.splice(J,1)}static checkBlendMode($,Z){$.setBlendMode(Z.blendMode)}static checkPolygonOffset($,Z){$.setPolygonOffset(1,Z.polygonOffset)}destroy(){this.gl=null}},$9=dZ;$9.extension={type:O.RendererSystem,name:"state"};_.add($9);class _8 extends Q$.default{constructor(){super(...arguments);this.runners={},this._systemsHash={}}setup($){this.addRunners(...$.runners);const Z=($.priority??[]).filter((Q)=>$.systems[Q]),J=[...Z,...Object.keys($.systems).filter((Q)=>!Z.includes(Q))];for(let Q of J)this.addSystem($.systems[Q],Q)}addRunners(...$){$.forEach((Z)=>{this.runners[Z]=new F0(Z)})}addSystem($,Z){const J=new $(this);if(this[Z])throw new Error(`Whoops! The name "${Z}" is already in use`);this[Z]=J,this._systemsHash[Z]=J;for(let Q in this.runners)this.runners[Q].add(J);return this}emitWithCustomOptions($,Z){const J=Object.keys(this._systemsHash);$.items.forEach((Q)=>{const K=J.find((q)=>this._systemsHash[q]===Q);Q[$.name](Z[K])})}destroy(){Object.values(this.runners).forEach(($)=>{$.destroy()}),this._systemsHash={}}}var Z9=class{constructor($){this.renderer=$,this.count=0,this.checkCount=0,this.maxIdle=Z9.defaultMaxIdle,this.checkCountMax=Z9.defaultCheckCountMax,this.mode=Z9.defaultMode}postrender(){if(!this.renderer.objectRenderer.renderingToScreen)return;if(this.count++,this.mode===X5.MANUAL)return;if(this.checkCount++,this.checkCount>this.checkCountMax)this.checkCount=0,this.run()}run(){const $=this.renderer.texture,Z=$.managedTextures;let J=!1;for(let Q=0;Q<Z.length;Q++){const K=Z[Q];if(!K.framebuffer&&this.count-K.touched>this.maxIdle)$.destroyTexture(K,!0),Z[Q]=null,J=!0}if(J){let Q=0;for(let K=0;K<Z.length;K++)if(Z[K]!==null)Z[Q++]=Z[K];Z.length=Q}}unload($){const Z=this.renderer.texture,J=$._texture;if(J&&!J.framebuffer)Z.destroyTexture(J);for(let Q=$.children.length-1;Q>=0;Q--)this.unload($.children[Q])}destroy(){this.renderer=null}},e0=Z9;e0.defaultMode=X5.AUTO;e0.defaultMaxIdle=3600;e0.defaultCheckCountMax=600;e0.extension={type:O.RendererSystem,name:"textureGC"};_.add(e0);class G6{constructor($){this.texture=$,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=l.UNSIGNED_BYTE,this.internalFormat=b.RGBA,this.samplerType=0}}var lK=function($){let Z;if(("WebGL2RenderingContext"in globalThis)&&$ instanceof globalThis.WebGL2RenderingContext)Z={[l.UNSIGNED_BYTE]:{[b.RGBA]:$.RGBA8,[b.RGB]:$.RGB8,[b.RG]:$.RG8,[b.RED]:$.R8,[b.RGBA_INTEGER]:$.RGBA8UI,[b.RGB_INTEGER]:$.RGB8UI,[b.RG_INTEGER]:$.RG8UI,[b.RED_INTEGER]:$.R8UI,[b.ALPHA]:$.ALPHA,[b.LUMINANCE]:$.LUMINANCE,[b.LUMINANCE_ALPHA]:$.LUMINANCE_ALPHA},[l.BYTE]:{[b.RGBA]:$.RGBA8_SNORM,[b.RGB]:$.RGB8_SNORM,[b.RG]:$.RG8_SNORM,[b.RED]:$.R8_SNORM,[b.RGBA_INTEGER]:$.RGBA8I,[b.RGB_INTEGER]:$.RGB8I,[b.RG_INTEGER]:$.RG8I,[b.RED_INTEGER]:$.R8I},[l.UNSIGNED_SHORT]:{[b.RGBA_INTEGER]:$.RGBA16UI,[b.RGB_INTEGER]:$.RGB16UI,[b.RG_INTEGER]:$.RG16UI,[b.RED_INTEGER]:$.R16UI,[b.DEPTH_COMPONENT]:$.DEPTH_COMPONENT16},[l.SHORT]:{[b.RGBA_INTEGER]:$.RGBA16I,[b.RGB_INTEGER]:$.RGB16I,[b.RG_INTEGER]:$.RG16I,[b.RED_INTEGER]:$.R16I},[l.UNSIGNED_INT]:{[b.RGBA_INTEGER]:$.RGBA32UI,[b.RGB_INTEGER]:$.RGB32UI,[b.RG_INTEGER]:$.RG32UI,[b.RED_INTEGER]:$.R32UI,[b.DEPTH_COMPONENT]:$.DEPTH_COMPONENT24},[l.INT]:{[b.RGBA_INTEGER]:$.RGBA32I,[b.RGB_INTEGER]:$.RGB32I,[b.RG_INTEGER]:$.RG32I,[b.RED_INTEGER]:$.R32I},[l.FLOAT]:{[b.RGBA]:$.RGBA32F,[b.RGB]:$.RGB32F,[b.RG]:$.RG32F,[b.RED]:$.R32F,[b.DEPTH_COMPONENT]:$.DEPTH_COMPONENT32F},[l.HALF_FLOAT]:{[b.RGBA]:$.RGBA16F,[b.RGB]:$.RGB16F,[b.RG]:$.RG16F,[b.RED]:$.R16F},[l.UNSIGNED_SHORT_5_6_5]:{[b.RGB]:$.RGB565},[l.UNSIGNED_SHORT_4_4_4_4]:{[b.RGBA]:$.RGBA4},[l.UNSIGNED_SHORT_5_5_5_1]:{[b.RGBA]:$.RGB5_A1},[l.UNSIGNED_INT_2_10_10_10_REV]:{[b.RGBA]:$.RGB10_A2,[b.RGBA_INTEGER]:$.RGB10_A2UI},[l.UNSIGNED_INT_10F_11F_11F_REV]:{[b.RGB]:$.R11F_G11F_B10F},[l.UNSIGNED_INT_5_9_9_9_REV]:{[b.RGB]:$.RGB9_E5},[l.UNSIGNED_INT_24_8]:{[b.DEPTH_STENCIL]:$.DEPTH24_STENCIL8},[l.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[b.DEPTH_STENCIL]:$.DEPTH32F_STENCIL8}};else Z={[l.UNSIGNED_BYTE]:{[b.RGBA]:$.RGBA,[b.RGB]:$.RGB,[b.ALPHA]:$.ALPHA,[b.LUMINANCE]:$.LUMINANCE,[b.LUMINANCE_ALPHA]:$.LUMINANCE_ALPHA},[l.UNSIGNED_SHORT_5_6_5]:{[b.RGB]:$.RGB},[l.UNSIGNED_SHORT_4_4_4_4]:{[b.RGBA]:$.RGBA},[l.UNSIGNED_SHORT_5_5_5_1]:{[b.RGBA]:$.RGBA}};return Z};class M8{constructor($){this.renderer=$,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new p,this.hasIntegerTextures=!1}contextChange(){const $=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=lK($);const Z=$.getParameter($.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=Z;for(let Q=0;Q<Z;Q++)this.boundTextures[Q]=null;this.emptyTextures={};const J=new G6($.createTexture());$.bindTexture($.TEXTURE_2D,J.texture),$.texImage2D($.TEXTURE_2D,0,$.RGBA,1,1,0,$.RGBA,$.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[$.TEXTURE_2D]=J,this.emptyTextures[$.TEXTURE_CUBE_MAP]=new G6($.createTexture()),$.bindTexture($.TEXTURE_CUBE_MAP,this.emptyTextures[$.TEXTURE_CUBE_MAP].texture);for(let Q=0;Q<6;Q++)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,$.RGBA,1,1,0,$.RGBA,$.UNSIGNED_BYTE,null);$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR);for(let Q=0;Q<this.boundTextures.length;Q++)this.bind(null,Q)}bind($,Z=0){const{gl:J}=this;if($=$?.castToBaseTexture(),$?.valid&&!$.parentTextureArray){$.touched=this.renderer.textureGC.count;const Q=$._glTextures[this.CONTEXT_UID]||this.initTexture($);if(this.boundTextures[Z]!==$){if(this.currentLocation!==Z)this.currentLocation=Z,J.activeTexture(J.TEXTURE0+Z);J.bindTexture($.target,Q.texture)}if(Q.dirtyId!==$.dirtyId){if(this.currentLocation!==Z)this.currentLocation=Z,J.activeTexture(J.TEXTURE0+Z);this.updateTexture($)}else if(Q.dirtyStyleId!==$.dirtyStyleId)this.updateTextureStyle($);this.boundTextures[Z]=$}else{if(this.currentLocation!==Z)this.currentLocation=Z,J.activeTexture(J.TEXTURE0+Z);J.bindTexture(J.TEXTURE_2D,this.emptyTextures[J.TEXTURE_2D].texture),this.boundTextures[Z]=null}}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let $=0;$<this.boundTextures.length;$++)this.boundTextures[$]=this.unknownTexture}unbind($){const{gl:Z,boundTextures:J}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let Q=0;Q<J.length;Q++)if(J[Q]===this.unknownTexture)this.bind(null,Q)}for(let Q=0;Q<J.length;Q++)if(J[Q]===$){if(this.currentLocation!==Q)Z.activeTexture(Z.TEXTURE0+Q),this.currentLocation=Q;Z.bindTexture($.target,this.emptyTextures[$.target].texture),J[Q]=null}}ensureSamplerType($){const{boundTextures:Z,hasIntegerTextures:J,CONTEXT_UID:Q}=this;if(!J)return;for(let K=$-1;K>=0;--K){const q=Z[K];if(q){if(q._glTextures[Q].samplerType!==C5.FLOAT)this.renderer.texture.unbind(q)}}}initTexture($){const Z=new G6(this.gl.createTexture());return Z.dirtyId=-1,$._glTextures[this.CONTEXT_UID]=Z,this.managedTextures.push($),$.on("dispose",this.destroyTexture,this),Z}initTextureType($,Z){if(Z.internalFormat=this.internalFormats[$.type]?.[$.format]??$.format,this.webGLVersion===2&&$.type===l.HALF_FLOAT)Z.type=this.gl.HALF_FLOAT;else Z.type=$.type}updateTexture($){const Z=$._glTextures[this.CONTEXT_UID];if(!Z)return;const J=this.renderer;if(this.initTextureType($,Z),$.resource?.upload(J,$,Z)){if(Z.samplerType!==C5.FLOAT)this.hasIntegerTextures=!0}else{const{realWidth:Q,realHeight:K}=$,q=J.gl;if(Z.width!==Q||Z.height!==K||Z.dirtyId<0)Z.width=Q,Z.height=K,q.texImage2D($.target,0,Z.internalFormat,Q,K,0,$.format,Z.type,null)}if($.dirtyStyleId!==Z.dirtyStyleId)this.updateTextureStyle($);Z.dirtyId=$.dirtyId}destroyTexture($,Z){const{gl:J}=this;if($=$.castToBaseTexture(),$._glTextures[this.CONTEXT_UID]){if(this.unbind($),J.deleteTexture($._glTextures[this.CONTEXT_UID].texture),$.off("dispose",this.destroyTexture,this),delete $._glTextures[this.CONTEXT_UID],!Z){const Q=this.managedTextures.indexOf($);if(Q!==-1)M5(this.managedTextures,Q,1)}}}updateTextureStyle($){const Z=$._glTextures[this.CONTEXT_UID];if(!Z)return;if(($.mipmap===D0.POW2||this.webGLVersion!==2)&&!$.isPowerOfTwo)Z.mipmap=!1;else Z.mipmap=$.mipmap>=1;if(this.webGLVersion!==2&&!$.isPowerOfTwo)Z.wrapMode=x0.CLAMP;else Z.wrapMode=$.wrapMode;if($.resource?.style(this.renderer,$,Z));else this.setStyle($,Z);Z.dirtyStyleId=$.dirtyStyleId}setStyle($,Z){const J=this.gl;if(Z.mipmap&&$.mipmap!==D0.ON_MANUAL)J.generateMipmap($.target);if(J.texParameteri($.target,J.TEXTURE_WRAP_S,Z.wrapMode),J.texParameteri($.target,J.TEXTURE_WRAP_T,Z.wrapMode),Z.mipmap){J.texParameteri($.target,J.TEXTURE_MIN_FILTER,$.scaleMode===a0.LINEAR?J.LINEAR_MIPMAP_LINEAR:J.NEAREST_MIPMAP_NEAREST);const Q=this.renderer.context.extensions.anisotropicFiltering;if(Q&&$.anisotropicLevel>0&&$.scaleMode===a0.LINEAR){const K=Math.min($.anisotropicLevel,J.getParameter(Q.MAX_TEXTURE_MAX_ANISOTROPY_EXT));J.texParameterf($.target,Q.TEXTURE_MAX_ANISOTROPY_EXT,K)}}else J.texParameteri($.target,J.TEXTURE_MIN_FILTER,$.scaleMode===a0.LINEAR?J.LINEAR:J.NEAREST);J.texParameteri($.target,J.TEXTURE_MAG_FILTER,$.scaleMode===a0.LINEAR?J.LINEAR:J.NEAREST)}destroy(){this.renderer=null}}M8.extension={type:O.RendererSystem,name:"texture"};_.add(M8);class D8{constructor($){this.renderer=$}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind($){const{gl:Z,CONTEXT_UID:J}=this,Q=$._glTransformFeedbacks[J]||this.createGLTransformFeedback($);Z.bindTransformFeedback(Z.TRANSFORM_FEEDBACK,Q)}unbind(){const{gl:$}=this;$.bindTransformFeedback($.TRANSFORM_FEEDBACK,null)}beginTransformFeedback($,Z){const{gl:J,renderer:Q}=this;if(Z)Q.shader.bind(Z);J.beginTransformFeedback($)}endTransformFeedback(){const{gl:$}=this;$.endTransformFeedback()}createGLTransformFeedback($){const{gl:Z,renderer:J,CONTEXT_UID:Q}=this,K=Z.createTransformFeedback();$._glTransformFeedbacks[Q]=K,Z.bindTransformFeedback(Z.TRANSFORM_FEEDBACK,K);for(let q=0;q<$.buffers.length;q++){const V=$.buffers[q];if(!V)continue;J.buffer.update(V),V._glBuffers[Q].refCount++,Z.bindBufferBase(Z.TRANSFORM_FEEDBACK_BUFFER,q,V._glBuffers[Q].buffer||null)}return Z.bindTransformFeedback(Z.TRANSFORM_FEEDBACK,null),$.disposeRunner.add(this),K}disposeTransformFeedback($,Z){const J=$._glTransformFeedbacks[this.CONTEXT_UID],Q=this.gl;$.disposeRunner.remove(this);const K=this.renderer.buffer;if(K)for(let q=0;q<$.buffers.length;q++){const V=$.buffers[q];if(!V)continue;const U=V._glBuffers[this.CONTEXT_UID];if(U){if(U.refCount--,U.refCount===0&&!Z)K.dispose(V,Z)}}if(!J)return;if(!Z)Q.deleteTransformFeedback(J);delete $._glTransformFeedbacks[this.CONTEXT_UID]}destroy(){this.renderer=null}}D8.extension={type:O.RendererSystem,name:"transformFeedback"};_.add(D8);class W${constructor($){this.renderer=$}init($){this.screen=new c(0,0,$.width,$.height),this.element=$.view||I.ADAPTER.createCanvas(),this.resolution=$.resolution||I.RESOLUTION,this.autoDensity=!!$.autoDensity}resizeView($,Z){this.element.width=Math.round($*this.resolution),this.element.height=Math.round(Z*this.resolution);const J=this.element.width/this.resolution,Q=this.element.height/this.resolution;if(this.screen.width=J,this.screen.height=Q,this.autoDensity)this.element.style.width=`${J}px`,this.element.style.height=`${Q}px`;this.renderer.emit("resize",J,Q),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy($){if($)this.element.parentNode?.removeChild(this.element);this.renderer=null,this.element=null,this.screen=null}}W$.defaultOptions={width:800,height:600,resolution:I.RESOLUTION,autoDensity:!1};W$.extension={type:[O.RendererSystem,O.CanvasRendererSystem],name:"_view"};_.add(W$);I.PREFER_ENV=$7.WEBGL2;I.STRICT_TEXTURE_CACHE=!1;I.RENDER_OPTIONS={...U$.defaultOptions,...V$.defaultOptions,...W$.defaultOptions,...z$.defaultOptions};Object.defineProperties(I,{WRAP_MODE:{get(){return p.defaultOptions.wrapMode},set($){t("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),p.defaultOptions.wrapMode=$}},SCALE_MODE:{get(){return p.defaultOptions.scaleMode},set($){t("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),p.defaultOptions.scaleMode=$}},MIPMAP_TEXTURES:{get(){return p.defaultOptions.mipmap},set($){t("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),p.defaultOptions.mipmap=$}},ANISOTROPIC_LEVEL:{get(){return p.defaultOptions.anisotropicLevel},set($){t("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),p.defaultOptions.anisotropicLevel=$}},FILTER_RESOLUTION:{get(){return t("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),W0.defaultResolution},set($){W0.defaultResolution=$}},FILTER_MULTISAMPLE:{get(){return t("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),W0.defaultMultisample},set($){W0.defaultMultisample=$}},SPRITE_MAX_TEXTURES:{get(){return Q7.defaultMaxTextures},set($){t("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Q7.defaultMaxTextures=$}},SPRITE_BATCH_SIZE:{get(){return Q7.defaultBatchSize},set($){t("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Q7.defaultBatchSize=$}},CAN_UPLOAD_SAME_BUFFER:{get(){return Q7.canUploadSameBuffer},set($){t("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Q7.canUploadSameBuffer=$}},GC_MODE:{get(){return e0.defaultMode},set($){t("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),e0.defaultMode=$}},GC_MAX_IDLE:{get(){return e0.defaultMaxIdle},set($){t("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),e0.defaultMaxIdle=$}},GC_MAX_CHECK_COUNT:{get(){return e0.defaultCheckCountMax},set($){t("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),e0.defaultCheckCountMax=$}},PRECISION_VERTEX:{get(){return M0.defaultVertexPrecision},set($){t("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),M0.defaultVertexPrecision=$}},PRECISION_FRAGMENT:{get(){return M0.defaultFragmentPrecision},set($){t("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),M0.defaultFragmentPrecision=$}}});var K7=(($)=>{return $[$.INTERACTION=50]="INTERACTION",$[$.HIGH=25]="HIGH",$[$.NORMAL=0]="NORMAL",$[$.LOW=-25]="LOW",$[$.UTILITY=-50]="UTILITY",$})(K7||{});class A8{constructor($,Z=null,J=0,Q=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=$,this.context=Z,this.priority=J,this.once=Q}match($,Z=null){return this.fn===$&&this.context===Z}emit($){if(this.fn)if(this.context)this.fn.call(this.context,$);else this.fn($);const Z=this.next;if(this.once)this.destroy(!0);if(this._destroyed)this.next=null;return Z}connect($){if(this.previous=$,$.next)$.next.previous=this;this.next=$.next,$.next=this}destroy($=!1){if(this._destroyed=!0,this.fn=null,this.context=null,this.previous)this.previous.next=this.next;if(this.next)this.next.previous=this.previous;const Z=this.next;return this.next=$?null:Z,this.previous=null,Z}}var q7=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new A8(null,null,Infinity),this.deltaMS=1/q7.targetFPMS,this.elapsedMS=1/q7.targetFPMS,this._tick=($)=>{if(this._requestId=null,this.started){if(this.update($),this.started&&this._requestId===null&&this._head.next)this._requestId=requestAnimationFrame(this._tick)}}}_requestIfNeeded(){if(this._requestId===null&&this._head.next)this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick)}_cancelIfNeeded(){if(this._requestId!==null)cancelAnimationFrame(this._requestId),this._requestId=null}_startIfPossible(){if(this.started)this._requestIfNeeded();else if(this.autoStart)this.start()}add($,Z,J=K7.NORMAL){return this._addListener(new A8($,Z,J))}addOnce($,Z,J=K7.NORMAL){return this._addListener(new A8($,Z,J,!0))}_addListener($){let Z=this._head.next,J=this._head;if(!Z)$.connect(J);else{while(Z){if($.priority>Z.priority){$.connect(J);break}J=Z,Z=Z.next}if(!$.previous)$.connect(J)}return this._startIfPossible(),this}remove($,Z){let J=this._head.next;while(J)if(J.match($,Z))J=J.destroy();else J=J.next;if(!this._head.next)this._cancelIfNeeded();return this}get count(){if(!this._head)return 0;let $=0,Z=this._head;while(Z=Z.next)$++;return $}start(){if(!this.started)this.started=!0,this._requestIfNeeded()}stop(){if(this.started)this.started=!1,this._cancelIfNeeded()}destroy(){if(!this._protected){this.stop();let $=this._head.next;while($)$=$.destroy(!0);this._head.destroy(),this._head=null}}update($=performance.now()){let Z;if($>this.lastTime){if(Z=this.elapsedMS=$-this.lastTime,Z>this._maxElapsedMS)Z=this._maxElapsedMS;if(Z*=this.speed,this._minElapsedMS){const K=$-this._lastFrame|0;if(K<this._minElapsedMS)return;this._lastFrame=$-K%this._minElapsedMS}this.deltaMS=Z,this.deltaTime=this.deltaMS*q7.targetFPMS;const J=this._head;let Q=J.next;while(Q)Q=Q.emit(this.deltaTime);if(!J.next)this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=$}get FPS(){return 1000/this.elapsedMS}get minFPS(){return 1000/this._maxElapsedMS}set minFPS($){const Z=Math.min(this.maxFPS,$),J=Math.min(Math.max(0,Z)/1000,q7.targetFPMS);this._maxElapsedMS=1/J}get maxFPS(){if(this._minElapsedMS)return Math.round(1000/this._minElapsedMS);return 0}set maxFPS($){if($===0)this._minElapsedMS=0;else{const Z=Math.max(this.minFPS,$);this._minElapsedMS=1/(Z/1000)}}static get shared(){if(!q7._shared){const $=q7._shared=new q7;$.autoStart=!0,$._protected=!0}return q7._shared}static get system(){if(!q7._system){const $=q7._system=new q7;$.autoStart=!0,$._protected=!0}return q7._system}},Y0=q7;Y0.targetFPMS=0.06;Object.defineProperties(I,{TARGET_FPMS:{get(){return Y0.targetFPMS},set($){t("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Y0.targetFPMS=$}}});class J9{static init($){if($=Object.assign({autoStart:!0,sharedTicker:!1},$),Object.defineProperty(this,"ticker",{set(Z){if(this._ticker)this._ticker.remove(this.render,this);if(this._ticker=Z,Z)Z.add(this.render,this,K7.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=$.sharedTicker?Y0.shared:new Y0,$.autoStart)this.start()}static destroy(){if(this._ticker){const $=this._ticker;this.ticker=null,$.destroy()}}}J9.extension=O.Application;_.add(J9);var lZ=function($){for(let Z of nK)if(Z.test($))return new Z($);throw new Error("Unable to auto-detect a suitable renderer.")},nK=[];_.handleByList(O.Renderer,nK);var oK="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}";var sK="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";var nZ=oK,E8=sK;class Q9{constructor($){this.renderer=$}contextChange($){let Z;if(this.renderer.context.webGLVersion===1){const J=$.getParameter($.FRAMEBUFFER_BINDING);$.bindFramebuffer($.FRAMEBUFFER,null),Z=$.getParameter($.SAMPLES),$.bindFramebuffer($.FRAMEBUFFER,J)}else{const J=$.getParameter($.DRAW_FRAMEBUFFER_BINDING);$.bindFramebuffer($.DRAW_FRAMEBUFFER,null),Z=$.getParameter($.SAMPLES),$.bindFramebuffer($.DRAW_FRAMEBUFFER,J)}if(Z>=H0.HIGH)this.multisample=H0.HIGH;else if(Z>=H0.MEDIUM)this.multisample=H0.MEDIUM;else if(Z>=H0.LOW)this.multisample=H0.LOW;else this.multisample=H0.NONE}destroy(){}}Q9.extension={type:O.RendererSystem,name:"_multisample"};_.add(Q9);class oZ{constructor($){this.buffer=$||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class K9{constructor($){this.renderer=$,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind($){const{gl:Z,CONTEXT_UID:J}=this,Q=$._glBuffers[J]||this.createGLBuffer($);Z.bindBuffer($.type,Q.buffer)}unbind($){const{gl:Z}=this;Z.bindBuffer($,null)}bindBufferBase($,Z){const{gl:J,CONTEXT_UID:Q}=this;if(this.boundBufferBases[Z]!==$){const K=$._glBuffers[Q]||this.createGLBuffer($);this.boundBufferBases[Z]=$,J.bindBufferBase(J.UNIFORM_BUFFER,Z,K.buffer)}}bindBufferRange($,Z,J){const{gl:Q,CONTEXT_UID:K}=this;J=J||0;const q=$._glBuffers[K]||this.createGLBuffer($);Q.bindBufferRange(Q.UNIFORM_BUFFER,Z||0,q.buffer,J*256,256)}update($){const{gl:Z,CONTEXT_UID:J}=this,Q=$._glBuffers[J]||this.createGLBuffer($);if($._updateID===Q.updateID)return;if(Q.updateID=$._updateID,Z.bindBuffer($.type,Q.buffer),Q.byteLength>=$.data.byteLength)Z.bufferSubData($.type,0,$.data);else{const K=$.static?Z.STATIC_DRAW:Z.DYNAMIC_DRAW;Q.byteLength=$.data.byteLength,Z.bufferData($.type,$.data,K)}}dispose($,Z){if(!this.managedBuffers[$.id])return;delete this.managedBuffers[$.id];const J=$._glBuffers[this.CONTEXT_UID],Q=this.gl;if($.disposeRunner.remove(this),!J)return;if(!Z)Q.deleteBuffer(J.buffer);delete $._glBuffers[this.CONTEXT_UID]}disposeAll($){const Z=Object.keys(this.managedBuffers);for(let J=0;J<Z.length;J++)this.dispose(this.managedBuffers[Z[J]],$)}createGLBuffer($){const{CONTEXT_UID:Z,gl:J}=this;return $._glBuffers[Z]=new oZ(J.createBuffer()),this.managedBuffers[$.id]=$,$.disposeRunner.add(this),$._glBuffers[Z]}}K9.extension={type:O.RendererSystem,name:"buffer"};_.add(K9);class q9{constructor($){this.renderer=$}render($,Z){const J=this.renderer;let Q,K,q,V;if(Z)Q=Z.renderTexture,K=Z.clear,q=Z.transform,V=Z.skipUpdateTransform;if(this.renderingToScreen=!Q,J.runners.prerender.emit(),J.emit("prerender"),J.projection.transform=q,J.context.isLost)return;if(!Q)this.lastObjectRendered=$;if(!V){const U=$.enableTempParent();$.updateTransform(),$.disableTempParent(U)}if(J.renderTexture.bind(Q),J.batch.currentRenderer.start(),K??J.background.clearBeforeRender)J.renderTexture.clear();if($.render(J),J.batch.currentRenderer.flush(),Q){if(Z.blit)J.framebuffer.blit();Q.baseTexture.update()}J.runners.postrender.emit(),J.projection.transform=null,J.emit("postrender")}destroy(){this.renderer=null,this.lastObjectRendered=null}}q9.extension={type:O.RendererSystem,name:"objectRenderer"};_.add(q9);var sZ=class extends _8{constructor($){super();this.type=JZ.WEBGL,$=Object.assign({},I.RENDER_OPTIONS,$),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new E0({projectionMatrix:new Z0},!0);const Z={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:sZ.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};if(this.setup(Z),("useContextAlpha"in $))t("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),$.premultipliedAlpha=$.useContextAlpha&&$.useContextAlpha!=="notMultiplied",$.backgroundAlpha=$.useContextAlpha===!1?1:$.backgroundAlpha;this._plugin.rendererPlugins=sZ.__plugins,this.options=$,this.startup.run(this.options)}static test($){if($?.forceCanvas)return!1;return O5()}render($,Z){this.objectRenderer.render($,Z)}resize($,Z){this._view.resizeView($,Z)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy($=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:$}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution($){this._view.resolution=$,this.runners.resolutionChange.emit($)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return t("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return t("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return t("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return t("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor($){t("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=$}get backgroundAlpha(){return t("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha($){t("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=$}get powerPreference(){return t("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture($,Z){return this.textureGenerator.generateTexture($,Z)}},c$=sZ;c$.extension={type:O.Renderer,priority:1};c$.__plugins={};c$.__systems={};_.handleByMap(O.RendererPlugin,c$.__plugins);_.handleByMap(O.RendererSystem,c$.__systems);_.add(c$);class p$ extends j7{constructor($,Z){const{width:J,height:Q}=Z||{};super(J,Q);this.items=[],this.itemDirtyIds=[];for(let K=0;K<$;K++){const q=new p;this.items.push(q),this.itemDirtyIds.push(-2)}this.length=$,this._load=null,this.baseTexture=null}initFromArray($,Z){for(let J=0;J<this.length;J++){if(!$[J])continue;if($[J].castToBaseTexture)this.addBaseTextureAt($[J].castToBaseTexture(),J);else if($[J]instanceof j7)this.addResourceAt($[J],J);else this.addResourceAt(z6($[J],Z),J)}}dispose(){for(let $=0,Z=this.length;$<Z;$++)this.items[$].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt($,Z){if(!this.items[Z])throw new Error(`Index ${Z} is out of bounds`);if($.valid&&!this.valid)this.resize($.width,$.height);return this.items[Z].setResource($),this}bind($){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind($);for(let Z=0;Z<this.length;Z++)this.items[Z].parentTextureArray=$,this.items[Z].on("update",$.update,$)}unbind($){super.unbind($);for(let Z=0;Z<this.length;Z++)this.items[Z].parentTextureArray=null,this.items[Z].off("update",$.update,$)}load(){if(this._load)return this._load;const Z=this.items.map((J)=>J.resource).filter((J)=>J).map((J)=>J.load());return this._load=Promise.all(Z).then(()=>{const{realWidth:J,realHeight:Q}=this.items[0];return this.resize(J,Q),Promise.resolve(this)}),this._load}}class b8 extends p${constructor($,Z){const{width:J,height:Q}=Z||{};let K,q;if(Array.isArray($))K=$,q=$.length;else q=$;super(q,{width:J,height:Q});if(K)this.initFromArray(K,Z)}addBaseTextureAt($,Z){if($.resource)this.addResourceAt($.resource,Z);else throw new Error("ArrayResource does not support RenderTexture");return this}bind($){super.bind($),$.target=m7.TEXTURE_2D_ARRAY}upload($,Z,J){const{length:Q,itemDirtyIds:K,items:q}=this,{gl:V}=$;if(J.dirtyId<0)V.texImage3D(V.TEXTURE_2D_ARRAY,0,J.internalFormat,this._width,this._height,Q,0,Z.format,J.type,null);for(let U=0;U<Q;U++){const H=q[U];if(K[U]<H.dirtyId){if(K[U]=H.dirtyId,H.valid)V.texSubImage3D(V.TEXTURE_2D_ARRAY,0,0,0,U,H.resource.width,H.resource.height,1,Z.format,J.type,H.resource.source)}}return!0}}class v8 extends h0{constructor($){super($)}static test($){const{OffscreenCanvas:Z}=globalThis;if(Z&&$ instanceof Z)return!0;return globalThis.HTMLCanvasElement&&$ instanceof HTMLCanvasElement}}var S8=class extends p${constructor($,Z){const{width:J,height:Q,autoLoad:K,linkBaseTexture:q}=Z||{};if($&&$.length!==S8.SIDES)throw new Error(`Invalid length. Got ${$.length}, expected 6`);super(6,{width:J,height:Q});for(let V=0;V<S8.SIDES;V++)this.items[V].target=m7.TEXTURE_CUBE_MAP_POSITIVE_X+V;if(this.linkBaseTexture=q!==!1,$)this.initFromArray($,Z);if(K!==!1)this.load()}bind($){super.bind($),$.target=m7.TEXTURE_CUBE_MAP}addBaseTextureAt($,Z,J){if(J===void 0)J=this.linkBaseTexture;if(!this.items[Z])throw new Error(`Index ${Z} is out of bounds`);if(!this.linkBaseTexture||$.parentTextureArray||Object.keys($._glTextures).length>0)if($.resource)this.addResourceAt($.resource,Z);else throw new Error("CubeResource does not support copying of renderTexture.");else $.target=m7.TEXTURE_CUBE_MAP_POSITIVE_X+Z,$.parentTextureArray=this.baseTexture,this.items[Z]=$;if($.valid&&!this.valid)this.resize($.realWidth,$.realHeight);return this.items[Z]=$,this}upload($,Z,J){const Q=this.itemDirtyIds;for(let K=0;K<S8.SIDES;K++){const q=this.items[K];if(Q[K]<q.dirtyId||J.dirtyId<Z.dirtyId){if(q.valid&&q.resource)q.resource.upload($,q,J),Q[K]=q.dirtyId;else if(Q[K]<-1)$.gl.texImage2D(q.target,0,J.internalFormat,Z.realWidth,Z.realHeight,0,Z.format,J.type,null),Q[K]=-1}}return!0}static test($){return Array.isArray($)&&$.length===S8.SIDES}},T8=S8;T8.SIDES=6;class d7 extends h0{constructor($,Z){Z=Z||{};let J,Q;if(typeof $==="string")J=d7.EMPTY,Q=$;else J=$,Q=null;super(J);if(this.url=Q,this.crossOrigin=Z.crossOrigin??!0,this.alphaMode=typeof Z.alphaMode==="number"?Z.alphaMode:null,this._load=null,Z.autoLoad!==!1)this.load()}load(){if(this._load)return this._load;return this._load=new Promise(async($,Z)=>{if(this.url===null){$(this);return}try{const J=await I.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const Q=await J.blob();if(this.destroyed)return;const K=await createImageBitmap(Q,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===P0.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=K,this.update(),$(this)}catch(J){if(this.destroyed)return;Z(J),this.onError.emit(J)}}),this._load}upload($,Z,J){if(!(this.source instanceof ImageBitmap))return this.load(),!1;if(typeof this.alphaMode==="number")Z.alphaMode=this.alphaMode;return super.upload($,Z,J)}dispose(){if(this.source instanceof ImageBitmap)this.source.close();super.dispose(),this._load=null}static test($){return!!globalThis.createImageBitmap&&typeof ImageBitmap!=="undefined"&&(typeof $==="string"||$ instanceof ImageBitmap)}static get EMPTY(){return d7._EMPTY=d7._EMPTY??I.ADAPTER.createCanvas(0,0),d7._EMPTY}}var V9=class extends h0{constructor($,Z){Z=Z||{};super(I.ADAPTER.createCanvas());if(this._width=0,this._height=0,this.svg=$,this.scale=Z.scale||1,this._overrideWidth=Z.width,this._overrideHeight=Z.height,this._resolve=null,this._crossorigin=Z.crossorigin,this._load=null,Z.autoLoad!==!1)this.load()}load(){if(this._load)return this._load;return this._load=new Promise(($)=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),$(this)},V9.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load}_loadSvg(){const $=new Image;h0.crossOrigin($,this.svg,this._crossorigin),$.src=this.svg,$.onerror=(Z)=>{if(!this._resolve)return;$.onerror=null,this.onError.emit(Z)},$.onload=()=>{if(!this._resolve)return;const{width:Z,height:J}=$;if(!Z||!J)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let Q=Z*this.scale,K=J*this.scale;if(this._overrideWidth||this._overrideHeight)Q=this._overrideWidth||this._overrideHeight/J*Z,K=this._overrideHeight||this._overrideWidth/Z*J;Q=Math.round(Q),K=Math.round(K);const q=this.source;q.width=Q,q.height=K,q._pixiId=`canvas_${A7()}`,q.getContext("2d").drawImage($,0,0,Z,J,0,0,Q,K),this._resolve(),this._resolve=null}}static getSize($){const Z=V9.SVG_SIZE.exec($),J={};if(Z)J[Z[1]]=Math.round(parseFloat(Z[3])),J[Z[5]]=Math.round(parseFloat(Z[7]));return J}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test($,Z){return Z==="svg"||typeof $==="string"&&$.startsWith("data:image/svg+xml")||typeof $==="string"&&V9.SVG_XML.test($)}},l7=V9;l7.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;l7.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var iZ=class extends h0{constructor($,Z){if(Z=Z||{},!($ instanceof HTMLVideoElement)){const J=document.createElement("video");if(J.setAttribute("preload","auto"),J.setAttribute("webkit-playsinline",""),J.setAttribute("playsinline",""),typeof $==="string")$=[$];const Q=$[0].src||$[0];h0.crossOrigin(J,Q,Z.crossorigin);for(let K=0;K<$.length;++K){const q=document.createElement("source");let{src:V,mime:U}=$[K];V=V||$[K];const H=V.split("?").shift().toLowerCase(),z=H.slice(H.lastIndexOf(".")+1);U=U||iZ.MIME_TYPES[z]||`video/${z}`,q.src=V,q.type=U,J.appendChild(q)}$=J}super($);if(this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=Z.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=Z.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),Z.autoLoad!==!1)this.load()}update($=0){if(!this.destroyed){const Z=Y0.shared.elapsedMS*this.source.playbackRate;if(this._msToNextUpdate=Math.floor(this._msToNextUpdate-Z),!this._updateFPS||this._msToNextUpdate<=0)super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1000/this._updateFPS):0}}load(){if(this._load)return this._load;const $=this.source;if(($.readyState===$.HAVE_ENOUGH_DATA||$.readyState===$.HAVE_FUTURE_DATA)&&$.width&&$.height)$.complete=!0;if($.addEventListener("play",this._onPlayStart.bind(this)),$.addEventListener("pause",this._onPlayStop.bind(this)),!this._isSourceReady())$.addEventListener("canplay",this._onCanPlay),$.addEventListener("canplaythrough",this._onCanPlay),$.addEventListener("error",this._onError,!0);else this._onCanPlay();return this._load=new Promise((Z)=>{if(this.valid)Z(this);else this._resolve=Z,$.load()}),this._load}_onError($){this.source.removeEventListener("error",this._onError,!0),this.onError.emit($)}_isSourcePlaying(){const $=this.source;return!$.paused&&!$.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){if(!this.valid)this._onCanPlay();if(this.autoUpdate&&!this._isConnectedToTicker)Y0.shared.add(this.update,this),this._isConnectedToTicker=!0}_onPlayStop(){if(this._isConnectedToTicker)Y0.shared.remove(this.update,this),this._isConnectedToTicker=!1}_onCanPlay(){const $=this.source;$.removeEventListener("canplay",this._onCanPlay),$.removeEventListener("canplaythrough",this._onCanPlay);const Z=this.valid;if(this.resize($.videoWidth,$.videoHeight),!Z&&this._resolve)this._resolve(this),this._resolve=null;if(this._isSourcePlaying())this._onPlayStart();else if(this.autoPlay)$.play()}dispose(){if(this._isConnectedToTicker)Y0.shared.remove(this.update,this),this._isConnectedToTicker=!1;const $=this.source;if($)$.removeEventListener("error",this._onError,!0),$.pause(),$.src="",$.load();super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate($){if($!==this._autoUpdate){if(this._autoUpdate=$,!this._autoUpdate&&this._isConnectedToTicker)Y0.shared.remove(this.update,this),this._isConnectedToTicker=!1;else if(this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying())Y0.shared.add(this.update,this),this._isConnectedToTicker=!0}}get updateFPS(){return this._updateFPS}set updateFPS($){if($!==this._updateFPS)this._updateFPS=$}static test($,Z){return globalThis.HTMLVideoElement&&$ instanceof HTMLVideoElement||iZ.TYPES.includes(Z)}},N6=iZ;N6.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];N6.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};H6.push(d7,x$,v8,N6,l7,J7,T8,b8);class n7{constructor(){this.minX=Infinity,this.minY=Infinity,this.maxX=(-Infinity),this.maxY=(-Infinity),this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=Infinity,this.minY=Infinity,this.maxX=(-Infinity),this.maxY=(-Infinity)}getRectangle($){if(this.minX>this.maxX||this.minY>this.maxY)return c.EMPTY;return $=$||new c(0,0,1,1),$.x=this.minX,$.y=this.minY,$.width=this.maxX-this.minX,$.height=this.maxY-this.minY,$}addPoint($){this.minX=Math.min(this.minX,$.x),this.maxX=Math.max(this.maxX,$.x),this.minY=Math.min(this.minY,$.y),this.maxY=Math.max(this.maxY,$.y)}addPointMatrix($,Z){const{a:J,b:Q,c:K,d:q,tx:V,ty:U}=$,H=J*Z.x+K*Z.y+V,z=Q*Z.x+q*Z.y+U;this.minX=Math.min(this.minX,H),this.maxX=Math.max(this.maxX,H),this.minY=Math.min(this.minY,z),this.maxY=Math.max(this.maxY,z)}addQuad($){let Z=this.minX,J=this.minY,Q=this.maxX,K=this.maxY,q=$[0],V=$[1];Z=q<Z?q:Z,J=V<J?V:J,Q=q>Q?q:Q,K=V>K?V:K,q=$[2],V=$[3],Z=q<Z?q:Z,J=V<J?V:J,Q=q>Q?q:Q,K=V>K?V:K,q=$[4],V=$[5],Z=q<Z?q:Z,J=V<J?V:J,Q=q>Q?q:Q,K=V>K?V:K,q=$[6],V=$[7],Z=q<Z?q:Z,J=V<J?V:J,Q=q>Q?q:Q,K=V>K?V:K,this.minX=Z,this.minY=J,this.maxX=Q,this.maxY=K}addFrame($,Z,J,Q,K){this.addFrameMatrix($.worldTransform,Z,J,Q,K)}addFrameMatrix($,Z,J,Q,K){const{a:q,b:V,c:U,d:H,tx:z,ty:W}=$;let Y=this.minX,w=this.minY,j=this.maxX,C=this.maxY,X=q*Z+U*J+z,G=V*Z+H*J+W;Y=X<Y?X:Y,w=G<w?G:w,j=X>j?X:j,C=G>C?G:C,X=q*Q+U*J+z,G=V*Q+H*J+W,Y=X<Y?X:Y,w=G<w?G:w,j=X>j?X:j,C=G>C?G:C,X=q*Z+U*K+z,G=V*Z+H*K+W,Y=X<Y?X:Y,w=G<w?G:w,j=X>j?X:j,C=G>C?G:C,X=q*Q+U*K+z,G=V*Q+H*K+W,Y=X<Y?X:Y,w=G<w?G:w,j=X>j?X:j,C=G>C?G:C,this.minX=Y,this.minY=w,this.maxX=j,this.maxY=C}addVertexData($,Z,J){let Q=this.minX,K=this.minY,q=this.maxX,V=this.maxY;for(let U=Z;U<J;U+=2){const H=$[U],z=$[U+1];Q=H<Q?H:Q,K=z<K?z:K,q=H>q?H:q,V=z>V?z:V}this.minX=Q,this.minY=K,this.maxX=q,this.maxY=V}addVertices($,Z,J,Q){this.addVerticesMatrix($.worldTransform,Z,J,Q)}addVerticesMatrix($,Z,J,Q,K=0,q=K){const{a:V,b:U,c:H,d:z,tx:W,ty:Y}=$;let w=this.minX,j=this.minY,C=this.maxX,X=this.maxY;for(let G=J;G<Q;G+=2){const F=Z[G],L=Z[G+1],N=V*F+H*L+W,B=z*L+U*F+Y;w=Math.min(w,N-K),C=Math.max(C,N+K),j=Math.min(j,B-q),X=Math.max(X,B+q)}this.minX=w,this.minY=j,this.maxX=C,this.maxY=X}addBounds($){const Z=this.minX,J=this.minY,Q=this.maxX,K=this.maxY;this.minX=$.minX<Z?$.minX:Z,this.minY=$.minY<J?$.minY:J,this.maxX=$.maxX>Q?$.maxX:Q,this.maxY=$.maxY>K?$.maxY:K}addBoundsMask($,Z){const J=$.minX>Z.minX?$.minX:Z.minX,Q=$.minY>Z.minY?$.minY:Z.minY,K=$.maxX<Z.maxX?$.maxX:Z.maxX,q=$.maxY<Z.maxY?$.maxY:Z.maxY;if(J<=K&&Q<=q){const V=this.minX,U=this.minY,H=this.maxX,z=this.maxY;this.minX=J<V?J:V,this.minY=Q<U?Q:U,this.maxX=K>H?K:H,this.maxY=q>z?q:z}}addBoundsMatrix($,Z){this.addFrameMatrix(Z,$.minX,$.minY,$.maxX,$.maxY)}addBoundsArea($,Z){const J=$.minX>Z.x?$.minX:Z.x,Q=$.minY>Z.y?$.minY:Z.y,K=$.maxX<Z.x+Z.width?$.maxX:Z.x+Z.width,q=$.maxY<Z.y+Z.height?$.maxY:Z.y+Z.height;if(J<=K&&Q<=q){const V=this.minX,U=this.minY,H=this.maxX,z=this.maxY;this.minX=J<V?J:V,this.minY=Q<U?Q:U,this.maxX=K>H?K:H,this.maxY=q>z?q:z}}pad($=0,Z=$){if(!this.isEmpty())this.minX-=$,this.maxX+=$,this.minY-=Z,this.maxY+=Z}addFramePad($,Z,J,Q,K,q){$-=K,Z-=q,J+=K,Q+=q,this.minX=this.minX<$?this.minX:$,this.maxX=this.maxX>J?this.maxX:J,this.minY=this.minY<Z?this.minY:Z,this.maxY=this.maxY>Q?this.maxY:Q}}class U0 extends A.EventEmitter{constructor(){super();this.tempDisplayObjectParent=null,this.transform=new q$,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new n7,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin($){const Z=Object.keys($);for(let J=0;J<Z.length;++J){const Q=Z[J];Object.defineProperty(U0.prototype,Q,Object.getOwnPropertyDescriptor($,Q))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){if(this.parent)this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform);else this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds($,Z){if(!$)if(!this.parent)this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null;else this._recursivePostUpdateTransform(),this.updateTransform();if(this._bounds.updateID!==this._boundsID)this.calculateBounds(),this._bounds.updateID=this._boundsID;if(!Z){if(!this._boundsRect)this._boundsRect=new c;Z=this._boundsRect}return this._bounds.getRectangle(Z)}getLocalBounds($){if(!$){if(!this._localBoundsRect)this._localBoundsRect=new c;$=this._localBoundsRect}if(!this._localBounds)this._localBounds=new n7;const Z=this.transform,J=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const Q=this._bounds,K=this._boundsID;this._bounds=this._localBounds;const q=this.getBounds(!1,$);return this.parent=J,this.transform=Z,this._bounds=Q,this._bounds.updateID+=this._boundsID-K,q}toGlobal($,Z,J=!1){if(!J)if(this._recursivePostUpdateTransform(),!this.parent)this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null;else this.displayObjectUpdateTransform();return this.worldTransform.apply($,Z)}toLocal($,Z,J,Q){if(Z)$=Z.toGlobal($,J,Q);if(!Q)if(this._recursivePostUpdateTransform(),!this.parent)this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null;else this.displayObjectUpdateTransform();return this.worldTransform.applyInverse($,J)}setParent($){if(!$||!$.addChild)throw new Error("setParent: Argument must be a Container");return $.addChild(this),$}removeFromParent(){this.parent?.removeChild(this)}setTransform($=0,Z=0,J=1,Q=1,K=0,q=0,V=0,U=0,H=0){return this.position.x=$,this.position.y=Z,this.scale.x=!J?1:J,this.scale.y=!Q?1:Q,this.rotation=K,this.skew.x=q,this.skew.y=V,this.pivot.x=U,this.pivot.y=H,this}destroy($){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){if(this.tempDisplayObjectParent===null)this.tempDisplayObjectParent=new aZ;return this.tempDisplayObjectParent}enableTempParent(){const $=this.parent;return this.parent=this._tempDisplayObjectParent,$}disableTempParent($){this.parent=$}get x(){return this.position.x}set x($){this.transform.position.x=$}get y(){return this.position.y}set y($){this.transform.position.y=$}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position($){this.transform.position.copyFrom($)}get scale(){return this.transform.scale}set scale($){this.transform.scale.copyFrom($)}get pivot(){return this.transform.pivot}set pivot($){this.transform.pivot.copyFrom($)}get skew(){return this.transform.skew}set skew($){this.transform.skew.copyFrom($)}get rotation(){return this.transform.rotation}set rotation($){this.transform.rotation=$}get angle(){return this.transform.rotation*vZ}set angle($){this.transform.rotation=$*SZ}get zIndex(){return this._zIndex}set zIndex($){if(this._zIndex=$,this.parent)this.parent.sortDirty=!0}get worldVisible(){let $=this;do{if(!$.visible)return!1;$=$.parent}while($);return!0}get mask(){return this._mask}set mask($){if(this._mask===$)return;if(this._mask){const Z=this._mask.isMaskData?this._mask.maskObject:this._mask;if(Z){if(Z._maskRefCount--,Z._maskRefCount===0)Z.renderable=!0,Z.isMask=!1}}if(this._mask=$,this._mask){const Z=this._mask.isMaskData?this._mask.maskObject:this._mask;if(Z){if(Z._maskRefCount===0)Z.renderable=!1,Z.isMask=!0;Z._maskRefCount++}}}}class aZ extends U0{constructor(){super(...arguments);this.sortDirty=null}}U0.prototype.displayObjectUpdateTransform=U0.prototype.updateTransform;var bW=function($,Z){if($.zIndex===Z.zIndex)return $._lastSortedIndex-Z._lastSortedIndex;return $.zIndex-Z.zIndex},EW=new Z0,rZ=class extends U0{constructor(){super();this.children=[],this.sortableChildren=rZ.defaultSortableChildren,this.sortDirty=!1}onChildrenChange($){}addChild(...$){if($.length>1)for(let Z=0;Z<$.length;Z++)this.addChild($[Z]);else{const Z=$[0];if(Z.parent)Z.parent.removeChild(Z);Z.parent=this,this.sortDirty=!0,Z.transform._parentID=-1,this.children.push(Z),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",Z,this,this.children.length-1),Z.emit("added",this)}return $[0]}addChildAt($,Z){if(Z<0||Z>this.children.length)throw new Error(`${$}addChildAt: The index ${Z} supplied is out of bounds ${this.children.length}`);if($.parent)$.parent.removeChild($);return $.parent=this,this.sortDirty=!0,$.transform._parentID=-1,this.children.splice(Z,0,$),this._boundsID++,this.onChildrenChange(Z),$.emit("added",this),this.emit("childAdded",$,this,Z),$}swapChildren($,Z){if($===Z)return;const J=this.getChildIndex($),Q=this.getChildIndex(Z);this.children[J]=Z,this.children[Q]=$,this.onChildrenChange(J<Q?J:Q)}getChildIndex($){const Z=this.children.indexOf($);if(Z===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return Z}setChildIndex($,Z){if(Z<0||Z>=this.children.length)throw new Error(`The index ${Z} supplied is out of bounds ${this.children.length}`);const J=this.getChildIndex($);A.removeItems(this.children,J,1),this.children.splice(Z,0,$),this.onChildrenChange(Z)}getChildAt($){if($<0||$>=this.children.length)throw new Error(`getChildAt: Index (${$}) does not exist.`);return this.children[$]}removeChild(...$){if($.length>1)for(let Z=0;Z<$.length;Z++)this.removeChild($[Z]);else{const Z=$[0],J=this.children.indexOf(Z);if(J===-1)return null;Z.parent=null,Z.transform._parentID=-1,A.removeItems(this.children,J,1),this._boundsID++,this.onChildrenChange(J),Z.emit("removed",this),this.emit("childRemoved",Z,this,J)}return $[0]}removeChildAt($){const Z=this.getChildAt($);return Z.parent=null,Z.transform._parentID=-1,A.removeItems(this.children,$,1),this._boundsID++,this.onChildrenChange($),Z.emit("removed",this),this.emit("childRemoved",Z,this,$),Z}removeChildren($=0,Z=this.children.length){const J=$,Q=Z,K=Q-J;let q;if(K>0&&K<=Q){q=this.children.splice(J,K);for(let V=0;V<q.length;++V)if(q[V].parent=null,q[V].transform)q[V].transform._parentID=-1;this._boundsID++,this.onChildrenChange($);for(let V=0;V<q.length;++V)q[V].emit("removed",this),this.emit("childRemoved",q[V],this,V);return q}else if(K===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let $=!1;for(let Z=0,J=this.children.length;Z<J;++Z){const Q=this.children[Z];if(Q._lastSortedIndex=Z,!$&&Q.zIndex!==0)$=!0}if($&&this.children.length>1)this.children.sort(bW);this.sortDirty=!1}updateTransform(){if(this.sortableChildren&&this.sortDirty)this.sortChildren();this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let $=0,Z=this.children.length;$<Z;++$){const J=this.children[$];if(J.visible)J.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let $=0;$<this.children.length;$++){const Z=this.children[$];if(!Z.visible||!Z.renderable)continue;if(Z.calculateBounds(),Z._mask){const J=Z._mask.isMaskData?Z._mask.maskObject:Z._mask;if(J)J.calculateBounds(),this._bounds.addBoundsMask(Z._bounds,J._bounds);else this._bounds.addBounds(Z._bounds)}else if(Z.filterArea)this._bounds.addBoundsArea(Z._bounds,Z.filterArea);else this._bounds.addBounds(Z._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds($,Z=!1){const J=super.getLocalBounds($);if(!Z)for(let Q=0,K=this.children.length;Q<K;++Q){const q=this.children[Q];if(q.visible)q.updateTransform()}return J}_calculateBounds(){}_renderWithCulling($){const Z=$.renderTexture.sourceFrame;if(!(Z.width>0&&Z.height>0))return;let J,Q;if(this.cullArea)J=this.cullArea,Q=this.worldTransform;else if(this._render!==rZ.prototype._render)J=this.getBounds(!0);const K=$.projection.transform;if(K)if(Q)Q=EW.copyFrom(Q),Q.prepend(K);else Q=K;if(J&&Z.intersects(J,Q))this._render($);else if(this.cullArea)return;for(let q=0,V=this.children.length;q<V;++q){const U=this.children[q],H=U.cullable;U.cullable=H||!this.cullArea,U.render($),U.cullable=H}}render($){if(!this.visible||this.worldAlpha<=0||!this.renderable)return;if(this._mask||this.filters?.length)this.renderAdvanced($);else if(this.cullable)this._renderWithCulling($);else{this._render($);for(let Z=0,J=this.children.length;Z<J;++Z)this.children[Z].render($)}}renderAdvanced($){const Z=this.filters,J=this._mask;if(Z){if(!this._enabledFilters)this._enabledFilters=[];this._enabledFilters.length=0;for(let K=0;K<Z.length;K++)if(Z[K].enabled)this._enabledFilters.push(Z[K])}const Q=Z&&this._enabledFilters?.length||J&&(!J.isMaskData||J.enabled&&(J.autoDetect||J.type!==N0.NONE));if(Q)$.batch.flush();if(Z&&this._enabledFilters?.length)$.filter.push(this,this._enabledFilters);if(J)$.mask.push(this,this._mask);if(this.cullable)this._renderWithCulling($);else{this._render($);for(let K=0,q=this.children.length;K<q;++K)this.children[K].render($)}if(Q)$.batch.flush();if(J)$.mask.pop(this);if(Z&&this._enabledFilters?.length)$.filter.pop()}_render($){}destroy($){super.destroy(),this.sortDirty=!1;const Z=typeof $==="boolean"?$:$?.children,J=this.removeChildren(0,this.children.length);if(Z)for(let Q=0;Q<J.length;++Q)J[Q].destroy($)}get width(){return this.scale.x*this.getLocalBounds().width}set width($){const Z=this.getLocalBounds().width;if(Z!==0)this.scale.x=$/Z;else this.scale.x=1;this._width=$}get height(){return this.scale.y*this.getLocalBounds().height}set height($){const Z=this.getLocalBounds().height;if(Z!==0)this.scale.y=$/Z;else this.scale.y=1;this._height=$}},i=rZ;i.defaultSortableChildren=!1;i.prototype.containerUpdateTransform=i.prototype.updateTransform;Object.defineProperties(I,{SORTABLE_CHILDREN:{get(){return i.defaultSortableChildren},set($){A.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),i.defaultSortableChildren=$}}});var U9=function($,Z){if($){if(typeof $=="function")return $;if(typeof $=="string")return iK[$]}else return iK[Z]},vW=Object.defineProperty,SW=($,Z,J)=>(Z in $)?vW($,Z,{enumerable:!0,configurable:!0,writable:!0,value:J}):$[Z]=J,R=($,Z,J)=>(SW($,typeof Z!="symbol"?Z+"":Z,J),J);class V7{constructor($){R(this,"parent"),R(this,"paused"),this.parent=$,this.paused=!1}destroy(){}down($){return!1}move($){return!1}up($){return!1}wheel($){return!1}update($){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var TW=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},aK={exports:{}};(function($,Z){(function(){var J,Q;Q=function(K){return $.exports=K},J={linear:function(K,q,V,U){return V*K/U+q},easeInQuad:function(K,q,V,U){return V*(K/=U)*K+q},easeOutQuad:function(K,q,V,U){return-V*(K/=U)*(K-2)+q},easeInOutQuad:function(K,q,V,U){return(K/=U/2)<1?V/2*K*K+q:-V/2*(--K*(K-2)-1)+q},easeInCubic:function(K,q,V,U){return V*(K/=U)*K*K+q},easeOutCubic:function(K,q,V,U){return V*((K=K/U-1)*K*K+1)+q},easeInOutCubic:function(K,q,V,U){return(K/=U/2)<1?V/2*K*K*K+q:V/2*((K-=2)*K*K+2)+q},easeInQuart:function(K,q,V,U){return V*(K/=U)*K*K*K+q},easeOutQuart:function(K,q,V,U){return-V*((K=K/U-1)*K*K*K-1)+q},easeInOutQuart:function(K,q,V,U){return(K/=U/2)<1?V/2*K*K*K*K+q:-V/2*((K-=2)*K*K*K-2)+q},easeInQuint:function(K,q,V,U){return V*(K/=U)*K*K*K*K+q},easeOutQuint:function(K,q,V,U){return V*((K=K/U-1)*K*K*K*K+1)+q},easeInOutQuint:function(K,q,V,U){return(K/=U/2)<1?V/2*K*K*K*K*K+q:V/2*((K-=2)*K*K*K*K+2)+q},easeInSine:function(K,q,V,U){return-V*Math.cos(K/U*(Math.PI/2))+V+q},easeOutSine:function(K,q,V,U){return V*Math.sin(K/U*(Math.PI/2))+q},easeInOutSine:function(K,q,V,U){return-V/2*(Math.cos(Math.PI*K/U)-1)+q},easeInExpo:function(K,q,V,U){return K===0?q:V*Math.pow(2,10*(K/U-1))+q},easeOutExpo:function(K,q,V,U){return K===U?q+V:V*(-Math.pow(2,-10*K/U)+1)+q},easeInOutExpo:function(K,q,V,U){return(K/=U/2)<1?V/2*Math.pow(2,10*(K-1))+q:V/2*(-Math.pow(2,-10*--K)+2)+q},easeInCirc:function(K,q,V,U){return-V*(Math.sqrt(1-(K/=U)*K)-1)+q},easeOutCirc:function(K,q,V,U){return V*Math.sqrt(1-(K=K/U-1)*K)+q},easeInOutCirc:function(K,q,V,U){return(K/=U/2)<1?-V/2*(Math.sqrt(1-K*K)-1)+q:V/2*(Math.sqrt(1-(K-=2)*K)+1)+q},easeInElastic:function(K,q,V,U){var H,z,W;return W=1.70158,z=0,H=V,K===0||(K/=U),z||(z=U*0.3),H<Math.abs(V)?(H=V,W=z/4):W=z/(2*Math.PI)*Math.asin(V/H),-(H*Math.pow(2,10*(K-=1))*Math.sin((K*U-W)*(2*Math.PI)/z))+q},easeOutElastic:function(K,q,V,U){var H,z,W;return W=1.70158,z=0,H=V,K===0||(K/=U),z||(z=U*0.3),H<Math.abs(V)?(H=V,W=z/4):W=z/(2*Math.PI)*Math.asin(V/H),H*Math.pow(2,-10*K)*Math.sin((K*U-W)*(2*Math.PI)/z)+V+q},easeInOutElastic:function(K,q,V,U){var H,z,W;return W=1.70158,z=0,H=V,K===0||(K/=U/2),z||(z=U*0.44999999999999996),H<Math.abs(V)?(H=V,W=z/4):W=z/(2*Math.PI)*Math.asin(V/H),K<1?-0.5*(H*Math.pow(2,10*(K-=1))*Math.sin((K*U-W)*(2*Math.PI)/z))+q:H*Math.pow(2,-10*(K-=1))*Math.sin((K*U-W)*(2*Math.PI)/z)*0.5+V+q},easeInBack:function(K,q,V,U,H){return H===void 0&&(H=1.70158),V*(K/=U)*K*((H+1)*K-H)+q},easeOutBack:function(K,q,V,U,H){return H===void 0&&(H=1.70158),V*((K=K/U-1)*K*((H+1)*K+H)+1)+q},easeInOutBack:function(K,q,V,U,H){return H===void 0&&(H=1.70158),(K/=U/2)<1?V/2*(K*K*(((H*=1.525)+1)*K-H))+q:V/2*((K-=2)*K*(((H*=1.525)+1)*K+H)+2)+q},easeInBounce:function(K,q,V,U){var H;return H=J.easeOutBounce(U-K,0,V,U),V-H+q},easeOutBounce:function(K,q,V,U){return(K/=U)<0.36363636363636365?V*(7.5625*K*K)+q:K<0.7272727272727273?V*(7.5625*(K-=0.5454545454545454)*K+0.75)+q:K<0.9090909090909091?V*(7.5625*(K-=0.8181818181818182)*K+0.9375)+q:V*(7.5625*(K-=0.9545454545454546)*K+0.984375)+q},easeInOutBounce:function(K,q,V,U){var H;return K<U/2?(H=J.easeInBounce(K*2,0,V,U),H*0.5+q):(H=J.easeOutBounce(K*2-U,0,V,U),H*0.5+V*0.5+q)}},Q(J)}).call(TW)})(aK);var iK=aK.exports,hW={removeOnInterrupt:!1,ease:"linear",time:1000};class rK extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"startX"),R(this,"startY"),R(this,"deltaX"),R(this,"deltaY"),R(this,"keepCenter"),R(this,"startWidth",null),R(this,"startHeight",null),R(this,"deltaWidth",null),R(this,"deltaHeight",null),R(this,"width",null),R(this,"height",null),R(this,"time",0),this.options=Object.assign({},hW,Z),this.options.ease=U9(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update($){if(this.paused)return;this.time+=$;const Z=new g(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const J=this.parent.width,Q=this.parent.height;this.complete(),(J!==this.parent.width||Q!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:Z,type:"animate"})}else{const J=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const Q=this.startWidth,K=this.deltaWidth;this.parent.fitWidth(Q+K*J,this.keepCenter,this.height===null)}if(this.height!==null){const Q=this.startHeight,K=this.deltaHeight;this.parent.fitHeight(Q+K*J,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const Q=this.startX,K=this.startY,q=this.deltaX,V=this.deltaY,U=new g(this.parent.x,this.parent.y);this.parent.moveCenter(Q+q*J,K+V*J),this.parent.emit("moved",{viewport:this.parent,original:U,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:Z,type:"animate"})}}}var yW={sides:"all",friction:0.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class tK extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"left"),R(this,"top"),R(this,"right"),R(this,"bottom"),R(this,"underflowX"),R(this,"underflowY"),R(this,"ease"),R(this,"toX"),R(this,"toY"),this.options=Object.assign({},yW,Z),this.ease=U9(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const J=this.options.underflow.toLowerCase();J==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=J.indexOf("left")!==-1?-1:J.indexOf("right")!==-1?1:0,this.underflowY=J.indexOf("top")!==-1?-1:J.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update($){if(!this.paused){if(this.bounce(),this.toX){const Z=this.toX;Z.time+=$,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),Z.time>=this.options.time?(this.parent.x=Z.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(Z.time,Z.start,Z.delta,this.options.time)}if(this.toY){const Z=this.toY;Z.time+=$,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),Z.time>=this.options.time?(this.parent.y=Z.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(Z.time,Z.start,Z.delta,this.options.time)}}}calcUnderflowX(){let $;switch(this.underflowX){case-1:$=0;break;case 1:$=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:$=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return $}calcUnderflowY(){let $;switch(this.underflowY){case-1:$=0;break;case 1:$=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:$=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return $}oob(){const $=this.options.bounceBox;if($){const Z=typeof $.x>"u"?0:$.x,J=typeof $.y>"u"?0:$.y,Q=typeof $.width>"u"?this.parent.worldWidth:$.width,K=typeof $.height>"u"?this.parent.worldHeight:$.height;return{left:this.parent.left<Z,right:this.parent.right>Q,top:this.parent.top<J,bottom:this.parent.bottom>K,topLeft:new g(Z*this.parent.scale.x,J*this.parent.scale.y),bottomRight:new g(Q*this.parent.scale.x-this.parent.screenWidth,K*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new g(0,0),bottomRight:new g(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var $,Z;if(this.paused)return;let J,Q=this.parent.plugins.get("decelerate",!0);Q&&(Q.x||Q.y)&&(Q.x&&Q.percentChangeX===(($=Q.options)==null?void 0:$.friction)||Q.y&&Q.percentChangeY===((Z=Q.options)==null?void 0:Z.friction))&&(J=this.oob(),(J.left&&this.left||J.right&&this.right)&&(Q.percentChangeX=this.options.friction),(J.top&&this.top||J.bottom&&this.bottom)&&(Q.percentChangeY=this.options.friction));const K=this.parent.plugins.get("drag",!0)||{},q=this.parent.plugins.get("pinch",!0)||{};if(Q=Q||{},!(K!=null&&K.active)&&!(q!=null&&q.active)&&(!this.toX||!this.toY)&&(!Q.x||!Q.y)){J=J||this.oob();const{topLeft:V,bottomRight:U}=J;if(!this.toX&&!Q.x){let H=null;J.left&&this.left?H=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-V.x:J.right&&this.right&&(H=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-U.x),H!==null&&this.parent.x!==H&&(this.toX={time:0,start:this.parent.x,delta:H-this.parent.x,end:H},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!Q.y){let H=null;J.top&&this.top?H=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-V.y:J.bottom&&this.bottom&&(H=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-U.y),H!==null&&this.parent.y!==H&&(this.toY={time:0,start:this.parent.y,delta:H-this.parent.y,end:H},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}var fW={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class eK extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"last"),R(this,"noUnderflow"),R(this,"underflowX"),R(this,"underflowY"),this.options=Object.assign({},fW,Z),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const $=this.options.underflow.toLowerCase();$==="none"?this.noUnderflow=!0:$==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=$.indexOf("left")!==-1?-1:$.indexOf("right")!==-1?1:0,this.underflowY=$.indexOf("top")!==-1?-1:$.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const $=new g(this.parent.x,this.parent.y),Z=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let J=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,J=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,J=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,J=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,Z.x=0,J=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,Z.x=0,J=!0);J&&this.parent.emit("moved",{viewport:this.parent,original:$,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let J=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,J=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,J=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,J=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,Z.y=0,J=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,Z.y=0,J=!0);J&&this.parent.emit("moved",{viewport:this.parent,original:$,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}var gW={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class $q extends V7{constructor($,Z={}){super($);R(this,"options"),this.options=Object.assign({},gW,Z),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let $=this.parent.worldScreenWidth,Z=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&$<this.options.minWidth){const J=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/J,$=this.parent.worldScreenWidth,Z=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&$>this.options.maxWidth){const J=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/J,$=this.parent.worldScreenWidth,Z=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&Z<this.options.minHeight){const J=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/J,$=this.parent.worldScreenWidth,Z=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&Z>this.options.maxHeight){const J=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/J,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const $={x:null,y:null},Z={x:null,y:null};if(typeof this.options.minScale=="number")$.x=this.options.minScale,$.y=this.options.minScale;else if(this.options.minScale!==null){const K=this.options.minScale;$.x=typeof K.x>"u"?null:K.x,$.y=typeof K.y>"u"?null:K.y}if(typeof this.options.maxScale=="number")Z.x=this.options.maxScale,Z.y=this.options.maxScale;else if(this.options.maxScale!==null){const K=this.options.maxScale;Z.x=typeof K.x>"u"?null:K.x,Z.y=typeof K.y>"u"?null:K.y}let J=this.parent.scale.x,Q=this.parent.scale.y;$.x!==null&&J<$.x&&(J=$.x),Z.x!==null&&J>Z.x&&(J=Z.x),$.y!==null&&Q<$.y&&(Q=$.y),Z.y!==null&&Q>Z.y&&(Q=Z.y),(J!==this.parent.scale.x||Q!==this.parent.scale.y)&&(this.parent.scale.set(J,Q),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}var xW={friction:0.98,bounce:0.8,minSpeed:0.01},Y$=16;class Zq extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"x"),R(this,"y"),R(this,"percentChangeX"),R(this,"percentChangeY"),R(this,"saved"),R(this,"timeSinceRelease"),this.options=Object.assign({},xW,Z),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",(J)=>this.handleMoved(J))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const $=this.parent.input.count();return($===1||$>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved($){if(this.saved.length){const Z=this.saved[this.saved.length-1];$.type==="clamp-x"&&$.original?Z.x===$.original.x&&(Z.x=this.parent.x):$.type==="clamp-y"&&$.original&&Z.y===$.original.y&&(Z.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const $=performance.now();for(let Z of this.saved)if(Z.time>=$-100){const J=$-Z.time;this.x=(this.parent.x-Z.x)/J,this.y=(this.parent.y-Z.y)/J,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate($){$=$||{},typeof $.x<"u"&&(this.x=$.x,this.percentChangeX=this.options.friction),typeof $.y<"u"&&(this.y=$.y,this.percentChangeY=this.options.friction)}update($){if(this.paused)return;const Z=this.x||this.y,J=this.timeSinceRelease,Q=this.timeSinceRelease+$;if(this.x){const K=this.percentChangeX,q=Math.log(K);this.parent.x+=this.x*Y$/q*(Math.pow(K,Q/Y$)-Math.pow(K,J/Y$)),this.x*=Math.pow(this.percentChangeX,$/Y$)}if(this.y){const K=this.percentChangeY,q=Math.log(K);this.parent.y+=this.y*Y$/q*(Math.pow(K,Q/Y$)-Math.pow(K,J/Y$)),this.y*=Math.pow(this.percentChangeY,$/Y$)}this.timeSinceRelease+=$,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),Z&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}var mW={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class Jq extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"moved"),R(this,"reverse"),R(this,"xDirection"),R(this,"yDirection"),R(this,"keyIsPressed"),R(this,"mouse"),R(this,"underflowX"),R(this,"underflowY"),R(this,"last"),R(this,"current"),R(this,"windowEventHandlers",[]),this.options=Object.assign({},mW,Z),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses($){const Z=(Q)=>{$.includes(Q.code)&&(this.keyIsPressed=!0)},J=(Q)=>{$.includes(Q.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",J),this.addWindowEventHandler("keydown",Z)}addWindowEventHandler($,Z){window.addEventListener($,Z),this.windowEventHandlers.push({event:$,handler:Z})}destroy(){this.windowEventHandlers.forEach(({event:$,handler:Z})=>{window.removeEventListener($,Z)})}mouseButtons($){!$||$==="all"?this.mouse=[!0,!0,!0]:this.mouse=[$.indexOf("left")!==-1,$.indexOf("middle")!==-1,$.indexOf("right")!==-1]}parseUnderflow(){const $=this.options.underflow.toLowerCase();$==="center"?(this.underflowX=0,this.underflowY=0):($.includes("left")?this.underflowX=-1:$.includes("right")?this.underflowX=1:this.underflowX=0,$.includes("top")?this.underflowY=-1:$.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons($){const Z=$.pointerType==="mouse",J=this.parent.input.count();return!!((J===1||J>1&&!this.parent.plugins.get("pinch",!0))&&(!Z||this.mouse[$.button]))}checkKeyPress($){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&$.data.pointerType==="touch"}down($){return this.paused||!this.options.pressDrag?!1:this.checkButtons($)&&this.checkKeyPress($)?(this.last={x:$.global.x,y:$.global.y},this.current=$.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move($){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===$.data.pointerId){const Z=$.global.x,J=$.global.y,Q=this.parent.input.count();if(Q===1||Q>1&&!this.parent.plugins.get("pinch",!0)){const K=Z-this.last.x,q=J-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(K)||this.yDirection&&this.parent.input.checkThreshold(q)){const V={x:Z,y:J};return this.xDirection&&(this.parent.x+=(V.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(V.y-this.last.y)*this.options.factor),this.last=V,this.moved||this.parent.emit("drag-start",{event:$,screen:new g(this.last.x,this.last.y),world:this.parent.toWorld(new g(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up($){if(this.paused)return!1;const Z=this.parent.input.touches;if(Z.length===1){const J=Z[0];return J.last&&(this.last={x:J.last.x,y:J.last.y},this.current=J.id),this.moved=!1,!0}else if(this.last&&this.moved){const J=new g(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:$,screen:J,world:this.parent.toWorld(J),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel($){if(this.paused)return!1;if(this.options.wheel){const Z=this.parent.plugins.get("wheel",!0);if(!Z||!Z.options.wheelZoom&&!$.ctrlKey){const J=$.deltaMode?this.options.lineHeight:1,Q=[$.deltaX,$.deltaY],[K,q]=this.options.wheelSwapAxes?Q.reverse():Q;return this.xDirection&&(this.parent.x+=K*J*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=q*J*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||$.preventDefault(),this.parent.options.stopPropagation&&$.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const $=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,$.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,$.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,$.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,$.y=0)}}var cW={speed:0,acceleration:null,radius:null};class Qq extends V7{constructor($,Z,J={}){super($);R(this,"options"),R(this,"target"),R(this,"velocity"),this.target=Z,this.options=Object.assign({},cW,J),this.velocity={x:0,y:0}}update($){if(this.paused)return;const Z=this.parent.center;let J=this.target.x,Q=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-Z.y,2)+Math.pow(this.target.x-Z.x,2))>this.options.radius){const V=Math.atan2(this.target.y-Z.y,this.target.x-Z.x);J=this.target.x-Math.cos(V)*this.options.radius,Q=this.target.y-Math.sin(V)*this.options.radius}else return;const K=J-Z.x,q=Q-Z.y;if(K||q)if(this.options.speed)if(this.options.acceleration){const V=Math.atan2(Q-Z.y,J-Z.x),U=Math.sqrt(Math.pow(K,2)+Math.pow(q,2));if(U){const H=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);U>H?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*$,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*$,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const z=Math.cos(V)*this.velocity.x,W=Math.sin(V)*this.velocity.y,Y=Math.abs(z)>Math.abs(K)?J:Z.x+z,w=Math.abs(W)>Math.abs(q)?Q:Z.y+W;this.parent.moveCenter(Y,w),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const V=Math.atan2(Q-Z.y,J-Z.x),U=Math.cos(V)*this.options.speed,H=Math.sin(V)*this.options.speed,z=Math.abs(U)>Math.abs(K)?J:Z.x+U,W=Math.abs(H)>Math.abs(q)?Q:Z.y+H;this.parent.moveCenter(z,W),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(J,Q),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}var pW={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class Kq extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"reverse"),R(this,"radiusSquared"),R(this,"left"),R(this,"top"),R(this,"right"),R(this,"bottom"),R(this,"horizontal"),R(this,"vertical"),this.options=Object.assign({},pW,Z),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const $=this.options.distance;$!==null?(this.left=$,this.top=$,this.right=this.parent.screenWidth-$,this.bottom=this.parent.screenHeight-$):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move($){if(this.paused||$.pointerType!=="mouse"&&$.pointerId!==1||!this.options.allowButtons&&$.buttons!==0)return!1;const Z=$.global.x,J=$.global.y;if(this.radiusSquared){const Q=this.parent.toScreen(this.parent.center);if(Math.pow(Q.x-Z,2)+Math.pow(Q.y-J,2)>=this.radiusSquared){const K=Math.atan2(Q.y-J,Q.x-Z);this.options.linear?(this.horizontal=Math.round(Math.cos(K))*this.options.speed*this.reverse*0.06,this.vertical=Math.round(Math.sin(K))*this.options.speed*this.reverse*0.06):(this.horizontal=Math.cos(K)*this.options.speed*this.reverse*0.06,this.vertical=Math.sin(K)*this.options.speed*this.reverse*0.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&Z<this.left?this.horizontal=Number(this.reverse)*this.options.speed*0.06:this.right!==null&&Z>this.right?this.horizontal=-1*this.reverse*this.options.speed*0.06:(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&J<this.top?this.vertical=Number(this.reverse)*this.options.speed*0.06:this.bottom!==null&&J>this.bottom?this.vertical=-1*this.reverse*this.options.speed*0.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const $=this.parent.plugins.get("decelerate",!0);this.horizontal&&$&&!this.options.noDecelerate&&$.activate({x:this.horizontal*this.options.speed*this.reverse/16.666666666666668})}decelerateVertical(){const $=this.parent.plugins.get("decelerate",!0);this.vertical&&$&&!this.options.noDecelerate&&$.activate({y:this.vertical*this.options.speed*this.reverse/16.666666666666668})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const $=this.parent.center;this.horizontal&&($.x+=this.horizontal*this.options.speed),this.vertical&&($.y+=this.vertical*this.options.speed),this.parent.moveCenter($),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}var uW={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class qq extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"active",!1),R(this,"pinching",!1),R(this,"moved",!1),R(this,"lastCenter"),this.options=Object.assign({},uW,Z)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move($){if(this.paused||!this.active)return!1;const Z=$.global.x,J=$.global.y,Q=this.parent.input.touches;if(Q.length>=2){const K=Q[0],q=Q[1],V=K.last&&q.last?Math.sqrt(Math.pow(q.last.x-K.last.x,2)+Math.pow(q.last.y-K.last.y,2)):null;if(K.id===$.pointerId?K.last={x:Z,y:J,data:$}:q.id===$.pointerId&&(q.last={x:Z,y:J,data:$}),V){let U;const H=new g(K.last.x+(q.last.x-K.last.x)/2,K.last.y+(q.last.y-K.last.y)/2);this.options.center||(U=this.parent.toLocal(H));let z=Math.sqrt(Math.pow(q.last.x-K.last.x,2)+Math.pow(q.last.y-K.last.y,2));z=z===0?z=0.0000000001:z;const W=(1-V/z)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=W),this.isAxisY()&&(this.parent.scale.y+=W),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:H});const Y=this.parent.plugins.get("clamp-zoom",!0);if(Y&&Y.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const w=this.parent.toGlobal(U);this.parent.x+=(H.x-w.x)*this.options.factor,this.parent.y+=(H.y-w.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(H.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(H.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=H,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}}var dW={topLeft:!1,friction:0.8,time:1000,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class Vq extends V7{constructor($,Z,J,Q={}){super($);R(this,"options"),R(this,"ease"),R(this,"x"),R(this,"y"),R(this,"percent"),R(this,"snapping"),R(this,"deltaX"),R(this,"deltaY"),R(this,"startX"),R(this,"startY"),this.options=Object.assign({},dW,Q),this.ease=U9(Q.ease,"easeInOutSine"),this.x=Z,this.y=J,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const $=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-$.x,this.deltaY=this.y-$.y,this.startX=$.x,this.startY=$.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const $=this.parent.plugins.get("decelerate",!0);$&&($.x||$.y)&&($.percentChangeX=$.percentChangeY=this.options.friction)}return!1}update($){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const Z=this.snapping;Z.time+=$;let J,Q,K;const q=this.startX,V=this.startY,U=this.deltaX,H=this.deltaY;if(Z.time>this.options.time)J=!0,Q=q+U,K=V+H;else{const z=this.ease(Z.time,0,1,this.options.time);Q=q+U*z,K=V+H*z}this.options.topLeft?this.parent.moveCorner(Q,K):this.parent.moveCenter(Q,K),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),J&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const Z=this.options.topLeft?this.parent.corner:this.parent.center;(Z.x!==this.x||Z.y!==this.y)&&this.snapStart()}}}var lW={width:0,height:0,time:1000,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class Uq extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"ease"),R(this,"xScale"),R(this,"yScale"),R(this,"xIndependent"),R(this,"yIndependent"),R(this,"snapping"),this.options=Object.assign({},lW,Z),this.ease=U9(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=$.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=$.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?($.container.scale.x=this.xScale,$.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):Z.forceStart&&this.createSnapping()}createSnapping(){const $=this.parent.worldScreenWidth,Z=this.parent.worldScreenHeight,J=this.parent.screenWidth/this.xScale,Q=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:$,startY:Z,deltaX:J-$,deltaY:Q-Z},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update($){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let Z;if(!this.options.center&&!this.options.noMove&&(Z=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const J=this.snapping;if(J.time+=$,J.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const K=this.snapping,q=this.ease(K.time,K.startX,K.deltaX,this.options.time),V=this.ease(K.time,K.startY,K.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/q,this.parent.scale.y=this.parent.screenHeight/V}const Q=this.parent.plugins.get("clamp-zoom",!0);Q&&Q.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(Z))}}resume(){this.snapping=null,super.resume()}}var nW={percent:0.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class Hq extends V7{constructor($,Z={}){super($);R(this,"options"),R(this,"smoothing"),R(this,"smoothingCenter"),R(this,"smoothingCount"),R(this,"keyIsPressed"),this.options=Object.assign({},nW,Z),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses($){window.addEventListener("keydown",(Z)=>{$.includes(Z.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",(Z)=>{$.includes(Z.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const $=this.smoothingCenter,Z=this.smoothing;let J;this.options.center||(J=this.parent.toLocal($)),this.isAxisX()&&(this.parent.scale.x+=Z.x),this.isAxisY()&&(this.parent.scale.y+=Z.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const Q=this.parent.plugins.get("clamp-zoom",!0);if(Q&&Q.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const K=this.parent.toGlobal(J);this.parent.x+=$.x-K.x,this.parent.y+=$.y-K.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch($){if(this.paused)return;const Z=this.parent.input.getPointerPosition($),J=-$.deltaY*($.deltaMode?this.options.lineHeight:1)/200,Q=Math.pow(2,(1+this.options.percent)*J);let K;this.options.center||(K=this.parent.toLocal(Z)),this.isAxisX()&&(this.parent.scale.x*=Q),this.isAxisY()&&(this.parent.scale.y*=Q),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const q=this.parent.plugins.get("clamp-zoom",!0);if(q&&q.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const V=this.parent.toGlobal(K);this.parent.x+=Z.x-V.x,this.parent.y+=Z.y-V.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:$,viewport:this.parent})}wheel($){if(this.paused||!this.checkKeyPress())return!1;if($.ctrlKey&&this.options.trackpadPinch)this.pinch($);else if(this.options.wheelZoom){const Z=this.parent.input.getPointerPosition($),J=(this.options.reverse?-1:1)*-$.deltaY*($.deltaMode?this.options.lineHeight:1)/500,Q=Math.pow(2,(1+this.options.percent)*J);if(this.options.smooth){const K={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+K.x)*Q-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+K.y)*Q-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=Z}else{let K;this.options.center||(K=this.parent.toLocal(Z)),this.isAxisX()&&(this.parent.scale.x*=Q),this.isAxisY()&&(this.parent.scale.y*=Q),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const q=this.parent.plugins.get("clamp-zoom",!0);if(q&&q.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const V=this.parent.toGlobal(K);this.parent.x+=Z.x-V.x,this.parent.y+=Z.y-V.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:$,viewport:this.parent})}return!this.parent.options.passiveWheel}}class zq{constructor($){R(this,"viewport"),R(this,"clickedAvailable"),R(this,"isMouseDown"),R(this,"last"),R(this,"wheelFunction"),R(this,"touches"),this.viewport=$,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new c(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=($)=>this.handleWheel($),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down($){if(this.viewport.pause||!this.viewport.worldVisible)return;if($.pointerType==="mouse"?this.isMouseDown=!0:this.get($.pointerId)||this.touches.push({id:$.pointerId,last:null}),this.count()===1){this.last=$.global.clone();const Z=this.viewport.plugins.get("decelerate",!0),J=this.viewport.plugins.get("bounce",!0);(!Z||!Z.isActive())&&(!J||!J.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down($)&&this.viewport.options.stopPropagation&&$.stopPropagation()}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold($){return Math.abs($)>=this.viewport.threshold}move($){if(this.viewport.pause||!this.viewport.worldVisible)return;const Z=this.viewport.plugins.move($);if(this.clickedAvailable&&this.last){const J=$.global.x-this.last.x,Q=$.global.y-this.last.y;(this.checkThreshold(J)||this.checkThreshold(Q))&&(this.clickedAvailable=!1)}Z&&this.viewport.options.stopPropagation&&$.stopPropagation()}up($){if(this.viewport.pause||!this.viewport.worldVisible)return;$.pointerType==="mouse"&&(this.isMouseDown=!1),$.pointerType!=="mouse"&&this.remove($.pointerId);const Z=this.viewport.plugins.up($);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:$,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),Z&&this.viewport.options.stopPropagation&&$.stopPropagation()}getPointerPosition($){const Z=new g;return this.viewport.options.events.mapPositionToPoint(Z,$.clientX,$.clientY),Z}handleWheel($){if(this.viewport.pause||!this.viewport.worldVisible)return;const Z=this.viewport.toLocal(this.getPointerPosition($));this.viewport.left<=Z.x&&Z.x<=this.viewport.right&&this.viewport.top<=Z.y&&Z.y<=this.viewport.bottom&&this.viewport.plugins.wheel($)&&!this.viewport.options.passiveWheel&&$.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get($){for(let Z of this.touches)if(Z.id===$)return Z;return null}remove($){for(let Z=0;Z<this.touches.length;Z++)if(this.touches[Z].id===$){this.touches.splice(Z,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}var h8=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class Wq{constructor($){R(this,"plugins"),R(this,"list"),R(this,"viewport"),this.viewport=$,this.list=[],this.plugins={}}add($,Z,J=h8.length){const Q=this.plugins[$];Q&&Q.destroy(),this.plugins[$]=Z;const K=h8.indexOf($);K!==-1&&h8.splice(K,1),h8.splice(J,0,$),this.sort()}get($,Z){var J;return Z&&(J=this.plugins[$])!=null&&J.paused?null:this.plugins[$]}update($){for(let Z of this.list)Z.update($)}resize(){for(let $ of this.list)$.resize()}reset(){for(let $ of this.list)$.reset()}removeAll(){this.list.forEach(($)=>{$.destroy()}),this.plugins={},this.sort()}remove($){var Z;this.plugins[$]&&((Z=this.plugins[$])==null||Z.destroy(),delete this.plugins[$],this.viewport.emit("plugin-remove",$),this.sort())}pause($){var Z;(Z=this.plugins[$])==null||Z.pause()}resume($){var Z;(Z=this.plugins[$])==null||Z.resume()}sort(){this.list=[];for(let $ of h8)this.plugins[$]&&this.list.push(this.plugins[$])}down($){let Z=!1;for(let J of this.list)J.down($)&&(Z=!0);return Z}move($){let Z=!1;for(let J of this.viewport.plugins.list)J.move($)&&(Z=!0);return Z}up($){let Z=!1;for(let J of this.list)J.up($)&&(Z=!0);return Z}wheel($){let Z=!1;for(let J of this.list)J.wheel($)&&(Z=!0);return Z}}var oW={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:Y0.shared,allowPreserveDragOutside:!1};class tZ extends i{constructor($){super();R(this,"moving"),R(this,"screenWidth"),R(this,"screenHeight"),R(this,"threshold"),R(this,"input"),R(this,"plugins"),R(this,"zooming"),R(this,"lastViewport"),R(this,"options"),R(this,"_dirty"),R(this,"_forceHitArea"),R(this,"_hitAreaDefault"),R(this,"_pause"),R(this,"tickerFunction"),R(this,"_worldWidth"),R(this,"_worldHeight"),R(this,"_disableOnContextMenu",(Z)=>Z.preventDefault()),this.options={...oW,...$},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new zq(this),this.plugins=new Wq(this)}destroy($){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy($)}update($){this.pause||(this.plugins.update($),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new c(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize($=window.innerWidth,Z=window.innerHeight,J,Q){this.screenWidth=$,this.screenHeight=Z,typeof J<"u"&&(this._worldWidth=J),typeof Q<"u"&&(this._worldHeight=Q),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth($){this._worldWidth=$,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight($){this._worldHeight=$,this.plugins.resize()}getVisibleBounds(){return new c(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld($,Z){return arguments.length===2?this.toLocal(new g($,Z)):this.toLocal($)}toScreen($,Z){return arguments.length===2?this.toGlobal(new g($,Z)):this.toGlobal($)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new g(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center($){this.moveCenter($)}moveCenter(...$){let Z,J;typeof $[0]=="number"?(Z=$[0],J=$[1]):(Z=$[0].x,J=$[0].y);const Q=(this.worldScreenWidth/2-Z)*this.scale.x,K=(this.worldScreenHeight/2-J)*this.scale.y;return(this.x!==Q||this.y!==K)&&(this.position.set(Q,K),this.plugins.reset(),this.dirty=!0),this}get corner(){return new g(-this.x/this.scale.x,-this.y/this.scale.y)}set corner($){this.moveCorner($)}moveCorner(...$){let Z,J;return $.length===1?(Z=-$[0].x*this.scale.x,J=-$[0].y*this.scale.y):(Z=-$[0]*this.scale.x,J=-$[1]*this.scale.y),(Z!==this.x||J!==this.y)&&(this.position.set(Z,J),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth($){return this.screenWidth/$}findFitHeight($){return this.screenHeight/$}findFit($,Z){const J=this.screenWidth/$,Q=this.screenHeight/Z;return Math.min(J,Q)}findCover($,Z){const J=this.screenWidth/$,Q=this.screenHeight/Z;return Math.max(J,Q)}fitWidth($=this.worldWidth,Z,J=!0,Q){let K;Z&&(K=this.center),this.scale.x=this.screenWidth/$,J&&(this.scale.y=this.scale.x);const q=this.plugins.get("clamp-zoom",!0);return!Q&&q&&q.clamp(),Z&&K&&this.moveCenter(K),this}fitHeight($=this.worldHeight,Z,J=!0,Q){let K;Z&&(K=this.center),this.scale.y=this.screenHeight/$,J&&(this.scale.x=this.scale.y);const q=this.plugins.get("clamp-zoom",!0);return!Q&&q&&q.clamp(),Z&&K&&this.moveCenter(K),this}fitWorld($){let Z;$&&(Z=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const J=this.plugins.get("clamp-zoom",!0);return J&&J.clamp(),$&&Z&&this.moveCenter(Z),this}fit($,Z=this.worldWidth,J=this.worldHeight){let Q;$&&(Q=this.center),this.scale.x=this.screenWidth/Z,this.scale.y=this.screenHeight/J,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const K=this.plugins.get("clamp-zoom",!0);return K&&K.clamp(),$&&Q&&this.moveCenter(Q),this}setZoom($,Z){let J;Z&&(J=this.center),this.scale.set($);const Q=this.plugins.get("clamp-zoom",!0);return Q&&Q.clamp(),Z&&J&&this.moveCenter(J),this}zoomPercent($,Z){return this.setZoom(this.scale.x+this.scale.x*$,Z)}zoom($,Z){return this.fitWidth($+this.worldScreenWidth,Z),this}get scaled(){return this.scale.x}set scaled($){this.setZoom($,!0)}snapZoom($){return this.plugins.add("snap-zoom",new Uq(this,$)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new g(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right($){this.x=-$*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left($){this.x=-$*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top($){this.y=-$*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom($){this.y=-$*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty($){this._dirty=$}get forceHitArea(){return this._forceHitArea}set forceHitArea($){$?(this._forceHitArea=$,this.hitArea=$):(this._forceHitArea=null,this.hitArea=new c(0,0,this.worldWidth,this.worldHeight))}drag($){return this.plugins.add("drag",new Jq(this,$)),this}clamp($){return this.plugins.add("clamp",new eK(this,$)),this}decelerate($){return this.plugins.add("decelerate",new Zq(this,$)),this}bounce($){return this.plugins.add("bounce",new tK(this,$)),this}pinch($){return this.plugins.add("pinch",new qq(this,$)),this}snap($,Z,J){return this.plugins.add("snap",new Vq(this,$,Z,J)),this}follow($,Z){return this.plugins.add("follow",new Qq(this,$,Z)),this}wheel($){return this.plugins.add("wheel",new Hq(this,$)),this}animate($){return this.plugins.add("animate",new rK(this,$)),this}clampZoom($){return this.plugins.add("clamp-zoom",new $q(this,$)),this}mouseEdges($){return this.plugins.add("mouse-edges",new Kq(this,$)),this}get pause(){return!!this._pause}set pause($){this._pause=$,this.lastViewport=null,this.moving=!1,this.zooming=!1,$&&this.input.pause()}ensureVisible($,Z,J,Q,K){K&&(J>this.worldScreenWidth||Q>this.worldScreenHeight)&&(this.fit(!0,J,Q),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let q=!1;$<this.left?(this.left=$,q=!0):$+J>this.right&&(this.right=$+J,q=!0),Z<this.top?(this.top=Z,q=!0):Z+Q>this.bottom&&(this.bottom=Z+Q,q=!0),q&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}var y8=new g,sW=new Uint16Array([0,1,2,0,2,3]);class k0 extends i{constructor($){super();this._anchor=new C7(this._onAnchorUpdate,this,$?$.defaultAnchor.x:0,$?$.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new a(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=o.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=$||S.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=sW,this.pluginName="batch",this.isSprite=!0,this._roundPixels=I.ROUND_PIXELS}_onTextureUpdate(){if(this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width)this.scale.x=A.sign(this.scale.x)*this._width/this._texture.orig.width;if(this._height)this.scale.y=A.sign(this.scale.y)*this._height/this._texture.orig.height}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const $=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===$._updateID)return;if(this._textureID!==$._updateID)this.uvs=this._texture._uvs.uvsFloat32;this._transformID=this.transform._worldID,this._textureID=$._updateID;const Z=this.transform.worldTransform,J=Z.a,Q=Z.b,K=Z.c,q=Z.d,V=Z.tx,U=Z.ty,H=this.vertexData,z=$.trim,W=$.orig,Y=this._anchor;let w=0,j=0,C=0,X=0;if(z)j=z.x-Y._x*W.width,w=j+z.width,X=z.y-Y._y*W.height,C=X+z.height;else j=-Y._x*W.width,w=j+W.width,X=-Y._y*W.height,C=X+W.height;if(H[0]=J*j+K*X+V,H[1]=q*X+Q*j+U,H[2]=J*w+K*X+V,H[3]=q*X+Q*w+U,H[4]=J*w+K*C+V,H[5]=q*C+Q*w+U,H[6]=J*j+K*C+V,H[7]=q*C+Q*j+U,this._roundPixels){const G=I.RESOLUTION;for(let F=0;F<H.length;++F)H[F]=Math.round(H[F]*G)/G}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const $=this._texture,Z=this.vertexTrimmedData,J=$.orig,Q=this._anchor,K=this.transform.worldTransform,q=K.a,V=K.b,U=K.c,H=K.d,z=K.tx,W=K.ty,Y=-Q._x*J.width,w=Y+J.width,j=-Q._y*J.height,C=j+J.height;Z[0]=q*Y+U*j+z,Z[1]=H*j+V*Y+W,Z[2]=q*w+U*j+z,Z[3]=H*j+V*w+W,Z[4]=q*w+U*C+z,Z[5]=H*C+V*w+W,Z[6]=q*Y+U*C+z,Z[7]=H*C+V*Y+W}_render($){this.calculateVertices(),$.batch.setObjectRenderer($.plugins[this.pluginName]),$.plugins[this.pluginName].render(this)}_calculateBounds(){const $=this._texture.trim,Z=this._texture.orig;if(!$||$.width===Z.width&&$.height===Z.height)this.calculateVertices(),this._bounds.addQuad(this.vertexData);else this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)}getLocalBounds($){if(this.children.length===0){if(!this._localBounds)this._localBounds=new n7;if(this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),!$){if(!this._localBoundsRect)this._localBoundsRect=new c;$=this._localBoundsRect}return this._localBounds.getRectangle($)}return super.getLocalBounds.call(this,$)}containsPoint($){this.worldTransform.applyInverse($,y8);const Z=this._texture.orig.width,J=this._texture.orig.height,Q=-Z*this.anchor.x;let K=0;if(y8.x>=Q&&y8.x<Q+Z){if(K=-J*this.anchor.y,y8.y>=K&&y8.y<K+J)return!0}return!1}destroy($){if(super.destroy($),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof $==="boolean"?$:$?.texture){const J=typeof $==="boolean"?$:$?.baseTexture;this._texture.destroy(!!J)}this._texture=null}static from($,Z){const J=$ instanceof S?$:S.from($,Z);return new k0(J)}set roundPixels($){if(this._roundPixels!==$)this._transformID=-1;this._roundPixels=$}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width($){const Z=A.sign(this.scale.x)||1;this.scale.x=Z*$/this._texture.orig.width,this._width=$}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height($){const Z=A.sign(this.scale.y)||1;this.scale.y=Z*$/this._texture.orig.height,this._height=$}get anchor(){return this._anchor}set anchor($){this._anchor.copyFrom($)}get tint(){return this._tintColor.value}set tint($){this._tintColor.setValue($),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture($){if(this._texture===$)return;if(this._texture)this._texture.off("update",this._onTextureUpdate,this);if(this._texture=$||S.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,$)if($.baseTexture.valid)this._onTextureUpdate();else $.once("update",this._onTextureUpdate,this)}}var Yq=new Z0;U0.prototype._cacheAsBitmap=!1;U0.prototype._cacheData=null;U0.prototype._cacheAsBitmapResolution=null;U0.prototype._cacheAsBitmapMultisample=null;class wq{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(U0.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set($){if($===this._cacheAsBitmapResolution)return;if(this._cacheAsBitmapResolution=$,this.cacheAsBitmap)this.cacheAsBitmap=!1,this.cacheAsBitmap=!0}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set($){if($===this._cacheAsBitmapMultisample)return;if(this._cacheAsBitmapMultisample=$,this.cacheAsBitmap)this.cacheAsBitmap=!1,this.cacheAsBitmap=!0}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set($){if(this._cacheAsBitmap===$)return;this._cacheAsBitmap=$;let Z;if($){if(!this._cacheData)this._cacheData=new wq;Z=this._cacheData,Z.originalRender=this.render,Z.originalRenderCanvas=this.renderCanvas,Z.originalUpdateTransform=this.updateTransform,Z.originalCalculateBounds=this.calculateBounds,Z.originalGetLocalBounds=this.getLocalBounds,Z.originalDestroy=this.destroy,Z.originalContainsPoint=this.containsPoint,Z.originalMask=this._mask,Z.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy}else{if(Z=this._cacheData,Z.sprite)this._destroyCachedDisplayObject();this.render=Z.originalRender,this.renderCanvas=Z.originalRenderCanvas,this.calculateBounds=Z.originalCalculateBounds,this.getLocalBounds=Z.originalGetLocalBounds,this.destroy=Z.originalDestroy,this.updateTransform=Z.originalUpdateTransform,this.containsPoint=Z.originalContainsPoint,this._mask=Z.originalMask,this.filterArea=Z.originalFilterArea}}}});U0.prototype._renderCached=function $(Z){if(!this.visible||this.worldAlpha<=0||!this.renderable)return;this._initCachedDisplayObject(Z),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(Z)};U0.prototype._initCachedDisplayObject=function $(Z){if(this._cacheData?.sprite)return;const J=this.alpha;this.alpha=1,Z.batch.flush();const Q=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const w=this.filters[0].padding;Q.pad(w)}Q.ceil(I.RESOLUTION);const K=Z.renderTexture.current,q=Z.renderTexture.sourceFrame.clone(),V=Z.renderTexture.destinationFrame.clone(),U=Z.projection.transform,H=X7.create({width:Q.width,height:Q.height,resolution:this.cacheAsBitmapResolution||Z.resolution,multisample:this.cacheAsBitmapMultisample??Z.multisample}),z=`cacheAsBitmap_${A.uid()}`;this._cacheData.textureCacheId=z,p.addToCache(H.baseTexture,z),S.addToCache(H,z);const W=this.transform.localTransform.copyTo(Yq).invert().translate(-Q.x,-Q.y);this.render=this._cacheData.originalRender,Z.render(this,{renderTexture:H,clear:!0,transform:W,skipUpdateTransform:!1}),Z.framebuffer.blit(),Z.projection.transform=U,Z.renderTexture.bind(K,q,V),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=J;const Y=new k0(H);if(Y.transform.worldTransform=this.transform.worldTransform,Y.anchor.x=-(Q.x/Q.width),Y.anchor.y=-(Q.y/Q.height),Y.alpha=J,Y._bounds=this._bounds,this._cacheData.sprite=Y,this.transform._parentID=-1,!this.parent)this.enableTempParent(),this.updateTransform(),this.disableTempParent(null);else this.updateTransform();this.containsPoint=Y.containsPoint.bind(Y)};U0.prototype._renderCachedCanvas=function $(Z){if(!this.visible||this.worldAlpha<=0||!this.renderable)return;this._initCachedDisplayObjectCanvas(Z),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(Z)};U0.prototype._initCachedDisplayObjectCanvas=function $(Z){if(this._cacheData?.sprite)return;const J=this.getLocalBounds(null,!0),Q=this.alpha;this.alpha=1;const K=Z.canvasContext.activeContext,q=Z._projTransform;J.ceil(I.RESOLUTION);const V=X7.create({width:J.width,height:J.height}),U=`cacheAsBitmap_${A.uid()}`;this._cacheData.textureCacheId=U,p.addToCache(V.baseTexture,U),S.addToCache(V,U);const H=Yq;this.transform.localTransform.copyTo(H),H.invert(),H.tx-=J.x,H.ty-=J.y,this.renderCanvas=this._cacheData.originalRenderCanvas,Z.render(this,{renderTexture:V,clear:!0,transform:H,skipUpdateTransform:!1}),Z.canvasContext.activeContext=K,Z._projTransform=q,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=Q;const z=new k0(V);if(z.transform.worldTransform=this.transform.worldTransform,z.anchor.x=-(J.x/J.width),z.anchor.y=-(J.y/J.height),z.alpha=Q,z._bounds=this._bounds,this._cacheData.sprite=z,this.transform._parentID=-1,!this.parent)this.parent=Z._tempDisplayObjectParent,this.updateTransform(),this.parent=null;else this.updateTransform();this.containsPoint=z.containsPoint.bind(z)};U0.prototype._calculateCachedBounds=function $(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};U0.prototype._getCachedLocalBounds=function $(){return this._cacheData.sprite.getLocalBounds(null)};U0.prototype._destroyCachedDisplayObject=function $(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,p.removeFromCache(this._cacheData.textureCacheId),S.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};U0.prototype._cacheAsBitmapDestroy=function $(Z){this.cacheAsBitmap=!1,this.destroy(Z)};U0.prototype.name=null;i.prototype.getChildByName=function $(Z,J){for(let Q=0,K=this.children.length;Q<K;Q++)if(this.children[Q].name===Z)return this.children[Q];if(J)for(let Q=0,K=this.children.length;Q<K;Q++){const q=this.children[Q];if(!q.getChildByName)continue;const V=q.getChildByName(Z,!0);if(V)return V}return null};U0.prototype.getGlobalPosition=function $(Z=new g,J=!1){if(this.parent)this.parent.toGlobal(this.position,Z,J);else Z.x=this.position.x,Z.y=this.position.y;return Z};var jq="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n";class H9 extends W0{constructor($=1){super(nZ,jq,{uAlpha:1});this.alpha=$}get alpha(){return this.uniforms.uAlpha}set alpha($){this.uniforms.uAlpha=$}}var Cq=function($){const Z=iW[$],J=Z.length;let Q=aW,K="";const q="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let V;for(let U=0;U<$;U++){let H=q.replace("%index%",U.toString());if(V=U,U>=J)V=$-U-1;H=H.replace("%value%",Z[V].toString()),K+=H,K+="\n"}return Q=Q.replace("%blur%",K),Q=Q.replace("%size%",$.toString()),Q},iW={5:[0.153388,0.221461,0.250301],7:[0.071303,0.131514,0.189879,0.214607],9:[0.028532,0.067234,0.124009,0.179044,0.20236],11:[0.0093,0.028002,0.065984,0.121703,0.175713,0.198596],13:[0.002406,0.009255,0.027867,0.065666,0.121117,0.174868,0.197641],15:[0.000489,0.002403,0.009246,0.02784,0.065602,0.120999,0.174697,0.197448]},aW=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var Xq=function($,Z){const J=Math.ceil($/2);let Q=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`,K="",q;if(Z)q="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);";else q="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let V=0;V<$;V++){let U=q.replace("%index%",V.toString());U=U.replace("%sampleIndex%",`${V-(J-1)}.0`),K+=U,K+="\n"}return Q=Q.replace("%blur%",K),Q=Q.replace("%size%",$.toString()),Q};class u$ extends W0{constructor($,Z=8,J=4,Q=W0.defaultResolution,K=5){const q=Xq(K,$),V=Cq(K);super(q,V);this.horizontal=$,this.resolution=Q,this._quality=0,this.quality=J,this.blur=Z}apply($,Z,J,Q){if(J)if(this.horizontal)this.uniforms.strength=1/J.width*(J.width/Z.width);else this.uniforms.strength=1/J.height*(J.height/Z.height);else if(this.horizontal)this.uniforms.strength=1/$.renderer.width*($.renderer.width/Z.width);else this.uniforms.strength=1/$.renderer.height*($.renderer.height/Z.height);if(this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)$.applyFilter(this,Z,J,Q);else{const K=$.getFilterTexture(),q=$.renderer;let V=Z,U=K;this.state.blend=!1,$.applyFilter(this,V,U,Z7.CLEAR);for(let H=1;H<this.passes-1;H++){$.bindAndClear(V,Z7.BLIT),this.uniforms.uSampler=U;const z=U;U=V,V=z,q.shader.bind(this),q.geometry.draw(5)}this.state.blend=!0,$.applyFilter(this,U,J,Q),$.returnFilterTexture(K)}}get blur(){return this.strength}set blur($){this.padding=1+Math.abs($)*2,this.strength=$}get quality(){return this._quality}set quality($){this._quality=$,this.passes=$}}class z9 extends W0{constructor($=8,Z=4,J=W0.defaultResolution,Q=5){super();this._repeatEdgePixels=!1,this.blurXFilter=new u$(!0,$,Z,J,Q),this.blurYFilter=new u$(!1,$,Z,J,Q),this.resolution=J,this.quality=Z,this.blur=$,this.repeatEdgePixels=!1}apply($,Z,J,Q){const K=Math.abs(this.blurXFilter.strength),q=Math.abs(this.blurYFilter.strength);if(K&&q){const V=$.getFilterTexture();this.blurXFilter.apply($,Z,V,Z7.CLEAR),this.blurYFilter.apply($,V,J,Q),$.returnFilterTexture(V)}else if(q)this.blurYFilter.apply($,Z,J,Q);else this.blurXFilter.apply($,Z,J,Q)}updatePadding(){if(this._repeatEdgePixels)this.padding=0;else this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur($){this.blurXFilter.blur=this.blurYFilter.blur=$,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality($){this.blurXFilter.quality=this.blurYFilter.quality=$}get blurX(){return this.blurXFilter.blur}set blurX($){this.blurXFilter.blur=$,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY($){this.blurYFilter.blur=$,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode($){this.blurYFilter.blendMode=$}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels($){this._repeatEdgePixels=$,this.updatePadding()}}var Gq="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n";class L6 extends W0{constructor(){const $={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(E8,Gq,$);this.alpha=1}_loadMatrix($,Z=!1){let J=$;if(Z)this._multiply(J,this.uniforms.m,$),J=this._colorMatrix(J);this.uniforms.m=J}_multiply($,Z,J){return $[0]=Z[0]*J[0]+Z[1]*J[5]+Z[2]*J[10]+Z[3]*J[15],$[1]=Z[0]*J[1]+Z[1]*J[6]+Z[2]*J[11]+Z[3]*J[16],$[2]=Z[0]*J[2]+Z[1]*J[7]+Z[2]*J[12]+Z[3]*J[17],$[3]=Z[0]*J[3]+Z[1]*J[8]+Z[2]*J[13]+Z[3]*J[18],$[4]=Z[0]*J[4]+Z[1]*J[9]+Z[2]*J[14]+Z[3]*J[19]+Z[4],$[5]=Z[5]*J[0]+Z[6]*J[5]+Z[7]*J[10]+Z[8]*J[15],$[6]=Z[5]*J[1]+Z[6]*J[6]+Z[7]*J[11]+Z[8]*J[16],$[7]=Z[5]*J[2]+Z[6]*J[7]+Z[7]*J[12]+Z[8]*J[17],$[8]=Z[5]*J[3]+Z[6]*J[8]+Z[7]*J[13]+Z[8]*J[18],$[9]=Z[5]*J[4]+Z[6]*J[9]+Z[7]*J[14]+Z[8]*J[19]+Z[9],$[10]=Z[10]*J[0]+Z[11]*J[5]+Z[12]*J[10]+Z[13]*J[15],$[11]=Z[10]*J[1]+Z[11]*J[6]+Z[12]*J[11]+Z[13]*J[16],$[12]=Z[10]*J[2]+Z[11]*J[7]+Z[12]*J[12]+Z[13]*J[17],$[13]=Z[10]*J[3]+Z[11]*J[8]+Z[12]*J[13]+Z[13]*J[18],$[14]=Z[10]*J[4]+Z[11]*J[9]+Z[12]*J[14]+Z[13]*J[19]+Z[14],$[15]=Z[15]*J[0]+Z[16]*J[5]+Z[17]*J[10]+Z[18]*J[15],$[16]=Z[15]*J[1]+Z[16]*J[6]+Z[17]*J[11]+Z[18]*J[16],$[17]=Z[15]*J[2]+Z[16]*J[7]+Z[17]*J[12]+Z[18]*J[17],$[18]=Z[15]*J[3]+Z[16]*J[8]+Z[17]*J[13]+Z[18]*J[18],$[19]=Z[15]*J[4]+Z[16]*J[9]+Z[17]*J[14]+Z[18]*J[19]+Z[19],$}_colorMatrix($){const Z=new Float32Array($);return Z[4]/=255,Z[9]/=255,Z[14]/=255,Z[19]/=255,Z}brightness($,Z){const J=[$,0,0,0,0,0,$,0,0,0,0,0,$,0,0,0,0,0,1,0];this._loadMatrix(J,Z)}tint($,Z){const[J,Q,K]=a.shared.setValue($).toArray(),q=[J,0,0,0,0,0,Q,0,0,0,0,0,K,0,0,0,0,0,1,0];this._loadMatrix(q,Z)}greyscale($,Z){const J=[$,$,$,0,0,$,$,$,0,0,$,$,$,0,0,0,0,0,1,0];this._loadMatrix(J,Z)}blackAndWhite($){const Z=[0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0,0,0,1,0];this._loadMatrix(Z,$)}hue($,Z){$=($||0)/180*Math.PI;const J=Math.cos($),Q=Math.sin($),K=Math.sqrt,q=0.3333333333333333,V=K(q),U=J+(1-J)*q,H=q*(1-J)-V*Q,z=q*(1-J)+V*Q,W=q*(1-J)+V*Q,Y=J+q*(1-J),w=q*(1-J)-V*Q,j=q*(1-J)-V*Q,C=q*(1-J)+V*Q,X=J+q*(1-J),G=[U,H,z,0,0,W,Y,w,0,0,j,C,X,0,0,0,0,0,1,0];this._loadMatrix(G,Z)}contrast($,Z){const J=($||0)+1,Q=-0.5*(J-1),K=[J,0,0,0,Q,0,J,0,0,Q,0,0,J,0,Q,0,0,0,1,0];this._loadMatrix(K,Z)}saturate($=0,Z){const J=$*2/3+1,Q=(J-1)*-0.5,K=[J,Q,Q,0,0,Q,J,Q,0,0,Q,Q,J,0,0,0,0,0,1,0];this._loadMatrix(K,Z)}desaturate(){this.saturate(-1)}negative($){const Z=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(Z,$)}sepia($){const Z=[0.393,0.7689999,0.18899999,0,0,0.349,0.6859999,0.16799999,0,0,0.272,0.5339999,0.13099999,0,0,0,0,0,1,0];this._loadMatrix(Z,$)}technicolor($){const Z=[1.9125277891456083,-0.8545344976951645,-0.09155508482755585,0,11.793603434377337,-0.3087833385928097,1.7658908555458428,-0.10601743074722245,0,-70.35205161461398,-0.231103377548616,-0.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(Z,$)}polaroid($){const Z=[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(Z,$)}toBGR($){const Z=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(Z,$)}kodachrome($){const Z=[1.1285582396593525,-0.3967382283601348,-0.03992559172921793,0,63.72958762196502,-0.16404339962244616,1.0835251566291304,-0.05498805115633132,0,24.732407896706203,-0.16786010706155763,-0.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(Z,$)}browni($){const Z=[0.5997023498159715,0.34553243048391263,-0.2708298674538042,0,47.43192855600873,-0.037703249837783157,0.8609577587992641,0.15059552388459913,0,-36.96841498319127,0.24113635128153335,-0.07441037908422492,0.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(Z,$)}vintage($){const Z=[0.6279345635605994,0.3202183420819367,-0.03965408211312453,0,9.651285835294123,0.02578397704808868,0.6441188644374771,0.03259127616149294,0,7.462829176470591,0.0466055556782719,-0.0851232987247891,0.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(Z,$)}colorTone($,Z,J,Q,K){$=$||0.2,Z=Z||0.15,J=J||16770432,Q=Q||3375104;const q=a.shared,[V,U,H]=q.setValue(J).toArray(),[z,W,Y]=q.setValue(Q).toArray(),w=[0.3,0.59,0.11,0,0,V,U,H,$,0,z,W,Y,Z,0,V-z,U-W,H-Y,0,0];this._loadMatrix(w,K)}night($,Z){$=$||0.1;const J=[$*-2,-$,0,0,0,-$,0,$,0,0,0,$,$*2,0,0,0,0,0,1,0];this._loadMatrix(J,Z)}predator($,Z){const J=[11.224130630493164*$,-4.794486999511719*$,-2.8746118545532227*$,0*$,0.40342438220977783*$,-3.6330697536468506*$,9.193157196044922*$,-2.951810836791992*$,0*$,-1.316135048866272*$,-3.2184197902679443*$,-4.2375030517578125*$,7.476448059082031*$,0*$,0.8044459223747253*$,0,0,0,1,0];this._loadMatrix(J,Z)}lsd($){const Z=[2,-0.4,0.5,0,0,-0.5,2,-0.4,0,0,-0.4,-0.5,3,0,0,0,0,0,1,0];this._loadMatrix(Z,$)}reset(){const $=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix($,!1)}get matrix(){return this.uniforms.m}set matrix($){this.uniforms.m=$}get alpha(){return this.uniforms.uAlpha}set alpha($){this.uniforms.uAlpha=$}}L6.prototype.grayscale=L6.prototype.greyscale;var Nq="varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n";var Lq="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n";class W9 extends W0{constructor($,Z){const J=new Z0;$.renderable=!1;super(Lq,Nq,{mapSampler:$._texture,filterMatrix:J,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])});if(this.maskSprite=$,this.maskMatrix=J,Z===null||Z===void 0)Z=20;this.scale=new g(Z,Z)}apply($,Z,J,Q){this.uniforms.filterMatrix=$.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const K=this.maskSprite.worldTransform,q=Math.sqrt(K.a*K.a+K.b*K.b),V=Math.sqrt(K.c*K.c+K.d*K.d);if(q!==0&&V!==0)this.uniforms.rotation[0]=K.a/q,this.uniforms.rotation[1]=K.b/q,this.uniforms.rotation[2]=K.c/V,this.uniforms.rotation[3]=K.d/V;$.applyFilter(this,Z,J,Q)}get map(){return this.uniforms.mapSampler}set map($){this.uniforms.mapSampler=$}}var Bq="varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it's\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n";var Pq="\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n";class Y9 extends W0{constructor(){super(Pq,Bq)}}var Fq="precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n";class w9 extends W0{constructor($=0.5,Z=Math.random()){super(E8,Fq,{uNoise:0,uSeed:0});this.noise=$,this.seed=Z}get noise(){return this.uniforms.uNoise}set noise($){this.uniforms.uNoise=$}get seed(){return this.uniforms.uSeed}set seed($){this.uniforms.uSeed=$}}var eZ={AlphaFilter:H9,BlurFilter:z9,BlurFilterPass:u$,ColorMatrixFilter:L6,DisplacementFilter:W9,FXAAFilter:Y9,NoiseFilter:w9};Object.entries(eZ).forEach(([$,Z])=>{Object.defineProperty(eZ,$,{get(){return A.deprecation("7.1.0",`filters.${$} has moved to ${$}`),Z}})});class Iq{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init($){this.removeTickerListener(),this.events=$,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate($){this._pauseUpdate=$}addTickerListener(){if(this.tickerAdded||!this.domElement)return;Y0.system.add(this.tickerUpdate,this,K7.INTERACTION),this.tickerAdded=!0}removeTickerListener(){if(!this.tickerAdded)return;Y0.system.remove(this.tickerUpdate,this),this.tickerAdded=!1}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const $=this.events.rootPointerEvent;if(this.events.supportsTouchEvents&&$.pointerType==="touch")return;globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:$.clientX,clientY:$.clientY}))}tickerUpdate($){if(this._deltaTime+=$,this._deltaTime<this.interactionFrequency)return;this._deltaTime=0,this.update()}}var v7=new Iq;class o7{constructor($){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=o7.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new g,this.page=new g,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=$}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){if(this.manager&&(!this.path||this.path[this.path.length-1]!==this.target))this.path=this.target?this.manager.propagationPath(this.target):[];return this.path}initEvent($,Z,J){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent($,Z,J,Q,K){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){if(this.nativeEvent instanceof Event&&this.nativeEvent.cancelable)this.nativeEvent.preventDefault();this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class s7 extends o7{constructor(){super(...arguments);this.client=new g,this.movement=new g,this.offset=new g,this.global=new g,this.screen=new g}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition($,Z,J){return $.worldTransform.applyInverse(J||this.global,Z)}getModifierState($){return("getModifierState"in this.nativeEvent)&&this.nativeEvent.getModifierState($)}initMouseEvent($,Z,J,Q,K,q,V,U,H,z,W,Y,w,j,C){throw new Error("Method not implemented.")}}class u0 extends s7{constructor(){super(...arguments);this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){if(this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove")return[this];return[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class S7 extends s7{constructor(){super(...arguments);this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}S7.DOM_DELTA_PIXEL=0;S7.DOM_DELTA_LINE=1;S7.DOM_DELTA_PAGE=2;var rW=2048,tW=new g,$J=new g;class B6{constructor($){this.dispatch=new A.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=$,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping($,Z){if(!this.mappingTable[$])this.mappingTable[$]=[];this.mappingTable[$].push({fn:Z,priority:0}),this.mappingTable[$].sort((J,Q)=>J.priority-Q.priority)}dispatchEvent($,Z){$.propagationStopped=!1,$.propagationImmediatelyStopped=!1,this.propagate($,Z),this.dispatch.emit(Z||$.type,$)}mapEvent($){if(!this.rootTarget)return;const Z=this.mappingTable[$.type];if(Z)for(let J=0,Q=Z.length;J<Q;J++)Z[J].fn($);else console.warn(`[EventBoundary]: Event mapping not defined for ${$.type}`)}hitTest($,Z){v7.pauseUpdate=!0;const Q=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",K=this[Q](this.rootTarget,this.rootTarget.eventMode,tW.set($,Z),this.hitTestFn,this.hitPruneFn);return K&&K[0]}propagate($,Z){if(!$.target)return;const J=$.composedPath();$.eventPhase=$.CAPTURING_PHASE;for(let Q=0,K=J.length-1;Q<K;Q++)if($.currentTarget=J[Q],this.notifyTarget($,Z),$.propagationStopped||$.propagationImmediatelyStopped)return;if($.eventPhase=$.AT_TARGET,$.currentTarget=$.target,this.notifyTarget($,Z),$.propagationStopped||$.propagationImmediatelyStopped)return;$.eventPhase=$.BUBBLING_PHASE;for(let Q=J.length-2;Q>=0;Q--)if($.currentTarget=J[Q],this.notifyTarget($,Z),$.propagationStopped||$.propagationImmediatelyStopped)return}all($,Z,J=this._allInteractiveElements){if(J.length===0)return;$.eventPhase=$.BUBBLING_PHASE;const Q=Array.isArray(Z)?Z:[Z];for(let K=J.length-1;K>=0;K--)Q.forEach((q)=>{$.currentTarget=J[K],this.notifyTarget($,q)})}propagationPath($){const Z=[$];for(let J=0;J<rW&&$!==this.rootTarget;J++){if(!$.parent)throw new Error("Cannot find propagation path to disconnected target");Z.push($.parent),$=$.parent}return Z.reverse(),Z}hitTestMoveRecursive($,Z,J,Q,K,q=!1){let V=!1;if(this._interactivePrune($))return null;if($.eventMode==="dynamic"||Z==="dynamic")v7.pauseUpdate=!1;if($.interactiveChildren&&$.children){const z=$.children;for(let W=z.length-1;W>=0;W--){const Y=z[W],w=this.hitTestMoveRecursive(Y,this._isInteractive(Z)?Z:Y.eventMode,J,Q,K,q||K($,J));if(w){if(w.length>0&&!w[w.length-1].parent)continue;const j=$.isInteractive();if(w.length>0||j){if(j)this._allInteractiveElements.push($);w.push($)}if(this._hitElements.length===0)this._hitElements=w;V=!0}}}const U=this._isInteractive(Z),H=$.isInteractive();if(H&&H)this._allInteractiveElements.push($);if(q||this._hitElements.length>0)return null;if(V)return this._hitElements;if(U&&(!K($,J)&&Q($,J)))return H?[$]:[];return null}hitTestRecursive($,Z,J,Q,K){if(this._interactivePrune($)||K($,J))return null;if($.eventMode==="dynamic"||Z==="dynamic")v7.pauseUpdate=!1;if($.interactiveChildren&&$.children){const U=$.children;for(let H=U.length-1;H>=0;H--){const z=U[H],W=this.hitTestRecursive(z,this._isInteractive(Z)?Z:z.eventMode,J,Q,K);if(W){if(W.length>0&&!W[W.length-1].parent)continue;const Y=$.isInteractive();if(W.length>0||Y)W.push($);return W}}}const q=this._isInteractive(Z),V=$.isInteractive();if(q&&Q($,J))return V?[$]:[];return null}_isInteractive($){return $==="static"||$==="dynamic"}_interactivePrune($){if(!$||$.isMask||!$.visible||!$.renderable)return!0;if($.eventMode==="none")return!0;if($.eventMode==="passive"&&!$.interactiveChildren)return!0;if($.isMask)return!0;return!1}hitPruneFn($,Z){if($.hitArea){if($.worldTransform.applyInverse(Z,$J),!$.hitArea.contains($J.x,$J.y))return!0}if($._mask){const J=$._mask.isMaskData?$._mask.maskObject:$._mask;if(J&&!J.containsPoint?.(Z))return!0}return!1}hitTestFn($,Z){if($.eventMode==="passive")return!1;if($.hitArea)return!0;if($.containsPoint)return $.containsPoint(Z);return!1}notifyTarget($,Z){Z=Z??$.type;const J=`on${Z}`;$.currentTarget[J]?.($);const Q=$.eventPhase===$.CAPTURING_PHASE||$.eventPhase===$.AT_TARGET?`${Z}capture`:Z;if(this.notifyListeners($,Q),$.eventPhase===$.AT_TARGET)this.notifyListeners($,Z)}mapPointerDown($){if(!($ instanceof u0)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const Z=this.createPointerEvent($);if(this.dispatchEvent(Z,"pointerdown"),Z.pointerType==="touch")this.dispatchEvent(Z,"touchstart");else if(Z.pointerType==="mouse"||Z.pointerType==="pen"){const Q=Z.button===2;this.dispatchEvent(Z,Q?"rightdown":"mousedown")}const J=this.trackingData($.pointerId);J.pressTargetsByButton[$.button]=Z.composedPath(),this.freeEvent(Z)}mapPointerMove($){if(!($ instanceof u0)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const Z=this.createPointerEvent($);this._isPointerMoveEvent=!1;const J=Z.pointerType==="mouse"||Z.pointerType==="pen",Q=this.trackingData($.pointerId),K=this.findMountedTarget(Q.overTargets);if(Q.overTargets?.length>0&&K!==Z.target){const U=$.type==="mousemove"?"mouseout":"pointerout",H=this.createPointerEvent($,U,K);if(this.dispatchEvent(H,"pointerout"),J)this.dispatchEvent(H,"mouseout");if(!Z.composedPath().includes(K)){const z=this.createPointerEvent($,"pointerleave",K);z.eventPhase=z.AT_TARGET;while(z.target&&!Z.composedPath().includes(z.target)){if(z.currentTarget=z.target,this.notifyTarget(z),J)this.notifyTarget(z,"mouseleave");z.target=z.target.parent}this.freeEvent(z)}this.freeEvent(H)}if(K!==Z.target){const U=$.type==="mousemove"?"mouseover":"pointerover",H=this.clonePointerEvent(Z,U);if(this.dispatchEvent(H,"pointerover"),J)this.dispatchEvent(H,"mouseover");let z=K?.parent;while(z&&z!==this.rootTarget.parent){if(z===Z.target)break;z=z.parent}if(!z||z===this.rootTarget.parent){const Y=this.clonePointerEvent(Z,"pointerenter");Y.eventPhase=Y.AT_TARGET;while(Y.target&&Y.target!==K&&Y.target!==this.rootTarget.parent){if(Y.currentTarget=Y.target,this.notifyTarget(Y),J)this.notifyTarget(Y,"mouseenter");Y.target=Y.target.parent}this.freeEvent(Y)}this.freeEvent(H)}const q=[],V=this.enableGlobalMoveEvents??!0;if(this.moveOnAll?q.push("pointermove"):this.dispatchEvent(Z,"pointermove"),V&&q.push("globalpointermove"),Z.pointerType==="touch")this.moveOnAll?q.splice(1,0,"touchmove"):this.dispatchEvent(Z,"touchmove"),V&&q.push("globaltouchmove");if(J)this.moveOnAll?q.splice(1,0,"mousemove"):this.dispatchEvent(Z,"mousemove"),V&&q.push("globalmousemove"),this.cursor=Z.target?.cursor;if(q.length>0)this.all(Z,q);this._allInteractiveElements.length=0,this._hitElements.length=0,Q.overTargets=Z.composedPath(),this.freeEvent(Z)}mapPointerOver($){if(!($ instanceof u0)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const Z=this.trackingData($.pointerId),J=this.createPointerEvent($),Q=J.pointerType==="mouse"||J.pointerType==="pen";if(this.dispatchEvent(J,"pointerover"),Q)this.dispatchEvent(J,"mouseover");if(J.pointerType==="mouse")this.cursor=J.target?.cursor;const K=this.clonePointerEvent(J,"pointerenter");K.eventPhase=K.AT_TARGET;while(K.target&&K.target!==this.rootTarget.parent){if(K.currentTarget=K.target,this.notifyTarget(K),Q)this.notifyTarget(K,"mouseenter");K.target=K.target.parent}Z.overTargets=J.composedPath(),this.freeEvent(J),this.freeEvent(K)}mapPointerOut($){if(!($ instanceof u0)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const Z=this.trackingData($.pointerId);if(Z.overTargets){const J=$.pointerType==="mouse"||$.pointerType==="pen",Q=this.findMountedTarget(Z.overTargets),K=this.createPointerEvent($,"pointerout",Q);if(this.dispatchEvent(K),J)this.dispatchEvent(K,"mouseout");const q=this.createPointerEvent($,"pointerleave",Q);q.eventPhase=q.AT_TARGET;while(q.target&&q.target!==this.rootTarget.parent){if(q.currentTarget=q.target,this.notifyTarget(q),J)this.notifyTarget(q,"mouseleave");q.target=q.target.parent}Z.overTargets=null,this.freeEvent(K),this.freeEvent(q)}this.cursor=null}mapPointerUp($){if(!($ instanceof u0)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const Z=performance.now(),J=this.createPointerEvent($);if(this.dispatchEvent(J,"pointerup"),J.pointerType==="touch")this.dispatchEvent(J,"touchend");else if(J.pointerType==="mouse"||J.pointerType==="pen"){const V=J.button===2;this.dispatchEvent(J,V?"rightup":"mouseup")}const Q=this.trackingData($.pointerId),K=this.findMountedTarget(Q.pressTargetsByButton[$.button]);let q=K;if(K&&!J.composedPath().includes(K)){let V=K;while(V&&!J.composedPath().includes(V)){if(J.currentTarget=V,this.notifyTarget(J,"pointerupoutside"),J.pointerType==="touch")this.notifyTarget(J,"touchendoutside");else if(J.pointerType==="mouse"||J.pointerType==="pen"){const U=J.button===2;this.notifyTarget(J,U?"rightupoutside":"mouseupoutside")}V=V.parent}delete Q.pressTargetsByButton[$.button],q=V}if(q){const V=this.clonePointerEvent(J,"click");if(V.target=q,V.path=null,!Q.clicksByButton[$.button])Q.clicksByButton[$.button]={clickCount:0,target:V.target,timeStamp:Z};const U=Q.clicksByButton[$.button];if(U.target===V.target&&Z-U.timeStamp<200)++U.clickCount;else U.clickCount=1;if(U.target=V.target,U.timeStamp=Z,V.detail=U.clickCount,V.pointerType==="mouse"){const H=V.button===2;this.dispatchEvent(V,H?"rightclick":"click")}else if(V.pointerType==="touch")this.dispatchEvent(V,"tap");this.dispatchEvent(V,"pointertap"),this.freeEvent(V)}this.freeEvent(J)}mapPointerUpOutside($){if(!($ instanceof u0)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const Z=this.trackingData($.pointerId),J=this.findMountedTarget(Z.pressTargetsByButton[$.button]),Q=this.createPointerEvent($);if(J){let K=J;while(K){if(Q.currentTarget=K,this.notifyTarget(Q,"pointerupoutside"),Q.pointerType==="touch")this.notifyTarget(Q,"touchendoutside");else if(Q.pointerType==="mouse"||Q.pointerType==="pen")this.notifyTarget(Q,Q.button===2?"rightupoutside":"mouseupoutside");K=K.parent}delete Z.pressTargetsByButton[$.button]}this.freeEvent(Q)}mapWheel($){if(!($ instanceof S7)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const Z=this.createWheelEvent($);this.dispatchEvent(Z),this.freeEvent(Z)}findMountedTarget($){if(!$)return null;let Z=$[0];for(let J=1;J<$.length;J++)if($[J].parent===Z)Z=$[J];else break;return Z}createPointerEvent($,Z,J){const Q=this.allocateEvent(u0);if(this.copyPointerData($,Q),this.copyMouseData($,Q),this.copyData($,Q),Q.nativeEvent=$.nativeEvent,Q.originalEvent=$,Q.target=J??this.hitTest(Q.global.x,Q.global.y)??this._hitElements[0],typeof Z==="string")Q.type=Z;return Q}createWheelEvent($){const Z=this.allocateEvent(S7);return this.copyWheelData($,Z),this.copyMouseData($,Z),this.copyData($,Z),Z.nativeEvent=$.nativeEvent,Z.originalEvent=$,Z.target=this.hitTest(Z.global.x,Z.global.y),Z}clonePointerEvent($,Z){const J=this.allocateEvent(u0);return J.nativeEvent=$.nativeEvent,J.originalEvent=$.originalEvent,this.copyPointerData($,J),this.copyMouseData($,J),this.copyData($,J),J.target=$.target,J.path=$.composedPath().slice(),J.type=Z??J.type,J}copyWheelData($,Z){Z.deltaMode=$.deltaMode,Z.deltaX=$.deltaX,Z.deltaY=$.deltaY,Z.deltaZ=$.deltaZ}copyPointerData($,Z){if(!($ instanceof u0&&Z instanceof u0))return;Z.pointerId=$.pointerId,Z.width=$.width,Z.height=$.height,Z.isPrimary=$.isPrimary,Z.pointerType=$.pointerType,Z.pressure=$.pressure,Z.tangentialPressure=$.tangentialPressure,Z.tiltX=$.tiltX,Z.tiltY=$.tiltY,Z.twist=$.twist}copyMouseData($,Z){if(!($ instanceof s7&&Z instanceof s7))return;Z.altKey=$.altKey,Z.button=$.button,Z.buttons=$.buttons,Z.client.copyFrom($.client),Z.ctrlKey=$.ctrlKey,Z.metaKey=$.metaKey,Z.movement.copyFrom($.movement),Z.screen.copyFrom($.screen),Z.shiftKey=$.shiftKey,Z.global.copyFrom($.global)}copyData($,Z){Z.isTrusted=$.isTrusted,Z.srcElement=$.srcElement,Z.timeStamp=performance.now(),Z.type=$.type,Z.detail=$.detail,Z.view=$.view,Z.which=$.which,Z.layer.copyFrom($.layer),Z.page.copyFrom($.page)}trackingData($){if(!this.mappingState.trackingData[$])this.mappingState.trackingData[$]={pressTargetsByButton:{},clicksByButton:{},overTarget:null};return this.mappingState.trackingData[$]}allocateEvent($){if(!this.eventPool.has($))this.eventPool.set($,[]);const Z=this.eventPool.get($).pop()||new $(this);return Z.eventPhase=Z.NONE,Z.currentTarget=null,Z.path=null,Z.target=null,Z}freeEvent($){if($.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const Z=$.constructor;if(!this.eventPool.has(Z))this.eventPool.set(Z,[]);this.eventPool.get(Z).push($)}notifyListeners($,Z){const J=$.currentTarget._events[Z];if(!J)return;if(!$.currentTarget.isInteractive())return;if("fn"in J){if(J.once)$.currentTarget.removeListener(Z,J.fn,void 0,!0);J.fn.call(J.context,$)}else for(let Q=0,K=J.length;Q<K&&!$.propagationImmediatelyStopped;Q++){if(J[Q].once)$.currentTarget.removeListener(Z,J[Q].fn,void 0,!0);J[Q].fn.call(J[Q].context,$)}}}var eW=1,$2={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ZJ=class{constructor($){this.supportsTouchEvents=("ontouchstart"in globalThis),this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=$,this.rootBoundary=new B6(null),v7.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new u0(null),this.rootWheelEvent=new S7(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ZJ.defaultEventFeatures},{set:(Z,J,Q)=>{if(J==="globalMove")this.rootBoundary.enableGlobalMoveEvents=Q;return Z[J]=Q,!0}}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init($){const{view:Z,resolution:J}=this.renderer;this.setTargetElement(Z),this.resolution=J,ZJ._defaultEventMode=$.eventMode??"auto",Object.assign(this.features,$.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange($){this.resolution=$}destroy(){this.setTargetElement(null),this.renderer=null}setCursor($){$=$||"default";let Z=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas)Z=!1;if(this.currentCursor===$)return;this.currentCursor=$;const J=this.cursorStyles[$];if(J)switch(typeof J){case"string":if(Z)this.domElement.style.cursor=J;break;case"function":J($);break;case"object":if(Z)Object.assign(this.domElement.style,J);break}else if(Z&&typeof $==="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,$))this.domElement.style.cursor=$}get pointer(){return this.rootPointerEvent}onPointerDown($){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&$.pointerType==="touch")return;const Z=this.normalizeToPointerData($);if(this.autoPreventDefault&&Z[0].isNormalized){if($.cancelable||!("cancelable"in $))$.preventDefault()}for(let J=0,Q=Z.length;J<Q;J++){const K=Z[J],q=this.bootstrapEvent(this.rootPointerEvent,K);this.rootBoundary.mapEvent(q)}this.setCursor(this.rootBoundary.cursor)}onPointerMove($){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&$.pointerType==="touch")return;v7.pointerMoved();const Z=this.normalizeToPointerData($);for(let J=0,Q=Z.length;J<Q;J++){const K=this.bootstrapEvent(this.rootPointerEvent,Z[J]);this.rootBoundary.mapEvent(K)}this.setCursor(this.rootBoundary.cursor)}onPointerUp($){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&$.pointerType==="touch")return;let Z=$.target;if($.composedPath&&$.composedPath().length>0)Z=$.composedPath()[0];const J=Z!==this.domElement?"outside":"",Q=this.normalizeToPointerData($);for(let K=0,q=Q.length;K<q;K++){const V=this.bootstrapEvent(this.rootPointerEvent,Q[K]);V.type+=J,this.rootBoundary.mapEvent(V)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut($){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&$.pointerType==="touch")return;const Z=this.normalizeToPointerData($);for(let J=0,Q=Z.length;J<Q;J++){const K=this.bootstrapEvent(this.rootPointerEvent,Z[J]);this.rootBoundary.mapEvent(K)}this.setCursor(this.rootBoundary.cursor)}onWheel($){if(!this.features.wheel)return;const Z=this.normalizeWheelEvent($);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(Z)}setTargetElement($){this.removeEvents(),this.domElement=$,v7.domElement=$,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;v7.addTickerListener();const $=this.domElement.style;if($){if(globalThis.navigator.msPointerEnabled)$.msContentZooming="none",$.msTouchAction="none";else if(this.supportsPointerEvents)$.touchAction="none"}if(this.supportsPointerEvents)globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0);else globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0);if(this.supportsTouchEvents)this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0);this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;v7.removeTickerListener();const $=this.domElement.style;if(globalThis.navigator.msPointerEnabled)$.msContentZooming="",$.msTouchAction="";else if(this.supportsPointerEvents)$.touchAction="";if(this.supportsPointerEvents)globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0);else globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0);if(this.supportsTouchEvents)this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0);this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint($,Z,J){let Q;if(!this.domElement.parentElement)Q={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};else Q=this.domElement.getBoundingClientRect();const K=1/this.resolution;$.x=(Z-Q.left)*(this.domElement.width/Q.width)*K,$.y=(J-Q.top)*(this.domElement.height/Q.height)*K}normalizeToPointerData($){const Z=[];if(this.supportsTouchEvents&&$ instanceof TouchEvent)for(let J=0,Q=$.changedTouches.length;J<Q;J++){const K=$.changedTouches[J];if(typeof K.button==="undefined")K.button=0;if(typeof K.buttons==="undefined")K.buttons=1;if(typeof K.isPrimary==="undefined")K.isPrimary=$.touches.length===1&&$.type==="touchstart";if(typeof K.width==="undefined")K.width=K.radiusX||1;if(typeof K.height==="undefined")K.height=K.radiusY||1;if(typeof K.tiltX==="undefined")K.tiltX=0;if(typeof K.tiltY==="undefined")K.tiltY=0;if(typeof K.pointerType==="undefined")K.pointerType="touch";if(typeof K.pointerId==="undefined")K.pointerId=K.identifier||0;if(typeof K.pressure==="undefined")K.pressure=K.force||0.5;if(typeof K.twist==="undefined")K.twist=0;if(typeof K.tangentialPressure==="undefined")K.tangentialPressure=0;if(typeof K.layerX==="undefined")K.layerX=K.offsetX=K.clientX;if(typeof K.layerY==="undefined")K.layerY=K.offsetY=K.clientY;K.isNormalized=!0,K.type=$.type,Z.push(K)}else if(!globalThis.MouseEvent||$ instanceof MouseEvent&&(!this.supportsPointerEvents||!($ instanceof globalThis.PointerEvent))){const J=$;if(typeof J.isPrimary==="undefined")J.isPrimary=!0;if(typeof J.width==="undefined")J.width=1;if(typeof J.height==="undefined")J.height=1;if(typeof J.tiltX==="undefined")J.tiltX=0;if(typeof J.tiltY==="undefined")J.tiltY=0;if(typeof J.pointerType==="undefined")J.pointerType="mouse";if(typeof J.pointerId==="undefined")J.pointerId=eW;if(typeof J.pressure==="undefined")J.pressure=0.5;if(typeof J.twist==="undefined")J.twist=0;if(typeof J.tangentialPressure==="undefined")J.tangentialPressure=0;J.isNormalized=!0,Z.push(J)}else Z.push($);return Z}normalizeWheelEvent($){const Z=this.rootWheelEvent;return this.transferMouseData(Z,$),Z.deltaX=$.deltaX,Z.deltaY=$.deltaY,Z.deltaZ=$.deltaZ,Z.deltaMode=$.deltaMode,this.mapPositionToPoint(Z.screen,$.clientX,$.clientY),Z.global.copyFrom(Z.screen),Z.offset.copyFrom(Z.screen),Z.nativeEvent=$,Z.type=$.type,Z}bootstrapEvent($,Z){if($.originalEvent=null,$.nativeEvent=Z,$.pointerId=Z.pointerId,$.width=Z.width,$.height=Z.height,$.isPrimary=Z.isPrimary,$.pointerType=Z.pointerType,$.pressure=Z.pressure,$.tangentialPressure=Z.tangentialPressure,$.tiltX=Z.tiltX,$.tiltY=Z.tiltY,$.twist=Z.twist,this.transferMouseData($,Z),this.mapPositionToPoint($.screen,Z.clientX,Z.clientY),$.global.copyFrom($.screen),$.offset.copyFrom($.screen),$.isTrusted=Z.isTrusted,$.type==="pointerleave")$.type="pointerout";if($.type.startsWith("mouse"))$.type=$.type.replace("mouse","pointer");if($.type.startsWith("touch"))$.type=$2[$.type]||$.type;return $}transferMouseData($,Z){$.isTrusted=Z.isTrusted,$.srcElement=Z.srcElement,$.timeStamp=performance.now(),$.type=Z.type,$.altKey=Z.altKey,$.button=Z.button,$.buttons=Z.buttons,$.client.x=Z.clientX,$.client.y=Z.clientY,$.ctrlKey=Z.ctrlKey,$.metaKey=Z.metaKey,$.movement.x=Z.movementX,$.movement.y=Z.movementY,$.page.x=Z.pageX,$.page.y=Z.pageY,$.relatedTarget=null,$.shiftKey=Z.shiftKey}},d$=ZJ;d$.extension={name:"events",type:[O.RendererSystem,O.CanvasRendererSystem]};d$.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};_.add(d$);var kq=function($){return $==="dynamic"||$==="static"},Oq={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??kq(d$.defaultEventMode)},set interactive($){A.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=$,this.eventMode=$?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??d$.defaultEventMode},set eventMode($){this._internalInteractive=kq($),this._internalEventMode=$},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener($,Z,J){const Q=typeof J==="boolean"&&J||typeof J==="object"&&J.capture,K=typeof Z==="function"?void 0:Z;$=Q?`${$}capture`:$,Z=typeof Z==="function"?Z:Z.handleEvent,this.on($,Z,K)},removeEventListener($,Z,J){const Q=typeof J==="boolean"&&J||typeof J==="object"&&J.capture,K=typeof Z==="function"?void 0:Z;$=Q?`${$}capture`:$,Z=typeof Z==="function"?Z:Z.handleEvent,this.off($,Z,K)},dispatchEvent($){if(!($ instanceof o7))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return $.defaultPrevented=!1,$.path=null,$.target=this,$.manager.dispatchEvent($),!$.defaultPrevented}};U0.mixin(Oq);var JJ={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};U0.mixin(JJ);var Z2=9,j9=100,J2=0,Q2=0,Rq=2,_q=1,K2=-1000,q2=-1000,V2=2;class C9{constructor($){if(this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,A.isMobile.tablet||A.isMobile.phone)this.createTouchHook();const Z=document.createElement("div");Z.style.width=`${j9}px`,Z.style.height=`${j9}px`,Z.style.position="absolute",Z.style.top=`${J2}px`,Z.style.left=`${Q2}px`,Z.style.zIndex=Rq.toString(),this.div=Z,this.renderer=$,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const $=document.createElement("button");$.style.width=`${_q}px`,$.style.height=`${_q}px`,$.style.position="absolute",$.style.top=`${K2}px`,$.style.left=`${q2}px`,$.style.zIndex=V2.toString(),$.style.backgroundColor="#FF0000",$.title="select to enable accessibility for this content",$.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild($),this._hookDiv=$}destroyTouchHook(){if(!this._hookDiv)return;document.body.removeChild(this._hookDiv),this._hookDiv=null}activate(){if(this._isActive)return;this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div)}deactivate(){if(!this._isActive||this._isMobileAccessibility)return;this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div)}updateAccessibleObjects($){if(!$.visible||!$.accessibleChildren)return;if($.accessible&&$.isInteractive()){if(!$._accessibleActive)this.addChild($);$.renderId=this.renderId}const Z=$.children;if(Z)for(let J=0;J<Z.length;J++)this.updateAccessibleObjects(Z[J])}update(){const $=performance.now();if(A.isMobile.android.device&&$<this.androidUpdateCount)return;if(this.androidUpdateCount=$+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;if(this.renderer.lastObjectRendered)this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:Z,y:J,width:Q,height:K}=this.renderer.view.getBoundingClientRect(),{width:q,height:V,resolution:U}=this.renderer,H=Q/q*U,z=K/V*U;let W=this.div;W.style.left=`${Z}px`,W.style.top=`${J}px`,W.style.width=`${q}px`,W.style.height=`${V}px`;for(let Y=0;Y<this.children.length;Y++){const w=this.children[Y];if(w.renderId!==this.renderId)w._accessibleActive=!1,A.removeItems(this.children,Y,1),this.div.removeChild(w._accessibleDiv),this.pool.push(w._accessibleDiv),w._accessibleDiv=null,Y--;else{W=w._accessibleDiv;let j=w.hitArea;const C=w.worldTransform;if(w.hitArea)W.style.left=`${(C.tx+j.x*C.a)*H}px`,W.style.top=`${(C.ty+j.y*C.d)*z}px`,W.style.width=`${j.width*C.a*H}px`,W.style.height=`${j.height*C.d*z}px`;else{if(j=w.getBounds(),this.capHitArea(j),W.style.left=`${j.x*H}px`,W.style.top=`${j.y*z}px`,W.style.width=`${j.width*H}px`,W.style.height=`${j.height*z}px`,W.title!==w.accessibleTitle&&w.accessibleTitle!==null)W.title=w.accessibleTitle;if(W.getAttribute("aria-label")!==w.accessibleHint&&w.accessibleHint!==null)W.setAttribute("aria-label",w.accessibleHint)}if(w.accessibleTitle!==W.title||w.tabIndex!==W.tabIndex){if(W.title=w.accessibleTitle,W.tabIndex=w.tabIndex,this.debug)this.updateDebugHTML(W)}}}this.renderId++}updateDebugHTML($){$.innerHTML=`type: ${$.type}</br> title : ${$.title}</br> tabIndex: ${$.tabIndex}`}capHitArea($){if($.x<0)$.width+=$.x,$.x=0;if($.y<0)$.height+=$.y,$.y=0;const{width:Z,height:J}=this.renderer;if($.x+$.width>Z)$.width=Z-$.x;if($.y+$.height>J)$.height=J-$.y}addChild($){let Z=this.pool.pop();if(!Z){if(Z=document.createElement("button"),Z.style.width=`${j9}px`,Z.style.height=`${j9}px`,Z.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",Z.style.position="absolute",Z.style.zIndex=Rq.toString(),Z.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome"))Z.setAttribute("aria-live","off");else Z.setAttribute("aria-live","polite");if(navigator.userAgent.match(/rv:.*Gecko\//))Z.setAttribute("aria-relevant","additions");else Z.setAttribute("aria-relevant","text");Z.addEventListener("click",this._onClick.bind(this)),Z.addEventListener("focus",this._onFocus.bind(this)),Z.addEventListener("focusout",this._onFocusOut.bind(this))}if(Z.style.pointerEvents=$.accessiblePointerEvents,Z.type=$.accessibleType,$.accessibleTitle&&$.accessibleTitle!==null)Z.title=$.accessibleTitle;else if(!$.accessibleHint||$.accessibleHint===null)Z.title=`displayObject ${$.tabIndex}`;if($.accessibleHint&&$.accessibleHint!==null)Z.setAttribute("aria-label",$.accessibleHint);if(this.debug)this.updateDebugHTML(Z);$._accessibleActive=!0,$._accessibleDiv=Z,Z.displayObject=$,this.children.push($),this.div.appendChild($._accessibleDiv),$._accessibleDiv.tabIndex=$.tabIndex}_dispatchEvent($,Z){const{displayObject:J}=$.target,Q=this.renderer.events.rootBoundary,K=Object.assign(new o7(Q),{target:J});Q.rootTarget=this.renderer.lastObjectRendered,Z.forEach((q)=>Q.dispatchEvent(K,q))}_onClick($){this._dispatchEvent($,["click","pointertap","tap"])}_onFocus($){if(!$.target.getAttribute("aria-live"))$.target.setAttribute("aria-live","assertive");this._dispatchEvent($,["mouseover"])}_onFocusOut($){if(!$.target.getAttribute("aria-live"))$.target.setAttribute("aria-live","polite");this._dispatchEvent($,["mouseout"])}_onKeyDown($){if($.keyCode!==Z2)return;this.activate()}_onMouseMove($){if($.movementX===0&&$.movementY===0)return;this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}C9.extension={name:"accessibility",type:[O.RendererPlugin,O.CanvasRendererPlugin]};_.add(C9);var QJ=class{constructor($){this.stage=new i,$=Object.assign({forceCanvas:!1},$),this.renderer=lZ($),QJ._plugins.forEach((Z)=>{Z.init.call(this,$)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy($,Z){const J=QJ._plugins.slice(0);J.reverse(),J.forEach((Q)=>{Q.destroy.call(this)}),this.stage.destroy(Z),this.stage=null,this.renderer.destroy($),this.renderer=null}},f8=QJ;f8._plugins=[];_.handleByList(O.Application,f8._plugins);class X9{static init($){Object.defineProperty(this,"resizeTo",{set(Z){if(globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=Z,Z)globalThis.addEventListener("resize",this.queueResize),this.resize()},get(){return this._resizeTo}}),this.queueResize=()=>{if(!this._resizeTo)return;this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize())},this.cancelResize=()=>{if(this._resizeId)cancelAnimationFrame(this._resizeId),this._resizeId=null},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let Z,J;if(this._resizeTo===globalThis.window)Z=globalThis.innerWidth,J=globalThis.innerHeight;else{const{clientWidth:Q,clientHeight:K}=this._resizeTo;Z=Q,J=K}this.renderer.resize(Z,J),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=$.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}X9.extension=O.Application;_.add(X9);var Mq={loader:O.LoadParser,resolver:O.ResolveParser,cache:O.CacheParser,detection:O.DetectionParser};_.handle(O.Asset,($)=>{const Z=$.ref;Object.entries(Mq).filter(([J])=>!!Z[J]).forEach(([J,Q])=>_.add(Object.assign(Z[J],{extension:Z[J].extension??Q})))},($)=>{const Z=$.ref;Object.keys(Mq).filter((J)=>!!Z[J]).forEach((J)=>_.remove(Z[J]))});class KJ{constructor($,Z=!1){this._loader=$,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=Z}add($){if($.forEach((Z)=>{this._assetList.push(Z)}),this.verbose)console.log("[BackgroundLoader] assets: ",this._assetList);if(this._isActive&&!this._isLoading)this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const $=[],Z=Math.min(this._assetList.length,this._maxConcurrent);for(let J=0;J<Z;J++)$.push(this._assetList.pop());await this._loader.load($),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active($){if(this._isActive===$)return;if(this._isActive=$,$&&!this._isLoading)this._next()}}var G7=function($,Z){if(Array.isArray(Z)){for(let J of Z)if($.startsWith(`data:${J}`))return!0;return!1}return $.startsWith(`data:${Z}`)};var y0=function($,Z){const J=$.split("?")[0],Q=A.path.extname(J).toLowerCase();if(Array.isArray(Z))return Z.includes(Q);return Q===Z};var d0=($,Z)=>{if(!Array.isArray($))$=[$];if(!Z)return $;return $.map((J)=>{if(typeof J==="string")return Z(J);return J})};var l$=($,Z)=>{const J=Z.split("?")[1];if(J)$+=`?${J}`;return $};var Dq=function($,Z,J,Q,K){const q=Z[J];for(let V=0;V<q.length;V++){const U=q[V];if(J<Z.length-1)Dq($.replace(Q[J],U),Z,J+1,Q,K);else K.push($.replace(Q[J],U))}},G9=function($){const Z=/\{(.*?)\}/g,J=$.match(Z),Q=[];if(J){const K=[];J.forEach((q)=>{const V=q.substring(1,q.length-1).split(",");K.push(V)}),Dq($,K,0,J,Q)}else Q.push($);return Q};var i7=($)=>!Array.isArray($);class Aq{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has($){return this._cache.has($)}get($){const Z=this._cache.get($);if(!Z)console.warn(`[Assets] Asset id ${$} was not found in the Cache`);return Z}set($,Z){const J=d0($);let Q;for(let V=0;V<this.parsers.length;V++){const U=this.parsers[V];if(U.test(Z)){Q=U.getCacheableAssets(J,Z);break}}if(!Q)Q={},J.forEach((V)=>{Q[V]=Z});const K=Object.keys(Q),q={cacheKeys:K,keys:J};if(J.forEach((V)=>{this._cacheMap.set(V,q)}),K.forEach((V)=>{if(this._cache.has(V)&&this._cache.get(V)!==Z)console.warn("[Cache] already has key:",V);this._cache.set(V,Q[V])}),Z instanceof S){const V=Z;J.forEach((U)=>{if(V.baseTexture!==S.EMPTY.baseTexture)p.addToCache(V.baseTexture,U);S.addToCache(V,U)})}}remove($){if(this._cacheMap.get($),!this._cacheMap.has($)){console.warn(`[Assets] Asset id ${$} was not found in the Cache`);return}const Z=this._cacheMap.get($);Z.cacheKeys.forEach((Q)=>{this._cache.delete(Q)}),Z.keys.forEach((Q)=>{this._cacheMap.delete(Q)})}get parsers(){return this._parsers}}var w$=new Aq;class qJ{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:($,Z,J)=>{return this._parsersValidated=!1,$[Z]=J,!0}}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser($,Z){const J={promise:null,parser:null};return J.promise=(async()=>{let Q=null,K=null;if(Z.loadParser){if(K=this._parserHash[Z.loadParser],!K)console.warn(`[Assets] specified load parser "${Z.loadParser}" not found while loading ${$}`)}if(!K){for(let q=0;q<this.parsers.length;q++){const V=this.parsers[q];if(V.load&&V.test?.($,Z,this)){K=V;break}}if(!K)return console.warn(`[Assets] ${$} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}Q=await K.load($,Z,this),J.parser=K;for(let q=0;q<this.parsers.length;q++){const V=this.parsers[q];if(V.parse){if(V.parse&&await V.testParse?.(Q,Z,this))Q=await V.parse(Q,Z,this)||Q,J.parser=V}}return Q})(),J}async load($,Z){if(!this._parsersValidated)this._validateParsers();let J=0;const Q={},K=i7($),q=d0($,(H)=>({src:H})),V=q.length,U=q.map(async(H)=>{const z=A.path.toAbsolute(H.src);if(!Q[H.src])try{if(!this.promiseCache[z])this.promiseCache[z]=this._getLoadPromiseAndParser(z,H);if(Q[H.src]=await this.promiseCache[z].promise,Z)Z(++J/V)}catch(W){throw delete this.promiseCache[z],delete Q[H.src],new Error(`[Loader.load] Failed to load ${z}.
${W}`)}});return await Promise.all(U),K?Q[q[0].src]:Q}async unload($){const J=d0($,(Q)=>({src:Q})).map(async(Q)=>{const K=A.path.toAbsolute(Q.src),q=this.promiseCache[K];if(q){const V=await q.promise;q.parser?.unload?.(V,Q,this),delete this.promiseCache[K]}});await Promise.all(J)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(($)=>$.name).reduce(($,Z)=>{if($[Z.name])console.warn(`[Assets] loadParser name conflict "${Z.name}"`);return{...$,[Z.name]:Z}},{})}}var L0=(($)=>{return $[$.Low=0]="Low",$[$.Normal=1]="Normal",$[$.High=2]="High",$})(L0||{});var U2=".json",H2="application/json",VJ={extension:{type:O.LoadParser,priority:L0.Low},name:"loadJson",test($){return G7($,H2)||y0($,U2)},async load($){return await(await I.ADAPTER.fetch($)).json()}};_.add(VJ);var z2=".txt",W2="text/plain",UJ={name:"loadTxt",extension:{type:O.LoadParser,priority:L0.Low},test($){return G7($,W2)||y0($,z2)},async load($){return await(await I.ADAPTER.fetch($)).text()}};_.add(UJ);var HJ=function($){const Z=A.path.extname($),K=A.path.basename($,Z).replace(/(-|_)/g," ").toLowerCase().split(" ").map((U)=>U.charAt(0).toUpperCase()+U.slice(1));let q=K.length>0;for(let U of K)if(!U.match(C2)){q=!1;break}let V=K.join(" ");if(!q)V=`"${V.replace(/[\\"]/g,"\\$&")}"`;return V},Y2=["normal","bold","100","200","300","400","500","600","700","800","900"],w2=[".ttf",".otf",".woff",".woff2"],j2=["font/ttf","font/otf","font/woff","font/woff2"],C2=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,zJ={extension:{type:O.LoadParser,priority:L0.Low},name:"loadWebFont",test($){return G7($,j2)||y0($,w2)},async load($,Z){const J=I.ADAPTER.getFontFaceSet();if(J){const Q=[],K=Z.data?.family??HJ($),q=Z.data?.weights?.filter((U)=>Y2.includes(U))??["normal"],V=Z.data??{};for(let U=0;U<q.length;U++){const H=q[U],z=new FontFace(K,`url(${encodeURI($)})`,{...V,weight:H});await z.load(),J.add(z),Q.push(z)}return Q.length===1?Q[0]:Q}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload($){(Array.isArray($)?$:[$]).forEach((Z)=>I.ADAPTER.getFontFaceSet().delete(Z))}};_.add(zJ);var Eq=0,WJ,X2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",G2={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${X2}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},N2={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`},YJ;class bq{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){if(this._isImageBitmapSupported!==void 0)return this._isImageBitmapSupported;return this._isImageBitmapSupported=new Promise(($)=>{const Z=URL.createObjectURL(new Blob([G2.code],{type:"application/javascript"})),J=new Worker(Z);J.addEventListener("message",(Q)=>{J.terminate(),URL.revokeObjectURL(Z),$(Q.data)})}),this._isImageBitmapSupported}loadImageBitmap($){return this._run("loadImageBitmap",[$])}async _initWorkers(){if(this._initialized)return;this._initialized=!0}getWorker(){if(WJ===void 0)WJ=navigator.hardwareConcurrency||4;let $=this.workerPool.pop();if(!$&&this._createdWorkers<WJ){if(!YJ)YJ=URL.createObjectURL(new Blob([N2.code],{type:"application/javascript"}));this._createdWorkers++,$=new Worker(YJ),$.addEventListener("message",(Z)=>{this.complete(Z.data),this.returnWorker(Z.target),this.next()})}return $}returnWorker($){this.workerPool.push($)}complete($){if($.error!==void 0)this.resolveHash[$.uuid].reject($.error);else this.resolveHash[$.uuid].resolve($.data);this.resolveHash[$.uuid]=null}async _run($,Z){await this._initWorkers();const J=new Promise((Q,K)=>{this.queue.push({id:$,arguments:Z,resolve:Q,reject:K})});return this.next(),J}next(){if(!this.queue.length)return;const $=this.getWorker();if(!$)return;const Z=this.queue.pop(),J=Z.id;this.resolveHash[Eq]={resolve:Z.resolve,reject:Z.reject},$.postMessage({data:Z.arguments,uuid:Eq++,id:J})}}var wJ=new bq;var T7=function($,Z,J){const Q=new S($);return Q.baseTexture.on("dispose",()=>{delete Z.promiseCache[J]}),Q};async function jJ($){const Z=await I.ADAPTER.fetch($);if(!Z.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${$}: ${Z.status} ${Z.statusText}`);const J=await Z.blob();return await createImageBitmap(J)}var L2=[".jpeg",".jpg",".png",".webp",".avif"],B2=["image/jpeg","image/png","image/webp","image/avif"],a7={name:"loadTextures",extension:{type:O.LoadParser,priority:L0.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test($){return G7($,B2)||y0($,L2)},async load($,Z,J){let Q=null;if(globalThis.createImageBitmap&&this.config.preferCreateImageBitmap)if(this.config.preferWorkers&&await wJ.isImageBitmapSupported())Q=await wJ.loadImageBitmap($);else Q=await jJ($);else Q=await new Promise((q)=>{if(Q=new Image,Q.crossOrigin=this.config.crossOrigin,Q.src=$,Q.complete)q(Q);else Q.onload=()=>{q(Q)}});const K=new p(Q,{resolution:A.getResolutionOfUrl($),...Z.data});return K.resource.src=$,T7(K,J,$)},unload($){$.destroy(!0)}};_.add(a7);var P2=".svg",F2="image/svg+xml",CJ={extension:{type:O.LoadParser,priority:L0.High},name:"loadSVG",test($){return G7($,F2)||y0($,P2)},async testParse($){return l7.test($)},async parse($,Z,J){const Q=new l7($,Z?.data?.resourceOptions);await Q.load();const K=new p(Q,{resolution:A.getResolutionOfUrl($),...Z?.data});return K.resource.src=$,T7(K,J,$)},async load($,Z){return(await I.ADAPTER.fetch($)).text()},unload:a7.unload};_.add(CJ);class XJ{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:($,Z)=>`${$}${this._bundleIdConnector}${Z}`,extractAssetIdFromBundle:($,Z)=>Z.replace(`${$}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier($){if(this._bundleIdConnector=$.connector??this._bundleIdConnector,this._createBundleAssetId=$.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=$.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...$){$.forEach((Z)=>{if(this._preferredOrder.push(Z),!Z.priority)Z.priority=Object.keys(Z.params)}),this._resolverHash={}}set basePath($){this._basePath=$}get basePath(){return this._basePath}set rootPath($){this._rootPath=$}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams($){if(typeof $==="string")this._defaultSearchParams=$;else{const Z=$;this._defaultSearchParams=Object.keys(Z).map((J)=>`${encodeURIComponent(J)}=${encodeURIComponent(Z[J])}`).join("&")}}addManifest($){if(this._manifest)console.warn("[Resolver] Manifest already exists, this will be overwritten");this._manifest=$,$.bundles.forEach((Z)=>{this.addBundle(Z.name,Z.assets)})}addBundle($,Z){const J=[];if(Array.isArray(Z))Z.forEach((Q)=>{if(typeof Q.name==="string"){const K=this._createBundleAssetId($,Q.name);J.push(K),this.add([Q.name,K],Q.srcs,Q.data)}else{const K=Q.name.map((q)=>this._createBundleAssetId($,q));K.forEach((q)=>{J.push(q)}),this.add([...Q.name,...K],Q.srcs)}});else Object.keys(Z).forEach((Q)=>{J.push(this._createBundleAssetId($,Q)),this.add([Q,this._createBundleAssetId($,Q)],Z[Q])});this._bundles[$]=J}add($,Z,J){const Q=d0($);if(Q.forEach((q)=>{if(this.hasKey(q))console.warn(`[Resolver] already has key: ${q} overwriting`)}),!Array.isArray(Z))if(typeof Z==="string")Z=G9(Z);else Z=[Z];const K=Z.map((q)=>{let V=q;if(typeof q==="string"){let U=!1;for(let H=0;H<this._parsers.length;H++){const z=this._parsers[H];if(z.test(q)){V=z.parse(q),U=!0;break}}if(!U)V={src:q}}if(!V.format)V.format=V.src.split(".").pop();if(!V.alias)V.alias=Q;if(this._basePath||this._rootPath)V.src=A.path.toAbsolute(V.src,this._basePath,this._rootPath);return V.src=this._appendDefaultSearchParams(V.src),V.data=V.data??J,V});Q.forEach((q)=>{this._assetMap[q]=K})}resolveBundle($){const Z=i7($);$=d0($);const J={};return $.forEach((Q)=>{const K=this._bundles[Q];if(K){const q=this.resolve(K),V={};for(let U in q){const H=q[U];V[this._extractAssetIdFromBundle(Q,U)]=H}J[Q]=V}}),Z?J[$[0]]:J}resolveUrl($){const Z=this.resolve($);if(typeof $!=="string"){const J={};for(let Q in Z)J[Q]=Z[Q].src;return J}return Z.src}resolve($){const Z=i7($);$=d0($);const J={};return $.forEach((Q)=>{if(!this._resolverHash[Q])if(this._assetMap[Q]){let K=this._assetMap[Q];const q=this._getPreferredOrder(K),V=K[0];q?.priority.forEach((U)=>{q.params[U].forEach((H)=>{const z=K.filter((W)=>{if(W[U])return W[U]===H;return!1});if(z.length)K=z})}),this._resolverHash[Q]=K[0]??V}else{let K=Q;if(this._basePath||this._rootPath)K=A.path.toAbsolute(K,this._basePath,this._rootPath);K=this._appendDefaultSearchParams(K),this._resolverHash[Q]={src:K}}J[Q]=this._resolverHash[Q]}),Z?J[$[0]]:J}hasKey($){return!!this._assetMap[$]}hasBundle($){return!!this._bundles[$]}_getPreferredOrder($){for(let Z=0;Z<$.length;Z++){const J=$[0],Q=this._preferredOrder.find((K)=>K.params.format.includes(J.format));if(Q)return Q}return this._preferredOrder[0]}_appendDefaultSearchParams($){if(!this._defaultSearchParams)return $;const Z=/\?/.test($)?"&":"?";return`${$}${Z}${this._defaultSearchParams}`}}class GJ{constructor(){this._detections=[],this._initialized=!1,this.resolver=new XJ,this.loader=new qJ,this.cache=w$,this._backgroundLoader=new KJ(this.loader),this._backgroundLoader.active=!0,this.reset()}async init($={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,$.defaultSearchParams)this.resolver.setDefaultSearchParams($.defaultSearchParams);if($.basePath)this.resolver.basePath=$.basePath;if($.bundleIdentifier)this.resolver.setBundleIdentifier($.bundleIdentifier);if($.manifest){let K=$.manifest;if(typeof K==="string")K=await this.load(K);this.resolver.addManifest(K)}const Z=$.texturePreference?.resolution??1,J=typeof Z==="number"?[Z]:Z;let Q=[];if($.texturePreference?.format){const K=$.texturePreference?.format;Q=typeof K==="string"?[K]:K;for(let q of this._detections)if(!await q.test())Q=await q.remove(Q)}else for(let K of this._detections)if(await K.test())Q=await K.add(Q);if(this.resolver.prefer({params:{format:Q,resolution:J}}),$.preferences)this.setPreferences($.preferences)}add($,Z,J){this.resolver.add($,Z,J)}async load($,Z){if(!this._initialized)await this.init();const J=i7($),Q=d0($).map((V)=>{if(typeof V!=="string")return this.resolver.add(V.src,V),V.src;if(!this.resolver.hasKey(V))this.resolver.add(V,V);return V}),K=this.resolver.resolve(Q),q=await this._mapLoadToResolve(K,Z);return J?q[Q[0]]:q}addBundle($,Z){this.resolver.addBundle($,Z)}async loadBundle($,Z){if(!this._initialized)await this.init();let J=!1;if(typeof $==="string")J=!0,$=[$];const Q=this.resolver.resolveBundle($),K={},q=Object.keys(Q);let V=0,U=0;const H=()=>{Z?.(++V/U)},z=q.map((W)=>{const Y=Q[W];return U+=Object.keys(Y).length,this._mapLoadToResolve(Y,H).then((w)=>{K[W]=w})});return await Promise.all(z),J?K[$[0]]:K}async backgroundLoad($){if(!this._initialized)await this.init();if(typeof $==="string")$=[$];const Z=this.resolver.resolve($);this._backgroundLoader.add(Object.values(Z))}async backgroundLoadBundle($){if(!this._initialized)await this.init();if(typeof $==="string")$=[$];const Z=this.resolver.resolveBundle($);Object.values(Z).forEach((J)=>{this._backgroundLoader.add(Object.values(J))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get($){if(typeof $==="string")return w$.get($);const Z={};for(let J=0;J<$.length;J++)Z[J]=w$.get($[J]);return Z}async _mapLoadToResolve($,Z){const J=Object.values($),Q=Object.keys($);this._backgroundLoader.active=!1;const K=await this.loader.load(J,Z);this._backgroundLoader.active=!0;const q={};return J.forEach((V,U)=>{const H=K[V.src],z=[V.src];if(V.alias)z.push(...V.alias);q[Q[U]]=H,w$.set(z,H)}),q}async unload($){if(!this._initialized)await this.init();const Z=d0($).map((Q)=>typeof Q!=="string"?Q.src:Q),J=this.resolver.resolve(Z);await this._unloadFromResolved(J)}async unloadBundle($){if(!this._initialized)await this.init();$=d0($);const Z=this.resolver.resolveBundle($),J=Object.keys(Z).map((Q)=>this._unloadFromResolved(Z[Q]));await Promise.all(J)}async _unloadFromResolved($){const Z=Object.values($);Z.forEach((J)=>{w$.remove(J.src)}),await this.loader.unload(Z)}get detections(){return this._detections}get preferWorkers(){return a7.config.preferWorkers}set preferWorkers($){A.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:$})}setPreferences($){this.loader.parsers.forEach((Z)=>{if(!Z.config)return;Object.keys(Z.config).filter((J)=>(J in $)).forEach((J)=>{Z.config[J]=$[J]})})}}var h7=new GJ;_.handleByList(O.LoadParser,h7.loader.parsers).handleByList(O.ResolveParser,h7.resolver.parsers).handleByList(O.CacheParser,h7.cache.parsers).handleByList(O.DetectionParser,h7.detections);var NJ={extension:O.CacheParser,test:($)=>Array.isArray($)&&$.every((Z)=>Z instanceof S),getCacheableAssets:($,Z)=>{const J={};return $.forEach((Q)=>{Z.forEach((K,q)=>{J[Q+(q===0?"":q+1)]=K})}),J}};_.add(NJ);var LJ={extension:{type:O.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const $="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",Z=await I.ADAPTER.fetch($).then((J)=>J.blob());return createImageBitmap(Z).then(()=>!0,()=>!1)},add:async($)=>[...$,"avif"],remove:async($)=>$.filter((Z)=>Z!=="avif")};_.add(LJ);var BJ={extension:{type:O.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const $="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",Z=await I.ADAPTER.fetch($).then((J)=>J.blob());return createImageBitmap(Z).then(()=>!0,()=>!1)},add:async($)=>[...$,"webp"],remove:async($)=>$.filter((Z)=>Z!=="webp")};_.add(BJ);var vq=["png","jpg","jpeg"],PJ={extension:{type:O.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async($)=>[...$,...vq],remove:async($)=>$.filter((Z)=>!vq.includes(Z))};_.add(PJ);var FJ={extension:O.ResolveParser,test:a7.test,parse:($)=>({resolution:parseFloat(I.RETINA_PREFIX.exec($)?.[1]??"1"),format:$.split(".").pop(),src:$})};_.add(FJ);var l0=(($)=>{return $[$.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",$[$.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",$[$.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",$[$.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",$[$.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",$[$.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",$[$.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",$[$.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",$[$.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",$[$.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",$[$.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",$[$.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",$[$.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",$[$.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",$[$.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",$[$.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",$[$.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",$[$.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",$[$.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",$[$.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",$[$.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",$[$.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",$[$.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",$[$.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",$[$.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",$[$.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",$[$.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",$})(l0||{}),j$={[33776]:0.5,[33777]:0.5,[33778]:1,[33779]:1,[35916]:0.5,[35917]:0.5,[35918]:1,[35919]:1,[37488]:0.5,[37489]:0.5,[37490]:1,[37491]:1,[37492]:0.5,[37496]:1,[37493]:0.5,[37497]:1,[37494]:0.5,[37495]:0.5,[35840]:0.5,[35842]:0.5,[35841]:0.25,[35843]:0.25,[36196]:0.5,[35986]:0.5,[35986]:1,[34798]:1,[37808]:1};var Sq=function(){P6={s3tc:r7.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:r7.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:r7.getExtension("WEBGL_compressed_texture_etc"),etc1:r7.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:r7.getExtension("WEBGL_compressed_texture_pvrtc")||r7.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:r7.getExtension("WEBGL_compressed_texture_atc"),astc:r7.getExtension("WEBGL_compressed_texture_astc")}},r7,P6,IJ={extension:{type:O.DetectionParser,priority:2},test:async()=>{const Z=I.ADAPTER.createCanvas().getContext("webgl");if(!Z)return console.warn("WebGL not available for compressed textures."),!1;return r7=Z,!0},add:async($)=>{if(!P6)Sq();const Z=[];for(let J in P6){if(!P6[J])continue;Z.push(J)}return[...Z,...$]},remove:async($)=>{if(!P6)Sq();return $.filter((Z)=>!(Z in P6))}};_.add(IJ);class g8 extends J7{constructor($,Z={width:1,height:1,autoLoad:!0}){let J,Q;if(typeof $==="string")J=$,Q=new Uint8Array;else J=null,Q=$;super(Q,Z);if(this.origin=J,this.buffer=Q?new E$(Q):null,this._load=null,this.loaded=!1,this.origin!==null&&Z.autoLoad!==!1)this.load();if(this.origin===null&&this.buffer)this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData)}onBlobLoaded($){}load(){if(this._load)return this._load;return this._load=fetch(this.origin).then(($)=>$.blob()).then(($)=>$.arrayBuffer()).then(($)=>{return this.data=new Uint32Array($),this.buffer=new E$($),this.loaded=!0,this.onBlobLoaded($),this.update(),this}),this._load}}class R7 extends g8{constructor($,Z){super($,Z);if(this.format=Z.format,this.levels=Z.levels||1,this._width=Z.width,this._height=Z.height,this._extension=R7._formatToExtension(this.format),Z.levelBuffers||this.buffer)this._levelBuffers=Z.levelBuffers||R7._createLevelBuffers($ instanceof Uint8Array?$:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}upload($,Z,J){const Q=$.gl;if(!$.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let q=0,V=this.levels;q<V;q++){const{levelID:U,levelWidth:H,levelHeight:z,levelBuffer:W}=this._levelBuffers[q];Q.compressedTexImage2D(Q.TEXTURE_2D,U,this.format,H,z,0,W)}return!0}onBlobLoaded(){this._levelBuffers=R7._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension($){if($>=33776&&$<=33779)return"s3tc";else if($>=37488&&$<=37497)return"etc";else if($>=35840&&$<=35843)return"pvrtc";else if($>=36196)return"etc1";else if($>=35986&&$<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers($,Z,J,Q,K,q,V){const U=new Array(J);let H=$.byteOffset,z=q,W=V,Y=z+Q-1&~(Q-1),w=W+K-1&~(K-1),j=Y*w*j$[Z];for(let C=0;C<J;C++)U[C]={levelID:C,levelWidth:J>1?z:Y,levelHeight:J>1?W:w,levelBuffer:new Uint8Array($.buffer,H,j)},H+=j,z=z>>1||1,W=W>>1||1,Y=z+Q-1&~(Q-1),w=W+K-1&~(K-1),j=Y*w*j$[Z];return U}}var P9=function($){const Z=new Uint32Array($);if(Z[0]!==k2)throw new Error("Invalid DDS file magic word");const Q=new Uint32Array($,0,N9/Uint32Array.BYTES_PER_ELEMENT),K=Q[L9.HEIGHT],q=Q[L9.WIDTH],V=Q[L9.MIPMAP_COUNT],U=new Uint32Array($,L9.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,I2/Uint32Array.BYTES_PER_ELEMENT),H=U[R2];if(H&M2){const z=U[O2.FOURCC];if(z!==T2){const N=y2[z],B=kJ+N9,T=new Uint8Array($,B);return[new R7(T,{format:N,width:q,height:K,levels:V})]}const W=kJ+N9,Y=new Uint32Array(Z.buffer,W,Tq/Uint32Array.BYTES_PER_ELEMENT),w=Y[B9.DXGI_FORMAT],j=Y[B9.RESOURCE_DIMENSION],C=Y[B9.MISC_FLAG],X=Y[B9.ARRAY_SIZE],G=f2[w];if(G===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${w}`);if(C===h2)throw new Error("DDSParser does not support cubemap textures");if(j===6)throw new Error("DDSParser does not supported 3D texture data");const F=new Array,L=kJ+N9+Tq;if(X===1)F.push(new Uint8Array($,L));else{const N=j$[G];let B=0,T=q,x=K;for(let v=0;v<V;v++){const s=Math.max(1,T+3&~3),E=Math.max(1,x+3&~3),h=s*E*N;B+=h,T=T>>>1,x=x>>>1}let k=L;for(let v=0;v<X;v++)F.push(new Uint8Array($,k,B)),k+=B}return F.map((N)=>new R7(N,{format:G,width:q,height:K,levels:V}))}if(H&D2)throw new Error("DDSParser does not support uncompressed texture data.");if(H&A2)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(H&E2)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(H&_2)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")},kJ=4,N9=124,I2=32,Tq=20,k2=542327876,L9={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},O2={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},B9={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};var R2=1,_2=2,M2=4,D2=64,A2=512,E2=131072,b2=827611204,v2=861165636,S2=894720068,T2=808540228,h2=4,y2={[b2]:l0.COMPRESSED_RGBA_S3TC_DXT1_EXT,[v2]:l0.COMPRESSED_RGBA_S3TC_DXT3_EXT,[S2]:l0.COMPRESSED_RGBA_S3TC_DXT5_EXT},f2={[70]:l0.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:l0.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:l0.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:l0.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:l0.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:l0.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:l0.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:l0.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:l0.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};var I9=function($,Z,J=!1){const Q=new DataView(Z);if(!x2($,Q))return null;const K=Q.getUint32(_7.ENDIANNESS,!0)===g2,q=Q.getUint32(_7.GL_TYPE,K),V=Q.getUint32(_7.GL_FORMAT,K),U=Q.getUint32(_7.GL_INTERNAL_FORMAT,K),H=Q.getUint32(_7.PIXEL_WIDTH,K),z=Q.getUint32(_7.PIXEL_HEIGHT,K)||1,W=Q.getUint32(_7.PIXEL_DEPTH,K)||1,Y=Q.getUint32(_7.NUMBER_OF_ARRAY_ELEMENTS,K)||1,w=Q.getUint32(_7.NUMBER_OF_FACES,K),j=Q.getUint32(_7.NUMBER_OF_MIPMAP_LEVELS,K),C=Q.getUint32(_7.BYTES_OF_KEY_VALUE_DATA,K);if(z===0||W!==1)throw new Error("Only 2D textures are supported");if(w!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(Y!==1)throw new Error("WebGL does not support array textures");const X=4,G=4,F=H+3&~3,L=z+3&~3,N=new Array(Y);let B=H*z;if(q===0)B=F*L;let T;if(q!==0)if(F9[q])T=F9[q]*RJ[V];else T=_J[q];else T=j$[U];if(T===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=J?c2(Q,C,K):null;let v=B*T,s=H,E=z,h=F,Q0=L,M=OJ+C;for(let D=0;D<j;D++){const V0=Q.getUint32(M,K);let e=M+4;for(let $0=0;$0<Y;$0++){let w0=N[$0];if(!w0)w0=N[$0]=new Array(j);w0[D]={levelID:D,levelWidth:j>1||q!==0?s:h,levelHeight:j>1||q!==0?E:Q0,levelBuffer:new Uint8Array(Z,e,v)},e+=v}M+=V0+4,M=M%4!==0?M+4-M%4:M,s=s>>1||1,E=E>>1||1,h=s+X-1&~(X-1),Q0=E+G-1&~(G-1),v=h*Q0*T}if(q!==0)return{uncompressed:N.map((D)=>{let V0=D[0].levelBuffer,e=!1;if(q===l.FLOAT)V0=new Float32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4);else if(q===l.UNSIGNED_INT)e=!0,V0=new Uint32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4);else if(q===l.INT)e=!0,V0=new Int32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4);return{resource:new J7(V0,{width:D[0].levelWidth,height:D[0].levelHeight}),type:q,format:e?m2(V):V}}),kvData:x};return{compressed:N.map((D)=>new R7(null,{format:U,width:H,height:z,levels:j,levelBuffers:D})),kvData:x}},x2=function($,Z){for(let J=0;J<hq.length;J++)if(Z.getUint8(J)!==hq[J])return console.error(`${$} is not a valid *.ktx file!`),!1;return!0},m2=function($){switch($){case b.RGBA:return b.RGBA_INTEGER;case b.RGB:return b.RGB_INTEGER;case b.RG:return b.RG_INTEGER;case b.RED:return b.RED_INTEGER;default:return $}},c2=function($,Z,J){const Q=new Map;let K=0;while(K<Z){const q=$.getUint32(OJ+K,J),V=OJ+K+4,U=3-(q+3)%4;if(q===0||q>Z-K){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let H=0;for(;H<q;H++)if($.getUint8(V+H)===0)break;if(H===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const z=(new TextDecoder()).decode(new Uint8Array($.buffer,V,H)),W=new DataView($.buffer,V+H+1,q-H-1);Q.set(z,W),K+=4+q+U}return Q},hq=[171,75,84,88,32,49,49,187,13,10,26,10],g2=67305985,_7={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},OJ=64,F9={[l.UNSIGNED_BYTE]:1,[l.UNSIGNED_SHORT]:2,[l.INT]:4,[l.UNSIGNED_INT]:4,[l.FLOAT]:4,[l.HALF_FLOAT]:8},RJ={[b.RGBA]:4,[b.RGB]:3,[b.RG]:2,[b.RED]:1,[b.LUMINANCE]:1,[b.LUMINANCE_ALPHA]:2,[b.ALPHA]:1},_J={[l.UNSIGNED_SHORT_4_4_4_4]:2,[l.UNSIGNED_SHORT_5_5_5_1]:2,[l.UNSIGNED_SHORT_5_6_5]:2};var MJ={extension:{type:O.LoadParser,priority:L0.High},name:"loadDDS",test($){return y0($,".dds")},async load($,Z,J){const K=await(await I.ADAPTER.fetch($)).arrayBuffer(),V=P9(K).map((U)=>{const H=new p(U,{mipmap:D0.OFF,alphaMode:P0.NO_PREMULTIPLIED_ALPHA,resolution:A.getResolutionOfUrl($),...Z.data});return T7(H,J,$)});return V.length===1?V[0]:V},unload($){if(Array.isArray($))$.forEach((Z)=>Z.destroy(!0));else $.destroy(!0)}};_.add(MJ);var DJ={extension:{type:O.LoadParser,priority:L0.High},name:"loadKTX",test($){return y0($,".ktx")},async load($,Z,J){const K=await(await I.ADAPTER.fetch($)).arrayBuffer(),{compressed:q,uncompressed:V,kvData:U}=I9($,K),H=q??V,z={mipmap:D0.OFF,alphaMode:P0.NO_PREMULTIPLIED_ALPHA,resolution:A.getResolutionOfUrl($),...Z.data},W=H.map((Y)=>{if(H===V)Object.assign(z,{type:Y.type,format:Y.format});const w=new p(Y,z);return w.ktxKeyValueData=U,T7(w,J,$)});return W.length===1?W[0]:W},unload($){if(Array.isArray($))$.forEach((Z)=>Z.destroy(!0));else $.destroy(!0)}};_.add(DJ);var AJ={extension:O.ResolveParser,test:($)=>{const J=$.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(J)},parse:($)=>{if($.split("?")[0].split(".").pop()==="ktx"){const Q=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(Q.some((K)=>$.endsWith(K)))return{resolution:parseFloat(I.RETINA_PREFIX.exec($)?.[1]??"1"),format:Q.find((K)=>$.endsWith(K)),src:$}}return{resolution:parseFloat(I.RETINA_PREFIX.exec($)?.[1]??"1"),format:$.split(".").pop(),src:$}}};_.add(AJ);var p2=new c,u2=4,x8=class{constructor($){this.renderer=$}async image($,Z,J){const Q=new Image;return Q.src=await this.base64($,Z,J),Q}async base64($,Z,J){const Q=this.canvas($);if(Q.toBlob!==void 0)return new Promise((K,q)=>{Q.toBlob((V)=>{if(!V){q(new Error("ICanvas.toBlob failed!"));return}const U=new FileReader;U.onload=()=>K(U.result),U.onerror=q,U.readAsDataURL(V)},Z,J)});if(Q.toDataURL!==void 0)return Q.toDataURL(Z,J);if(Q.convertToBlob!==void 0){const K=await Q.convertToBlob({type:Z,quality:J});return new Promise((q,V)=>{const U=new FileReader;U.onload=()=>q(U.result),U.onerror=V,U.readAsDataURL(K)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas($,Z){const{pixels:J,width:Q,height:K,flipY:q}=this._rawPixels($,Z);if(q)x8._flipY(J,Q,K);x8._unpremultiplyAlpha(J);const V=new A.CanvasRenderTarget(Q,K,1),U=new ImageData(new Uint8ClampedArray(J.buffer),Q,K);return V.context.putImageData(U,0,0),V.canvas}pixels($,Z){const{pixels:J,width:Q,height:K,flipY:q}=this._rawPixels($,Z);if(q)x8._flipY(J,Q,K);return x8._unpremultiplyAlpha(J),J}_rawPixels($,Z){const J=this.renderer;if(!J)throw new Error("The Extract has already been destroyed");let Q,K=!1,q,V=!1;if($)if($ instanceof X7)q=$;else q=J.generateTexture($,{resolution:J.resolution,multisample:J.multisample}),V=!0;if(q){if(Q=q.baseTexture.resolution,Z=Z??q.frame,K=!1,!V){J.renderTexture.bind(q);const Y=q.framebuffer.glFramebuffers[J.CONTEXT_UID];if(Y.blitFramebuffer)J.framebuffer.bind(Y.blitFramebuffer)}}else{if(Q=J.resolution,!Z)Z=p2,Z.width=J.width/Q,Z.height=J.height/Q;K=!0,J.renderTexture.bind()}const U=Math.round(Z.width*Q),H=Math.round(Z.height*Q),z=new Uint8Array(u2*U*H),W=J.gl;if(W.readPixels(Math.round(Z.x*Q),Math.round(Z.y*Q),U,H,W.RGBA,W.UNSIGNED_BYTE,z),V)q?.destroy(!0);return{pixels:z,width:U,height:H,flipY:K}}destroy(){this.renderer=null}static _flipY($,Z,J){const Q=Z<<2,K=J>>1,q=new Uint8Array(Q);for(let V=0;V<K;V++){const U=V*Q,H=(J-V-1)*Q;q.set($.subarray(U,U+Q)),$.copyWithin(U,H,H+Q),$.set(q,H)}}static _unpremultiplyAlpha($){if($ instanceof Uint8ClampedArray)$=new Uint8Array($.buffer);const Z=$.length;for(let J=0;J<Z;J+=4){const Q=$[J+3];if(Q!==0){const K=255.001/Q;$[J]=$[J]*K+0.5,$[J+1]=$[J+1]*K+0.5,$[J+2]=$[J+2]*K+0.5}}}},EJ=x8;EJ.extension={name:"extract",type:O.RendererSystem};_.add(EJ);var C$={build($){const Z=$.points;let J,Q,K,q,V,U;if($.type===j0.CIRC){const C=$.shape;J=C.x,Q=C.y,V=U=C.radius,K=q=0}else if($.type===j0.ELIP){const C=$.shape;J=C.x,Q=C.y,V=C.width,U=C.height,K=q=0}else{const C=$.shape,X=C.width/2,G=C.height/2;J=C.x+X,Q=C.y+G,V=U=Math.max(0,Math.min(C.radius,Math.min(X,G))),K=X-V,q=G-U}if(!(V>=0&&U>=0&&K>=0&&q>=0)){Z.length=0;return}const H=Math.ceil(2.3*Math.sqrt(V+U)),z=H*8+(K?4:0)+(q?4:0);if(Z.length=z,z===0)return;if(H===0){Z.length=8,Z[0]=Z[6]=J+K,Z[1]=Z[3]=Q+q,Z[2]=Z[4]=J-K,Z[5]=Z[7]=Q-q;return}let W=0,Y=H*4+(K?2:0)+2,w=Y,j=z;{const C=K+V,X=q,G=J+C,F=J-C,L=Q+X;if(Z[W++]=G,Z[W++]=L,Z[--Y]=L,Z[--Y]=F,q){const N=Q-X;Z[w++]=F,Z[w++]=N,Z[--j]=N,Z[--j]=G}}for(let C=1;C<H;C++){const X=Math.PI/2*(C/H),G=K+Math.cos(X)*V,F=q+Math.sin(X)*U,L=J+G,N=J-G,B=Q+F,T=Q-F;Z[W++]=L,Z[W++]=B,Z[--Y]=B,Z[--Y]=N,Z[w++]=N,Z[w++]=T,Z[--j]=T,Z[--j]=L}{const C=K,X=q+U,G=J+C,F=J-C,L=Q+X,N=Q-X;if(Z[W++]=G,Z[W++]=L,Z[--j]=N,Z[--j]=G,K)Z[W++]=F,Z[W++]=L,Z[--j]=N,Z[--j]=F}},triangulate($,Z){const J=$.points,Q=Z.points,K=Z.indices;if(J.length===0)return;let q=Q.length/2;const V=q;let U,H;if($.type!==j0.RREC){const W=$.shape;U=W.x,H=W.y}else{const W=$.shape;U=W.x+W.width/2,H=W.y+W.height/2}const z=$.matrix;Q.push($.matrix?z.a*U+z.c*H+z.tx:U,$.matrix?z.b*U+z.d*H+z.ty:H),q++,Q.push(J[0],J[1]);for(let W=2;W<J.length;W+=2)Q.push(J[W],J[W+1]),K.push(q++,V,q);K.push(V+1,V,q)}};var yq=function($,Z=!1){const J=$.length;if(J<6)return;let Q=0;for(let K=0,q=$[J-2],V=$[J-1];K<J;K+=2){const U=$[K],H=$[K+1];Q+=(U-q)*(H+V),q=U,V=H}if(!Z&&Q>0||Z&&Q<=0){const K=J/2;for(let q=K+K%2;q<J;q+=2){const V=J-q-2,U=J-q-1,H=q,z=q+1;[$[V],$[H]]=[$[H],$[V]],[$[U],$[z]]=[$[z],$[U]]}}},F6={build($){$.points=$.shape.points.slice()},triangulate($,Z){let J=$.points;const Q=$.holes,K=Z.points,q=Z.indices;if(J.length>=6){yq(J,!1);const V=[];for(let z=0;z<Q.length;z++){const W=Q[z];yq(W.points,!0),V.push(J.length/2),J=J.concat(W.points)}const U=A.earcut(J,V,2);if(!U)return;const H=K.length/2;for(let z=0;z<U.length;z+=3)q.push(U[z]+H),q.push(U[z+1]+H),q.push(U[z+2]+H);for(let z=0;z<J.length;z++)K.push(J[z])}}};var k9={build($){const Z=$.shape,J=Z.x,Q=Z.y,K=Z.width,q=Z.height,V=$.points;if(V.length=0,!(K>=0&&q>=0))return;V.push(J,Q,J+K,Q,J+K,Q+q,J,Q+q)},triangulate($,Z){const J=$.points,Q=Z.points;if(J.length===0)return;const K=Q.length/2;Q.push(J[0],J[1],J[2],J[3],J[6],J[7],J[4],J[5]),Z.indices.push(K,K+1,K+2,K+1,K+2,K+3)}};var O9={build($){C$.build($)},triangulate($,Z){C$.triangulate($,Z)}};var n0=(($)=>{return $.MITER="miter",$.BEVEL="bevel",$.ROUND="round",$})(n0||{}),M7=(($)=>{return $.BUTT="butt",$.ROUND="round",$.SQUARE="square",$})(M7||{}),N7={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:0.0001,_segmentsCount($,Z=20){if(!this.adaptive||!$||isNaN($))return Z;let J=Math.ceil($/this.maxLength);if(J<this.minSegments)J=this.minSegments;else if(J>this.maxSegments)J=this.maxSegments;return J}};class I6{static curveTo($,Z,J,Q,K,q){const V=q[q.length-2],H=q[q.length-1]-Z,z=V-$,W=Q-Z,Y=J-$,w=Math.abs(H*Y-z*W);if(w<0.00000001||K===0){if(q[q.length-2]!==$||q[q.length-1]!==Z)q.push($,Z);return null}const j=H*H+z*z,C=W*W+Y*Y,X=H*W+z*Y,G=K*Math.sqrt(j)/w,F=K*Math.sqrt(C)/w,L=G*X/j,N=F*X/C,B=G*Y+F*z,T=G*W+F*H,x=z*(F+L),k=H*(F+L),v=Y*(G+N),s=W*(G+N),E=Math.atan2(k-T,x-B),h=Math.atan2(s-T,v-B);return{cx:B+$,cy:T+Z,radius:K,startAngle:E,endAngle:h,anticlockwise:z*W>Y*H}}static arc($,Z,J,Q,K,q,V,U,H){const z=V-q,W=N7._segmentsCount(Math.abs(z)*K,Math.ceil(Math.abs(z)/K$)*40),Y=z/(W*2),w=Y*2,j=Math.cos(Y),C=Math.sin(Y),X=W-1,G=X%1/X;for(let F=0;F<=X;++F){const L=F+G*F,N=Y+q+w*L,B=Math.cos(N),T=-Math.sin(N);H.push((j*B+C*T)*K+J,(j*-T+C*B)*K+Q)}}}class m8{constructor(){this.reset()}begin($,Z,J){this.reset(),this.style=$,this.start=Z,this.attribStart=J}end($,Z){this.attribSize=Z-this.attribStart,this.size=$-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class k6{static curveLength($,Z,J,Q,K,q,V,U){let z=0,W=0,Y=0,w=0,j=0,C=0,X=0,G=0,F=0,L=0,N=0,B=$,T=Z;for(let x=1;x<=10;++x)W=x/10,Y=W*W,w=Y*W,j=1-W,C=j*j,X=C*j,G=X*$+3*C*W*J+3*j*Y*K+w*V,F=X*Z+3*C*W*Q+3*j*Y*q+w*U,L=B-G,N=T-F,B=G,T=F,z+=Math.sqrt(L*L+N*N);return z}static curveTo($,Z,J,Q,K,q,V){const U=V[V.length-2],H=V[V.length-1];V.length-=2;const z=N7._segmentsCount(k6.curveLength(U,H,$,Z,J,Q,K,q));let W=0,Y=0,w=0,j=0,C=0;V.push(U,H);for(let X=1,G=0;X<=z;++X)G=X/z,W=1-G,Y=W*W,w=Y*W,j=G*G,C=j*G,V.push(w*U+3*Y*G*$+3*W*j*J+C*K,w*H+3*Y*G*Z+3*W*j*Q+C*q)}}var fq=function($,Z,J,Q,K,q,V,U){const H=$-J*K,z=Z-Q*K,W=$+J*q,Y=Z+Q*q;let w,j;if(V)w=Q,j=-J;else w=-Q,j=J;const C=H+w,X=z+j,G=W+w,F=Y+j;return U.push(C,X,G,F),2},n$=function($,Z,J,Q,K,q,V,U){const H=J-$,z=Q-Z;let W=Math.atan2(H,z),Y=Math.atan2(K-$,q-Z);if(U&&W<Y)W+=Math.PI*2;else if(!U&&W>Y)Y+=Math.PI*2;let w=W;const j=Y-W,C=Math.abs(j),X=Math.sqrt(H*H+z*z),G=(15*C*Math.sqrt(X)/Math.PI>>0)+1,F=j/G;if(w+=F,U){V.push($,Z,J,Q);for(let L=1,N=w;L<G;L++,N+=F)V.push($,Z,$+Math.sin(N)*X,Z+Math.cos(N)*X);V.push($,Z,K,q)}else{V.push(J,Q,$,Z);for(let L=1,N=w;L<G;L++,N+=F)V.push($+Math.sin(N)*X,Z+Math.cos(N)*X,$,Z);V.push(K,q,$,Z)}return G*2},d2=function($,Z){const J=$.shape;let Q=$.points||J.points.slice();const K=Z.closePointEps;if(Q.length===0)return;const q=$.lineStyle,V=new g(Q[0],Q[1]),U=new g(Q[Q.length-2],Q[Q.length-1]),H=J.type!==j0.POLY||J.closeStroke,z=Math.abs(V.x-U.x)<K&&Math.abs(V.y-U.y)<K;if(H){if(Q=Q.slice(),z)Q.pop(),Q.pop(),U.set(Q[Q.length-2],Q[Q.length-1]);const $0=(V.x+U.x)*0.5,w0=(U.y+V.y)*0.5;Q.unshift($0,w0),Q.push($0,w0)}const W=Z.points,Y=Q.length/2;let w=Q.length;const j=W.length/2,C=q.width/2,X=C*C,G=q.miterLimit*q.miterLimit;let F=Q[0],L=Q[1],N=Q[2],B=Q[3],T=0,x=0,k=-(L-B),v=F-N,s=0,E=0,h=Math.sqrt(k*k+v*v);k/=h,v/=h,k*=C,v*=C;const Q0=q.alignment,M=(1-Q0)*2,D=Q0*2;if(!H){if(q.cap===M7.ROUND)w+=n$(F-k*(M-D)*0.5,L-v*(M-D)*0.5,F-k*M,L-v*M,F+k*D,L+v*D,W,!0)+2;else if(q.cap===M7.SQUARE)w+=fq(F,L,k,v,M,D,!0,W)}W.push(F-k*M,L-v*M,F+k*D,L+v*D);for(let $0=1;$0<Y-1;++$0){F=Q[($0-1)*2],L=Q[($0-1)*2+1],N=Q[$0*2],B=Q[$0*2+1],T=Q[($0+1)*2],x=Q[($0+1)*2+1],k=-(L-B),v=F-N,h=Math.sqrt(k*k+v*v),k/=h,v/=h,k*=C,v*=C,s=-(B-x),E=N-T,h=Math.sqrt(s*s+E*E),s/=h,E/=h,s*=C,E*=C;const w0=N-F,K0=L-B,v6=N-T,S6=x-B,zQ=w0*v6+K0*S6,a8=K0*v6-S6*w0,T6=a8<0;if(Math.abs(a8)<0.001*Math.abs(zQ)){if(W.push(N-k*M,B-v*M,N+k*D,B+v*D),zQ>=0){if(q.join===n0.ROUND)w+=n$(N,B,N-k*M,B-v*M,N-s*M,B-E*M,W,!1)+4;else w+=2;W.push(N-s*D,B-E*D,N+s*M,B+E*M)}continue}const WQ=(-k+F)*(-v+B)-(-k+N)*(-v+L),YQ=(-s+T)*(-E+B)-(-s+N)*(-E+x),r8=(w0*YQ-v6*WQ)/a8,t8=(S6*WQ-K0*YQ)/a8,wQ=(r8-N)*(r8-N)+(t8-B)*(t8-B),F$=N+(r8-N)*M,I$=B+(t8-B)*M,k$=N-(r8-N)*D,O$=B-(t8-B)*D,CV=Math.min(w0*w0+K0*K0,v6*v6+S6*S6),jQ=T6?M:D,XV=CV+jQ*jQ*X,GV=wQ<=XV;let e8=q.join;if(e8===n0.MITER&&wQ/X>G)e8=n0.BEVEL;if(GV)switch(e8){case n0.MITER:{W.push(F$,I$,k$,O$);break}case n0.BEVEL:{if(T6)W.push(F$,I$,N+k*D,B+v*D,F$,I$,N+s*D,B+E*D);else W.push(N-k*M,B-v*M,k$,O$,N-s*M,B-E*M,k$,O$);w+=2;break}case n0.ROUND:{if(T6)W.push(F$,I$,N+k*D,B+v*D),w+=n$(N,B,N+k*D,B+v*D,N+s*D,B+E*D,W,!0)+4,W.push(F$,I$,N+s*D,B+E*D);else W.push(N-k*M,B-v*M,k$,O$),w+=n$(N,B,N-k*M,B-v*M,N-s*M,B-E*M,W,!1)+4,W.push(N-s*M,B-E*M,k$,O$);break}}else{switch(W.push(N-k*M,B-v*M,N+k*D,B+v*D),e8){case n0.MITER:{if(T6)W.push(k$,O$,k$,O$);else W.push(F$,I$,F$,I$);w+=2;break}case n0.ROUND:{if(T6)w+=n$(N,B,N+k*D,B+v*D,N+s*D,B+E*D,W,!0)+2;else w+=n$(N,B,N-k*M,B-v*M,N-s*M,B-E*M,W,!1)+2;break}}W.push(N-s*M,B-E*M,N+s*D,B+E*D),w+=2}}if(F=Q[(Y-2)*2],L=Q[(Y-2)*2+1],N=Q[(Y-1)*2],B=Q[(Y-1)*2+1],k=-(L-B),v=F-N,h=Math.sqrt(k*k+v*v),k/=h,v/=h,k*=C,v*=C,W.push(N-k*M,B-v*M,N+k*D,B+v*D),!H){if(q.cap===M7.ROUND)w+=n$(N-k*(M-D)*0.5,B-v*(M-D)*0.5,N-k*M,B-v*M,N+k*D,B+v*D,W,!1)+2;else if(q.cap===M7.SQUARE)w+=fq(N,B,k,v,M,D,!1,W)}const V0=Z.indices,e=N7.epsilon*N7.epsilon;for(let $0=j;$0<w+j-2;++$0){if(F=W[$0*2],L=W[$0*2+1],N=W[($0+1)*2],B=W[($0+1)*2+1],T=W[($0+2)*2],x=W[($0+2)*2+1],Math.abs(F*(B-x)+N*(x-L)+T*(L-B))<e)continue;V0.push($0,$0+1,$0+2)}},l2=function($,Z){let J=0;const Q=$.shape,K=$.points||Q.points,q=Q.type!==j0.POLY||Q.closeStroke;if(K.length===0)return;const{points:V,indices:U}=Z,H=K.length/2,z=V.length/2;let W=z;V.push(K[0],K[1]);for(J=1;J<H;J++)V.push(K[J*2],K[J*2+1]),U.push(W,W+1),W++;if(q)U.push(W,z)},c8=function($,Z){if($.lineStyle.native)l2($,Z);else d2($,Z)};class O6{static curveLength($,Z,J,Q,K,q){const V=$-2*J+K,U=Z-2*Q+q,H=2*J-2*$,z=2*Q-2*Z,W=4*(V*V+U*U),Y=4*(V*H+U*z),w=H*H+z*z,j=2*Math.sqrt(W+Y+w),C=Math.sqrt(W),X=2*W*C,G=2*Math.sqrt(w),F=Y/C;return(X*j+C*Y*(j-G)+(4*w*W-Y*Y)*Math.log((2*C+F+j)/(F+G)))/(4*X)}static curveTo($,Z,J,Q,K){const q=K[K.length-2],V=K[K.length-1],U=N7._segmentsCount(O6.curveLength(q,V,$,Z,J,Q));let H=0,z=0;for(let W=1;W<=U;++W){const Y=W/U;H=q+($-q)*Y,z=V+(Z-V)*Y,K.push(H+($+(J-$)*Y-H)*Y,z+(Z+(Q-Z)*Y-z)*Y)}}}var p8={[j0.POLY]:F6,[j0.CIRC]:C$,[j0.ELIP]:C$,[j0.RECT]:k9,[j0.RREC]:O9},R9=[],R6=[];class _6{constructor($,Z=null,J=null,Q=null){this.points=[],this.holes=[],this.shape=$,this.lineStyle=J,this.fillStyle=Z,this.matrix=Q,this.type=$.type}clone(){return new _6(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}var M6=new g,gq=class extends w6{constructor(){super();this.closePointEps=0.0001,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new n7,this.boundsDirty=-1}get bounds(){if(this.updateBatches(),this.boundsDirty!==this.dirty)this.boundsDirty=this.dirty,this.calculateBounds();return this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let $=0;$<this.drawCalls.length;$++)this.drawCalls[$].texArray.clear(),R6.push(this.drawCalls[$]);this.drawCalls.length=0;for(let $=0;$<this.batches.length;$++){const Z=this.batches[$];Z.reset(),R9.push(Z)}this.batches.length=0}clear(){if(this.graphicsData.length>0)this.invalidate(),this.clearDirty++,this.graphicsData.length=0;return this}drawShape($,Z=null,J=null,Q=null){const K=new _6($,Z,J,Q);return this.graphicsData.push(K),this.dirty++,this}drawHole($,Z=null){if(!this.graphicsData.length)return null;const J=new _6($,null,null,Z),Q=this.graphicsData[this.graphicsData.length-1];return J.lineStyle=Q.lineStyle,Q.holes.push(J),this.dirty++,this}destroy(){super.destroy();for(let $=0;$<this.graphicsData.length;++$)this.graphicsData[$].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint($){const Z=this.graphicsData;for(let J=0;J<Z.length;++J){const Q=Z[J];if(!Q.fillStyle.visible)continue;if(Q.shape){if(Q.matrix)Q.matrix.applyInverse($,M6);else M6.copyFrom($);if(Q.shape.contains(M6.x,M6.y)){let K=!1;if(Q.holes){for(let q=0;q<Q.holes.length;q++)if(Q.holes[q].shape.contains(M6.x,M6.y)){K=!0;break}}if(!K)return!0}}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const $=this.uvs,Z=this.graphicsData;let J=null,Q=null;if(this.batches.length>0)J=this.batches[this.batches.length-1],Q=J.style;for(let U=this.shapeIndex;U<Z.length;U++){this.shapeIndex++;const H=Z[U],z=H.fillStyle,W=H.lineStyle;if(p8[H.type].build(H),H.matrix)this.transformPoints(H.points,H.matrix);if(z.visible||W.visible)this.processHoles(H.holes);for(let w=0;w<2;w++){const j=w===0?z:W;if(!j.visible)continue;const C=j.texture.baseTexture,X=this.indices.length,G=this.points.length/2;if(C.wrapMode=x0.REPEAT,w===0)this.processFill(H);else this.processLine(H);const F=this.points.length/2-G;if(F===0)continue;if(J&&!this._compareStyles(Q,j))J.end(X,G),J=null;if(!J)J=R9.pop()||new m8,J.begin(j,X,G),this.batches.push(J),Q=j;this.addUvs(this.points,$,j.texture,G,F,j.matrix)}}const K=this.indices.length,q=this.points.length/2;if(J)J.end(K,q);if(this.batches.length===0){this.batchable=!0;return}const V=q>65535;if(this.indicesUint16&&this.indices.length===this.indicesUint16.length&&V===this.indicesUint16.BYTES_PER_ELEMENT>2)this.indicesUint16.set(this.indices);else this.indicesUint16=V?new Uint32Array(this.indices):new Uint16Array(this.indices);if(this.batchable=this.isBatchable(),this.batchable)this.packBatches();else this.buildDrawCalls()}_compareStyles($,Z){if(!$||!Z)return!1;if($.texture.baseTexture!==Z.texture.baseTexture)return!1;if($.color+$.alpha!==Z.color+Z.alpha)return!1;if(!!$.native!==!!Z.native)return!1;return!0}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let $=0,Z=this.graphicsData.length;$<Z;$++){const J=this.graphicsData[$],Q=J.fillStyle,K=J.lineStyle;if(Q&&!Q.texture.baseTexture.valid)return!1;if(K&&!K.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const $=this.batches;for(let Z=0,J=$.length;Z<J;Z++){const Q=$[Z];for(let K=0;K<Q.size;K++){const q=Q.start+K;this.indicesUint16[q]=this.indicesUint16[q]-Q.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const $=this.batches;for(let Z=0;Z<$.length;Z++)if($[Z].style.native)return!1;return this.points.length<gq.BATCHABLE_SIZE*2}buildDrawCalls(){let $=++p._globalBatch;for(let W=0;W<this.drawCalls.length;W++)this.drawCalls[W].texArray.clear(),R6.push(this.drawCalls[W]);this.drawCalls.length=0;const Z=this.colors,J=this.textureIds;let Q=R6.pop();if(!Q)Q=new b$,Q.texArray=new f$;Q.texArray.count=0,Q.start=0,Q.size=0,Q.type=i0.TRIANGLES;let K=0,q=null,V=0,U=!1,H=i0.TRIANGLES,z=0;this.drawCalls.push(Q);for(let W=0;W<this.batches.length;W++){const Y=this.batches[W],j=Y.style,C=j.texture.baseTexture;if(U!==!!j.native)U=!!j.native,H=U?i0.LINES:i0.TRIANGLES,q=null,K=8,$++;if(q!==C){if(q=C,C._batchEnabled!==$){if(K===8){if($++,K=0,Q.size>0){if(Q=R6.pop(),!Q)Q=new b$,Q.texArray=new f$;this.drawCalls.push(Q)}Q.start=z,Q.size=0,Q.texArray.count=0,Q.type=H}C.touched=1,C._batchEnabled=$,C._batchLocation=K,C.wrapMode=x0.REPEAT,Q.texArray.elements[Q.texArray.count++]=C,K++}}Q.size+=Y.size,z+=Y.size,V=C._batchLocation,this.addColors(Z,j.color,j.alpha,Y.attribSize,Y.attribStart),this.addTextureIds(J,V,Y.attribSize,Y.attribStart)}p._globalBatch=$,this.packAttributes()}packAttributes(){const $=this.points,Z=this.uvs,J=this.colors,Q=this.textureIds,K=new ArrayBuffer($.length*3*4),q=new Float32Array(K),V=new Uint32Array(K);let U=0;for(let H=0;H<$.length/2;H++)q[U++]=$[H*2],q[U++]=$[H*2+1],q[U++]=Z[H*2],q[U++]=Z[H*2+1],V[U++]=J[H],q[U++]=Q[H];this._buffer.update(K),this._indexBuffer.update(this.indicesUint16)}processFill($){if($.holes.length)F6.triangulate($,this);else p8[$.type].triangulate($,this)}processLine($){c8($,this);for(let Z=0;Z<$.holes.length;Z++)c8($.holes[Z],this)}processHoles($){for(let Z=0;Z<$.length;Z++){const J=$[Z];if(p8[J.type].build(J),J.matrix)this.transformPoints(J.points,J.matrix)}}calculateBounds(){const $=this._bounds;$.clear(),$.addVertexData(this.points,0,this.points.length),$.pad(this.boundsPadding,this.boundsPadding)}transformPoints($,Z){for(let J=0;J<$.length/2;J++){const Q=$[J*2],K=$[J*2+1];$[J*2]=Z.a*Q+Z.c*K+Z.tx,$[J*2+1]=Z.b*Q+Z.d*K+Z.ty}}addColors($,Z,J,Q,K=0){const q=a.shared.setValue(Z).toLittleEndianNumber(),V=a.shared.setValue(q).toPremultiplied(J);$.length=Math.max($.length,K+Q);for(let U=0;U<Q;U++)$[K+U]=V}addTextureIds($,Z,J,Q=0){$.length=Math.max($.length,Q+J);for(let K=0;K<J;K++)$[Q+K]=Z}addUvs($,Z,J,Q,K,q=null){let V=0;const U=Z.length,H=J.frame;while(V<K){let W=$[(Q+V)*2],Y=$[(Q+V)*2+1];if(q){const w=q.a*W+q.c*Y+q.tx;Y=q.b*W+q.d*Y+q.ty,W=w}V++,Z.push(W/H.width,Y/H.height)}const z=J.baseTexture;if(H.width<z.width||H.height<z.height)this.adjustUvs(Z,J,U,K)}adjustUvs($,Z,J,Q){const K=Z.baseTexture,V=J+Q*2,U=Z.frame,H=U.width/K.width,z=U.height/K.height;let W=U.x/U.width,Y=U.y/U.height,w=Math.floor($[J]+0.000001),j=Math.floor($[J+1]+0.000001);for(let C=J+2;C<V;C+=2)w=Math.min(w,Math.floor($[C]+0.000001)),j=Math.min(j,Math.floor($[C+1]+0.000001));W-=w,Y-=j;for(let C=J;C<V;C+=2)$[C]=($[C]+W)*H,$[C+1]=($[C+1]+Y)*z}},_9=gq;_9.BATCHABLE_SIZE=100;class o${constructor(){this.color=16777215,this.alpha=1,this.texture=S.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const $=new o$;return $.color=this.color,$.alpha=this.alpha,$.texture=this.texture,$.matrix=this.matrix,$.visible=this.visible,$}reset(){this.color=16777215,this.alpha=1,this.texture=S.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class u8 extends o${constructor(){super(...arguments);this.width=0,this.alignment=0.5,this.native=!1,this.cap=M7.BUTT,this.join=n0.MITER,this.miterLimit=10}clone(){const $=new u8;return $.color=this.color,$.alpha=this.alpha,$.texture=this.texture,$.matrix=this.matrix,$.visible=this.visible,$.width=this.width,$.alignment=this.alignment,$.native=this.native,$.cap=this.cap,$.join=this.join,$.miterLimit=this.miterLimit,$}reset(){super.reset(),this.color=0,this.alignment=0.5,this.width=0,this.native=!1}}var bJ={},M9=class extends i{constructor($=null){super();this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new o$,this._lineStyle=new u8,this._matrix=null,this._holeMode=!1,this.state=A0.for2d(),this._geometry=$||new _9,this._geometry.refCount++,this._transformID=-1,this._tintColor=new a(16777215),this.blendMode=o.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new M9(this._geometry)}set blendMode($){this.state.blendMode=$}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint($){this._tintColor.setValue($)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle($=null,Z=0,J,Q=0.5,K=!1){if(typeof $==="number")$={width:$,color:Z,alpha:J,alignment:Q,native:K};return this.lineTextureStyle($)}lineTextureStyle($){const Z={width:0,texture:S.WHITE,color:$?.texture?16777215:0,matrix:null,alignment:0.5,native:!1,cap:M7.BUTT,join:n0.MITER,miterLimit:10};if($=Object.assign(Z,$),this.normalizeColor($),this.currentPath)this.startPoly();const J=$.width>0&&$.alpha>0;if(!J)this._lineStyle.reset();else{if($.matrix)$.matrix=$.matrix.clone(),$.matrix.invert();Object.assign(this._lineStyle,{visible:J},$)}return this}startPoly(){if(this.currentPath){const $=this.currentPath.points,Z=this.currentPath.points.length;if(Z>2)this.drawShape(this.currentPath),this.currentPath=new u7,this.currentPath.closeStroke=!1,this.currentPath.points.push($[Z-2],$[Z-1])}else this.currentPath=new u7,this.currentPath.closeStroke=!1}finishPoly(){if(this.currentPath)if(this.currentPath.points.length>2)this.drawShape(this.currentPath),this.currentPath=null;else this.currentPath.points.length=0}moveTo($,Z){return this.startPoly(),this.currentPath.points[0]=$,this.currentPath.points[1]=Z,this}lineTo($,Z){if(!this.currentPath)this.moveTo(0,0);const J=this.currentPath.points,Q=J[J.length-2],K=J[J.length-1];if(Q!==$||K!==Z)J.push($,Z);return this}_initCurve($=0,Z=0){if(this.currentPath){if(this.currentPath.points.length===0)this.currentPath.points=[$,Z]}else this.moveTo($,Z)}quadraticCurveTo($,Z,J,Q){this._initCurve();const K=this.currentPath.points;if(K.length===0)this.moveTo(0,0);return O6.curveTo($,Z,J,Q,K),this}bezierCurveTo($,Z,J,Q,K,q){return this._initCurve(),k6.curveTo($,Z,J,Q,K,q,this.currentPath.points),this}arcTo($,Z,J,Q,K){this._initCurve($,Z);const q=this.currentPath.points,V=I6.curveTo($,Z,J,Q,K,q);if(V){const{cx:U,cy:H,radius:z,startAngle:W,endAngle:Y,anticlockwise:w}=V;this.arc(U,H,z,W,Y,w)}return this}arc($,Z,J,Q,K,q=!1){if(Q===K)return this;if(!q&&K<=Q)K+=K$;else if(q&&Q<=K)Q+=K$;if(K-Q===0)return this;const U=$+Math.cos(Q)*J,H=Z+Math.sin(Q)*J,z=this._geometry.closePointEps;let W=this.currentPath?this.currentPath.points:null;if(W){const Y=Math.abs(W[W.length-2]-U),w=Math.abs(W[W.length-1]-H);if(Y<z&&w<z);else W.push(U,H)}else this.moveTo(U,H),W=this.currentPath.points;return I6.arc(U,H,$,Z,J,Q,K,q,W),this}beginFill($=0,Z){return this.beginTextureFill({texture:S.WHITE,color:$,alpha:Z})}normalizeColor($){const Z=a.shared.setValue($.color??0);$.color=Z.toNumber(),$.alpha??($.alpha=Z.alpha)}beginTextureFill($){const Z={texture:S.WHITE,color:16777215,matrix:null};if($=Object.assign(Z,$),this.normalizeColor($),this.currentPath)this.startPoly();const J=$.alpha>0;if(!J)this._fillStyle.reset();else{if($.matrix)$.matrix=$.matrix.clone(),$.matrix.invert();Object.assign(this._fillStyle,{visible:J},$)}return this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect($,Z,J,Q){return this.drawShape(new c($,Z,J,Q))}drawRoundedRect($,Z,J,Q,K){return this.drawShape(new q8($,Z,J,Q,K))}drawCircle($,Z,J){return this.drawShape(new v$($,Z,J))}drawEllipse($,Z,J,Q){return this.drawShape(new K8($,Z,J,Q))}drawPolygon(...$){let Z,J=!0;const Q=$[0];if(Q.points)J=Q.closeStroke,Z=Q.points;else if(Array.isArray($[0]))Z=$[0];else Z=$;const K=new u7(Z);return K.closeStroke=J,this.drawShape(K),this}drawShape($){if(!this._holeMode)this._geometry.drawShape($,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix);else this._geometry.drawHole($,this._matrix);return this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const $=this._geometry.graphicsData;return $.length===1&&$[0].shape.type===j0.RECT&&!$[0].matrix&&!$[0].holes.length&&!($[0].lineStyle.visible&&$[0].lineStyle.width)}_render($){this.finishPoly();const Z=this._geometry;if(Z.updateBatches(),Z.batchable){if(this.batchDirty!==Z.batchDirty)this._populateBatches();this._renderBatched($)}else $.batch.flush(),this._renderDirect($)}_populateBatches(){const $=this._geometry,Z=this.blendMode,J=$.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=$.batchDirty,this.batches.length=J,this.vertexData=new Float32Array($.points);for(let Q=0;Q<J;Q++){const K=$.batches[Q],q=K.style.color,V=new Float32Array(this.vertexData.buffer,K.attribStart*4*2,K.attribSize*2),U=new Float32Array($.uvsFloat32.buffer,K.attribStart*4*2,K.attribSize*2),H=new Uint16Array($.indicesUint16.buffer,K.start*2,K.size),z={vertexData:V,blendMode:Z,indices:H,uvs:U,_batchRGB:a.shared.setValue(q).toRgbArray(),_tintRGB:q,_texture:K.style.texture,alpha:K.style.alpha,worldAlpha:1};this.batches[Q]=z}}_renderBatched($){if(!this.batches.length)return;$.batch.setObjectRenderer($.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let Z=0,J=this.batches.length;Z<J;Z++){const Q=this.batches[Z];Q.worldAlpha=this.worldAlpha*Q.alpha,$.plugins[this.pluginName].render(Q)}}_renderDirect($){const Z=this._resolveDirectShader($),J=this._geometry,Q=this.worldAlpha,K=Z.uniforms,q=J.drawCalls;K.translationMatrix=this.transform.worldTransform,a.shared.setValue(this._tintColor).premultiply(Q).toArray(K.tint),$.shader.bind(Z),$.geometry.bind(J,Z),$.state.set(this.state);for(let V=0,U=q.length;V<U;V++)this._renderDrawCallDirect($,J.drawCalls[V])}_renderDrawCallDirect($,Z){const{texArray:J,type:Q,size:K,start:q}=Z,V=J.count;for(let U=0;U<V;U++)$.texture.bind(J.elements[U],U);$.geometry.draw(Q,K,q)}_resolveDirectShader($){let Z=this.shader;const J=this.pluginName;if(!Z){if(!bJ[J]){const{maxTextures:Q}=$.plugins[J],K=new Int32Array(Q);for(let U=0;U<Q;U++)K[U]=U;const q={tint:new Float32Array([1,1,1,1]),translationMatrix:new Z0,default:E0.from({uSamplers:K},!0)},V=$.plugins[J]._shader.program;bJ[J]=new b0(V,q)}Z=bJ[J]}return Z}_calculateBounds(){this.finishPoly();const $=this._geometry;if(!$.graphicsData.length)return;const{minX:Z,minY:J,maxX:Q,maxY:K}=$.bounds;this._bounds.addFrame(this.transform,Z,J,Q,K)}containsPoint($){return this.worldTransform.applyInverse($,M9._TEMP_POINT),this._geometry.containsPoint(M9._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let $=0;$<this.batches.length;$++){const Z=this.batches[$];Z._tintRGB=a.shared.setValue(this._tintColor).multiply(Z._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const $=this.transform._worldID;if(this._transformID===$)return;this._transformID=$;const Z=this.transform.worldTransform,J=Z.a,Q=Z.b,K=Z.c,q=Z.d,V=Z.tx,U=Z.ty,H=this._geometry.points,z=this.vertexData;let W=0;for(let Y=0;Y<H.length;Y+=2){const w=H[Y],j=H[Y+1];z[W++]=J*w+K*j+V,z[W++]=q*j+Q*w+U}}closePath(){const $=this.currentPath;if($)$.closeStroke=!0,this.finishPoly();return this}setMatrix($){return this._matrix=$,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy($){if(this._geometry.refCount--,this._geometry.refCount===0)this._geometry.dispose();this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy($)}},U7=M9;U7.curves=N7;U7._TEMP_POINT=new g;class D9{constructor($,Z){this.uvBuffer=$,this.uvMatrix=Z,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update($){if(!$&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const Z=this.uvBuffer.data;if(!this.data||this.data.length!==Z.length)this.data=new Float32Array(Z.length);this.uvMatrix.multiplyUvs(Z,this.data),this._updateID++}}var vJ=new g,xq=new u7,mq=class extends i{constructor($,Z,J,Q=i0.TRIANGLES){super();this.geometry=$,this.shader=Z,this.state=J||A0.for2d(),this.drawMode=Q,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=I.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry($){if(this._geometry===$)return;if(this._geometry){if(this._geometry.refCount--,this._geometry.refCount===0)this._geometry.dispose()}if(this._geometry=$,this._geometry)this._geometry.refCount++;this.vertexDirty=-1}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material($){this.shader=$}get material(){return this.shader}set blendMode($){this.state.blendMode=$}get blendMode(){return this.state.blendMode}set roundPixels($){if(this._roundPixels!==$)this._transformID=-1;this._roundPixels=$}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint($){this.shader.tint=$}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture($){this.shader.texture=$}_render($){const Z=this.geometry.buffers[0].data;if(this.shader.batchable&&this.drawMode===i0.TRIANGLES&&Z.length<mq.BATCHABLE_SIZE*2)this._renderToBatch($);else this._renderDefault($)}_renderDefault($){const Z=this.shader;if(Z.alpha=this.worldAlpha,Z.update)Z.update();$.batch.flush(),Z.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),$.shader.bind(Z),$.state.set(this.state),$.geometry.bind(this.geometry,Z),$.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch($){const Z=this.geometry,J=this.shader;if(J.uvMatrix)J.uvMatrix.update(),this.calculateUvs();this.calculateVertices(),this.indices=Z.indexBuffer.data,this._tintRGB=J._tintRGB,this._texture=J.texture;const Q=this.material.pluginName;$.batch.setObjectRenderer($.plugins[Q]),$.plugins[Q].render(this)}calculateVertices(){const Z=this.geometry.buffers[0],J=Z.data,Q=Z._updateID;if(Q===this.vertexDirty&&this._transformID===this.transform._worldID)return;if(this._transformID=this.transform._worldID,this.vertexData.length!==J.length)this.vertexData=new Float32Array(J.length);const K=this.transform.worldTransform,q=K.a,V=K.b,U=K.c,H=K.d,z=K.tx,W=K.ty,Y=this.vertexData;for(let w=0;w<Y.length/2;w++){const j=J[w*2],C=J[w*2+1];Y[w*2]=q*j+U*C+z,Y[w*2+1]=V*j+H*C+W}if(this._roundPixels){const w=I.RESOLUTION;for(let j=0;j<Y.length;++j)Y[j]=Math.round(Y[j]*w)/w}this.vertexDirty=Q}calculateUvs(){const $=this.geometry.buffers[1],Z=this.shader;if(!Z.uvMatrix.isSimple){if(!this.batchUvs)this.batchUvs=new D9($,Z.uvMatrix);this.batchUvs.update(),this.uvs=this.batchUvs.data}else this.uvs=$.data}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint($){if(!this.getBounds().contains($.x,$.y))return!1;this.worldTransform.applyInverse($,vJ);const Z=this.geometry.getBuffer("aVertexPosition").data,J=xq.points,Q=this.geometry.getIndex().data,K=Q.length,q=this.drawMode===4?3:1;for(let V=0;V+2<K;V+=q){const U=Q[V]*2,H=Q[V+1]*2,z=Q[V+2]*2;if(J[0]=Z[U],J[1]=Z[U+1],J[2]=Z[H],J[3]=Z[H+1],J[4]=Z[z],J[5]=Z[z+1],xq.contains(vJ.x,vJ.y))return!0}return!1}destroy($){if(super.destroy($),this._cachedTexture)this._cachedTexture.destroy(),this._cachedTexture=null;this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}},X$=mq;X$.BATCHABLE_SIZE=100;class s$ extends t0{constructor($,Z,J){super();const Q=new z0($),K=new z0(Z,!0),q=new z0(J,!0,!0);this.addAttribute("aVertexPosition",Q,2,!1,l.FLOAT).addAttribute("aTextureCoord",K,2,!1,l.FLOAT).addIndex(q),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var cq="varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n";var pq="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n";class G$ extends b0{constructor($,Z){const J={uSampler:$,alpha:1,uTextureMatrix:Z0.IDENTITY,uColor:new Float32Array([1,1,1,1])};if(Z=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},Z),Z.uniforms)Object.assign(J,Z.uniforms);super(Z.program||M0.from(pq,cq),J);this._colorDirty=!1,this.uvMatrix=new H$($),this.batchable=Z.program===void 0,this.pluginName=Z.pluginName,this._tintColor=new a(Z.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=Z.alpha}get texture(){return this.uniforms.uSampler}set texture($){if(this.uniforms.uSampler!==$){if(!this.uniforms.uSampler.baseTexture.alphaMode!==!$.baseTexture.alphaMode)this._colorDirty=!0;this.uniforms.uSampler=$,this.uvMatrix.texture=$}}set alpha($){if($===this._alpha)return;this._alpha=$,this._colorDirty=!0}get alpha(){return this._alpha}set tint($){if($===this.tint)return;this._tintColor.setValue($),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const Z=this.texture.baseTexture.alphaMode;a.shared.setValue(this._tintColor).premultiply(this._alpha,Z).toArray(this.uniforms.uColor)}if(this.uvMatrix.update())this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord}}class A9{constructor($,Z,J){this.geometry=new t0,this.indexBuffer=null,this.size=J,this.dynamicProperties=[],this.staticProperties=[];for(let Q=0;Q<$.length;++Q){let K=$[Q];if(K={attributeName:K.attributeName,size:K.size,uploadFunction:K.uploadFunction,type:K.type||l.FLOAT,offset:K.offset},Z[Q])this.dynamicProperties.push(K);else this.staticProperties.push(K)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const $=this.geometry;let Z=0;this.indexBuffer=new z0(A.createIndicesForQuads(this.size),!0,!0),$.addIndex(this.indexBuffer),this.dynamicStride=0;for(let q=0;q<this.dynamicProperties.length;++q){const V=this.dynamicProperties[q];V.offset=Z,Z+=V.size,this.dynamicStride+=V.size}const J=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(J),this.dynamicDataUint32=new Uint32Array(J),this.dynamicBuffer=new z0(this.dynamicData,!1,!1);let Q=0;this.staticStride=0;for(let q=0;q<this.staticProperties.length;++q){const V=this.staticProperties[q];V.offset=Q,Q+=V.size,this.staticStride+=V.size}const K=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(K),this.staticDataUint32=new Uint32Array(K),this.staticBuffer=new z0(this.staticData,!0,!1);for(let q=0;q<this.dynamicProperties.length;++q){const V=this.dynamicProperties[q];$.addAttribute(V.attributeName,this.dynamicBuffer,0,V.type===l.UNSIGNED_BYTE,V.type,this.dynamicStride*4,V.offset*4)}for(let q=0;q<this.staticProperties.length;++q){const V=this.staticProperties[q];$.addAttribute(V.attributeName,this.staticBuffer,0,V.type===l.UNSIGNED_BYTE,V.type,this.staticStride*4,V.offset*4)}}uploadDynamic($,Z,J){for(let Q=0;Q<this.dynamicProperties.length;Q++){const K=this.dynamicProperties[Q];K.uploadFunction($,Z,J,K.type===l.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,K.offset)}this.dynamicBuffer._updateID++}uploadStatic($,Z,J){for(let Q=0;Q<this.staticProperties.length;Q++){const K=this.staticProperties[Q];K.uploadFunction($,Z,J,K.type===l.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,K.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var uq="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}";var dq="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n";class E9 extends b7{constructor($){super($);this.shader=null,this.properties=null,this.tempMatrix=new Z0,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:l.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=b0.from(dq,uq,{}),this.state=A0.for2d()}render($){const{children:Z,_maxSize:J,_batchSize:Q}=$,K=this.renderer;let q=Z.length;if(q===0)return;else if(q>J&&!$.autoResize)q=J;let V=$._buffers;if(!V)V=$._buffers=this.generateBuffers($);const U=Z[0]._texture.baseTexture,H=U.alphaMode>0;this.state.blendMode=A.correctBlendMode($.blendMode,H),K.state.set(this.state);const z=K.gl,W=$.worldTransform.copyTo(this.tempMatrix);W.prepend(K.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=W.toArray(!0),this.shader.uniforms.uColor=a.shared.setValue($.tintRgb).premultiply($.worldAlpha,H).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=U,this.renderer.shader.bind(this.shader);let Y=!1;for(let w=0,j=0;w<q;w+=Q,j+=1){let C=q-w;if(C>Q)C=Q;if(j>=V.length)V.push(this._generateOneMoreBuffer($));const X=V[j];X.uploadDynamic(Z,w,C);const G=$._bufferUpdateIDs[j]||0;if(Y=Y||X._updateID<G,Y)X._updateID=$._updateID,X.uploadStatic(Z,w,C);K.geometry.bind(X.geometry),z.drawElements(z.TRIANGLES,C*6,z.UNSIGNED_SHORT,0)}}generateBuffers($){const Z=[],J=$._maxSize,Q=$._batchSize,K=$._properties;for(let q=0;q<J;q+=Q)Z.push(new A9(this.properties,K,Q));return Z}_generateOneMoreBuffer($){const{_batchSize:Z,_properties:J}=$;return new A9(this.properties,J,Z)}uploadVertices($,Z,J,Q,K,q){let V=0,U=0,H=0,z=0;for(let W=0;W<J;++W){const Y=$[Z+W],w=Y._texture,j=Y.scale.x,C=Y.scale.y,X=w.trim,G=w.orig;if(X)U=X.x-Y.anchor.x*G.width,V=U+X.width,z=X.y-Y.anchor.y*G.height,H=z+X.height;else V=G.width*(1-Y.anchor.x),U=G.width*-Y.anchor.x,H=G.height*(1-Y.anchor.y),z=G.height*-Y.anchor.y;Q[q]=U*j,Q[q+1]=z*C,Q[q+K]=V*j,Q[q+K+1]=z*C,Q[q+K*2]=V*j,Q[q+K*2+1]=H*C,Q[q+K*3]=U*j,Q[q+K*3+1]=H*C,q+=K*4}}uploadPosition($,Z,J,Q,K,q){for(let V=0;V<J;V++){const U=$[Z+V].position;Q[q]=U.x,Q[q+1]=U.y,Q[q+K]=U.x,Q[q+K+1]=U.y,Q[q+K*2]=U.x,Q[q+K*2+1]=U.y,Q[q+K*3]=U.x,Q[q+K*3+1]=U.y,q+=K*4}}uploadRotation($,Z,J,Q,K,q){for(let V=0;V<J;V++){const U=$[Z+V].rotation;Q[q]=U,Q[q+K]=U,Q[q+K*2]=U,Q[q+K*3]=U,q+=K*4}}uploadUvs($,Z,J,Q,K,q){for(let V=0;V<J;++V){const U=$[Z+V]._texture._uvs;if(U)Q[q]=U.x0,Q[q+1]=U.y0,Q[q+K]=U.x1,Q[q+K+1]=U.y1,Q[q+K*2]=U.x2,Q[q+K*2+1]=U.y2,Q[q+K*3]=U.x3,Q[q+K*3+1]=U.y3,q+=K*4;else Q[q]=0,Q[q+1]=0,Q[q+K]=0,Q[q+K+1]=0,Q[q+K*2]=0,Q[q+K*2+1]=0,Q[q+K*3]=0,Q[q+K*3+1]=0,q+=K*4}}uploadTint($,Z,J,Q,K,q){for(let V=0;V<J;++V){const U=$[Z+V],H=a.shared.setValue(U._tintRGB).toPremultiplied(U.alpha,U.texture.baseTexture.alphaMode>0);Q[q]=H,Q[q+K]=H,Q[q+K*2]=H,Q[q+K*3]=H,q+=K*4}}destroy(){if(super.destroy(),this.shader)this.shader.destroy(),this.shader=null;this.tempMatrix=null}}E9.extension={name:"particle",type:O.RendererPlugin};_.add(E9);var N$=(($)=>{return $[$.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",$[$.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",$})(N$||{});var b9={willReadFrequently:!0},n=class{static get experimentalLetterSpacingSupported(){let $=n._experimentalLetterSpacingSupported;if($!==void 0){const Z=I.ADAPTER.getCanvasRenderingContext2D().prototype;$=n._experimentalLetterSpacingSupported=("letterSpacing"in Z)||("textLetterSpacing"in Z)}return $}constructor($,Z,J,Q,K,q,V,U,H){this.text=$,this.style=Z,this.width=J,this.height=Q,this.lines=K,this.lineWidths=q,this.lineHeight=V,this.maxLineWidth=U,this.fontProperties=H}static measureText($,Z,J,Q=n._canvas){J=J===void 0||J===null?Z.wordWrap:J;const K=Z.toFontString(),q=n.measureFont(K);if(q.fontSize===0)q.fontSize=Z.fontSize,q.ascent=Z.fontSize;const V=Q.getContext("2d",b9);V.font=K;const H=(J?n.wordWrap($,Z,Q):$).split(/(?:\r\n|\r|\n)/),z=new Array(H.length);let W=0;for(let C=0;C<H.length;C++){const X=n._measureText(H[C],Z.letterSpacing,V);z[C]=X,W=Math.max(W,X)}let Y=W+Z.strokeThickness;if(Z.dropShadow)Y+=Z.dropShadowDistance;const w=Z.lineHeight||q.fontSize+Z.strokeThickness;let j=Math.max(w,q.fontSize+Z.strokeThickness*2)+(H.length-1)*(w+Z.leading);if(Z.dropShadow)j+=Z.dropShadowDistance;return new n($,Z,Y,j,H,z,w+Z.leading,W,q)}static _measureText($,Z,J){let Q=!1;if(n.experimentalLetterSpacingSupported)if(n.experimentalLetterSpacing)J.letterSpacing=`${Z}px`,J.textLetterSpacing=`${Z}px`,Q=!0;else J.letterSpacing="0px",J.textLetterSpacing="0px";let K=J.measureText($).width;if(K>0)if(Q)K-=Z;else K+=(n.graphemeSegmenter($).length-1)*Z;return K}static wordWrap($,Z,J=n._canvas){const Q=J.getContext("2d",b9);let K=0,q="",V="";const U=Object.create(null),{letterSpacing:H,whiteSpace:z}=Z,W=n.collapseSpaces(z),Y=n.collapseNewlines(z);let w=!W;const j=Z.wordWrapWidth+H,C=n.tokenize($);for(let X=0;X<C.length;X++){let G=C[X];if(n.isNewline(G)){if(!Y){V+=n.addLine(q),w=!W,q="",K=0;continue}G=" "}if(W){const L=n.isBreakingSpace(G),N=n.isBreakingSpace(q[q.length-1]);if(L&&N)continue}const F=n.getFromCache(G,H,U,Q);if(F>j){if(q!=="")V+=n.addLine(q),q="",K=0;if(n.canBreakWords(G,Z.breakWords)){const L=n.wordWrapSplit(G);for(let N=0;N<L.length;N++){let B=L[N],T=B,x=1;while(L[N+x]){const v=L[N+x];if(!n.canBreakChars(T,v,G,N,Z.breakWords))B+=v;else break;T=v,x++}N+=x-1;const k=n.getFromCache(B,H,U,Q);if(k+K>j)V+=n.addLine(q),w=!1,q="",K=0;q+=B,K+=k}}else{if(q.length>0)V+=n.addLine(q),q="",K=0;const L=X===C.length-1;V+=n.addLine(G,!L),w=!1,q="",K=0}}else{if(F+K>j)w=!1,V+=n.addLine(q),q="",K=0;if(q.length>0||!n.isBreakingSpace(G)||w)q+=G,K+=F}}return V+=n.addLine(q,!1),V}static addLine($,Z=!0){return $=n.trimRight($),$=Z?`${$}
`:$,$}static getFromCache($,Z,J,Q){let K=J[$];if(typeof K!=="number")K=n._measureText($,Z,Q)+Z,J[$]=K;return K}static collapseSpaces($){return $==="normal"||$==="pre-line"}static collapseNewlines($){return $==="normal"}static trimRight($){if(typeof $!=="string")return"";for(let Z=$.length-1;Z>=0;Z--){const J=$[Z];if(!n.isBreakingSpace(J))break;$=$.slice(0,-1)}return $}static isNewline($){if(typeof $!=="string")return!1;return n._newlines.includes($.charCodeAt(0))}static isBreakingSpace($,Z){if(typeof $!=="string")return!1;return n._breakingSpaces.includes($.charCodeAt(0))}static tokenize($){const Z=[];let J="";if(typeof $!=="string")return Z;for(let Q=0;Q<$.length;Q++){const K=$[Q],q=$[Q+1];if(n.isBreakingSpace(K,q)||n.isNewline(K)){if(J!=="")Z.push(J),J="";Z.push(K);continue}J+=K}if(J!=="")Z.push(J);return Z}static canBreakWords($,Z){return Z}static canBreakChars($,Z,J,Q,K){return!0}static wordWrapSplit($){return n.graphemeSegmenter($)}static measureFont($){if(n._fonts[$])return n._fonts[$];const Z={ascent:0,descent:0,fontSize:0},J=n._canvas,Q=n._context;Q.font=$;const K=n.METRICS_STRING+n.BASELINE_SYMBOL,q=Math.ceil(Q.measureText(K).width);let V=Math.ceil(Q.measureText(n.BASELINE_SYMBOL).width);const U=Math.ceil(n.HEIGHT_MULTIPLIER*V);if(V=V*n.BASELINE_MULTIPLIER|0,q===0||U===0)return n._fonts[$]=Z,Z;J.width=q,J.height=U,Q.fillStyle="#f00",Q.fillRect(0,0,q,U),Q.font=$,Q.textBaseline="alphabetic",Q.fillStyle="#000",Q.fillText(K,0,V);const H=Q.getImageData(0,0,q,U).data,z=H.length,W=q*4;let Y=0,w=0,j=!1;for(Y=0;Y<V;++Y){for(let C=0;C<W;C+=4)if(H[w+C]!==255){j=!0;break}if(!j)w+=W;else break}Z.ascent=V-Y,w=z-W,j=!1;for(Y=U;Y>V;--Y){for(let C=0;C<W;C+=4)if(H[w+C]!==255){j=!0;break}if(!j)w-=W;else break}return Z.descent=Y-V,Z.fontSize=Z.ascent+Z.descent,n._fonts[$]=Z,Z}static clearMetrics($=""){if($)delete n._fonts[$];else n._fonts={}}static get _canvas(){if(!n.__canvas){let $;try{const Z=new OffscreenCanvas(0,0);if(Z.getContext("2d",b9)?.measureText)return n.__canvas=Z,Z;$=I.ADAPTER.createCanvas()}catch(Z){$=I.ADAPTER.createCanvas()}$.width=$.height=10,n.__canvas=$}return n.__canvas}static get _context(){if(!n.__context)n.__context=n._canvas.getContext("2d",b9);return n.__context}},B0=n;B0.METRICS_STRING="|\xC9q\xC5";B0.BASELINE_SYMBOL="M";B0.BASELINE_MULTIPLIER=1.4;B0.HEIGHT_MULTIPLIER=2;B0.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter==="function"){const $=new Intl.Segmenter;return(Z)=>[...$.segment(Z)].map((J)=>J.segment)}return($)=>[...$]})();B0.experimentalLetterSpacing=!1;B0._fonts={};B0._newlines=[10,13];B0._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var SJ=function($){const Z=a.shared;if(!Array.isArray($))return Z.setValue($).toHex();else return $.map((J)=>Z.setValue(J).toHex())},a2=function($,Z){if(!Array.isArray($)||!Array.isArray(Z))return!1;if($.length!==Z.length)return!1;for(let J=0;J<$.length;++J)if($[J]!==Z[J])return!1;return!0},TJ=function($,Z,J){for(let Q in J)if(Array.isArray(Z[Q]))$[Q]=Z[Q].slice();else $[Q]=Z[Q]},i2=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],d8=class{constructor($){this.styleID=0,this.reset(),TJ(this,$,$)}clone(){const $={};return TJ($,this,d8.defaultStyle),new d8($)}reset(){TJ(this,d8.defaultStyle,d8.defaultStyle)}get align(){return this._align}set align($){if(this._align!==$)this._align=$,this.styleID++}get breakWords(){return this._breakWords}set breakWords($){if(this._breakWords!==$)this._breakWords=$,this.styleID++}get dropShadow(){return this._dropShadow}set dropShadow($){if(this._dropShadow!==$)this._dropShadow=$,this.styleID++}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha($){if(this._dropShadowAlpha!==$)this._dropShadowAlpha=$,this.styleID++}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle($){if(this._dropShadowAngle!==$)this._dropShadowAngle=$,this.styleID++}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur($){if(this._dropShadowBlur!==$)this._dropShadowBlur=$,this.styleID++}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor($){const Z=SJ($);if(this._dropShadowColor!==Z)this._dropShadowColor=Z,this.styleID++}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance($){if(this._dropShadowDistance!==$)this._dropShadowDistance=$,this.styleID++}get fill(){return this._fill}set fill($){const Z=SJ($);if(this._fill!==Z)this._fill=Z,this.styleID++}get fillGradientType(){return this._fillGradientType}set fillGradientType($){if(this._fillGradientType!==$)this._fillGradientType=$,this.styleID++}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops($){if(!a2(this._fillGradientStops,$))this._fillGradientStops=$,this.styleID++}get fontFamily(){return this._fontFamily}set fontFamily($){if(this.fontFamily!==$)this._fontFamily=$,this.styleID++}get fontSize(){return this._fontSize}set fontSize($){if(this._fontSize!==$)this._fontSize=$,this.styleID++}get fontStyle(){return this._fontStyle}set fontStyle($){if(this._fontStyle!==$)this._fontStyle=$,this.styleID++}get fontVariant(){return this._fontVariant}set fontVariant($){if(this._fontVariant!==$)this._fontVariant=$,this.styleID++}get fontWeight(){return this._fontWeight}set fontWeight($){if(this._fontWeight!==$)this._fontWeight=$,this.styleID++}get letterSpacing(){return this._letterSpacing}set letterSpacing($){if(this._letterSpacing!==$)this._letterSpacing=$,this.styleID++}get lineHeight(){return this._lineHeight}set lineHeight($){if(this._lineHeight!==$)this._lineHeight=$,this.styleID++}get leading(){return this._leading}set leading($){if(this._leading!==$)this._leading=$,this.styleID++}get lineJoin(){return this._lineJoin}set lineJoin($){if(this._lineJoin!==$)this._lineJoin=$,this.styleID++}get miterLimit(){return this._miterLimit}set miterLimit($){if(this._miterLimit!==$)this._miterLimit=$,this.styleID++}get padding(){return this._padding}set padding($){if(this._padding!==$)this._padding=$,this.styleID++}get stroke(){return this._stroke}set stroke($){const Z=SJ($);if(this._stroke!==Z)this._stroke=Z,this.styleID++}get strokeThickness(){return this._strokeThickness}set strokeThickness($){if(this._strokeThickness!==$)this._strokeThickness=$,this.styleID++}get textBaseline(){return this._textBaseline}set textBaseline($){if(this._textBaseline!==$)this._textBaseline=$,this.styleID++}get trim(){return this._trim}set trim($){if(this._trim!==$)this._trim=$,this.styleID++}get whiteSpace(){return this._whiteSpace}set whiteSpace($){if(this._whiteSpace!==$)this._whiteSpace=$,this.styleID++}get wordWrap(){return this._wordWrap}set wordWrap($){if(this._wordWrap!==$)this._wordWrap=$,this.styleID++}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth($){if(this._wordWrapWidth!==$)this._wordWrapWidth=$,this.styleID++}toFontString(){const $=typeof this.fontSize==="number"?`${this.fontSize}px`:this.fontSize;let Z=this.fontFamily;if(!Array.isArray(this.fontFamily))Z=this.fontFamily.split(",");for(let J=Z.length-1;J>=0;J--){let Q=Z[J].trim();if(!/([\"\'])[^\'\"]+\1/.test(Q)&&!i2.includes(Q))Q=`"${Q}"`;Z[J]=Q}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${$} ${Z.join(",")}`}},o0=d8;o0.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:N$.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var r2={texture:!0,children:!1,baseTexture:!0},hJ=class extends k0{constructor($,Z,J){let Q=!1;if(!J)J=I.ADAPTER.createCanvas(),Q=!0;J.width=3,J.height=3;const K=S.from(J);K.orig=new c,K.trim=new c;super(K);this._ownCanvas=Q,this.canvas=J,this.context=J.getContext("2d",{willReadFrequently:!0}),this._resolution=hJ.defaultResolution??I.RESOLUTION,this._autoResolution=hJ.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=$,this.style=Z,this.localStyleID=-1}static get experimentalLetterSpacing(){return B0.experimentalLetterSpacing}static set experimentalLetterSpacing($){A.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),B0.experimentalLetterSpacing=$}updateText($){const Z=this._style;if(this.localStyleID!==Z.styleID)this.dirty=!0,this.localStyleID=Z.styleID;if(!this.dirty&&$)return;this._font=this._style.toFontString();const J=this.context,Q=B0.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),K=Q.width,q=Q.height,V=Q.lines,U=Q.lineHeight,H=Q.lineWidths,z=Q.maxLineWidth,W=Q.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,K)+Z.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,q)+Z.padding*2)*this._resolution),J.scale(this._resolution,this._resolution),J.clearRect(0,0,this.canvas.width,this.canvas.height),J.font=this._font,J.lineWidth=Z.strokeThickness,J.textBaseline=Z.textBaseline,J.lineJoin=Z.lineJoin,J.miterLimit=Z.miterLimit;let Y,w;const j=Z.dropShadow?2:1;for(let C=0;C<j;++C){const X=Z.dropShadow&&C===0,G=X?Math.ceil(Math.max(1,q)+Z.padding*2):0,F=G*this._resolution;if(X){J.fillStyle="black",J.strokeStyle="black";const N=Z.dropShadowColor,B=Z.dropShadowBlur*this._resolution,T=Z.dropShadowDistance*this._resolution;J.shadowColor=a.shared.setValue(N).setAlpha(Z.dropShadowAlpha).toRgbaString(),J.shadowBlur=B,J.shadowOffsetX=Math.cos(Z.dropShadowAngle)*T,J.shadowOffsetY=Math.sin(Z.dropShadowAngle)*T+F}else J.fillStyle=this._generateFillStyle(Z,V,Q),J.strokeStyle=Z.stroke,J.shadowColor="black",J.shadowBlur=0,J.shadowOffsetX=0,J.shadowOffsetY=0;let L=(U-W.fontSize)/2;if(U-W.fontSize<0)L=0;for(let N=0;N<V.length;N++){if(Y=Z.strokeThickness/2,w=Z.strokeThickness/2+N*U+W.ascent+L,Z.align==="right")Y+=z-H[N];else if(Z.align==="center")Y+=(z-H[N])/2;if(Z.stroke&&Z.strokeThickness)this.drawLetterSpacing(V[N],Y+Z.padding,w+Z.padding-G,!0);if(Z.fill)this.drawLetterSpacing(V[N],Y+Z.padding,w+Z.padding-G)}}this.updateTexture()}drawLetterSpacing($,Z,J,Q=!1){const q=this._style.letterSpacing;let V=!1;if(B0.experimentalLetterSpacingSupported)if(B0.experimentalLetterSpacing)this.context.letterSpacing=`${q}px`,this.context.textLetterSpacing=`${q}px`,V=!0;else this.context.letterSpacing="0px",this.context.textLetterSpacing="0px";if(q===0||V){if(Q)this.context.strokeText($,Z,J);else this.context.fillText($,Z,J);return}let U=Z;const H=B0.graphemeSegmenter($);let z=this.context.measureText($).width,W=0;for(let Y=0;Y<H.length;++Y){const w=H[Y];if(Q)this.context.strokeText(w,U,J);else this.context.fillText(w,U,J);let j="";for(let C=Y+1;C<H.length;++C)j+=H[C];W=this.context.measureText(j).width,U+=z-W+q,z=W}}updateTexture(){const $=this.canvas;if(this._style.trim){const q=A.trimCanvas($);if(q.data)$.width=q.width,$.height=q.height,this.context.putImageData(q.data,0,0)}const Z=this._texture,J=this._style,Q=J.trim?0:J.padding,K=Z.baseTexture;Z.trim.width=Z._frame.width=$.width/this._resolution,Z.trim.height=Z._frame.height=$.height/this._resolution,Z.trim.x=-Q,Z.trim.y=-Q,Z.orig.width=Z._frame.width-Q*2,Z.orig.height=Z._frame.height-Q*2,this._onTextureUpdate(),K.setRealSize($.width,$.height,this._resolution),Z.updateUvs(),this.dirty=!1}_render($){if(this._autoResolution&&this._resolution!==$.resolution)this._resolution=$.resolution,this.dirty=!0;this.updateText(!0),super._render($)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds($,Z){if(this.updateText(!0),this._textureID===-1)$=!1;return super.getBounds($,Z)}getLocalBounds($){return this.updateText(!0),super.getLocalBounds.call(this,$)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle($,Z,J){const Q=$.fill;if(!Array.isArray(Q))return Q;else if(Q.length===1)return Q[0];let K;const q=$.dropShadow?$.dropShadowDistance:0,V=$.padding||0,U=this.canvas.width/this._resolution-q-V*2,H=this.canvas.height/this._resolution-q-V*2,z=Q.slice(),W=$.fillGradientStops.slice();if(!W.length){const Y=z.length+1;for(let w=1;w<Y;++w)W.push(w/Y)}if(z.unshift(Q[0]),W.unshift(0),z.push(Q[Q.length-1]),W.push(1),$.fillGradientType===N$.LINEAR_VERTICAL){K=this.context.createLinearGradient(U/2,V,U/2,H+V);const Y=J.fontProperties.fontSize+$.strokeThickness;for(let w=0;w<Z.length;w++){const j=J.lineHeight*(w-1)+Y,C=J.lineHeight*w;let X=C;if(w>0&&j>C)X=(C+j)/2;const G=C+Y,F=J.lineHeight*(w+1);let L=G;if(w+1<Z.length&&F<G)L=(G+F)/2;const N=(L-X)/H;for(let B=0;B<z.length;B++){let T=0;if(typeof W[B]==="number")T=W[B];else T=B/z.length;let x=Math.min(1,Math.max(0,X/H+T*N));x=Number(x.toFixed(5)),K.addColorStop(x,z[B])}}}else{K=this.context.createLinearGradient(V,H/2,U+V,H/2);const Y=z.length+1;let w=1;for(let j=0;j<z.length;j++){let C;if(typeof W[j]==="number")C=W[j];else C=w/Y;K.addColorStop(C,z[j]),w++}}return K}destroy($){if(typeof $==="boolean")$={children:$};if($=Object.assign({},r2,$),super.destroy($),this._ownCanvas)this.canvas.height=this.canvas.width=0;this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width($){this.updateText(!0);const Z=A.sign(this.scale.x)||1;this.scale.x=Z*$/this._texture.orig.width,this._width=$}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height($){this.updateText(!0);const Z=A.sign(this.scale.y)||1;this.scale.y=Z*$/this._texture.orig.height,this._height=$}get style(){return this._style}set style($){if($=$||{},$ instanceof o0)this._style=$;else this._style=new o0($);this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text($){if($=String($===null||$===void 0?"":$),this._text===$)return;this._text=$,this.dirty=!0}get resolution(){return this._resolution}set resolution($){if(this._autoResolution=!1,this._resolution===$)return;this._resolution=$,this.dirty=!0}},H7=hJ;H7.defaultAutoResolution=!0;class v9{constructor($){this.maxItemsPerFrame=$,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}var t2=function($,Z){let J=!1;if($?._textures?.length){for(let Q=0;Q<$._textures.length;Q++)if($._textures[Q]instanceof S){const K=$._textures[Q].baseTexture;if(!Z.includes(K))Z.push(K),J=!0}}return J},e2=function($,Z){if($.baseTexture instanceof p){const J=$.baseTexture;if(!Z.includes(J))Z.push(J);return!0}return!1},$Y=function($,Z){if($._texture&&$._texture instanceof S){const J=$._texture.baseTexture;if(!Z.includes(J))Z.push(J);return!0}return!1},ZY=function($,Z){if(Z instanceof H7)return Z.updateText(!0),!0;return!1},JY=function($,Z){if(Z instanceof o0){const J=Z.toFontString();return B0.measureFont(J),!0}return!1},QY=function($,Z){if($ instanceof H7){if(!Z.includes($.style))Z.push($.style);if(!Z.includes($))Z.push($);const J=$._texture.baseTexture;if(!Z.includes(J))Z.push(J);return!0}return!1},KY=function($,Z){if($ instanceof o0){if(!Z.includes($))Z.push($);return!0}return!1},lq=class{constructor($){this.limiter=new v9(lq.uploadsPerFrame),this.renderer=$,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{if(!this.queue)return;this.prepareItems()},this.registerFindHook(QY),this.registerFindHook(KY),this.registerFindHook(t2),this.registerFindHook(e2),this.registerFindHook($Y),this.registerUploadHook(ZY),this.registerUploadHook(JY)}upload($){return new Promise((Z)=>{if($)this.add($);if(this.queue.length){if(this.completes.push(Z),!this.ticking)this.ticking=!0,Y0.system.addOnce(this.tick,this,K7.UTILITY)}else Z()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){this.limiter.beginFrame();while(this.queue.length&&this.limiter.allowedToUpload()){const $=this.queue[0];let Z=!1;if($&&!$._destroyed){for(let J=0,Q=this.uploadHooks.length;J<Q;J++)if(this.uploadHooks[J](this.uploadHookHelper,$)){this.queue.shift(),Z=!0;break}}if(!Z)this.queue.shift()}if(!this.queue.length){this.ticking=!1;const $=this.completes.slice(0);this.completes.length=0;for(let Z=0,J=$.length;Z<J;Z++)$[Z]()}else Y0.system.addOnce(this.tick,this,K7.UTILITY)}registerFindHook($){if($)this.addHooks.push($);return this}registerUploadHook($){if($)this.uploadHooks.push($);return this}add($){for(let Z=0,J=this.addHooks.length;Z<J;Z++)if(this.addHooks[Z]($,this.queue))break;if($ instanceof i)for(let Z=$.children.length-1;Z>=0;Z--)this.add($.children[Z]);return this}destroy(){if(this.ticking)Y0.system.remove(this.tick,this);this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}},i$=lq;i$.uploadsPerFrame=4;Object.defineProperties(I,{UPLOADS_PER_FRAME:{get(){return i$.uploadsPerFrame},set($){A.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),i$.uploadsPerFrame=$}}});var nq=function($,Z){if(Z instanceof p){if(!Z._glTextures[$.CONTEXT_UID])$.texture.bind(Z);return!0}return!1},qY=function($,Z){if(!(Z instanceof U7))return!1;const{geometry:J}=Z;Z.finishPoly(),J.updateBatches();const{batches:Q}=J;for(let K=0;K<Q.length;K++){const{texture:q}=Q[K].style;if(q)nq($,q.baseTexture)}if(!J.batchable)$.geometry.bind(J,Z._resolveDirectShader($));return!0},VY=function($,Z){if($ instanceof U7)return Z.push($),!0;return!1};class S9 extends i${constructor($){super($);this.uploadHookHelper=this.renderer,this.registerFindHook(VY),this.registerUploadHook(nq),this.registerUploadHook(qY)}}S9.extension={name:"prepare",type:O.RendererSystem};_.add(S9);var l8=new g;class n8 extends k0{constructor($,Z=100,J=100){super($);this.tileTransform=new q$,this._width=Z,this._height=J,this.uvMatrix=this.texture.uvMatrix||new H$($),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin($){this.uvMatrix.clampMargin=$,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale($){this.tileTransform.scale.copyFrom($)}get tilePosition(){return this.tileTransform.position}set tilePosition($){this.tileTransform.position.copyFrom($)}_onTextureUpdate(){if(this.uvMatrix)this.uvMatrix.texture=this._texture;this._cachedTint=16777215}_render($){const Z=this._texture;if(!Z||!Z.valid)return;this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),$.batch.setObjectRenderer($.plugins[this.pluginName]),$.plugins[this.pluginName].render(this)}_calculateBounds(){const $=this._width*-this._anchor._x,Z=this._height*-this._anchor._y,J=this._width*(1-this._anchor._x),Q=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,$,Z,J,Q)}getLocalBounds($){if(this.children.length===0){if(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),!$){if(!this._localBoundsRect)this._localBoundsRect=new c;$=this._localBoundsRect}return this._bounds.getRectangle($)}return super.getLocalBounds.call(this,$)}containsPoint($){this.worldTransform.applyInverse($,l8);const Z=this._width,J=this._height,Q=-Z*this.anchor._x;if(l8.x>=Q&&l8.x<Q+Z){const K=-J*this.anchor._y;if(l8.y>=K&&l8.y<K+J)return!0}return!1}destroy($){super.destroy($),this.tileTransform=null,this.uvMatrix=null}static from($,Z){const J=$ instanceof S?$:S.from($,Z);return new n8(J,Z.width,Z.height)}get width(){return this._width}set width($){this._width=$}get height(){return this._height}set height($){this._height=$}}var oq="#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n";var sq="#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";var iq="#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n";var yJ="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";var aq="#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n";var T9=new Z0;class h9 extends b7{constructor($){super($);$.runners.contextChange.add(this),this.quad=new X6,this.state=A0.for2d()}contextChange(){const $=this.renderer,Z={globals:$.globalUniforms};this.simpleShader=b0.from(yJ,aq,Z),this.shader=$.context.webGLVersion>1?b0.from(sq,oq,Z):b0.from(yJ,iq,Z)}render($){const Z=this.renderer,J=this.quad;let Q=J.vertices;Q[0]=Q[6]=$._width*-$.anchor.x,Q[1]=Q[3]=$._height*-$.anchor.y,Q[2]=Q[4]=$._width*(1-$.anchor.x),Q[5]=Q[7]=$._height*(1-$.anchor.y);const K=$.uvRespectAnchor?$.anchor.x:0,q=$.uvRespectAnchor?$.anchor.y:0;Q=J.uvs,Q[0]=Q[6]=-K,Q[1]=Q[3]=-q,Q[2]=Q[4]=1-K,Q[5]=Q[7]=1-q,J.invalidate();const V=$._texture,U=V.baseTexture,H=U.alphaMode>0,z=$.tileTransform.localTransform,W=$.uvMatrix;let Y=U.isPowerOfTwo&&V.frame.width===U.width&&V.frame.height===U.height;if(Y)if(!U._glTextures[Z.CONTEXT_UID]){if(U.wrapMode===x0.CLAMP)U.wrapMode=x0.REPEAT}else Y=U.wrapMode!==x0.CLAMP;const w=Y?this.simpleShader:this.shader,j=V.width,C=V.height,X=$._width,G=$._height;if(T9.set(z.a*j/X,z.b*j/G,z.c*C/X,z.d*C/G,z.tx/X,z.ty/G),T9.invert(),Y)T9.prepend(W.mapCoord);else w.uniforms.uMapCoord=W.mapCoord.toArray(!0),w.uniforms.uClampFrame=W.uClampFrame,w.uniforms.uClampOffset=W.uClampOffset;w.uniforms.uTransform=T9.toArray(!0),w.uniforms.uColor=a.shared.setValue($.tint).premultiply($.worldAlpha,H).toArray(w.uniforms.uColor),w.uniforms.translationMatrix=$.transform.worldTransform.toArray(!0),w.uniforms.uSampler=V,Z.shader.bind(w),Z.geometry.bind(J),this.state.blendMode=A.correctBlendMode($.blendMode,H),Z.state.set(this.state),Z.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}h9.extension={name:"tilingSprite",type:O.RendererPlugin};_.add(h9);var o8=class{constructor($,Z,J=null){this.linkedSheets=[],this._texture=$ instanceof S?$:null,this.baseTexture=$ instanceof p?$:this._texture.baseTexture,this.textures={},this.animations={},this.data=Z;const Q=this.baseTexture.resource;this.resolution=this._updateResolution(J||(Q?Q.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution($=null){const{scale:Z}=this.data.meta;let J=A.getResolutionOfUrl($,null);if(J===null)J=parseFloat(Z??"1");if(J!==1)this.baseTexture.setResolution(J);return J}parse(){return new Promise(($)=>{if(this._callback=$,this._batchIndex=0,this._frameKeys.length<=o8.BATCH_SIZE)this._processFrames(0),this._processAnimations(),this._parseComplete();else this._nextBatch()})}_processFrames($){let Z=$;const J=o8.BATCH_SIZE;while(Z-$<J&&Z<this._frameKeys.length){const Q=this._frameKeys[Z],K=this._frames[Q],q=K.frame;if(q){let V=null,U=null;const H=K.trimmed!==!1&&K.sourceSize?K.sourceSize:K.frame,z=new c(0,0,Math.floor(H.w)/this.resolution,Math.floor(H.h)/this.resolution);if(K.rotated)V=new c(Math.floor(q.x)/this.resolution,Math.floor(q.y)/this.resolution,Math.floor(q.h)/this.resolution,Math.floor(q.w)/this.resolution);else V=new c(Math.floor(q.x)/this.resolution,Math.floor(q.y)/this.resolution,Math.floor(q.w)/this.resolution,Math.floor(q.h)/this.resolution);if(K.trimmed!==!1&&K.spriteSourceSize)U=new c(Math.floor(K.spriteSourceSize.x)/this.resolution,Math.floor(K.spriteSourceSize.y)/this.resolution,Math.floor(q.w)/this.resolution,Math.floor(q.h)/this.resolution);this.textures[Q]=new S(this.baseTexture,V,z,U,K.rotated?2:0,K.anchor,K.borders),S.addToCache(this.textures[Q],Q)}Z++}}_processAnimations(){const $=this.data.animations||{};for(let Z in $){this.animations[Z]=[];for(let J=0;J<$[Z].length;J++){const Q=$[Z][J];this.animations[Z].push(this.textures[Q])}}}_parseComplete(){const $=this._callback;this._callback=null,this._batchIndex=0,$.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*o8.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{if(this._batchIndex*o8.BATCH_SIZE<this._frameKeys.length)this._nextBatch();else this._processAnimations(),this._parseComplete()},0)}destroy($=!1){for(let Z in this.textures)this.textures[Z].destroy();if(this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,$)this._texture?.destroy(),this.baseTexture.destroy();this._texture=null,this.baseTexture=null,this.linkedSheets=[]}},L$=o8;L$.BATCH_SIZE=1000;var rq=function($,Z,J){const Q={};if($.forEach((K)=>{Q[K]=Z}),Object.keys(Z.textures).forEach((K)=>{Q[K]=Z.textures[K]}),!J){const K=A.path.dirname($[0]);Z.linkedSheets.forEach((q,V)=>{const U=rq([`${K}/${Z.data.meta.related_multi_packs[V]}`],q,!0);Object.assign(Q,U)})}return Q},UY=["jpg","png","jpeg","avif","webp"],tq={extension:O.Asset,cache:{test:($)=>$ instanceof L$,getCacheableAssets:($,Z)=>rq($,Z,!1)},resolver:{test:($)=>{const J=$.split("?")[0].split("."),Q=J.pop(),K=J.pop();return Q==="json"&&UY.includes(K)},parse:($)=>{const Z=$.split(".");return{resolution:parseFloat(I.RETINA_PREFIX.exec($)?.[1]??"1"),format:Z[Z.length-2],src:$}}},loader:{name:"spritesheetLoader",extension:{type:O.LoadParser,priority:L0.Normal},async testParse($,Z){return A.path.extname(Z.src).toLowerCase()===".json"&&!!$.frames},async parse($,Z,J){let Q=A.path.dirname(Z.src);if(Q&&Q.lastIndexOf("/")!==Q.length-1)Q+="/";let K=Q+$.meta.image;K=l$(K,Z.src);const V=(await J.load([K]))[K],U=new L$(V.baseTexture,$,Z.src);await U.parse();const H=$?.meta?.related_multi_packs;if(Array.isArray(H)){const z=[];for(let Y of H){if(typeof Y!=="string")continue;let w=Q+Y;if(Z.data?.ignoreMultiPack)continue;w=l$(w,Z.src),z.push(J.load({src:w,data:{ignoreMultiPack:!0}}))}const W=await Promise.all(z);U.linkedSheets=W,W.forEach((Y)=>{Y.linkedSheets=[U].concat(U.linkedSheets.filter((w)=>w!==Y))})}return U},unload($){$.destroy(!0)}}};_.add(tq);class t7{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class e7{static test($){return typeof $==="string"&&$.startsWith("info face=")}static parse($){const Z=$.match(/^[a-z]+\s+.+$/gm),J={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let K in Z){const q=Z[K].match(/^[a-z]+/gm)[0],V=Z[K].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),U={};for(let H in V){const z=V[H].split("="),W=z[0],Y=z[1].replace(/"/gm,""),w=parseFloat(Y),j=isNaN(w)?Y:w;U[W]=j}J[q].push(U)}const Q=new t7;return J.info.forEach((K)=>Q.info.push({face:K.face,size:parseInt(K.size,10)})),J.common.forEach((K)=>Q.common.push({lineHeight:parseInt(K.lineHeight,10)})),J.page.forEach((K)=>Q.page.push({id:parseInt(K.id,10),file:K.file})),J.char.forEach((K)=>Q.char.push({id:parseInt(K.id,10),page:parseInt(K.page,10),x:parseInt(K.x,10),y:parseInt(K.y,10),width:parseInt(K.width,10),height:parseInt(K.height,10),xoffset:parseInt(K.xoffset,10),yoffset:parseInt(K.yoffset,10),xadvance:parseInt(K.xadvance,10)})),J.kerning.forEach((K)=>Q.kerning.push({first:parseInt(K.first,10),second:parseInt(K.second,10),amount:parseInt(K.amount,10)})),J.distanceField.forEach((K)=>Q.distanceField.push({distanceRange:parseInt(K.distanceRange,10),fieldType:K.fieldType})),Q}}class B${static test($){const Z=$;return("getElementsByTagName"in Z)&&Z.getElementsByTagName("page").length&&Z.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse($){const Z=new t7,J=$.getElementsByTagName("info"),Q=$.getElementsByTagName("common"),K=$.getElementsByTagName("page"),q=$.getElementsByTagName("char"),V=$.getElementsByTagName("kerning"),U=$.getElementsByTagName("distanceField");for(let H=0;H<J.length;H++)Z.info.push({face:J[H].getAttribute("face"),size:parseInt(J[H].getAttribute("size"),10)});for(let H=0;H<Q.length;H++)Z.common.push({lineHeight:parseInt(Q[H].getAttribute("lineHeight"),10)});for(let H=0;H<K.length;H++)Z.page.push({id:parseInt(K[H].getAttribute("id"),10)||0,file:K[H].getAttribute("file")});for(let H=0;H<q.length;H++){const z=q[H];Z.char.push({id:parseInt(z.getAttribute("id"),10),page:parseInt(z.getAttribute("page"),10)||0,x:parseInt(z.getAttribute("x"),10),y:parseInt(z.getAttribute("y"),10),width:parseInt(z.getAttribute("width"),10),height:parseInt(z.getAttribute("height"),10),xoffset:parseInt(z.getAttribute("xoffset"),10),yoffset:parseInt(z.getAttribute("yoffset"),10),xadvance:parseInt(z.getAttribute("xadvance"),10)})}for(let H=0;H<V.length;H++)Z.kerning.push({first:parseInt(V[H].getAttribute("first"),10),second:parseInt(V[H].getAttribute("second"),10),amount:parseInt(V[H].getAttribute("amount"),10)});for(let H=0;H<U.length;H++)Z.distanceField.push({fieldType:U[H].getAttribute("fieldType"),distanceRange:parseInt(U[H].getAttribute("distanceRange"),10)});return Z}}class P${static test($){if(typeof $==="string"&&$.includes("<font>"))return B$.test(I.ADAPTER.parseXML($));return!1}static parse($){return B$.parse(I.ADAPTER.parseXML($))}}var gJ=function($){for(let Z=0;Z<fJ.length;Z++)if(fJ[Z].test($))return fJ[Z];return null},fJ=[e7,B$,P$];var xJ=function($,Z,J,Q,K,q){const V=J.fill;if(!Array.isArray(V))return V;else if(V.length===1)return V[0];let U;const H=J.dropShadow?J.dropShadowDistance:0,z=J.padding||0,W=$.width/Q-H-z*2,Y=$.height/Q-H-z*2,w=V.slice(),j=J.fillGradientStops.slice();if(!j.length){const C=w.length+1;for(let X=1;X<C;++X)j.push(X/C)}if(w.unshift(V[0]),j.unshift(0),w.push(V[V.length-1]),j.push(1),J.fillGradientType===N$.LINEAR_VERTICAL){U=Z.createLinearGradient(W/2,z,W/2,Y+z);let C=0;const G=(q.fontProperties.fontSize+J.strokeThickness)/Y;for(let F=0;F<K.length;F++){const L=q.lineHeight*F;for(let N=0;N<w.length;N++){let B=0;if(typeof j[N]==="number")B=j[N];else B=N/w.length;const T=L/Y+B*G;let x=Math.max(C,T);x=Math.min(x,1),U.addColorStop(x,w[N]),C=x}}}else{U=Z.createLinearGradient(z,Y/2,W+z,Y/2);const C=w.length+1;let X=1;for(let G=0;G<w.length;G++){let F;if(typeof j[G]==="number")F=j[G];else F=X/C;U.addColorStop(F,w[G]),X++}}return U};var mJ=function($,Z,J,Q,K,q,V){const{text:U,fontProperties:H}=J;Z.translate(Q,K),Z.scale(q,q);const z=V.strokeThickness/2,W=-(V.strokeThickness/2);if(Z.font=V.toFontString(),Z.lineWidth=V.strokeThickness,Z.textBaseline=V.textBaseline,Z.lineJoin=V.lineJoin,Z.miterLimit=V.miterLimit,Z.fillStyle=xJ($,Z,V,q,[U],J),Z.strokeStyle=V.stroke,V.dropShadow){const Y=V.dropShadowColor,w=V.dropShadowBlur*q,j=V.dropShadowDistance*q;Z.shadowColor=a.shared.setValue(Y).setAlpha(V.dropShadowAlpha).toRgbaString(),Z.shadowBlur=w,Z.shadowOffsetX=Math.cos(V.dropShadowAngle)*j,Z.shadowOffsetY=Math.sin(V.dropShadowAngle)*j}else Z.shadowColor="black",Z.shadowBlur=0,Z.shadowOffsetX=0,Z.shadowOffsetY=0;if(V.stroke&&V.strokeThickness)Z.strokeText(U,z,W+J.lineHeight-H.descent);if(V.fill)Z.fillText(U,z,W+J.lineHeight-H.descent);Z.setTransform(1,0,0,1,0,0),Z.fillStyle="rgba(0, 0, 0, 0)"};var a$=function($){return $.codePointAt?$.codePointAt(0):$.charCodeAt(0)};var s8=function($){return Array.from?Array.from($):$.split("")};var cJ=function($){if(typeof $==="string")$=[$];const Z=[];for(let J=0,Q=$.length;J<Q;J++){const K=$[J];if(Array.isArray(K)){if(K.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${K.length}.`);const q=K[0].charCodeAt(0),V=K[1].charCodeAt(0);if(V<q)throw new Error("[BitmapFont]: Invalid character range.");for(let U=q,H=V;U<=H;U++)Z.push(String.fromCharCode(U))}else Z.push(...s8(K))}if(Z.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return Z};var D7=class{constructor($,Z,J){const[Q]=$.info,[K]=$.common,[q]=$.page,[V]=$.distanceField,U=A.getResolutionOfUrl(q.file),H={};this._ownsTextures=J,this.font=Q.face,this.size=Q.size,this.lineHeight=K.lineHeight/U,this.chars={},this.pageTextures=H;for(let z=0;z<$.page.length;z++){const{id:W,file:Y}=$.page[z];if(H[W]=Z instanceof Array?Z[z]:Z[Y],V?.fieldType&&V.fieldType!=="none")H[W].baseTexture.alphaMode=P0.NO_PREMULTIPLIED_ALPHA,H[W].baseTexture.mipmap=D0.OFF}for(let z=0;z<$.char.length;z++){const{id:W,page:Y}=$.char[z];let{x:w,y:j,width:C,height:X,xoffset:G,yoffset:F,xadvance:L}=$.char[z];w/=U,j/=U,C/=U,X/=U,G/=U,F/=U,L/=U;const N=new c(w+H[Y].frame.x/U,j+H[Y].frame.y/U,C,X);this.chars[W]={xOffset:G,yOffset:F,xAdvance:L,kerning:{},texture:new S(H[Y].baseTexture,N),page:Y}}for(let z=0;z<$.kerning.length;z++){let{first:W,second:Y,amount:w}=$.kerning[z];if(W/=U,Y/=U,w/=U,this.chars[Y])this.chars[Y].kerning[W]=w}this.distanceFieldRange=V?.distanceRange,this.distanceFieldType=V?.fieldType?.toLowerCase()??"none"}destroy(){for(let $ in this.chars)this.chars[$].texture.destroy(),this.chars[$].texture=null;for(let $ in this.pageTextures){if(this._ownsTextures)this.pageTextures[$].destroy(!0);this.pageTextures[$]=null}this.chars=null,this.pageTextures=null}static install($,Z,J){let Q;if($ instanceof t7)Q=$;else{const q=gJ($);if(!q)throw new Error("Unrecognized data format for font.");Q=q.parse($)}if(Z instanceof S)Z=[Z];const K=new D7(Q,Z,J);return D7.available[K.font]=K,K}static uninstall($){const Z=D7.available[$];if(!Z)throw new Error(`No font found named '${$}'`);Z.destroy(),delete D7.available[$]}static from($,Z,J){if(!$)throw new Error("[BitmapFont] Property `name` is required.");const{chars:Q,padding:K,resolution:q,textureWidth:V,textureHeight:U,...H}=Object.assign({},D7.defaultOptions,J),z=cJ(Q),W=Z instanceof o0?Z:new o0(Z),Y=V,w=new t7;w.info[0]={face:W.fontFamily,size:W.fontSize},w.common[0]={lineHeight:W.fontSize};let j=0,C=0,X,G,F,L=0;const N=[],B=[];for(let x=0;x<z.length;x++){if(!X)X=I.ADAPTER.createCanvas(),X.width=V,X.height=U,G=X.getContext("2d"),F=new p(X,{resolution:q,...H}),N.push(F),B.push(new S(F)),w.page.push({id:B.length-1,file:""});const k=z[x],v=B0.measureText(k,W,!1,X),s=v.width,E=Math.ceil(v.height),h=Math.ceil((W.fontStyle==="italic"?2:1)*s);if(C>=U-E*q){if(C===0)throw new Error(`[BitmapFont] textureHeight ${U}px is too small (fontFamily: '${W.fontFamily}', fontSize: ${W.fontSize}px, char: '${k}')`);--x,X=null,G=null,F=null,C=0,j=0,L=0;continue}if(L=Math.max(E+v.fontProperties.descent,L),h*q+j>=Y){if(j===0)throw new Error(`[BitmapFont] textureWidth ${V}px is too small (fontFamily: '${W.fontFamily}', fontSize: ${W.fontSize}px, char: '${k}')`);--x,C+=L*q,C=Math.ceil(C),j=0,L=0;continue}mJ(X,G,v,j,C,q,W);const Q0=a$(v.text);w.char.push({id:Q0,page:B.length-1,x:j/q,y:C/q,width:h,height:E,xoffset:0,yoffset:0,xadvance:s-(W.dropShadow?W.dropShadowDistance:0)-(W.stroke?W.strokeThickness:0)}),j+=(h+2*K)*q,j=Math.ceil(j)}for(let x=0,k=z.length;x<k;x++){const v=z[x];for(let s=0;s<k;s++){const E=z[s],h=G.measureText(v).width,Q0=G.measureText(E).width,D=G.measureText(v+E).width-(h+Q0);if(D)w.kerning.push({first:a$(v),second:a$(E),amount:D})}}const T=new D7(w,B,!0);if(D7.available[$]!==void 0)D7.uninstall($);return D7.available[$]=T,T}},v0=D7;v0.ALPHA=[["a","z"],["A","Z"]," "];v0.NUMERIC=[["0","9"]];v0.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];v0.ASCII=[[" ","~"]];v0.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:D7.ALPHANUMERIC};v0.available={};var eq="// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n";var $V="// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n";var ZV=[],JV=[],QV=[],KV=class extends i{constructor($,Z={}){super();const{align:J,tint:Q,maxWidth:K,letterSpacing:q,fontName:V,fontSize:U}=Object.assign({},KV.styleDefaults,Z);if(!v0.available[V])throw new Error(`Missing BitmapFont "${V}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=J,this._tintColor=new a(Q),this._font=void 0,this._fontName=V,this._fontSize=U,this.text=$,this._maxWidth=K,this._maxLineHeight=0,this._letterSpacing=q,this._anchor=new C7(()=>{this.dirty=!0},this,0,0),this._roundPixels=I.ROUND_PIXELS,this.dirty=!0,this._resolution=I.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const $=v0.available[this._fontName],Z=this.fontSize,J=Z/$.size,Q=new g,K=[],q=[],V=[],U=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",H=s8(U),z=this._maxWidth*$.size/Z,W=$.distanceFieldType==="none"?ZV:JV;let Y=null,w=0,j=0,C=0,X=-1,G=0,F=0,L=0,N=0;for(let E=0;E<H.length;E++){const h=H[E],Q0=a$(h);if(/(?:\s)/.test(h))X=E,G=w,N++;if(h==="\r"||h==="\n"){q.push(w),V.push(-1),j=Math.max(j,w),++C,++F,Q.x=0,Q.y+=$.lineHeight,Y=null,N=0;continue}const M=$.chars[Q0];if(!M)continue;if(Y&&M.kerning[Y])Q.x+=M.kerning[Y];const D=QV.pop()||{texture:S.EMPTY,line:0,charCode:0,prevSpaces:0,position:new g};if(D.texture=M.texture,D.line=C,D.charCode=Q0,D.position.x=Math.round(Q.x+M.xOffset+this._letterSpacing/2),D.position.y=Math.round(Q.y+M.yOffset),D.prevSpaces=N,K.push(D),w=D.position.x+Math.max(M.xAdvance-M.xOffset,M.texture.orig.width),Q.x+=M.xAdvance+this._letterSpacing,L=Math.max(L,M.yOffset+M.texture.height),Y=Q0,X!==-1&&z>0&&Q.x>z)++F,A.removeItems(K,1+X-F,1+E-X),E=X,X=-1,q.push(G),V.push(K.length>0?K[K.length-1].prevSpaces:0),j=Math.max(j,G),C++,Q.x=0,Q.y+=$.lineHeight,Y=null,N=0}const B=H[H.length-1];if(B!=="\r"&&B!=="\n"){if(/(?:\s)/.test(B))w=G;q.push(w),j=Math.max(j,w),V.push(-1)}const T=[];for(let E=0;E<=C;E++){let h=0;if(this._align==="right")h=j-q[E];else if(this._align==="center")h=(j-q[E])/2;else if(this._align==="justify")h=V[E]<0?0:(j-q[E])/V[E];T.push(h)}const x=K.length,k={},v=[],s=this._activePagesMeshData;W.push(...s);for(let E=0;E<x;E++){const h=K[E].texture,Q0=h.baseTexture.uid;if(!k[Q0]){let M=W.pop();if(!M){const V0=new s$;let e,$0;if($.distanceFieldType==="none")e=new G$(S.EMPTY),$0=o.NORMAL;else e=new G$(S.EMPTY,{program:M0.from($V,eq),uniforms:{uFWidth:0}}),$0=o.NORMAL_NPM;const w0=new X$(V0,e);w0.blendMode=$0,M={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:w0,vertices:null,uvs:null,indices:null}}M.index=0,M.indexCount=0,M.vertexCount=0,M.uvsCount=0,M.total=0;const{_textureCache:D}=this;D[Q0]=D[Q0]||new S(h.baseTexture),M.mesh.texture=D[Q0],M.mesh.tint=this._tintColor.value,v.push(M),k[Q0]=M}k[Q0].total++}for(let E=0;E<s.length;E++)if(!v.includes(s[E]))this.removeChild(s[E].mesh);for(let E=0;E<v.length;E++)if(v[E].mesh.parent!==this)this.addChild(v[E].mesh);this._activePagesMeshData=v;for(let E in k){const h=k[E],Q0=h.total;if(!(h.indices?.length>6*Q0)||h.vertices.length<X$.BATCHABLE_SIZE*2)h.vertices=new Float32Array(8*Q0),h.uvs=new Float32Array(8*Q0),h.indices=new Uint16Array(6*Q0);else{const{total:M,vertices:D}=h;for(let V0=M*4*2;V0<D.length;V0++)D[V0]=0}h.mesh.size=6*Q0}for(let E=0;E<x;E++){const h=K[E];let Q0=h.position.x+T[h.line]*(this._align==="justify"?h.prevSpaces:1);if(this._roundPixels)Q0=Math.round(Q0);const M=Q0*J,D=h.position.y*J,V0=h.texture,e=k[V0.baseTexture.uid],$0=V0.frame,w0=V0._uvs,K0=e.index++;e.indices[K0*6+0]=0+K0*4,e.indices[K0*6+1]=1+K0*4,e.indices[K0*6+2]=2+K0*4,e.indices[K0*6+3]=0+K0*4,e.indices[K0*6+4]=2+K0*4,e.indices[K0*6+5]=3+K0*4,e.vertices[K0*8+0]=M,e.vertices[K0*8+1]=D,e.vertices[K0*8+2]=M+$0.width*J,e.vertices[K0*8+3]=D,e.vertices[K0*8+4]=M+$0.width*J,e.vertices[K0*8+5]=D+$0.height*J,e.vertices[K0*8+6]=M,e.vertices[K0*8+7]=D+$0.height*J,e.uvs[K0*8+0]=w0.x0,e.uvs[K0*8+1]=w0.y0,e.uvs[K0*8+2]=w0.x1,e.uvs[K0*8+3]=w0.y1,e.uvs[K0*8+4]=w0.x2,e.uvs[K0*8+5]=w0.y2,e.uvs[K0*8+6]=w0.x3,e.uvs[K0*8+7]=w0.y3}this._textWidth=j*J,this._textHeight=(Q.y+$.lineHeight)*J;for(let E in k){const h=k[E];if(this.anchor.x!==0||this.anchor.y!==0){let V0=0;const e=this._textWidth*this.anchor.x,$0=this._textHeight*this.anchor.y;for(let w0=0;w0<h.total;w0++)h.vertices[V0++]-=e,h.vertices[V0++]-=$0,h.vertices[V0++]-=e,h.vertices[V0++]-=$0,h.vertices[V0++]-=e,h.vertices[V0++]-=$0,h.vertices[V0++]-=e,h.vertices[V0++]-=$0}this._maxLineHeight=L*J;const Q0=h.mesh.geometry.getBuffer("aVertexPosition"),M=h.mesh.geometry.getBuffer("aTextureCoord"),D=h.mesh.geometry.getIndex();Q0.data=h.vertices,M.data=h.uvs,D.data=h.indices,Q0.update(),M.update(),D.update()}for(let E=0;E<K.length;E++)QV.push(K[E]);this._font=$,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render($){if(this._autoResolution&&this._resolution!==$.resolution)this._resolution=$.resolution,this.dirty=!0;const{distanceFieldRange:Z,distanceFieldType:J,size:Q}=v0.available[this._fontName];if(J!=="none"){const{a:K,b:q,c:V,d:U}=this.worldTransform,H=Math.sqrt(K*K+q*q),z=Math.sqrt(V*V+U*U),W=(Math.abs(H)+Math.abs(z))/2,Y=this.fontSize/Q,w=$._view.resolution;for(let j of this._activePagesMeshData)j.mesh.shader.uniforms.uFWidth=W*Z*Y*w}super._render($)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const $=v0.available[this._fontName];if(!$)throw new Error(`Missing BitmapFont "${this._fontName}"`);if(this._font!==$)this.dirty=!0;if(this.dirty)this.updateText()}get tint(){return this._tintColor.value}set tint($){if(this.tint===$)return;this._tintColor.setValue($);for(let Z=0;Z<this._activePagesMeshData.length;Z++)this._activePagesMeshData[Z].mesh.tint=$}get align(){return this._align}set align($){if(this._align!==$)this._align=$,this.dirty=!0}get fontName(){return this._fontName}set fontName($){if(!v0.available[$])throw new Error(`Missing BitmapFont "${$}"`);if(this._fontName!==$)this._fontName=$,this.dirty=!0}get fontSize(){return this._fontSize??v0.available[this._fontName].size}set fontSize($){if(this._fontSize!==$)this._fontSize=$,this.dirty=!0}get anchor(){return this._anchor}set anchor($){if(typeof $==="number")this._anchor.set($);else this._anchor.copyFrom($)}get text(){return this._text}set text($){if($=String($===null||$===void 0?"":$),this._text===$)return;this._text=$,this.dirty=!0}get maxWidth(){return this._maxWidth}set maxWidth($){if(this._maxWidth===$)return;this._maxWidth=$,this.dirty=!0}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing($){if(this._letterSpacing!==$)this._letterSpacing=$,this.dirty=!0}get roundPixels(){return this._roundPixels}set roundPixels($){if($!==this._roundPixels)this._roundPixels=$,this.dirty=!0}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution($){if(this._autoResolution=!1,this._resolution===$)return;this._resolution=$,this.dirty=!0}destroy($){const{_textureCache:Z}=this,Q=v0.available[this._fontName].distanceFieldType==="none"?ZV:JV;Q.push(...this._activePagesMeshData);for(let K of this._activePagesMeshData)this.removeChild(K.mesh);this._activePagesMeshData=[],Q.filter((K)=>Z[K.mesh.texture.baseTexture.uid]).forEach((K)=>{K.mesh.texture=S.EMPTY});for(let K in Z)Z[K].destroy(),delete Z[K];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy($)}},qV=KV;qV.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};var HY=[".xml",".fnt"],VV={extension:{type:O.LoadParser,priority:L0.Normal},name:"loadBitmapFont",test($){return HY.includes(A.path.extname($).toLowerCase())},async testParse($){return e7.test($)||P$.test($)},async parse($,Z,J){const Q=e7.test($)?e7.parse($):P$.parse($),{src:K}=Z,{page:q}=Q,V=[];for(let z=0;z<q.length;++z){const W=q[z].file;let Y=A.path.join(A.path.dirname(K),W);Y=l$(Y,K),V.push(Y)}const U=await J.load(V),H=V.map((z)=>U[z]);return v0.install(Q,H,!0)},async load($,Z){return(await I.ADAPTER.fetch($)).text()},unload($){$.destroy()}};_.add(VV);var D6=class extends o0{constructor(){super(...arguments);this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from($){return new D6(Object.keys(D6.defaultOptions).reduce((Z,J)=>({...Z,[J]:$[J]}),{}))}cleanFonts(){if(this._fonts.length>0)this._fonts.forEach(($)=>{if(URL.revokeObjectURL($.src),$.refs--,$.refs===0){if($.fontFace)document.fonts.delete($.fontFace);delete D6.availableFonts[$.originalUrl]}}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0}loadFont($,Z={}){const{availableFonts:J}=D6;if(J[$]){const Q=J[$];return this._fonts.push(Q),Q.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return I.ADAPTER.fetch($).then((Q)=>Q.blob()).then(async(Q)=>new Promise((K,q)=>{const V=URL.createObjectURL(Q),U=new FileReader;U.onload=()=>K([V,U.result]),U.onerror=q,U.readAsDataURL(Q)})).then(async([Q,K])=>{const q=Object.assign({family:A.path.basename($,A.path.extname($)),weight:"normal",style:"normal",src:Q,dataSrc:K,refs:1,originalUrl:$,fontFace:null},Z);J[$]=q,this._fonts.push(q),this.styleID++;const V=new FontFace(q.family,`url(${q.src})`,{weight:q.weight,style:q.style});q.fontFace=V,await V.load(),document.fonts.add(V),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...$){const Z=$.filter((J)=>!this._overrides.includes(J));if(Z.length>0)this._overrides.push(...Z),this.styleID++}removeOverride(...$){const Z=$.filter((J)=>this._overrides.includes(J));if(Z.length>0)this._overrides=this._overrides.filter((J)=>!Z.includes(J)),this.styleID++}toCSS($){return[`transform: scale(${$})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(($,Z)=>`${$}
            @font-face {
                font-family: "${Z.family}";
                src: url('${Z.dataSrc}');
                font-weight: ${Z.weight};
                font-style: ${Z.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet($){if(this._stylesheet!==$)this._stylesheet=$,this.styleID++}normalizeColor($){if(Array.isArray($))$=A.rgb2hex($);if(typeof $==="number")return A.hex2string($);return $}dropShadowToCSS(){let $=this.normalizeColor(this.dropShadowColor);const Z=this.dropShadowAlpha,J=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),Q=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);if($.startsWith("#")&&Z<1)$+=(Z*255|0).toString(16).padStart(2,"0");const K=`${J}px ${Q}px`;if(this.dropShadowBlur>0)return`text-shadow: ${K} ${this.dropShadowBlur}px ${$}`;return`text-shadow: ${K} ${$}`}reset(){Object.assign(this,D6.defaultOptions)}onBeforeDraw(){const{fontsDirty:$}=this;if(this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&$)return new Promise((Z)=>setTimeout(Z,100));return Promise.resolve()}get isSafari(){const{userAgent:$}=I.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test($)}set fillGradientStops($){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType($){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit($){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim($){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline($){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading($){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin($){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}},r$=D6;r$.availableFonts={};r$.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};var A6=class extends k0{constructor($="",Z={}){super(S.EMPTY);this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const J=new Image,Q=S.from(J,{scaleMode:I.SCALE_MODE,resourceOptions:{autoLoad:!1}});Q.orig=new c,Q.trim=new c,this.texture=Q;const K="http://www.w3.org/2000/svg",q="http://www.w3.org/1999/xhtml",V=document.createElementNS(K,"svg"),U=document.createElementNS(K,"foreignObject"),H=document.createElementNS(q,"div"),z=document.createElementNS(q,"style");U.setAttribute("width","10000"),U.setAttribute("height","10000"),U.style.overflow="hidden",V.appendChild(U),this.maxWidth=A6.defaultMaxWidth,this.maxHeight=A6.defaultMaxHeight,this._domElement=H,this._styleElement=z,this._svgRoot=V,this._foreignObject=U,this._foreignObject.appendChild(z),this._foreignObject.appendChild(H),this._image=J,this._loadImage=new Image,this._autoResolution=A6.defaultAutoResolution,this._resolution=A6.defaultResolution??I.RESOLUTION,this.text=$,this.style=Z}measureText($){const{text:Z,style:J,resolution:Q}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},$);Object.assign(this._domElement,{innerHTML:Z,style:J.toCSS(Q)}),this._styleElement.textContent=J.toGlobalCSS(),document.body.appendChild(this._svgRoot);const K=this._domElement.getBoundingClientRect();this._svgRoot.remove();const q=Math.min(this.maxWidth,Math.ceil(K.width)),V=Math.min(this.maxHeight,Math.ceil(K.height));if(this._svgRoot.setAttribute("width",q.toString()),this._svgRoot.setAttribute("height",V.toString()),Z!==this._text)this._domElement.innerHTML=this._text;if(J!==this._style)Object.assign(this._domElement,{style:this._style?.toCSS(Q)}),this._styleElement.textContent=this._style?.toGlobalCSS();return{width:q+J.padding*2,height:V+J.padding*2}}async updateText($=!0){const{style:Z,_image:J,_loadImage:Q}=this;if(this.localStyleID!==Z.styleID)this.dirty=!0,this.localStyleID=Z.styleID;if(!this.dirty&&$)return;const{width:K,height:q}=this.measureText();if(J.width=Q.width=Math.ceil(Math.max(1,K)),J.height=Q.height=Math.ceil(Math.max(1,q)),!this._loading)this._loading=!0,await new Promise((V)=>{Q.onload=async()=>{await Z.onBeforeDraw(),this._loading=!1,J.src=Q.src,Q.onload=null,Q.src="",this.updateTexture(),V()};const U=new XMLSerializer().serializeToString(this._svgRoot);Q.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(U)}`})}get source(){return this._image}updateTexture(){const{style:$,texture:Z,_image:J,resolution:Q}=this,{padding:K}=$,{baseTexture:q}=Z;Z.trim.width=Z._frame.width=J.width/Q,Z.trim.height=Z._frame.height=J.height/Q,Z.trim.x=-K,Z.trim.y=-K,Z.orig.width=Z._frame.width-K*2,Z.orig.height=Z._frame.height-K*2,this._onTextureUpdate(),q.setRealSize(J.width,J.height,Q),this.dirty=!1}_render($){if(this._autoResolution&&this._resolution!==$.resolution)this._resolution=$.resolution,this.dirty=!0;this.updateText(!0),super._render($)}_renderCanvas($){if(this._autoResolution&&this._resolution!==$.resolution)this._resolution=$.resolution,this.dirty=!0;this.updateText(!0),super._renderCanvas($)}getLocalBounds($){return this.updateText(!0),super.getLocalBounds($)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy($){if(typeof $==="boolean")$={children:$};$=Object.assign({},A6.defaultDestroyOptions,$),super.destroy($);const Z=null;if(this.ownsStyle)this._style?.cleanFonts();this._style=Z,this._svgRoot?.remove(),this._svgRoot=Z,this._domElement?.remove(),this._domElement=Z,this._foreignObject?.remove(),this._foreignObject=Z,this._styleElement?.remove(),this._styleElement=Z,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=Z,this._image.src="",this._image=Z}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width($){this.updateText(!0);const Z=A.sign(this.scale.x)||1;this.scale.x=Z*$/this._image.width/this.resolution,this._width=$}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height($){this.updateText(!0);const Z=A.sign(this.scale.y)||1;this.scale.y=Z*$/this._image.height/this.resolution,this._height=$}get style(){return this._style}set style($){if(this._style===$)return;if($=$||{},$ instanceof r$)this.ownsStyle=!1,this._style=$;else if($ instanceof o0)console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=r$.from($);else this.ownsStyle=!0,this._style=new r$($);this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text($){if($=String($===""||$===null||$===void 0?" ":$),$=this.sanitiseText($),this._text===$)return;this._text=$,this.dirty=!0}get resolution(){return this._resolution}set resolution($){if(this._autoResolution=!1,this._resolution===$)return;this._resolution=$,this.dirty=!0}sanitiseText($){return $.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}},i8=A6;i8.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};i8.defaultMaxWidth=2024;i8.defaultMaxHeight=2024;i8.defaultAutoResolution=!0;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var E6=function(){return E6=Object.assign||function $(Z){for(var J,Q=1,K=arguments.length;Q<K;Q++){J=arguments[Q];for(var q in J)if(Object.prototype.hasOwnProperty.call(J,q))Z[q]=J[q]}return Z},E6.apply(this,arguments)},zY={visible:"visible",dirtyTest:!1},Xy=function(){function $(Z){if(Z===void 0)Z={};Z=E6(E6({},zY),Z),this.dirtyTest=typeof Z.dirtyTest!=="undefined"?Z.dirtyTest:!0,this.lists=[[]]}return $.prototype.addList=function(Z,J){if(this.lists.push(Z),J)Z.staticObject=!0;var Q=Z.length;for(var K=0;K<Q;K++)this.updateObject(Z[K]);return Z},$.prototype.removeList=function(Z){var J=this.lists.indexOf(Z);if(J===-1)return Z;return this.lists.splice(J,1),Z},$.prototype.add=function(Z,J){if(J)Z.staticObject=!0;if(this.dirtyTest||J)this.updateObject(Z);return this.lists[0].push(Z),Z},$.prototype.remove=function(Z){var J=this.lists[0].indexOf(Z);if(J===-1)return Z;return this.lists[0].splice(J,1),Z},$.prototype.cull=function(Z,J){if(!J)this.updateObjects();for(var Q=0,K=this.lists;Q<K.length;Q++){var q=K[Q],V=q.length;for(var U=0;U<V;U++){var H=q[U],z=H.AABB;H.visible=z.x+z.width>Z.x&&z.x<Z.x+Z.width&&z.y+z.height>Z.y&&z.y<Z.y+Z.height}}},$.prototype.updateObjects=function(){if(this.dirtyTest)for(var Z=0,J=this.lists;Z<J.length;Z++){var Q=J[Z];if(!Q.staticObject){var K=Q.length;for(var q=0;q<K;q++){var V=Q[q];if(!V.staticObject&&V.dirty)this.updateObject(V),V.dirty=!1}}}else for(var U=0,H=this.lists;U<H.length;U++){var Q=H[U];if(!Q.staticObject){var z=Q.length;for(var q=0;q<z;q++){var V=Q[q];if(!V.staticObject)this.updateObject(V)}}}},$.prototype.updateObject=function(Z){var J=Z.getLocalBounds();Z.AABB=Z.AABB||{x:0,y:0,width:0,height:0},Z.AABB.x=Z.x+(J.x-Z.pivot.x)*Math.abs(Z.scale.x),Z.AABB.y=Z.y+(J.y-Z.pivot.y)*Math.abs(Z.scale.y),Z.AABB.width=J.width*Math.abs(Z.scale.x),Z.AABB.height=J.height*Math.abs(Z.scale.y)},$.prototype.query=function(Z){var J=[];for(var Q=0,K=this.lists;Q<K.length;Q++){var q=K[Q];for(var V=0,U=q;V<U.length;V++){var H=U[V],z=H.AABB;if(z&&z.x+z.width>Z.x&&z.x-z.width<Z.x+Z.width&&z.y+z.height>Z.y&&z.y-z.height<Z.y+Z.height)J.push(H)}}return J},$.prototype.queryCallback=function(Z,J){for(var Q=0,K=this.lists;Q<K.length;Q++){var q=K[Q];for(var V=0,U=q;V<U.length;V++){var H=U[V],z=H.AABB;if(z&&z.x+z.width>Z.x&&z.x-z.width<Z.x+Z.width&&z.y+z.height>Z.y&&z.y-z.height<Z.y+Z.height){if(J(H))return!0}}}return!1},$.prototype.stats=function(){var Z=0,J=0;for(var Q=0,K=this.lists;Q<K.length;Q++){var q=K[Q];q.forEach(function(V){Z+=V.visible?1:0,J++})}return{total:J,visible:Z,culled:J-Z}},$}(),WY={xSize:1000,ySize:1000,simpleTest:!0,dirtyTest:!0},HV=function(){function $(Z){if(this.xSize=1000,this.ySize=1000,this.simpleTest=!0,this.dirtyTest=!0,Z=E6(E6({},WY),Z),Z&&typeof Z.size!=="undefined")this.xSize=this.ySize=Z.size;else this.xSize=Z.xSize,this.ySize=Z.ySize;this.simpleTest=Z.simpleTest,this.dirtyTest=Z.dirtyTest,this.width=this.height=0,this.hash={},this.containers=[],this.elements=[]}return $.prototype.add=function(Z,J){if(Z.spatial={hashes:[]},this.dirtyTest)Z.dirty=!0;if(J)Z.staticObject=!0;return this.updateObject(Z),this.elements.push(Z),Z},$.prototype.remove=function(Z){return this.elements.splice(this.elements.indexOf(Z),1),this.removeFromHash(Z),Z},$.prototype.addContainer=function(Z,J){var Q=this,K=function(z){z.spatial={hashes:[]},Q.updateObject(z)},q=function(z){Q.removeFromHash(z)},V=Z.children.length;for(var U=0;U<V;U++){var H=Z.children[U];H.spatial={hashes:[]},this.updateObject(H)}if(Z.cull={},this.containers.push(Z),Z.on("childAdded",K),Z.on("childRemoved",q),Z.cull.added=K,Z.cull.removed=q,J)Z.cull.static=!0},$.prototype.removeContainer=function(Z){var J=this;return this.containers.splice(this.containers.indexOf(Z),1),Z.children.forEach(function(Q){return J.removeFromHash(Q)}),Z.off("childAdded",Z.cull.added),Z.off("removedFrom",Z.cull.removed),delete Z.cull,Z},$.prototype.cull=function(Z,J,Q){if(!J)this.updateObjects();this.invisible();var K;if(Q)K=this.queryCallbackAll(Z,this.simpleTest,Q);else K=this.query(Z,this.simpleTest);return K.forEach(function(q){return q.visible=!0}),this.lastBuckets},$.prototype.invisible=function(){var Z=this.elements.length;for(var J=0;J<Z;J++)this.elements[J].visible=!1;for(var Q=0,K=this.containers;Q<K.length;Q++){var q=K[Q],V=q.children.length;for(var J=0;J<V;J++)q.children[J].visible=!1}},$.prototype.updateObjects=function(){if(this.dirtyTest){var Z=this.elements.length;for(var J=0;J<Z;J++){var Q=this.elements[J];if(Q.dirty)this.updateObject(Q),Q.dirty=!1}for(var K=0,q=this.containers;K<q.length;K++){var V=q[K];if(!V.cull.static){var U=V.children.length;for(var J=0;J<U;J++){var Q=V.children[J];if(Q.dirty)this.updateObject(Q),Q.dirty=!1}}}}else{var H=this.elements.length;for(var J=0;J<H;J++){var Q=this.elements[J];if(!Q.staticObject)this.updateObject(Q)}for(var z=0,W=this.containers;z<W.length;z++){var V=W[z];if(!V.cull.static){var Y=V.children.length;for(var J=0;J<Y;J++)this.updateObject(V.children[J])}}}},$.prototype.updateObject=function(Z){var J,Q=Z.getLocalBounds();J=Z.AABB={x:Z.x+(Q.x-Z.pivot.x)*Z.scale.x,y:Z.y+(Q.y-Z.pivot.y)*Z.scale.y,width:Q.width*Z.scale.x,height:Q.height*Z.scale.y};var K=Z.spatial;if(!K)K=Z.spatial={hashes:[]};var q=this.getBounds(J),V=q.xStart,U=q.yStart,H=q.xEnd,z=q.yEnd;if(K.xStart!==V||K.yStart!==U||K.xEnd!==H||K.yEnd!==z){if(K.hashes.length)this.removeFromHash(Z);for(var W=U;W<=z;W++)for(var Y=V;Y<=H;Y++){var w=Y+","+W;this.insert(Z,w),K.hashes.push(w)}K.xStart=V,K.yStart=U,K.xEnd=H,K.yEnd=z}},$.prototype.getBuckets=function(Z){if(Z===void 0)Z=1;var J=[];for(var Q in this.hash){var K=this.hash[Q];if(K.length>=Z)J.push(K)}return J},$.prototype.getBounds=function(Z){var J=Math.floor(Z.x/this.xSize),Q=Math.floor(Z.y/this.ySize),K=Math.floor((Z.x+Z.width)/this.xSize),q=Math.floor((Z.y+Z.height)/this.ySize);return{xStart:J,yStart:Q,xEnd:K,yEnd:q}},$.prototype.insert=function(Z,J){if(!this.hash[J])this.hash[J]=[Z];else this.hash[J].push(Z)},$.prototype.removeFromHash=function(Z){var J=Z.spatial;while(J.hashes.length){var Q=J.hashes.pop(),K=this.hash[Q];K.splice(K.indexOf(Z),1)}},$.prototype.neighbors=function(Z){var J=this,Q=[];return Z.spatial.hashes.forEach(function(K){return Q=Q.concat(J.hash[K])}),Q},$.prototype.query=function(Z,J){if(J===void 0)J=!0;var Q=0,K=[],q=this.getBounds(Z),V=q.xStart,U=q.yStart,H=q.xEnd,z=q.yEnd;for(var W=U;W<=z;W++)for(var Y=V;Y<=H;Y++){var w=this.hash[Y+","+W];if(w){if(J){var j=w.length;for(var C=0;C<j;C++){var X=w[C],G=X.AABB;if(G.x+G.width>Z.x&&G.x<Z.x+Z.width&&G.y+G.height>Z.y&&G.y<Z.y+Z.height)K.push(X)}}else K=K.concat(w);Q++}}return this.lastBuckets=Q,K},$.prototype.queryCallbackAll=function(Z,J,Q){if(J===void 0)J=!0;var K=0,q=[],V=this.getBounds(Z),U=V.xStart,H=V.yStart,z=V.xEnd,W=V.yEnd;for(var Y=H;Y<=W;Y++)for(var w=U;w<=z;w++){var j=this.hash[w+","+Y];if(j){if(J){var C=j.length;for(var X=0;X<C;X++){var G=j[X],F=G.AABB;if(F.x+F.width>Z.x&&F.x<Z.x+Z.width&&F.y+F.height>Z.y&&F.y<Z.y+Z.height)q.push(G),Q(G)}}else{q=q.concat(j);for(var L=0,N=j;L<N.length;L++){var G=N[L];Q(G)}}K++}}return this.lastBuckets=K,q},$.prototype.queryCallback=function(Z,J,Q){if(Q===void 0)Q=!0;var K=this.getBounds(Z),q=K.xStart,V=K.yStart,U=K.xEnd,H=K.yEnd;for(var z=V;z<=H;z++)for(var W=q;W<=U;W++){var Y=this.hash[W+","+z];if(Y)for(var w=0;w<Y.length;w++){var j=Y[w];if(Q){var C=j.AABB;if(C.x+C.width>C.x&&C.x<C.x+C.width&&C.y+C.height>C.y&&C.y<C.y+C.height){if(J(j))return!0}}else if(J(j))return!0}}return!1},$.prototype.stats=function(){var Z=0,J=0,Q=this.elements.length;for(var K=0;K<Q;K++){var q=this.elements[K];Z+=q.visible?1:0,J++}for(var V=0,U=this.containers;V<U.length;V++){var H=U[V],z=H.children.length;for(var K=0;K<z;K++){var q=H.children[K];Z+=q.visible?1:0,J++}}return{buckets:this.lastBuckets,total:J,visible:Z,culled:J-Z}},$.prototype.getNumberOfBuckets=function(){return Object.keys(this.hash).length},$.prototype.getAverageSize=function(){var Z=0;for(var J in this.hash)Z+=this.hash[J].length;return Z/this.getBuckets().length},$.prototype.getLargest=function(){var Z=0;for(var J in this.hash)if(this.hash[J].length>Z)Z=this.hash[J].length;return Z},$.prototype.getWorldBounds=function(){var Z=Infinity,J=Infinity,Q=0,K=0;for(var q in this.hash){var V=q.split(","),U=parseInt(V[0]),H=parseInt(V[1]);Z=U<Z?U:Z,J=H<J?H:J,Q=U>Q?U:Q,K=H>K?H:K}return{xStart:Z,yStart:J,xEnd:Q,yEnd:K}},$.prototype.getSparseness=function(Z){var J=0,Q=0,K=Z?this.getBounds(Z):this.getWorldBounds(),q=K.xStart,V=K.yStart,U=K.xEnd,H=K.yEnd;for(var z=V;z<H;z++)for(var W=q;W<U;W++)J+=this.hash[W+","+z]?1:0,Q++;return J/Q},$}();class pJ{Initialized=!1;container;skillTreeData;skillTreeDataCompare;_lastTick=Date.now();constructor($,Z,J){this.container=$,this.skillTreeData=Z,this.skillTreeDataCompare=J}Tick(){const $=Date.now(),Z=this._lastTick-$;if(this._lastTick=$,this.PreUpdate(Z),this.IsDirty())this.Update(Z);this.PostUpdate(Z),requestAnimationFrame(()=>{this.Tick()})}RenderBase=()=>{if(!this.Initialized)return;this.SetupLayers(),this.GenerateCompare(),this.ClearLayer(y.Background),this.DrawBackground(),this.ClearLayer(y.GroupBackground),this.DrawGroupBackgrounds(),this.DrawAscendacyBackgrounds(),this.ClearLayer(y.CharacterStarts),this.DrawInactiveCharacters(),this.ClearLayer(y.Connections),this.DrawConnectionsForNodes(y.Connections,this.skillTreeData.nodes),this.ClearLayer(y.SkillIcons),this.ClearLayer(y.SkillIconsFrames),this.ClearLayer(y.SkillIconsCompare),this.DrawInactiveNodes(),this.DrawCompareHighlights()};DrawBackground=()=>{var $=this.skillTreeData.hasSprite("background","Background1")?"Background1":"Background2",Z={patch:this.skillTreeData.patch,key:this.skillTreeData.tree==="Atlas"?"atlasBackground":"background",icon:this.skillTreeData.tree==="Atlas"?"AtlasPassiveBackground":$};this.DrawBackgroundAsset(y.Background,Z)};GenerateCompare=()=>{if(this.skillTreeDataCompare===void 0)return;for(let $ in this.skillTreeData.nodes){const Z=this.skillTreeData.nodes[$];if(Z.nodeGroup===void 0||Z.classStartIndex!==void 0)continue;if(this.skillTreeDataCompare.nodes[Z.GetId()]===void 0)continue;const J=this.skillTreeDataCompare.nodes[Z.GetId()];let Q=Z.stats.length!==J.stats.length;for(let V of Z.stats){let U=!1;for(let H of J.stats)if(V.toUpperCase()===H.toUpperCase())U=!0;if(!U){Q=!0;break}}if(Q)this.skillTreeDataCompare.addState(J,P.Compared);const K=Z.GetTargetSize();if(K.width!==0&&K.height!==0&&(Math.abs(Z.x-J.x)>K.width||Math.abs(Z.y-J.y)>K.height))this.skillTreeDataCompare.addState(J,P.Moved)}};DrawGroupBackgrounds=()=>{const $=[];for(let Z in this.skillTreeData.groups){const J=this.skillTreeData.groups[Z],Q=J.background;if(Q===void 0)continue;$.push({patch:this.skillTreeData.patch,key:"groupBackground",icon:Q.image,x:Math.ceil(J.x*this.skillTreeData.scale)+(Q.offsetX?Q.offsetX*this.skillTreeData.scale:0),y:Math.ceil(J.y*this.skillTreeData.scale)+(Q.offsetY?Q.offsetY*this.skillTreeData.scale:0),half:Q.isHalfImage})}this.DrawSpriteSheetAssets(y.GroupBackground,$)};DrawAscendacyBackgrounds=()=>{for(let $ in this.skillTreeData.ascedancyNodes){const Z=this.skillTreeData.ascedancyNodes[$];if(!Z.isAscendancyStart||Z.nodeGroup===void 0)continue;const{nodeGroup:J,ascendancyName:Q}=Z;if(!this.skillTreeData.hasSprite("ascendancyBackground",`Classes${Q}`))continue;const K={patch:this.skillTreeData.patch,key:"ascendancyBackground",icon:`Classes${Q}`,x:Math.ceil(J.x*this.skillTreeData.scale),y:Math.ceil(J.y*this.skillTreeData.scale),mask:"circle"},q=this.DrawSpriteSheetAsset(y.GroupBackground,K);if(this.skillTreeData.classes===void 0)continue;for(let V in this.skillTreeData.classes){const U=this.skillTreeData.classes[V];for(let H in U.ascendancies){const z=U.ascendancies[H];if(z.name!==Q||z.flavourTextRect===void 0)continue;const W=[z.flavourTextRect.x,z.flavourTextRect.y],Y=Math.ceil((J.x+ +W[0])*this.skillTreeData.scale)-q.width/2,w=Math.ceil((J.y+ +W[1])*this.skillTreeData.scale)-q.height/2,[j,C,X]=this.ExtractColour(z.flavourTextColour),G="0x"+((1<<24)+(j<<16)+(C<<8)+X).toString(16).slice(1);this.DrawText(y.GroupBackground,z.flavourText,G,Y,w)}}}};ExtractColour=($)=>{let Z=0,J=0,Q=0;if($.indexOf(",")>0){const K=$.split(",");Z=+K[0],J=+K[1],Q=+K[2]}else{const K=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec("#"+$);if(K&&K.length===4)Z=parseInt(K[1],16),J=parseInt(K[2],16),Q=parseInt(K[3],16)}return[Z,J,Q]};DrawInactiveCharacters=()=>{if(!this.skillTreeData.hasSprite("startNode","PSStartNodeBackgroundInactive"))return;const $=[];for(let Z of this.skillTreeData.root.out){const J=this.skillTreeData.nodes[Z];if(J.classStartIndex===void 0||J.nodeGroup===void 0)continue;$.push({patch:this.skillTreeData.patch,key:"startNode",icon:"PSStartNodeBackgroundInactive",x:J.nodeGroup.x*this.skillTreeData.scale,y:J.nodeGroup.y*this.skillTreeData.scale})}this.DrawSpriteSheetAssets(y.CharacterStarts,$)};DrawInactiveNodes=()=>{if(this.DrawNodes(y.SkillIcons,this.skillTreeData.nodes,this.skillTreeData.nodes,{filterClassIndex:!0,bindEvents:!0}),this.skillTreeDataCompare===void 0)return;const $={};for(let Z in this.skillTreeDataCompare.nodes){const J=this.skillTreeDataCompare.nodes[Z];if(this.skillTreeData.nodes[J.GetId()]!==void 0)continue;$[Z]=J}this.DrawNodes(y.SkillIconsCompare,$,this.skillTreeDataCompare.nodes,{filterClassIndex:!0,bindEvents:!0})};DrawCompareHighlights=()=>{if(this.skillTreeDataCompare===void 0)return;const $=[];for(let J in this.skillTreeData.nodes){const Q=this.skillTreeData.nodes[J];if(Q.nodeGroup===void 0||Q.classStartIndex!==void 0)continue;const K=this.skillTreeDataCompare.nodes[Q.GetId()];if(K===void 0)$.push({node:Q,color:$$.Added});else{if(!(K.is(P.Compared)||K.is(P.Moved)))continue;$.push({node:Q,color:$$.Changed})}}this.DrawHighlights(y.SkillIconsFrames,$);const Z=[];for(let J in this.skillTreeDataCompare.nodes){const Q=this.skillTreeDataCompare.nodes[J];if(this.skillTreeData.nodes[Q.GetId()]!==void 0)continue;this.skillTreeDataCompare.addState(Q,P.Compared),Z.push({node:Q,color:$$.Removed})}this.DrawHighlights(y.SkillIconsCompare,Z)};DrawConnectionsForNodes=($,Z)=>{const J=[],Q={};for(let K in Z){const q=Z[K];if(q.nodeGroup===void 0||$===y.Connections&&q.classStartIndex!==void 0)continue;let V=q.in.filter((U)=>!Q[`${+K}-${U}`]||!Q[`${U}-${+K}`]).map((U)=>{return Q[`${+K}-${U}`]=!0,Q[`${U}-${+K}`]=!0,this.skillTreeData.nodes[U]});if($===y.Connections)V=V.filter((U)=>U.classStartIndex===void 0);for(let U of V){if(!this.IsValidConnection(q,U))continue;const H=q.GetConnectionType(U),z=q.group===U.group&&q.orbit===U.orbit?x7.Arc:x7.Line,W=z===x7.Arc?`Orbit${q.orbit}${H}`:`LineConnector${H}`,Y=q.is(P.Active|P.Pathing)&&U.is(P.Active|P.Pathing);J.push({patch:q.patch,key:"line",icon:W,style:z,node:q,other:U,removing:Y})}}this.DrawConnections($,J)};IsValidConnection=($,Z)=>{if($.ascendancyName!==""&&Z.ascendancyName===""||$.ascendancyName===""&&Z.ascendancyName!=="")return!1;if($.classStartIndex!==void 0||Z.classStartIndex!==void 0){const J=this.skillTreeData.getStartClass();return $.classStartIndex===J||Z.classStartIndex===J}if($.isMastery||Z.isMastery)return!1;if($.isWormhole&&Z.isWormhole)return!1;if(($.is(P.Pathing)||$.is(P.Hovered))&&!(Z.is(P.Pathing)||Z.is(P.Hovered)||Z.is(P.Active)))return!1;return!0};DrawNodes=($,Z,J,Q)=>{const K=[],q=[],V=[],U=[];for(let H in Z){const z=Z[H];if(z.nodeGroup===void 0||Q.filterClassIndex&&z.classStartIndex!==void 0)continue;if(z.activeEffectImage!==""&&z.is(P.Active))K.push({patch:z.patch,key:"masteryActiveEffect",icon:z.activeEffectImage,x:z.x,y:z.y});const W=z.GetIcon();if(!z.isAscendancyStart&&W!=="")if(this.skillTreeData.tree==="Atlas"&&z.isMastery&&z.is(P.Hovered))if(this.skillTreeData.hasSprite("masteryOverlay",W))V.push({patch:z.patch,key:"masteryOverlay",icon:W,x:z.x,y:z.y});else V.push({patch:z.patch,key:"mastery",icon:W,x:z.x,y:z.y,scale:2.5});else q.push({patch:z.patch,key:z.GetSpriteSheetKey(),icon:W,x:z.x,y:z.y,node:Q.bindEvents?z:void 0});let Y=z.out.map((C)=>J[C]).filter((C)=>C);if(Q.filterClassIndex)Y=Y.filter((C)=>C.classStartIndex===void 0);if(Q.outFrames)for(let C of Y){if(C.classStartIndex!==void 0)continue;const X=C.in.map((L)=>J[L]),G=C.GetFrameAssetKey(X),F=G?.startsWith("Ascendancy")?"ascendancy":"frame";if(G!==null)U.push({patch:z.patch,key:F,icon:G,x:C.x,y:C.y})}const w=z.GetFrameAssetKey(Y),j=w?.startsWith("Ascendancy")?"ascendancy":"frame";if(w!==null)U.push({patch:z.patch,key:j,icon:w,x:z.x,y:z.y,node:Q.bindEvents?z:void 0})}this.DrawSpriteSheetAssets(y.SkillIconsActiveEffects,K),this.DrawSpriteSheetAssets(y.AtlasMasteryHighlight,V),this.DrawSpriteSheetAssets($,q),this.DrawSpriteSheetAssets($+3,U)};RenderActive=()=>{if(!this.Initialized)return;this.ClearLayer(y.ConnectionsPathing),this.ClearLayer(y.ConnectionsActive),this.DrawConnectionsForNodes(y.ConnectionsActive,this.skillTreeData.getNodes(P.Active)),this.ClearLayer(y.SkillIconsPathing),this.ClearLayer(y.SkillIconsPathingFrames),this.ClearLayer(y.SkillIconsActive),this.ClearLayer(y.SkillIconsActiveFrames),this.ClearLayer(y.SkillIconsActiveEffects),this.DrawNodes(y.SkillIconsActive,this.skillTreeData.getNodes(P.Active),this.skillTreeData.nodes,{outFrames:!0})};RenderCharacterStartsActive=()=>{if(!this.Initialized)return;this.ClearLayer(y.BackgroundActive),this.ClearLayer(y.CharacterStartsActive);const $=[],Z=[];for(let Q of this.skillTreeData.root.out){const K=this.skillTreeData.nodes[Q],q=K.classStartIndex;if(q===void 0||!K.is(P.Active)||K.nodeGroup===void 0)continue;const V=I0.getKeyByValue(this.skillTreeData.constants.classes,q);if(this.skillTreeData.hasSprite("startNode","AtlasPassiveSkillScreenStart"))Z.push({patch:K.patch,key:"startNode",icon:"AtlasPassiveSkillScreenStart",x:K.x,y:K.y});else if(V!==void 0){const U=this.skillTreeData.constants.classesToName[V];var J=`Background${V.replace("Class","")}`;if(this.skillTreeData.extraImages!==void 0&&this.skillTreeData.hasSprite("startNode",J)){const H=this.skillTreeData.extraImages[q];if(H)$.push({patch:K.patch,key:"startNode",icon:J,x:H.x*this.skillTreeData.scale,y:H.y*this.skillTreeData.scale,offsetX:0})}Z.push({patch:K.patch,key:"startNode",icon:`center${U.toLocaleLowerCase()}`,x:K.x,y:K.y})}}this.DrawSpriteSheetAssets(y.BackgroundActive,$),this.DrawSpriteSheetAssets(y.CharacterStartsActive,Z)};RenderHighlight=()=>{if(!this.Initialized)return;this.ClearLayer(y.Highlights);const $=[],Z=this.skillTreeData.getNodes(P.Highlighted);for(let K in Z)$.push({node:Z[K],color:$$.Searched});const J=this.skillTreeData.getNodes(P.Desired);for(let K in J)$.push({node:J[K],color:$$.Desired});const Q=this.skillTreeData.getNodes(P.UnDesired);for(let K in Q)$.push({node:Q[K],color:$$.UnDesired});this.DrawHighlights(y.Highlights,$)};StartRenderHover=($)=>{if(!this.Initialized)return;if(this.StopRenderHover($),this.DrawConnectionsForNodes(y.ConnectionsPathing,this.skillTreeData.getHoveredNodes()),this.DrawNodes(y.SkillIconsPathing,this.skillTreeData.getHoveredNodes(),this.skillTreeData.nodes,{}),this.DrawCompareMovedHighlights(),this.skillTreeDataCompare!==void 0&&$.is(P.Compared))this.skillTreeDataCompare.addState($,P.Hovered);this.RenderTooltip($)};StopRenderHover=($)=>{if(!this.Initialized)return;this.ClearLayer(y.ConnectionsPathing),this.ClearLayer(y.SkillIconsPathing),this.ClearLayer(y.SkillIconsPathingFrames),this.ClearLayer(y.AtlasMasteryHighlight),this.ClearLayer(y.NodeMoveCompare),this.ClearLayer(y.Tooltip),this.ClearLayer(y.TooltipCompare),this.DestroyTooltips()};DrawCompareMovedHighlights=()=>{if(this.skillTreeDataCompare===void 0)return;this.skillTreeDataCompare.clearState(P.Hovered);const $=this.skillTreeData.getNodes(P.Hovered),Z=[];for(let J in $){const Q=$[J];let K=this.skillTreeDataCompare.nodes[Q.GetId()];if(K===void 0)for(let q in this.skillTreeDataCompare.nodes){const V=this.skillTreeDataCompare.nodes[q];if(Math.abs(V.x-Q.x)<5&&Math.abs(V.y-Q.y)<5)K=V}if(K){if(K.is(P.Compared))this.skillTreeDataCompare.addState(K,P.Hovered);if(K.nodeGroup!==void 0&&K.is(P.Moved))Z.push({node:K,color:$$.Moved})}}this.DrawHighlights(y.NodeMoveCompare,Z)}}var y;(function(k){k[k["Background"]=0]="Background";k[k["BackgroundActive"]=1]="BackgroundActive";k[k["GroupBackground"]=2]="GroupBackground";k[k["Connections"]=3]="Connections";k[k["SkillIconsActiveEffects"]=4]="SkillIconsActiveEffects";k[k["ConnectionsActive"]=5]="ConnectionsActive";k[k["ConnectionsPathing"]=6]="ConnectionsPathing";k[k["SkillIcons"]=7]="SkillIcons";k[k["SkillIconsActive"]=8]="SkillIconsActive";k[k["SkillIconsPathing"]=9]="SkillIconsPathing";k[k["SkillIconsFrames"]=10]="SkillIconsFrames";k[k["SkillIconsActiveFrames"]=11]="SkillIconsActiveFrames";k[k["SkillIconsPathingFrames"]=12]="SkillIconsPathingFrames";k[k["CharacterStarts"]=13]="CharacterStarts";k[k["CharacterStartsActive"]=14]="CharacterStartsActive";k[k["JewelSocketActive"]=15]="JewelSocketActive";k[k["JewelSocketHighlights"]=16]="JewelSocketHighlights";k[k["SkillIconsCompare"]=17]="SkillIconsCompare";k[k["Highlights"]=18]="Highlights";k[k["NodeMoveCompare"]=19]="NodeMoveCompare";k[k["AtlasMasteryHighlight"]=20]="AtlasMasteryHighlight";k[k["Tooltip"]=21]="Tooltip";k[k["TooltipCompare"]=22]="TooltipCompare"})(y||(y={}));var $$;(function(U){U[U["Added"]=65280]="Added";U[U["Changed"]=16756736]="Changed";U[U["Removed"]=16711680]="Removed";U[U["Moved"]=16716947]="Moved";U[U["Searched"]=11817727]="Searched";U[U["Desired"]=5439412]="Desired";U[U["UnDesired"]=16023423]="UnDesired"})($$||($$={}));class uJ extends pJ{NodeTooltips;NodeSpritesheets;_dirty=!0;pixi;viewport;cull;DO_NOT_CULL=[y.Tooltip,y.TooltipCompare];LayerContainers={[y.Background]:new i,[y.BackgroundActive]:new i,[y.GroupBackground]:new i,[y.Connections]:new i,[y.SkillIconsActiveEffects]:new i,[y.ConnectionsActive]:new i,[y.ConnectionsPathing]:new i,[y.SkillIcons]:new i,[y.SkillIconsActive]:new i,[y.SkillIconsPathing]:new i,[y.SkillIconsFrames]:new i,[y.SkillIconsActiveFrames]:new i,[y.SkillIconsPathingFrames]:new i,[y.CharacterStarts]:new i,[y.CharacterStartsActive]:new i,[y.JewelSocketActive]:new i,[y.JewelSocketHighlights]:new i,[y.SkillIconsCompare]:new i,[y.Highlights]:new i,[y.NodeMoveCompare]:new i,[y.AtlasMasteryHighlight]:new i,[y.Tooltip]:new i,[y.TooltipCompare]:new i};constructor($,Z,J){super($,Z,J);this.NodeTooltips={},this.NodeSpritesheets={},this.pixi=new f8({resizeTo:window,resolution:devicePixelRatio,sharedTicker:!0,backgroundColor:Z.patch.compare(P7.v3_16_0)>=0?461584:1709073}),Y0.shared.stop(),Y0.system.stop(),$.appendChild(this.pixi.view),i.defaultSortableChildren=!1,p.defaultOptions.scaleMode=a0.NEAREST,I.ROUND_PIXELS=!1,I.RESOLUTION=devicePixelRatio,A.destroyTextureCache(),h7.reset();const Q=this.skillTreeData.imageZoomLevels.length>2?this.skillTreeData.imageZoomLevels[1]-this.skillTreeData.imageZoomLevels[0]:0.1;this.viewport=new tZ({screenWidth:this.pixi.screen.width,screenHeight:this.pixi.screen.height,worldWidth:this.skillTreeData.width*(this.skillTreeData.scale*1.25),worldHeight:this.skillTreeData.height*(this.skillTreeData.scale*1.25),events:this.pixi.renderer.events,noTicker:!0,stopPropagation:!0}),this.viewport.name="viewport",this.viewport.drag().wheel({percent:Q}).pinch({percent:Q*10}),this.viewport.clampZoom({minWidth:this.skillTreeData.width*(Q/8),minHeight:this.skillTreeData.height*(Q/8)}),this.viewport.fitWorld(!0),this.viewport.zoomPercent(1.726),this.viewport.on("drag-start",(K)=>m.fire("viewport","drag-start",K.world)),this.viewport.on("drag-end",(K)=>m.fire("viewport","drag-end",K.world)),this.viewport.on("mouseup",()=>m.fire("viewport","mouseup")),this.viewport.on("touchend",()=>m.fire("viewport","touchend")),this.viewport.on("touchcancel",()=>m.fire("viewport","touchcancel")),this.viewport.on("click",(K)=>this.HandleZoomClick(K,Q*2)),this.viewport.on("click",this.HandleShiftClick),this.viewport.on("rightdown",(K)=>this.HandleZoomClick(K,-Q*2)),this.pixi.stage.addChild(this.viewport),window.onresize=()=>{this.pixi.renderer.resize(window.innerWidth,window.innerHeight),this.viewport.resize(this.pixi.renderer.width,this.pixi.renderer.height,this.skillTreeData.width*(this.skillTreeData.scale*1.25),this.skillTreeData.height*(this.skillTreeData.scale*1.25)),this.viewport.clampZoom({minWidth:this.skillTreeData.width*(Q/8),minHeight:this.skillTreeData.height*(Q/8)})},this.cull=new HV({size:512}),super.Tick()}HandleZoomClick=($,Z)=>{if(!$.ctrlKey)return;$.preventDefault(),this.viewport.zoomPercent(Z,!1)};HandleShiftClick=($)=>{if(!$.shiftKey)return;const J=new B6(this.viewport.getChildAt(y.SkillIcons)).hitTest($.global.x,$.global.y);if(J===null||J.name===void 0||J.name===null||J.name==="")return;if(this.skillTreeData.nodes[J.name].isKeystone)return};IsDirty(){return this._dirty||this.viewport.dirty}PreUpdate($){this.viewport.update($)}Update($){this.cull.cull(this.viewport.getVisibleBounds()),this.pixi.render(),this._dirty=this.viewport.dirty=!1}PostUpdate($){}SetupLayers(){this.viewport.removeChildren();for(let $ in this.LayerContainers){const Z=Number($),J=this.LayerContainers[Z];if(this.DO_NOT_CULL.indexOf(Z)===-1)this.cull.addContainer(J);this.viewport.addChild(J)}}SetLayer($,Z){this._dirty=!0,this.LayerContainers[$]=Z;const J=this.viewport.getChildAt($);if(this.DO_NOT_CULL.indexOf($)===-1)this.cull.removeContainer(J);if(this.DO_NOT_CULL.indexOf($)===-1)this.cull.addContainer(Z);if(Z===J)return;this.viewport.addChild(Z),this.viewport.swapChildren(J,Z),this.viewport.removeChild(J)}GetLayer($){return this.viewport.getChildAt($)}ClearLayer($){this.SetLayer($,new i)}async Initialize(){if(this.Initialized)return!0;return await this.LoadAssets([this.skillTreeData,this.skillTreeDataCompare]),this.InitializeSpriteSheets()}LoadAssets=($)=>{const Z=$.filter(I0.NotUndefined);if(Z.length<=0)throw new Error("SkillTreeData has not been defined. Could not load assets.");const J=new Array;for(let V of Z)for(let U in V.sprites){const H=V.sprites[U],z=H[V.scale.toString()]||H["1"];if(z===void 0)continue;const W=z.filename;if(W==="LOAD_COORDS"){for(let Y in z.coords)if(J.indexOf(Y)<0)J.push(Y),h7.add(Y,`${I0.SKILL_TREES_URI}/${V.patch}/assets/${Y}.png`)}else if(J.indexOf(W)<0)J.push(W),h7.add(W,`${I0.SKILL_TREES_URI}/${V.patch}/assets/${W}`)}const K=Z[0].width/2;let q="";return h7.load(J,(V)=>{const U=`${V*100}%`;if(U!==q){this.viewport.removeChildren(),q=U;const H=new U7;H.moveTo(0,0),H.beginFill(16777215,0.75),H.lineStyle(2,13350300),H.drawRect(0,0,V*K,50),H.endFill(),this.viewport.addChild(H);const z=new H7(q,{fontSize:250,fill:16777215});z.position.set(0,-50),this.viewport.addChild(z),this.Tick()}}).then((V)=>!0)};async InitializeSpriteSheets(){if(this.Initialized)return!0;const $=new Promise((Z)=>{this.LoadSpriteSheetAssets([this.skillTreeData,this.skillTreeDataCompare]).then(()=>Z(!0))});return $.then(()=>this.Initialized=!0),$}LoadSpriteSheetAssets=($)=>{for(let J of $){if(J===void 0)continue;const Q=J.sprites;for(let K in Q){const q=this.GetSpritesheetKey(J.patch,K);if(this.NodeSpritesheets[q]===void 0)this.NodeSpritesheets[q]=[];const V=Q[K][J.scale.toString()]||Q[K]["1"];if(V===void 0)continue;const U=V.filename;if(U==="LOAD_COORDS")for(let H in V.coords){const z=S.from(H),W=this.GetCoordSpritesheetData(V,q,H,z);this.NodeSpritesheets[q]?.push(new L$(z.baseTexture,W))}else{const H=S.from(U),z=this.GetSpritesheetData(V,q);this.NodeSpritesheets[q]?.push(new L$(H.baseTexture,z))}}}const Z=new Array;for(let J in this.NodeSpritesheets){const Q=this.NodeSpritesheets[J];if(Q!==void 0)for(let K in Q){const q=new Promise((V)=>this.NodeSpritesheets[J][K].parse().then((U)=>V(!0)));Z.push(q)}}return Promise.all(Z)};GetSpritesheetData=($,Z)=>{let J={frames:{},animations:void 0,meta:{scale:"1"}};for(let Q in $.coords){const K=$.coords[Q],q=this.GetSpritesheetFrameKey(Z,Q);J.frames[q]={frame:K,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0},sourceSize:{w:K.w,h:K.h}}}return J};GetCoordSpritesheetData=($,Z,J,Q)=>{let K={frames:{},animations:void 0,meta:{scale:"1"}};const q=$.coords[J],V=this.GetSpritesheetFrameKey(Z,J);if(q.w===-1&&q.h===-1)q.w=Q.width,q.h=Q.height;return K.frames[V]={frame:q,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0},sourceSize:{w:q.w,h:q.h}},K};GetSpritesheetKey=($,Z)=>{return`${$.version}/${Z}`};GetSpritesheetFrameKey=($,Z)=>{return`${$}/${Z.startsWith("PassiveSkillScreen")?Z.replace("PassiveSkillScreen",""):Z}`};DrawSpriteSheetAsset=($,Z)=>{return this.DrawSpriteSheetAssets($,[Z])[0]};DrawSpriteSheetAssets=($,Z)=>{const J=[],Q=this.GetLayer($);for(var K of Z){const q=this.GetSpritesheetTexture(K.patch,K.key,K.icon);if(q===null||!q.valid)continue;const V=k0.from(q);V.name=`${K.patch}/${K.key}/${K.icon}`,V.position.set(K.x,K.y);const U=K.offsetX===void 0?0.5:K.offsetX;if(V.anchor.set(U,K.offsetY),K.scale!==void 0)V.scale.set(K.scale);if(Q.addChild(V),K.half){V.anchor.set(U,1);const H=k0.from(q);H.name=`${V.name}-half`,H.rotation=Math.PI,H.position.set(K.x,K.y),H.anchor.set(U,1),H.scale=V.scale,Q.addChild(H)}if(K.mask=="circle"){const H=new U7;H.beginFill(65280),H.drawCircle(V.x,V.y,V.height/2),H.endFill(),V.mask=H,Q.addChild(H)}if(K.node&&(K.key==="frame"||K.key==="ascendancy"||K.node.isMastery))this.RebindNodeEvents(K.node,V);else V.eventMode="none";J.push({width:V.width,height:V.height*(K.half?2:1)})}return this.SetLayer($,Q),J};DrawText=($,Z,J,Q,K)=>{const q=this.GetLayer($),V=new H7(Z,{fill:J,fontSize:48,fontFamily:"serif",fontStyle:"italic",stroke:0,strokeThickness:4});V.name=Z,V.position.set(Q,K),V.scale.set(this.skillTreeData.scale),q.addChild(V),this.SetLayer($,q)};DrawBackgroundAsset=($,Z)=>{const J=this.GetLayer($),Q=this.GetSpritesheetTexture(Z.patch,Z.key,Z.icon);if(Q===null||!Q.valid)return;let K=k0.from(Q);if(K.name=Z.icon,Z.icon==="AtlasPassiveBackground")K.scale.set(2.8173),K.anchor.set(0.504,0.918);else Q.baseTexture.wrapMode=x0.REPEAT,K=n8.from(Q.baseTexture,{width:this.skillTreeData.width*(this.skillTreeData.scale*1.25),height:this.skillTreeData.height*(this.skillTreeData.scale*1.25)}),K.anchor.set(0.5);J.addChild(K),this.SetLayer($,J)};DrawConnections=($,Z)=>{const J=this.GetLayer($),Q=new i;for(let K of Z){const q=this.DrawConnection(K);if(q)Q.addChild(q)}J.addChild(Q),this.SetLayer($,J)};DrawConnection=($)=>{switch($.style){case x7.Arc:return this.DrawArcConnection($);case x7.Line:return this.DrawLineConnection($)}};DrawArcConnection=($)=>{const Z=this.GetSpritesheetTexture($.patch,$.key,$.icon);if(Z===null||!Z.valid)return null;const{node:J,other:Q}=$;if(J.nodeGroup===void 0)return null;let K=J.arc<Q.arc?J.arc:Q.arc,q=J.arc<Q.arc?Q.arc:J.arc;const V=q-K;if(V>=Math.PI){const w=2*Math.PI-V;K=q,q=K+w}K-=Math.PI/2,q-=Math.PI/2;let U=q-K;const H=Math.ceil(U/(Math.PI/2)),z=Math.PI/2+K,W=new i,Y=new U7;Y.lineStyle(50*J.scale,16761035),Y.arc(J.nodeGroup.x*J.scale,J.nodeGroup.y*J.scale,J.orbitRadii[J.orbit]*J.scale,K,q,!1),W.addChild(Y);for(let w=0;w<H;++w){const j=k0.from(Z);if(j.rotation=U+z,j.position.set(J.nodeGroup.x*J.scale,J.nodeGroup.y*J.scale),j.anchor.set(1),$.removing)j.tint=16711680;if(j.mask=Y,W.addChild(j),U<Math.PI/2)continue;U-=Math.PI/2}return W};DrawLineConnection=($)=>{const Z=$.node.skill>$.other.skill?$.node:$.other,J=$.node.skill>$.other.skill?$.other:$.node,Q=this.GetSpritesheetTexture($.patch,$.key,$.icon);if(Q===null||!Q.valid)return null;const K=new i,q=Math.atan2(J.y-Z.y,J.x-Z.x);let V=Math.hypot(Z.x-J.x,Z.y-J.y);var U={x:Z.x,y:Z.y},H=Math.ceil(V/Q.frame.width);for(let z=0;z<H;++z){const W=V>=Q.frame.width?Q:new S(Q.baseTexture,new c(Q.frame.x,Q.frame.y,V,Q.frame.height)),Y=k0.from(W);if(Y.anchor.set(0,0.5),Y.position.set(U.x,U.y),Y.rotation=q,$.removing)Y.tint=16711680;K.addChild(Y),U={x:U.x+Y.width*Math.cos(q),y:U.y+Y.width*Math.sin(q)},V-=Q.frame.width}return K};DrawHighlights=($,Z)=>{const J=this.GetLayer($);for(var Q of Z){const K=Q.node.GetTargetSize();if(K.width===0||K.height===0)continue;const q=new U7;q.name=`highlight-${Q.node.id}`,q.beginFill(0,0),q.lineStyle(5,Q.color),q.drawCircle(0,0,Math.max(K.width,K.height)*0.85),q.endFill(),q.position.set(Q.node.x,Q.node.y),J.addChild(q)}this.SetLayer($,J)};CreateScreenshot=($)=>{return this.pixi.renderer.plugins.extract.base64(this.viewport,$,1)};GetSpritesheetTexture=($,Z,J)=>{const Q=this.GetSpritesheetKey($,Z),K=this.GetSpritesheetFrameKey(Q,J),q=this.NodeSpritesheets[Q];if(q!==void 0)for(let V of q){const U=V.textures[K];if(U!==void 0)return U}return console.warn(`Texture not found for ${K}`),null};RebindNodeEvents=($,Z)=>{Z.removeAllListeners(),Z.hitArea=new v$(0,0,Math.max(Z.texture.width,Z.texture.height)/2),Z.name=`${Z.name}-${$.GetId()}`;const J=m.getEvents("node");if(J!==void 0){Z.eventMode="static";for(let Q of J)Z.addEventListener(Q,(K)=>{if((Q==="click"||Q==="tap")&&(K.shiftKey||K.ctrlKey||K.altKey))return;m.fire("node",Q,$)})}};RenderTooltip=($)=>{const Z=this.GetLayer(y.Tooltip),J=this.GetLayer(y.TooltipCompare);let Q=void 0,K=void 0;const q=10,V=this.CreateTooltip($);if(V.position.set(q/2,q/2),this.skillTreeData.patch===$.patch)Q=new U7,Q.beginFill(0,0.75),Q.lineStyle(2,13350300),Q.drawRect(0,0,V.width+q,V.height+q),Q.endFill(),Q.addChild(V);let U=void 0;if(this.skillTreeDataCompare!==void 0){const H=this.skillTreeDataCompare.getNodes(P.Hovered);for(let z in H){const W=H[z];if(W.nodeGroup===void 0)continue;U=W;const Y=10,w=this.CreateTooltip(W);w.position.set(Y/2,Y/2),K=new U7,K.beginFill(0,0.75),K.lineStyle(2,16756736),K.drawRect(0,0,w.width+Y,w.height+Y),K.endFill(),K.addChild(w)}}if(Q===void 0&&K!==void 0&&U!==void 0)Q=K,$=U,K=void 0,U=void 0;if(Q!==void 0)Z.addChild(Q);if(K!==void 0)J.addChild(K);if(Q!==void 0&&$!==void 0){const H=Q.getBounds(),z=$.GetTargetSize(),W=Q.width/H.width/devicePixelRatio,Y=Q.height/H.height/devicePixelRatio;if(Q.worldTransform.tx+H.width>screen.width)Q.x=$.x-Q.width*W-z.width;else Q.x=$.x+z.width;if(Q.worldTransform.ty+H.height>screen.height)Q.y=$.y-Q.height*Y+z.height/2;else Q.y=$.y-z.height/2;if(Q.scale.set(W,Y),K!==void 0&&U!==void 0){const w=K.getBounds();K.y=Q.y,K.x=Q.x+Q.width,K.scale.set(K.width/w.width/devicePixelRatio,K.height/w.height/devicePixelRatio)}}this.SetLayer(y.Tooltip,Z),this.SetLayer(y.TooltipCompare,J)};CreateTooltip=($)=>{let Z=this.NodeTooltips[`${$.GetId()}_${$.patch}`];const J=this.skillTreeData.getNodes(P.Desired);if(Z===void 0){let Q=$.name.length>0?new H7(`${$.name} [${$.id}]`,{fill:16777215,fontSize:18}):null,K=$.stats.filter(I0.NotNullOrWhiteSpace).length>0?new H7(`\n${$.stats.filter(I0.NotNullOrWhiteSpace).join("\n")}`,{fill:16777215,fontSize:14}):null,q=$.flavourText.filter(I0.NotNullOrWhiteSpace).length>0?new H7(`\n${$.flavourText.filter(I0.NotNullOrWhiteSpace).join("\n")}`,{fill:11493413,fontSize:14}):null,V=$.reminderText.filter(I0.NotNullOrWhiteSpace).length>0?new H7(`\n${$.reminderText.filter(I0.NotNullOrWhiteSpace).join("\n")}`,{fill:8421504,fontSize:14}):null,U=J[$.id]!==void 0?new H7("Desired",{fill:16777215,fontSize:18}):null;Z=new i,Z.position.set(0,0);let H=0;if(Q!==null)Z.addChild(Q),Q.position.set(0,H),H+=Q.height;if(K!==null)Z.addChild(K),K.position.set(0,H),H+=K.height;if(q!==null)Z.addChild(q),q.position.set(0,H),H+=q.height;if(V!==null)Z.addChild(V),V.position.set(0,H),H+=V.height;if(U!==null)Z.addChild(U),U.position.set(0,H),H+=U.height;Z.eventMode="none",Z.containerUpdateTransform=()=>{},this.NodeTooltips[`${$.GetId()}_${$.patch}`]=Z}return Z};DestroyTooltips=()=>{for(let $ in this.NodeTooltips){const Z=this.NodeTooltips[$];if(Z===void 0)continue;Z.destroy({children:!0,texture:!0,baseTexture:!0}),delete this.NodeTooltips[$]}}}var YV=t$(WV(),1);class lJ{encodeURL($){const Z=$.getStartClass(),J=$.getAscendancyClass(),Q=$.getSkilledNodes(),K=[];K.push($.version>>24&255),K.push($.version>>16&255),K.push($.version>>8&255),K.push($.version>>0&255),K.push(Z),K.push(J),K.push($.fullscreen);const q=new Array;for(let V in Q)q.push(Q[V]);q.sort((V,U)=>{return+(V.id||V.skill)-+(U.id||V.skill)});for(let V of q){if(V.classStartIndex!==void 0||V.isAscendancyStart)continue;K.push(+(V.id||V.skill)>>8&255),K.push(+(V.id||V.skill)&255)}return this.Uint8ArryToBase64(new Uint8Array(K))}decodeURL($,Z){const J={Version:4,Class:0,Ascendancy:0,Fullscreen:0,Nodes:new Array},Q=this.Base64ToUint8Array($);if(J.Version=Q[0]<<24|Q[1]<<16|Q[2]<<8|Q[3],J.Class=Q[4],J.Ascendancy=Q[5],J.Version>3)J.Fullscreen=Q[6];for(let K=J.Version>3?7:6;K<Q.length;K+=2){const q=Q[K]<<8|Q[K+1],V=Z.nodes[q.toString()];if(V!==void 0)J.Nodes.push(V)}return J}Uint8ArryToBase64=($)=>{return btoa(Array.prototype.map.call($,(Z)=>String.fromCharCode(Z)).join("")).replace(/\+/gi,"-").replace(/\//gi,"_")};Base64ToUint8Array=($)=>{$=atob($.replace(/-/gi,"+").replace(/_/gi,"/"));const Z=new Uint8Array($.length);for(let J=0;J<$.length;J++)Z[J]=$.charCodeAt(J);return Z}}class nJ{dragStart;dragEnd;DRAG_THRESHOLD_SQUARED=25;LONG_PRESS_THRESHOLD=100;skillTreeData;skillTreeDataCompare;skillTreeCodec;constructor($,Z){this.skillTreeData=$,this.skillTreeDataCompare=Z,this.skillTreeCodec=new lJ,m.on("node","click",this.click),m.on("node","tap",this.click),m.on("node","mouseover",this.mouseover),m.on("node","mouseout",this.mouseout),m.on("node","touchstart",this.touchstart),m.on("node","touchend",this.touchend),m.on("node","touchcancel",this.touchend),this.dragStart=new g(0,0),this.dragEnd=new g(0,0),m.on("viewport","drag-start",(J)=>this.dragStart=JSON.parse(JSON.stringify(J))),m.on("viewport","drag-end",(J)=>this.dragEnd=JSON.parse(JSON.stringify(J))),m.on("viewport","mouseup",()=>setTimeout(()=>this.dragStart=JSON.parse(JSON.stringify(this.dragEnd)),250)),m.on("viewport","touchend",()=>setTimeout(()=>this.dragStart=JSON.parse(JSON.stringify(this.dragEnd)),250)),m.on("viewport","touchcancel",()=>setTimeout(()=>this.dragStart=JSON.parse(JSON.stringify(this.dragEnd)),250)),m.on("controls","class-change",this.changeStartClass),m.on("controls","ascendancy-class-change",this.changeAscendancyClass),m.on("controls","search-change",this.searchChange),m.on("skilltree","encode-url",this.encodeURL)}lastHash="";decodeURL=()=>{if(this.lastHash===window.location.hash)return;this.lastHash=window.location.hash;try{const $=window.location.hash.replace("#","");if($===null){window.location.hash="";return}const Z=this.skillTreeCodec.decodeURL($,this.skillTreeData);this.skillTreeData.version=Z.Version,this.skillTreeData.fullscreen=Z.Fullscreen,this.changeStartClass(Z.Class,!1),this.changeAscendancyClass(Z.Ascendancy,!1);for(let J of Z.Nodes)this.skillTreeData.addStateById(`${J.skill}`,P.Active);for(let J in this.skillTreeData.classStartNodes)if(this.skillTreeData.nodes[J].is(P.Active)){const Q=this.getRefundNodes(this.skillTreeData.nodes[J]);for(let K of Q)this.skillTreeData.removeState(K,P.Active)}this.encodeURL()}catch($){window.location.hash="",console.log($)}};encodeURL=()=>{m.fire("skilltree","active-nodes-update"),this.broadcastSkillCounts(),window.location.hash=`#${this.skillTreeCodec.encodeURL(this.skillTreeData)}`};broadcastSkillCounts=()=>{let $=this.skillTreeData.points.totalPoints;const Z=this.skillTreeData.points.ascendancyPoints;let J=0,Q=0;const K=this.skillTreeData.getNodes(P.Active);for(let q in K){const V=K[q];if(V.classStartIndex===void 0&&!V.isAscendancyStart){if(V.ascendancyName==="")J++;else Q++;$+=V.grantedPassivePoints}}m.fire("skilltree","normal-node-count",J),m.fire("skilltree","normal-node-count-maximum",$),m.fire("skilltree","ascendancy-node-count",Q),m.fire("skilltree","ascendancy-node-count-maximum",Z)};changeStartClass=($,Z=!0)=>{for(let J in this.skillTreeData.classStartNodes){const Q=this.skillTreeData.nodes[J];if(Q.classStartIndex===void 0)continue;if(Q.classStartIndex!==$){this.skillTreeData.removeState(Q,P.Active);continue}this.skillTreeData.addState(Q,P.Active),m.fire("skilltree","class-change",Q);for(let K of this.getRefundNodes(Q))this.skillTreeData.removeState(K,P.Active)}if(this.skillTreeData.clearState(P.Desired),this.changeAscendancyClass(0,!1),Z)this.encodeURL()};changeAscendancyClass=($,Z=!0)=>{if(this.skillTreeData.classes.length===0)return;const J=this.skillTreeData.classes[this.skillTreeData.getStartClass()].ascendancies;if(J===void 0)return;const Q=J[$],K=Q!==void 0?Q.name:void 0;for(let q in this.skillTreeData.ascedancyNodes){const V=this.skillTreeData.nodes[q];if(V.ascendancyName!==K){this.skillTreeData.removeState(V,P.Active);continue}if(V.isAscendancyStart)this.skillTreeData.addState(V,P.Active),m.fire("skilltree","ascendancy-class-change",V)}if(Z)this.encodeURL()};searchChange=($=void 0)=>{if(this.skillTreeData.clearState(P.Highlighted),$!==void 0&&$.length!==0){const Z=new RegExp($,"gi");for(let J in this.skillTreeData.nodes){const Q=this.skillTreeData.nodes[J];if(Q.isAscendancyStart||Q.classStartIndex!==void 0)continue;if(Q.name.match(Z)!==null||Q.stats.find((K)=>K.match(Z)!==null)!==void 0)this.skillTreeData.addState(Q,P.Highlighted)}}m.fire("skilltree","highlighted-nodes-update")};click=($)=>{if($.is(P.Compared))return;if((this.dragStart.x-this.dragEnd.x)*(this.dragStart.x-this.dragEnd.x)>this.DRAG_THRESHOLD_SQUARED||(this.dragStart.y-this.dragEnd.y)*(this.dragStart.y-this.dragEnd.y)>this.DRAG_THRESHOLD_SQUARED)return;if($.classStartIndex!==void 0||$.isAscendancyStart)return;const Z=Object.values(this.skillTreeData.getNodes(P.Active)).filter((q)=>q.classStartIndex===void 0&&q.ascendancyName==="");for(let q of Z)this.skillTreeData.removeState(q,P.Active);if($.is(P.Desired))this.skillTreeData.removeState($,P.Desired),this.skillTreeData.addState($,P.UnDesired);else if($.is(P.UnDesired))this.skillTreeData.removeState($,P.UnDesired);else if(!$.isMastery)this.skillTreeData.addState($,P.Desired);m.fire("skilltree","highlighted-nodes-update");const J=Object.values(this.skillTreeData.getNodes(P.Active)).filter((q)=>q.classStartIndex!==void 0)[0].out.filter((q)=>this.skillTreeData.nodes[q].isAscendancyStart===!1).map((q)=>this.skillTreeData.nodes[q]);let Q=Object.values(this.skillTreeData.getNodes(P.Desired)).sort((q,V)=>{let U=100,H=100;for(let z of J){const W=z.GetId(),Y=q.GetId(),w=V.GetId(),j=Y<W?Y:W,C=Y<W?W:Y,X=w<W?w:W,G=w<W?W:w,F=this.skillTreeData.nodes[j].distance[C],L=this.skillTreeData.nodes[X].distance[G];if(F===void 0||L===void 0)return-1;U=F<U?F:U,H=L<H?L:H}if(U<H)return-1;if(U>H)return 1;return 0});const K=Q[0];if(K!==void 0){if(Q.length===1&&!J.includes(Q[0])){const V=Q[0].GetId();let U,H=1000;for(let z of J){const W=z.GetId(),Y=V<W?V:W,w=V<W?W:V,j=this.skillTreeData.nodes[Y].distance[w];if(j<H)U=z,H=j}if(U===void 0)U=this.getShortestPath(K,!1)[0];if(!U.is(P.Active))this.skillTreeData.addState(U,P.Active)}let q=0;while(Q.length>0){if(++q>50){console.log("Breaking due to desiredNodes not going down",Q.length);break}const V=[];for(let z of Q){const W=z.GetId(),Y=this.getShortestPath(z,!0);V.push({id:W,path:Y})}if(V.length==0)break;V.sort((z,W)=>z.path.length-W.path.length);const U=V.shift();if(U===void 0)return;const H=this.skillTreeData.nodes[U.id];if(U.path.length>0||H.is(P.Active)){if(!H.is(P.Active))this.skillTreeData.addState(H,P.Active);for(let z of U.path)if(!z.is(P.Active))this.skillTreeData.addState(z,P.Active);Q=Q.filter((z)=>!z.is(P.Active))}}}this.skillTreeData.clearState(P.Hovered),this.skillTreeData.clearState(P.Pathing),this.skillTreeDataCompare?.clearState(P.Hovered),this.encodeURL()};touchTimeout=null;touchstart=($)=>{this.touchTimeout=setTimeout(()=>this.dragEnd.x=this.dragStart.x+this.DRAG_THRESHOLD_SQUARED*this.DRAG_THRESHOLD_SQUARED,this.LONG_PRESS_THRESHOLD),this.mouseover($)};touchend=($)=>{if(this.touchTimeout!==null)clearTimeout(this.touchTimeout);this.mouseout($)};mouseover=($)=>{if(this.skillTreeData.clearState(P.Hovered),this.skillTreeData.clearState(P.Pathing),this.skillTreeDataCompare?.clearState(P.Hovered),$.classStartIndex===void 0){if($.is(P.Compared))this.skillTreeDataCompare?.addState($,P.Hovered);else if(this.skillTreeData.addState($,P.Hovered),this.skillTreeData.tree==="Atlas"&&$.isMastery)for(let J in this.skillTreeData.nodes){const Q=this.skillTreeData.nodes[J];if(!Q.isMastery)continue;if(Q.name!==$.name)continue;this.skillTreeData.addState(Q,P.Hovered)}}const Z=this.getShortestPath($,!1);for(let J of Z)if(!J.is(P.Pathing)&&!J.is(P.Active))this.skillTreeData.addState(J,P.Pathing);if($.hoverText=Z.length.toString(),Z.length>0||$.is(P.Active)){const J=this.getRefundNodes($);for(let Q of J)this.skillTreeData.addState(Q,P.Pathing);if(J.length>0)$.hoverText=J.length.toString()}m.fire("skilltree","hovered-nodes-start",$)};mouseout=($)=>{this.skillTreeData.clearState(P.Hovered),this.skillTreeData.clearState(P.Pathing),this.skillTreeDataCompare?.clearState(P.Hovered),m.fire("skilltree","hovered-nodes-end",$)};getShortestPath=($,Z)=>{if(Z=Z&&$.id==="5616",$.is(P.Active)){if(Z)console.log("Early return 1");return new Array}if($.isBlighted){if(Z)console.log("Early return 2");return new Array($)}let J=$;const Q=Object.values(this.skillTreeData.getNodes(P.Active)).filter((Y)=>Y.classStartIndex!==void 0)[0].out.filter((Y)=>this.skillTreeData.nodes[Y].isAscendancyStart===!1).map((Y)=>this.skillTreeData.nodes[Y]),K=[],q={},V=this.getAdjacentNodes([$.GetId()]);for(let Y in V){const w=V[Y];if(w.isAscendancyStart&&!w.is(P.Active))continue;if(w.is(P.UnDesired))continue;K.push(V[Y]),q[Y]=1}if(Z)console.log(Q);const U={};U[$.GetId()]=$;const H={};while(K.length>0){const Y=K.shift();if(Y===void 0){if(Z)console.log("Early return 3");break}if(Z)console.log("Current frontier ID",Y.GetId());U[Y.GetId()]=Y;const w=q[Y.GetId()];let j=0;for(let C of Y.out){if(++j>20)break;if(Z)console.log("Current out ID",C);const X=this.skillTreeData.nodes[C];if(Y.ascendancyName===""&&X.ascendancyName!==""&&!X.is(P.Active)||Y.ascendancyName!==""&&X.ascendancyName===""&&!Y.is(P.Active))continue;if(U[C]||q[C])continue;if(X.isAscendancyStart&&!X.is(P.Active))continue;if(X.is(P.UnDesired))continue;if(Z)console.log("Adding out node to frontier");if(q[C]=w+1,H[C]=Y,K.push(X),Z)console.log("New frontier",K.map((G)=>G.GetId()));if(Z)console.log("Is out active?",X.is(P.Active));if(X.is(P.Active)||Q.map((G)=>G.id).includes(X.id)){K.length=0,J=X;break}}}if(Z)console.log("Found node",J,J===$,q[J.GetId()]);if(J===$||q[J.GetId()]===void 0)return new Array;let z=J;const W=new Array;while(z!==void 0)W.push(z),z=H[z.GetId()];return W.reverse()};getRefundNodes=($)=>{let Z=void 0;for(let V in this.skillTreeData.classStartNodes){const U=this.skillTreeData.nodes[V];if(U.is(P.Active)&&U.classStartIndex!==void 0)Z=U}if(Z===void 0)return new Array;let J=new Array;const Q={};for(let V of Z.out){const U=this.skillTreeData.nodes[V];if(U.ascendancyName!==""&&$.ascendancyName!==""&&U.ascendancyName!==$.ascendancyName)continue;if(U.is(P.Active)&&U.GetId()!==$.GetId())J.push(U),Q[V]=U}while(J.length>0){const V=new Array;for(let U of J)for(let H of U.out){const z=this.skillTreeData.nodes[H];if(z.isMultipleChoiceOption&&$.isMultipleChoiceOption){const W=z.in.find((Y)=>this.skillTreeData.nodes[Y].isMultipleChoice);if(W!==void 0&&W===$.in.find((Y)=>this.skillTreeData.nodes[Y].isMultipleChoice))continue}if(z.ascendancyName!==""&&$.ascendancyName!==""&&z.ascendancyName!==$.ascendancyName)continue;if(z.GetId()===$.GetId()||Q[H]||!z.is(P.Active))continue;V.push(z),Q[H]=z}J=V}const K=new Array,q=this.skillTreeData.getSkilledNodes();for(let V in q)if(this.skillTreeData.nodes[V].classStartIndex===void 0)K.push(this.skillTreeData.nodes[V]);return K};getAdjacentNodes=($)=>{const Z={};for(let J of $)for(let Q of this.skillTreeData.nodes[J].out){const K=this.skillTreeData.nodes[Q];if(K.classStartIndex!==void 0&&!K.is(P.Active))continue;Z[Q]=K}return Z}}class oJ{CanProcess($){return $.circles===void 0}Process($){let Z=$;return Z.realm="pc",Z.circles={Small:[{level:0.1246,width:199},{level:0.2109,width:337},{level:0.2972,width:476},{level:0.3835,width:614}],Medium:[{level:0.1246,width:299},{level:0.2109,width:506},{level:0.2972,width:713},{level:0.3835,width:920}],Large:[{level:0.1246,width:374},{level:0.2109,width:633},{level:0.2972,width:892},{level:0.3835,width:1151}]},Z}}class sJ{CanProcess($,Z){return Z!==void 0}Process($,Z){if(Z===void 0)return $;if($.classes===void 0)$.classes=[];for(let J in Z.ascClasses){const Q=Z.ascClasses[J],K=$.classes[+J]||{};K.name=K.name||Q.name;for(let q in Q.classes){const V=Q.classes[q];K.ascendancies[+q-1]={flavourText:V.flavourText,flavourTextColour:V.flavourTextColour,flavourTextRect:this.UpgradeFlavourTextRect(V.flavourTextRect),id:V.displayName,name:V.name}}$.classes[+J]=K}return $}UpgradeFlavourTextRect($){const Z=$.split(",");return{x:+Z[0],y:+Z[1],width:+Z[2],height:+Z[3]}}}class iJ{CanProcess($){return!0}Process($){$.nodes.root.in=$.nodes.root.in||[],$.nodes.root.out=$.nodes.root.out||[];const Z={};for(let K in $.nodes)Z[K.toString()]=this.FixNode(K,$.nodes[K]);for(let K in Z){if(K==="root")continue;for(let q of Z[K].out){if(q==="root")continue;if(Z[K].in.indexOf(q)<0)Z[K].in.push(q);if(!Z[q].isMastery&&Z[q].out.indexOf(K)<0)Z[q].out.push(K)}for(let q of Z[K].in){if(q==="root")continue;if(!Z[K].isMastery&&Z[K].out.indexOf(q)<0)Z[K].out.push(q);if(Z[q].in.indexOf(K)<0)Z[q].in.push(K)}}$.nodes=Z;for(var J in $.sprites)for(var Q in $.sprites[J])$.sprites[J][Q].filename=$.sprites[J][Q].filename.replace("https://web.poecdn.com/image/passive-skill/","");for(let K in $.groups){const q=$.groups[K];$.groups[K].nodes=(q.nodes||[]).map((V)=>V.toString()),$.groups[K].orbits=q.orbits||[]}return $}FixNode($,Z){return Z.in=(Z.in||[]).map((J)=>J.toString())||[],Z.out=(Z.out||[]).map((J)=>J.toString())||[],Z.in=Z.in.filter((J)=>J!==$),Z.out=Z.out.filter((J)=>J!==$),Z}}class aJ{CanProcess($){return $.assets!==void 0}Process($){const Z=JSON.parse(JSON.stringify($)),J={},Q=this.UpgradeSpriteSheets($);for(let q in Q){J[q]={};const V=Q[q];for(let U in V)J[q][U]=Q[q][U]}const K=this.UpgradeAssets($);for(let q in K){J[q]={};const V=K[q];for(let U in V)J[q][U]=K[q][U]}return Z.sprites=J,delete Z.assets,delete Z.skillSprites,Z}UpgradeSpriteSheets($){const Z={};for(let Q in $.skillSprites){const K=$.skillSprites[Q];for(let q in $.imageZoomLevels){const V=$.imageZoomLevels[q].toString(),U=K[q];if(U===void 0)continue;const H=Z[`${U.filename}-${V}`]||{w:0,h:0};Z[`${U.filename}-${V}`]=this.CalculateWidthAndHeight(H,U)}}const J={};for(let Q in $.skillSprites){J[Q]={};const K=$.skillSprites[Q];for(let q in $.imageZoomLevels){const V=$.imageZoomLevels[q].toString(),U=K[q];if(U===void 0)continue;J[Q][V]=this.UpgradeSpriteSheet(U,Z[`${U.filename}-${V}`])}}return J}UpgradeSpriteSheet($,Z){const J=$;return J.w=Z.w,J.h=Z.h,J}CalculateWidthAndHeight($,Z){let{w:J,h:Q}=$;for(let K in Z.coords){const q=Z.coords[K];J=Math.max(J,q.x+q.w),Q=Math.max(Q,q.y+q.h)}return{w:J,h:Q}}UpgradeAssets($){const Z={};for(let J in $.assets){const Q=this.MapAssetToGroup(J);if(Q===null)continue;if(Z[Q]===void 0)Z[Q]={};for(let K in $.assets[J]){if(Z[Q][K]===void 0)Z[Q][K]={filename:"LOAD_COORDS",h:-1,w:-1,coords:{}};Z[Q][K].coords[J]={x:0,y:0,h:-1,w:-1}}}return Z}MapAssetToGroup($){if($=$.startsWith("PassiveSkillScreen")?$.replace("PassiveSkillScreen",""):$,$==="Background2"||$==="Background1")return"background";if($==="PassiveMasteryConnectedButton")return"masteryActiveSelected";if($.startsWith("Classes"))return"ascendancyBackground";if($.startsWith("Ascendancy"))return"ascendancy";if($.startsWith("Background")||$.startsWith("center")||$==="PSStartNodeBackgroundInactive")return"startNode";if($.startsWith("PSGroupBackground")||$.startsWith("GroupBackground"))return"groupBackground";if($.indexOf("Frame")>=0||$.startsWith("JewelSocketClusterAlt")||$.startsWith("JewelSocketAlt"))return"frame";if($.startsWith("JewelSocket"))return"jewel";if($.startsWith("LineConnector")||$.startsWith("Orbit")||$.startsWith("PSLineDeco"))return"line";if($.indexOf("JewelCircle")>=0)return"jewelRadius";if($==="AtlasPassiveSkillScreenStart")return"startNode";if($==="AtlasPassiveBackground")return"atlasBackground";if($==="PSStartNodeBackgroundActive")return null;if($.startsWith("imgPSFade"))return null;if($.endsWith("Oil"))return null;throw new Error(`Unhandled Asset: ${$}`)}}class rJ{CanProcess($){for(let Z in $.groups)if($.groups[Z].background)return!1;return!0}Process($){const Z=JSON.parse(JSON.stringify($)),J=this.UpgradeGroups($);return Z.groups=J,delete Z.uiArtOptions,Z}UpgradeGroups($){var Z={};for(let J in $.groups){const Q=$.groups[J],K=Q.nodes||[];if(K.length===0||K.find((U)=>$.nodes[U].ascendancyName!==void 0)!==void 0){Z[J]=this.CopyGroup(Q);continue}let q=Q.orbits||[];q=q.filter((U)=>U<=3);const V=Q.backgroundOverride!==void 0&&Q.backgroundOverride!==0?Q.backgroundOverride:Math.max(...q);if(V<=0||V>3){Z[J]=this.CopyGroup(Q);continue}Z[J]=this.UpgradeGroup(Q,V,$.uiArtOptions==void 0?!0:$.uiArtOptions.largeGroupUsesHalfImage)}return Z}CopyGroup($){return{x:$.x,y:$.y,isProxy:$.isProxy,orbits:$.orbits,nodes:$.nodes,background:void 0}}UpgradeGroup($,Z,J){var Q=this.CopyGroup($);return Q.background={image:this.MapBackground(Z),isHalfImage:Z===3&&J?!0:void 0,offsetX:void 0,offsetY:void 0},Q}MapBackground($){switch($){case 1:return"PSGroupBackground1";case 2:return"PSGroupBackground2";case 3:return"PSGroupBackground3";default:throw new Error(`Unhandled BackgroundKey: ${$}`)}}}class tJ{CanProcess($){return $.tree==="Atlas"&&$.sprites.wormholeInactive===void 0}Process($){return JSON.parse(JSON.stringify($))}}class eJ{CanProcess($){return $.root!==void 0&&$.root.g!==void 0&&Array.isArray($.nodes)&&Object.keys($.skillSprites).length===2&&$.skillSprites.active!==void 0&&$.skillSprites.inactive!==void 0}Process($){var Z=JSON.parse(JSON.stringify($));for(let J in $.skillSprites){const Q=$.skillSprites[J];if(!(J==="active"||J==="inactive"))continue;const K=J.charAt(0).toUpperCase()+J.slice(1),q={};q[`notable${K}`]=[],q[`keystone${K}`]=[],q[`normal${K}`]=[];for(let V of Q){const U=V.notableCoords===void 0?V.coords:V.notableCoords,H=V.notableCoords===void 0?V.coords:V.notableCoords,z=V.coords;q[`notable${K}`].push({filename:V.filename,coords:U}),q[`keystone${K}`].push({filename:V.filename,coords:H}),q[`normal${K}`].push({filename:V.filename,coords:z})}for(let V in q)Z.skillSprites[V]=q[V]}return Z}}class $Q{CanProcess($){if(!($.root!==void 0&&$.root.g!==void 0&&Array.isArray($.nodes)&&Object.keys($.skillSprites).length>=6))return!1;for(var J in $.nodes){const Q=$.nodes[J];if(Q.ascendancyName!==void 0&&Q.ascendancyName!=="")return!1}return!0}Process($){var Z=JSON.parse(JSON.stringify($)),J=[];for(let Q of $.nodes)J.push(this.UpgradeNode(Q));return Z.nodes=J,Z}UpgradeNode($){var Z=$;return Z.isJewelSocket=!1,Z.isMultipleChoice=!1,Z.isMultipleChoiceOption=!1,Z.passivePointsGranted=0,Z.ascendancyName="",Z.isAscendancyStart=!1,Z.flavourText=[],Z.reminderText=[],Z}}class ZQ{CanProcess($){return $.extraImages===void 0}Process($){var Z=JSON.parse(JSON.stringify($));return Z.extraImages={},Z}}class JQ{CanProcess($){return Array.isArray($.nodes)}Process($){var Z=JSON.parse(JSON.stringify($));const J={};for(let Q of $.nodes)J[Q.id.toString()]=this.UpgradeNode(Q);return Z.nodes=J,Z}UpgradeNode($){var Z=$;if(Z.out===void 0)Z.out=[];if(Z.in===void 0)Z.in=[];return Z}}class QQ{CanProcess($){for(var Z in $.nodes)if($.nodes[Z].isBlighted===void 0)return!0;return!1}Process($){var Z=JSON.parse(JSON.stringify($));const J={};for(let Q in $.nodes)J[Q.toString()]=this.UpgradeNode($.nodes[Q]);return Z.nodes=J,Z}UpgradeNode($){var Z=$;return Z.isBlighted=!1,Z}}class KQ{CanProcess($){return $.root!==void 0}Process($){var Z={assets:$.assets||{},classes:[],constants:$.constants||{},extraImages:$.extraImages||{},groups:{},imageZoomLevels:$.imageZoomLevels||[],jewelSlots:[],max_x:$.max_x,max_y:$.max_y,min_x:$.min_x,min_y:$.min_y,nodes:{},skillSprites:$.skillSprites||{}};for(let K in $.characterData){const q=$.characterData[K],V=this.ClassIdToName(+K);if(V===null)continue;Z.classes[+K]={ascendancies:[],base_dex:q.base_dex,base_int:q.base_int,base_str:q.base_str,name:V}}const J={};for(let K in $.nodes)J[K.toString()]=this.UpgradeNode($.nodes[K]);J.root=this.UpgradeNode($.root),Z.nodes=J;const Q={};for(let K in $.groups)Q[K.toString()]=this.UpgradeGroup($.groups[K]);return Z.groups=Q,Z}UpgradeNode($){return{ascendancyName:$.ascendancyName||"",classStartIndex:$.spc&&$.spc.length>0?$.spc[0]:void 0,expansionJewel:void 0,flavourText:$.flavourText||[],grantedDexterity:$.da||0,grantedIntelligence:$.ia||0,grantedPassivePoints:$.passivePointsGranted||0,grantedStrength:$.sa||0,group:$.g,icon:$.icon,in:($.in||[]).map((Z)=>Z.toString())||[],isAscendancyStart:$.isAscendancyStart||!1,isBlighted:$.isBlighted||!1,isJewelSocket:$.isJewelSocket||!1,isKeystone:$.ks||!1,isMastery:$.m||!1,isMultipleChoice:$.isMultipleChoice||!1,isMultipleChoiceOption:$.isMultipleChoiceOption||!1,isNotable:$.not||!1,isProxy:!1,name:$.dn||"",orbit:$.o||0,orbitIndex:$.oidx||0,out:($.out||[]).map((Z)=>Z.toString())||[],recipe:[],reminderText:$.reminderText||[],skill:+$.id||-1,stats:$.sd||[]}}UpgradeGroup($){var Z=[];if(Array.isArray($.oo))$.oo={"0":$.oo[0]};for(let J in $.oo)Z.push(+J);return{isProxy:!1,nodes:($.n||[]).map((J)=>J.toString()),orbits:Z,x:$.x,y:$.y}}ClassIdToName($){switch($){case 0:return"Scion";case 1:return"Marauder";case 2:return"Ranger";case 3:return"Witch";case 4:return"Duelist";case 5:return"Templar";case 6:return"Shadow";default:return null}}}class qQ{CanProcess($){return $.tree===void 0}Process($){var Z=$;return Z.tree="Default",Z}}class VQ{CanProcess($){for(var Z in $.nodes)if($.nodes[Z].activeEffectImage!==void 0)return!1;return!0}Process($){var Z=$;const J={};for(let Q in $.nodes)J[Q.toString()]=this.UpgradeNode($.nodes[Q]);return Z.nodes=J,Z}UpgradeNode($){var Z=$;return Z.activeEffectImage=void 0,Z.activeIcon=void 0,Z.inactiveIcon=void 0,Z.masteryEffects=void 0,Z}}class UQ{CanProcess($){return $.points===void 0}Process($){var Z=$;return Z.points={totalPoints:121,ascendancyPoints:8},Z}}class HQ{static _preprocessors=[new eJ,new $Q,new ZQ,new JQ,new QQ,new KQ,new qQ,new VQ,new UQ,new aJ,new rJ,new tJ,new sJ,new iJ];static _optionsPreprocessors=[new oJ];static Decode($,Z){if(Z!==void 0){for(let J of this._optionsPreprocessors)if(J.CanProcess(Z))Z=J.Process(Z)}for(let J of this._preprocessors)if(J.CanProcess($,Z))$=J.Process($,Z);return $}}var wV=t$(w5(),1);class b6{skillTreeData;skillTreeDataCompare;skillTreeUtilities;renderer;launch=async($,Z,J)=>{for(let w of[$,Z]){if(w==="")continue;let j=void 0;const C=new wV.SemVer(w);if(C.compare(P7.v2_2_0)>=0&&C.compare(P7.v3_9_0)<=0)j=await fetch(`${I0.SKILL_TREES_URI}/${w}/Opts.json`).then((L)=>L.status===200?L.json():void 0);var Q=await fetch(`${I0.SKILL_TREES_URI}/${w}/SkillTree.json`).then((L)=>L.json()),K=Q;let X=Object.values(Q.nodes).filter((L)=>L.ascendancyName===void 0&&L.group!==0&&(L.isNotable===!0||L.isKeystone===!0)&&(L.out!==void 0&&L.out.length>0||L.in!==void 0&&L.in.length>0)).map((L)=>Number(L.skill));for(let L of Q.nodes.root.out){let N=[];N.push(...Q.nodes[L].out),N.push(...Q.nodes[L].in);for(let B of N)if(Q.nodes[B].isAscendancyStart===void 0)X.push(Number(B))}const G=X,F=new ZZ(HQ.Decode(K,j),C);if(w===$)this.skillTreeData=F;if(w===Z)this.skillTreeDataCompare=F}this.skillTreeUtilities=new nJ(this.skillTreeData,this.skillTreeDataCompare);const q=document.getElementById("skillTreeControl_Version"),V=document.getElementById("skillTreeControl_VersionCompare");for(let w of J.versions){const j=document.createElement("option");if(j.text=j.value=w,w===$)j.setAttribute("selected","selected");q.appendChild(j);const C=document.createElement("option");if(C.text=C.value=w,w===Z)C.setAttribute("selected","selected");V.appendChild(C)}const U=document.getElementsByClassName("skillTreeVersions");for(let w in U)if(U[w].style!==void 0)U[w].style.removeProperty("display");document.getElementById("skillTreeControl_VersionGo").addEventListener("click",()=>{const w=q.value!=="0"?q.value:"",j=V.value!=="0"?V.value:"";b6.ChangeSkillTreeVersion(w,j,"")}),document.getElementById("skillTreeControl_Reset").addEventListener("click",()=>{const w=this.skillTreeData.getStartClass(),j=this.skillTreeData.getAscendancyClass();this.skillTreeData.clearState(P.Active),this.skillTreeData.clearState(P.Desired),m.fire("controls","class-change",w),m.fire("controls","ascendancy-class-change",j)});const W=document.getElementById("skillTreeStats_ShowHide");W.addEventListener("click",()=>{const w=document.getElementById("skillTreeStats_Content"),j=document.getElementById("skillTreeStats");if(w.toggleAttribute("hidden"))j.style.setProperty("height","fit-content"),W.innerText="Show";else j.style.setProperty("height","80%"),W.innerText="Hide"});const Y=document.getElementById("skillTreeContainer");if(Y!==null)this.renderer=new uJ(Y,this.skillTreeData,this.skillTreeDataCompare),this.renderer.Initialize().then(()=>{this.SetupEventsAndControls(),this.renderer.RenderBase(),this.skillTreeUtilities.decodeURL(),this.renderer.RenderCharacterStartsActive();const w=document.getElementById("skillTreeControl_Screenshot");w.style.removeProperty("display"),w.addEventListener("click",()=>{YV.default(this.renderer.CreateScreenshot("image/jpeg"),`${$.replace(/\./g,"")}_skilltree.jpg`,"image/jpeg")})}).catch((w)=>console.error(w))};PreGenerateShortestDistances=($,Z,J)=>{const Q=$.nodes;for(let U in Q)$.nodes[U].distance={};let K=0;for(let U of Z){if(Q[U].ascendancyName!==void 0)continue;if(U==="root")continue;if(Q[U].out===void 0&&Q[U].in===void 0)continue;let H={};H[U]=0;const z=[Q[U]],W={};while(z.length>0){const Y=z.shift();if(Y===void 0)continue;W[Y.skill]=Y;const w=H[Y.skill];let j=[];j.push(...Y.out),j.push(...Y.in);for(let C of j){const X=Q[C];if(X.ascendancyName!==""&&X.ascendancyName!==void 0)continue;if(W[C]||H[C])continue;if(J.includes(Number(C))){let G=U,F=C;if(C<U)G=C,F=U;$.nodes[G].distance[F]=w+1}K++,H[C]=w+1,z.push(X)}}}console.log("Distances from 6 to 31628 are ",$.nodes[6].distance[31628]),console.log("Total frontier checks: "+K);var q=document.createElement("a"),V=new Blob([JSON.stringify($,null,4)],{type:"text/plain"});q.href=URL.createObjectURL(V),q.download="UpdatedTree.json",q.click()};SetupEventsAndControls=()=>{m.on("skilltree","highlighted-nodes-update",this.renderer.RenderHighlight),m.on("skilltree","class-change",this.renderer.RenderCharacterStartsActive),m.on("skilltree","hovered-nodes-start",this.renderer.StartRenderHover),m.on("skilltree","hovered-nodes-end",this.renderer.StopRenderHover),m.on("skilltree","active-nodes-update",this.renderer.RenderActive),m.on("skilltree","active-nodes-update",this.updateStats),m.on("skilltree","normal-node-count",(J)=>{const Q=document.getElementById("skillTreeNormalNodeCount");if(Q!==null)Q.innerHTML=J.toString()}),m.on("skilltree","normal-node-count-maximum",(J)=>{const Q=document.getElementById("skillTreeNormalNodeCountMaximum");if(Q!==null)Q.innerHTML=J.toString()}),m.on("skilltree","ascendancy-node-count",(J)=>{const Q=document.getElementById("skillTreeAscendancyNodeCount");if(Q!==null)Q.innerHTML=J.toString()}),m.on("skilltree","ascendancy-node-count-maximum",(J)=>{const Q=document.getElementById("skillTreeAscendancyNodeCountMaximum");if(Q!==null)Q.innerHTML=J.toString()}),this.populateStartClasses(document.getElementById("skillTreeControl_Class")),this.bindSearchBox(document.getElementById("skillTreeControl_Search"));const $=document.getElementsByClassName("skillTreeControls");for(let J in $)if($[J].style!==void 0)$[J].style.removeProperty("display");const Z=document.getElementsByClassName("skillTreePoints");for(let J in Z)if(Z[J].style!==void 0)Z[J].style.removeProperty("display")};updateStats=()=>{const $=this.skillTreeData.tree==="Atlas"?"Maps":"Default",Z=["The Maven"],J={};for(let z in this.skillTreeData.nodes){const W=this.skillTreeData.nodes[z],Y=this.skillTreeData.getMasteryForGroup(W.nodeGroup);if(Y!==null&&Y.name!==$)Z.push(Y.name),J[Y.name]=Y.name.replace("The","").replace("Mastery","")}const Q={};for(let z in this.skillTreeData.nodes){const W=this.skillTreeData.nodes[z];for(let Y of W.stats){if(Q[Y]!==void 0)continue;if(this.skillTreeData.getMasteryForGroup(W.nodeGroup)===null){let j=!1;for(let C of Z)if(Y.indexOf(J[C])>=0){j=!0;break}if(!j)Q[Y]=!0}}}const K={},q={},V={},U=this.skillTreeData.getSkilledNodes();for(let z in U){const W=U[z];for(let Y of W.stats){if(V[Y]===void 0)V[Y]=1;else V[Y]=V[Y]+1;if(q[Y]!==void 0){const j=q[Y];if(K[j].indexOf(Y)===-1)K[j].push(Y);continue}if(Q[Y]){if(K[$]===void 0)K[$]=[];if(K[$].indexOf(Y)===-1)q[Y]=$,K[$].push(Y);continue}const w=this.skillTreeData.getMasteryForGroup(W.nodeGroup);if(w!==null){if(K[w.name]===void 0)K[w.name]=[];if(K[w.name].indexOf(Y)===-1)q[Y]=w.name,K[w.name].push(Y)}else{let j=$;for(let C of Z)if(Y.indexOf(J[C])>=0){j=C;break}if(K[j]===void 0)K[j]=[];if(K[j].indexOf(Y)===-1)q[Y]=j,K[j].push(Y)}}}const H=document.getElementById("skillTreeStats_Content");while(H.firstChild)H.removeChild(H.firstChild);for(let z of Object.keys(K).sort((W,Y)=>W===$?-1:Y===$?1:W<Y?-1:1)){const W={};for(let w of K[z])W[w]=V[w];const Y=this.createStatGroup(z,W);H.appendChild(Y)}};createStatGroup=($,Z)=>{const J=document.createElement("div");J.className="group";const Q=document.createElement("span");Q.className="title",Q.innerText=$,Q.addEventListener("click",()=>{document.querySelectorAll(`[data-group-name*="${$}"]`).forEach((q)=>{q.toggleAttribute("hidden")})}),J.appendChild(Q);for(let K of Object.keys(Z).sort()){const q=Z[K];J.appendChild(this.createStat($,`${q}x ${K}`))}return J};createStat=($,Z)=>{const J=document.createElement("div");return J.className="stat",J.innerText=Z,J.setAttribute("data-group-name",$),J};populateStartClasses=($)=>{while($.firstChild)$.removeChild($.firstChild);const Z=new Array;for(let Q in this.skillTreeData.classStartNodes){const K=this.skillTreeData.nodes[Q].classStartIndex;if(K===void 0)continue;const q=document.createElement("option");if(q.text=this.skillTreeData.root.out.length===1?"Atlas":this.skillTreeData.constants.classIdToName[K],q.value=K.toString(),K===this.skillTreeData.getStartClass())q.setAttribute("selected","selected");Z.push(q)}Z.sort((Q,K)=>{const q=Q.value,V=K.value;if(q!==null&&V!==null)return+q-+V;return 0});for(let Q of Z)$.append(Q);const J=document.getElementById("skillTreeControl_Ascendancy");if(m.fire("controls","class-change",+$.value),$.onchange=()=>{const Q=$.value;if(m.fire("controls","class-change",+Q),J!==null)this.populateAscendancyClasses(J,+Q,0)},J!==null)this.populateAscendancyClasses(J)};populateAscendancyClasses=($,Z=void 0,J=void 0)=>{while($.firstChild)$.removeChild($.firstChild);if(this.skillTreeData.classes.length===0){$.style.display="none";const V=document.getElementById("skillTreeAscendancy");if(V!==null)V.style.display="none";return}const Q=J!==void 0?J:this.skillTreeData.getAscendancyClass(),K=document.createElement("option");if(K.text="None",K.value="0",Q===0)K.setAttribute("selected","selected");$.append(K);const q=Z!==void 0?Z:this.skillTreeData.getStartClass();if(this.skillTreeData.classes.length>0){const V=this.skillTreeData.classes[q].ascendancies;for(let U in V){const H=V[U],z=document.createElement("option");if(z.text=H.name,z.value=U,+U===Q)z.setAttribute("selected","selected");$.append(z)}}$.onchange=()=>{m.fire("controls","ascendancy-class-change",+$.value)}};searchTimout=null;bindSearchBox=($)=>{$.onkeyup=()=>{if(this.searchTimout!==null)clearTimeout(this.searchTimout);this.searchTimout=setTimeout(()=>{m.fire("controls","search-change",$.value),this.searchTimout=null},250)}};static decodeURLParams=($="")=>{return $.slice($.indexOf("?")+1).split("&").reduce((J,Q)=>{const K=Q.indexOf("=");if(K<0)return Object.assign(J,{[Q]:null});const q=Q.slice(0,K),V=Q.slice(K+1);return Object.assign(J,{[q]:decodeURIComponent(V)})},{})};static ChangeSkillTreeVersion=($,Z,J)=>{let Q="?";if($!=="")Q+=`v=${$}`;if(!Q.endsWith("?")&&Z!=="")Q+="&";if(Z!=="")Q+=`c=${Z}`;if(window.location.hash!==J)window.location.hash=J;if(window.location.search!==Q)window.location.search=Q}}window.onload=async()=>{const $=b6.decodeURLParams(window.location.search),Z={versions:[]},J=Object.fromEntries(Object.entries(P7));for(let Q in J){const K=J[Q];if(!(K instanceof jV.SemVer))continue;Z.versions.push(K.version)}if(Z.versions.indexOf($.v)===-1)$.v=Z.versions[Z.versions.length-1];if(!$.c)$.c="";b6.ChangeSkillTreeVersion($.v,$.c,window.location.hash),new b6().launch($.v,$.c,Z)};
